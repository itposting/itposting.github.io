<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Docker로 Redis 클러스터 설정하는 방법 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-23-RedisClusterusingDocker" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Docker로 Redis 클러스터 설정하는 방법 | itposting" data-gatsby-head="true"/><meta property="og:title" content="Docker로 Redis 클러스터 설정하는 방법 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-RedisClusterusingDocker_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-23-RedisClusterusingDocker" data-gatsby-head="true"/><meta name="twitter:title" content="Docker로 Redis 클러스터 설정하는 방법 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-RedisClusterusingDocker_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 15:44" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_buildManifest.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Docker로 Redis 클러스터 설정하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Docker로 Redis 클러스터 설정하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">6<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-RedisClusterusingDocker&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-06-23-RedisClusterusingDocker_0.png" alt="이미지"></p>
<p>우리는 특히 윈도우에서 도커를 사용하여 Redis 클러스터를 만드는 방법에 대해 이야기할 것입니다.</p>
<p>6개 노드(3개 마스터 + 3개 레플리카)로 Redis 클러스터를 생성할 것이며, Redis가 어떤 노드가 마스터인지 레플리카인지를 결정할 것입니다.</p>
<p>자세한 내용에 대해 파고들기 전에 몇 가지 제약사항을 알아야 합니다;</p>
<div class="content-ad"></div>
<ul>
<li>Redis Cluster 및 Docker</li>
</ul>
<ol start="2">
<li>Docker 호스트 네트워크 드라이버</li>
</ol>
<p>Windows에서 이러한 제한 사항을 고려할 때, 모든 노드 앞에 TCP 프록시를 설정하여 클러스터를 구성할 수 있습니다. 노드로의 모든 통신은 TCP 프록시를 통해 이루어질 것입니다. 이 예시에서는 HAProxy를 선택했습니다.</p>
<p>이제 설정으로 넘어갈 수 있습니다. 3개의 파일이 준비되어 있습니다;</p>
<div class="content-ad"></div>
<ul>
<li>docker-compose.yaml</li>
<li>redis.sh</li>
<li>haproxy.cfg</li>
</ul>
<p>이 파일들을 가지고 명령어를 사용하여 모든 클러스터, 프록시 및 UI를 실행할 수 있어요;</p>
<pre><code class="hljs language-js">docker compose up
</code></pre>
<h1>docker-compose.yaml</h1>
<div class="content-ad"></div>
<pre><code class="hljs language-js">서비스 : 
  redis-node-<span class="hljs-number">1</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7001"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-node-<span class="hljs-number">2</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7002"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-node-<span class="hljs-number">3</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7003"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-node-<span class="hljs-number">4</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7004"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-node-<span class="hljs-number">5</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7005"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-node-<span class="hljs-number">6</span> : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : [<span class="hljs-string">"/tmp/redis.sh"</span>, <span class="hljs-string">"10.11.12.13"</span>, <span class="hljs-string">"7006"</span>]
    볼륨 : 
      - ./redis.<span class="hljs-property">sh</span>:<span class="hljs-regexp">/tmp/</span>redis.<span class="hljs-property">sh</span>
  redis-cluster-creator : 
    이미지 : <span class="hljs-attr">redis</span>:<span class="hljs-number">7.2</span><span class="hljs-number">.3</span>
    명령 : redis-cli -a <span class="hljs-string">'SUPER_SECRET_PASSWORD'</span> --cluster create <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7001</span> <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7002</span> <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7003</span> <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7004</span> <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7005</span> <span class="hljs-number">10.11</span><span class="hljs-number">.12</span><span class="hljs-number">.13</span>:<span class="hljs-number">7006</span> --cluster-replicas <span class="hljs-number">1</span> --cluster-yes
    depends_on : 
      - redis-node-<span class="hljs-number">1</span>
      - redis-node-<span class="hljs-number">2</span>
      - redis-node-<span class="hljs-number">3</span>
      - redis-node-<span class="hljs-number">4</span>
      - redis-node-<span class="hljs-number">5</span>
      - redis-node-<span class="hljs-number">6</span>
      - redis-proxy
  redis-proxy : 
    이미지 : haproxytech/haproxy-<span class="hljs-attr">alpine</span>:<span class="hljs-number">2.4</span>
    볼륨 : 
      - ./<span class="hljs-attr">haproxy</span>:<span class="hljs-regexp">/usr/</span>local/etc/<span class="hljs-attr">haproxy</span>:ro
    포트 : 
      - <span class="hljs-number">8404</span>:<span class="hljs-number">8404</span>
      - <span class="hljs-number">7001</span>-<span class="hljs-number">7006</span>:<span class="hljs-number">9001</span>-<span class="hljs-number">9006</span>
      - <span class="hljs-number">7101</span>-<span class="hljs-number">7106</span>:<span class="hljs-number">9101</span>-<span class="hljs-number">9106</span>
    depends_on : 
      - redis-node-<span class="hljs-number">1</span>
      - redis-node-<span class="hljs-number">2</span>
      - redis-node-<span class="hljs-number">3</span>
      - redis-node-<span class="hljs-number">4</span>
      - redis-node-<span class="hljs-number">5</span>
      - redis-node-<span class="hljs-number">6</span>
  redis-insight : 
    container_name : redis-insight
    이미지 : redislabs/<span class="hljs-attr">redisinsight</span>:<span class="hljs-number">1.14</span><span class="hljs-number">.0</span>
    포트 : 
      - <span class="hljs-number">8001</span>:<span class="hljs-number">8001</span>
    depends_on : 
      - redis-proxy
</code></pre>
<p>다음을 참고하세요:</p>
<ul>
<li>6개의 서버 노드</li>
<li>1개의 클러스터 생성 노드. 이 컨테이너의 상태는 클러스터 생성 후에 "중지"되어야 합니다. (원한다면 어떤 컨테이너로 들어가서 클러스터 명령을 실행할 수 있습니다.)</li>
<li>TCP 프록시</li>
<li>UI (Redis Insight)</li>
</ul>
<p>10.11.12.13은 로컬 머신의 IP입니다 (사실상 TCP 프록시의 IP). 이를 변경해주세요 (예를 들어 PC 이름으로 변경할 수 있습니다).</p>
<div class="content-ad"></div>
<h1>redis.sh</h1>
<p>각 노드마다 별도의 redis.conf 파일을 만드는 대신, 주어진 매개변수에 따라 redis.conf 파일을 생성하는 sh 파일을 만들었습니다. 이 파일을 사용하여 서버를 시작합니다. 이는 데모에 더 유연합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">ANNOUNCE_IP</span>=$1
<span class="hljs-variable constant_">ANNOUNCE_PORT</span>=$(expr $2)
<span class="hljs-variable constant_">ANNOUNCE_BUS_PORT</span>=$(expr $ANNOUNCE_PORT + <span class="hljs-number">100</span>)

<span class="hljs-variable constant_">CONF_FILE</span>=<span class="hljs-string">"/tmp/redis.conf"</span>

# redis.<span class="hljs-property">conf</span> 파일 생성
echo <span class="hljs-string">"port 6379
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
loglevel debug
requirepass SUPER_SECRET_PASSWORD
masterauth SUPER_SECRET_PASSWORD
protected-mode no
cluster-announce-ip $ANNOUNCE_IP
cluster-announce-port $ANNOUNCE_PORT
cluster-announce-bus-port $ANNOUNCE_BUS_PORT
"</span> >> $CONF_FILE

# 서버 시작
redis-server $CONF_FILE
</code></pre>
<p>각 Redis 서버는 포트 6379에서 실행되지만 클러스터 알림 IP 및 포트는 다릅니다.</p>
<div class="content-ad"></div>
<h1>haproxy.cfg</h1>
<pre><code class="hljs language-js"><span class="hljs-variable language_">global</span>
  stats socket /<span class="hljs-keyword">var</span>/run/api.<span class="hljs-property">sock</span> user haproxy group haproxy mode <span class="hljs-number">660</span> level admin expose-fd listeners
  log stdout format raw local0 info

defaults
  mode tcp
  timeout client 600s
  timeout connect 5s
  timeout server 600s
  timeout http-request 10s
  log <span class="hljs-variable language_">global</span>

frontend stats
  mode http
  bind *:<span class="hljs-number">8404</span>
  stats enable
  stats uri /stats
  stats refresh 10s
  stats admin <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">LOCALHOST</span>

# frontend
frontend redisfe
  bind :<span class="hljs-number">9001</span>-<span class="hljs-number">9006</span>
  bind :<span class="hljs-number">9101</span>-<span class="hljs-number">9106</span>
  use_backend redisbe1 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9001</span> }
  use_backend redisbe2 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9002</span> }
  use_backend redisbe3 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9003</span> }
  use_backend redisbe4 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9004</span> }
  use_backend redisbe5 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9005</span> }
  use_backend redisbe6 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9006</span> }
  use_backend redisbusbe1 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9101</span> }
  use_backend redisbusbe2 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9102</span> }
  use_backend redisbusbe3 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9103</span> }
  use_backend redisbusbe4 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9104</span> }
  use_backend redisbusbe5 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9105</span> }
  use_backend redisbusbe6 <span class="hljs-keyword">if</span> { dst_port <span class="hljs-number">9106</span> }

# <span class="hljs-title class_">Server</span> <span class="hljs-number">1</span>
backend redisbe1
  server be1 redis-node-<span class="hljs-number">1</span>:<span class="hljs-number">6379</span> check

backend redisbusbe1
  server busbe1 redis-node-<span class="hljs-number">1</span>:<span class="hljs-number">16379</span> check

# <span class="hljs-title class_">Server</span> <span class="hljs-number">2</span>
backend redisbe2
  server be2 redis-node-<span class="hljs-number">2</span>:<span class="hljs-number">6379</span> check

backend redisbusbe2
  server busbe2 redis-node-<span class="hljs-number">2</span>:<span class="hljs-number">16379</span> check

# <span class="hljs-title class_">Server</span> <span class="hljs-number">3</span>
backend redisbe3
  server be3 redis-node-<span class="hljs-number">3</span>:<span class="hljs-number">6379</span> check

backend redisbusbe3
  server busbe3 redis-node-<span class="hljs-number">3</span>:<span class="hljs-number">16379</span> check

# <span class="hljs-title class_">Server</span> <span class="hljs-number">4</span>
backend redisbe4
  server be4 redis-node-<span class="hljs-number">4</span>:<span class="hljs-number">6379</span> check

backend redisbusbe4
  server busbe4 redis-node-<span class="hljs-number">4</span>:<span class="hljs-number">16379</span> check

# <span class="hljs-title class_">Server</span> <span class="hljs-number">5</span>
backend redisbe5
  server be5 redis-node-<span class="hljs-number">5</span>:<span class="hljs-number">6379</span> check

backend redisbusbe5
  server busbe5 redis-node-<span class="hljs-number">5</span>:<span class="hljs-number">16379</span> check

# <span class="hljs-title class_">Server</span> <span class="hljs-number">6</span>
backend redisbe6
  server be6 redis-node-<span class="hljs-number">6</span>:<span class="hljs-number">6379</span> check

backend redisbusbe6
  server busbe6 redis-node-<span class="hljs-number">6</span>:<span class="hljs-number">16379</span> check
</code></pre>
<p>HAProxy는 클라이언트 접근을 위해 9001-9006 포트를 수신하며(클라이언트-서버 간), 서버 간 접근을 위해 9101-9106 포트를 수신합니다. HAProxy 통계 정보는 <a href="http://localhost:8404/stats%EC%97%90%EC%84%9C" rel="nofollow" target="_blank">http://localhost:8404/stats에서</a> 확인할 수 있습니다.</p>
<p>접근 순서:</p>
<div class="content-ad"></div>
<ul>
<li>client =<code> haproxy-container:700x =</code> haproxy:900x =` redis-node-x:6379</li>
<li>redis-node-* =<code> haproxy-container:710x =</code> haproxy:910x =` redis-node-x:16379</li>
</ul>
<h1>Redis Insight</h1>
<p>레디스 인사이트는 레디스를 위한 정말 좋은 UI입니다. 이 설정에서 <a href="http://localhost:8001/%EC%97%90%EC%84%9C" rel="nofollow" target="_blank">http://localhost:8001/에서</a> 액세스할 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Docker로 Redis 클러스터 설정하는 방법","description":"","date":"2024-06-23 15:44","slug":"2024-06-23-RedisClusterusingDocker","content":"\n\n\n![이미지](/assets/img/2024-06-23-RedisClusterusingDocker_0.png)\n\n우리는 특히 윈도우에서 도커를 사용하여 Redis 클러스터를 만드는 방법에 대해 이야기할 것입니다.\n\n6개 노드(3개 마스터 + 3개 레플리카)로 Redis 클러스터를 생성할 것이며, Redis가 어떤 노드가 마스터인지 레플리카인지를 결정할 것입니다.\n\n자세한 내용에 대해 파고들기 전에 몇 가지 제약사항을 알아야 합니다;\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- Redis Cluster 및 Docker\n\n2. Docker 호스트 네트워크 드라이버\n\nWindows에서 이러한 제한 사항을 고려할 때, 모든 노드 앞에 TCP 프록시를 설정하여 클러스터를 구성할 수 있습니다. 노드로의 모든 통신은 TCP 프록시를 통해 이루어질 것입니다. 이 예시에서는 HAProxy를 선택했습니다.\n\n이제 설정으로 넘어갈 수 있습니다. 3개의 파일이 준비되어 있습니다;\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- docker-compose.yaml\n- redis.sh\n- haproxy.cfg\n\n이 파일들을 가지고 명령어를 사용하여 모든 클러스터, 프록시 및 UI를 실행할 수 있어요;\n\n```js\ndocker compose up\n```\n\n# docker-compose.yaml\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n서비스 : \n  redis-node-1 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7001\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-node-2 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7002\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-node-3 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7003\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-node-4 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7004\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-node-5 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7005\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-node-6 : \n    이미지 : redis:7.2.3\n    명령 : [\"/tmp/redis.sh\", \"10.11.12.13\", \"7006\"]\n    볼륨 : \n      - ./redis.sh:/tmp/redis.sh\n  redis-cluster-creator : \n    이미지 : redis:7.2.3\n    명령 : redis-cli -a 'SUPER_SECRET_PASSWORD' --cluster create 10.11.12.13:7001 10.11.12.13:7002 10.11.12.13:7003 10.11.12.13:7004 10.11.12.13:7005 10.11.12.13:7006 --cluster-replicas 1 --cluster-yes\n    depends_on : \n      - redis-node-1\n      - redis-node-2\n      - redis-node-3\n      - redis-node-4\n      - redis-node-5\n      - redis-node-6\n      - redis-proxy\n  redis-proxy : \n    이미지 : haproxytech/haproxy-alpine:2.4\n    볼륨 : \n      - ./haproxy:/usr/local/etc/haproxy:ro\n    포트 : \n      - 8404:8404\n      - 7001-7006:9001-9006\n      - 7101-7106:9101-9106\n    depends_on : \n      - redis-node-1\n      - redis-node-2\n      - redis-node-3\n      - redis-node-4\n      - redis-node-5\n      - redis-node-6\n  redis-insight : \n    container_name : redis-insight\n    이미지 : redislabs/redisinsight:1.14.0\n    포트 : \n      - 8001:8001\n    depends_on : \n      - redis-proxy\n```\n\n다음을 참고하세요:\n- 6개의 서버 노드\n- 1개의 클러스터 생성 노드. 이 컨테이너의 상태는 클러스터 생성 후에 \"중지\"되어야 합니다. (원한다면 어떤 컨테이너로 들어가서 클러스터 명령을 실행할 수 있습니다.)\n- TCP 프록시\n- UI (Redis Insight)\n\n10.11.12.13은 로컬 머신의 IP입니다 (사실상 TCP 프록시의 IP). 이를 변경해주세요 (예를 들어 PC 이름으로 변경할 수 있습니다).\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# redis.sh\n\n각 노드마다 별도의 redis.conf 파일을 만드는 대신, 주어진 매개변수에 따라 redis.conf 파일을 생성하는 sh 파일을 만들었습니다. 이 파일을 사용하여 서버를 시작합니다. 이는 데모에 더 유연합니다.\n\n```js\nANNOUNCE_IP=$1\nANNOUNCE_PORT=$(expr $2)\nANNOUNCE_BUS_PORT=$(expr $ANNOUNCE_PORT + 100)\n\nCONF_FILE=\"/tmp/redis.conf\"\n\n# redis.conf 파일 생성\necho \"port 6379\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly yes\nloglevel debug\nrequirepass SUPER_SECRET_PASSWORD\nmasterauth SUPER_SECRET_PASSWORD\nprotected-mode no\ncluster-announce-ip $ANNOUNCE_IP\ncluster-announce-port $ANNOUNCE_PORT\ncluster-announce-bus-port $ANNOUNCE_BUS_PORT\n\" \u003e\u003e $CONF_FILE\n\n# 서버 시작\nredis-server $CONF_FILE\n```\n\n각 Redis 서버는 포트 6379에서 실행되지만 클러스터 알림 IP 및 포트는 다릅니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# haproxy.cfg\n\n```js\nglobal\n  stats socket /var/run/api.sock user haproxy group haproxy mode 660 level admin expose-fd listeners\n  log stdout format raw local0 info\n\ndefaults\n  mode tcp\n  timeout client 600s\n  timeout connect 5s\n  timeout server 600s\n  timeout http-request 10s\n  log global\n\nfrontend stats\n  mode http\n  bind *:8404\n  stats enable\n  stats uri /stats\n  stats refresh 10s\n  stats admin if LOCALHOST\n\n# frontend\nfrontend redisfe\n  bind :9001-9006\n  bind :9101-9106\n  use_backend redisbe1 if { dst_port 9001 }\n  use_backend redisbe2 if { dst_port 9002 }\n  use_backend redisbe3 if { dst_port 9003 }\n  use_backend redisbe4 if { dst_port 9004 }\n  use_backend redisbe5 if { dst_port 9005 }\n  use_backend redisbe6 if { dst_port 9006 }\n  use_backend redisbusbe1 if { dst_port 9101 }\n  use_backend redisbusbe2 if { dst_port 9102 }\n  use_backend redisbusbe3 if { dst_port 9103 }\n  use_backend redisbusbe4 if { dst_port 9104 }\n  use_backend redisbusbe5 if { dst_port 9105 }\n  use_backend redisbusbe6 if { dst_port 9106 }\n\n# Server 1\nbackend redisbe1\n  server be1 redis-node-1:6379 check\n\nbackend redisbusbe1\n  server busbe1 redis-node-1:16379 check\n\n# Server 2\nbackend redisbe2\n  server be2 redis-node-2:6379 check\n\nbackend redisbusbe2\n  server busbe2 redis-node-2:16379 check\n\n# Server 3\nbackend redisbe3\n  server be3 redis-node-3:6379 check\n\nbackend redisbusbe3\n  server busbe3 redis-node-3:16379 check\n\n# Server 4\nbackend redisbe4\n  server be4 redis-node-4:6379 check\n\nbackend redisbusbe4\n  server busbe4 redis-node-4:16379 check\n\n# Server 5\nbackend redisbe5\n  server be5 redis-node-5:6379 check\n\nbackend redisbusbe5\n  server busbe5 redis-node-5:16379 check\n\n# Server 6\nbackend redisbe6\n  server be6 redis-node-6:6379 check\n\nbackend redisbusbe6\n  server busbe6 redis-node-6:16379 check\n```\n\nHAProxy는 클라이언트 접근을 위해 9001-9006 포트를 수신하며(클라이언트-서버 간), 서버 간 접근을 위해 9101-9106 포트를 수신합니다. HAProxy 통계 정보는 http://localhost:8404/stats에서 확인할 수 있습니다.\n\n접근 순서:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- client =` haproxy-container:700x =` haproxy:900x =` redis-node-x:6379\n- redis-node-* =` haproxy-container:710x =` haproxy:910x =` redis-node-x:16379\n\n# Redis Insight\n\n레디스 인사이트는 레디스를 위한 정말 좋은 UI입니다. 이 설정에서 http://localhost:8001/에서 액세스할 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-23-RedisClusterusingDocker_0.png"},"coverImage":"/assets/img/2024-06-23-RedisClusterusingDocker_0.png","tag":["Tech"],"readingTime":6},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-RedisClusterusingDocker_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e우리는 특히 윈도우에서 도커를 사용하여 Redis 클러스터를 만드는 방법에 대해 이야기할 것입니다.\u003c/p\u003e\n\u003cp\u003e6개 노드(3개 마스터 + 3개 레플리카)로 Redis 클러스터를 생성할 것이며, Redis가 어떤 노드가 마스터인지 레플리카인지를 결정할 것입니다.\u003c/p\u003e\n\u003cp\u003e자세한 내용에 대해 파고들기 전에 몇 가지 제약사항을 알아야 합니다;\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eRedis Cluster 및 Docker\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eDocker 호스트 네트워크 드라이버\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWindows에서 이러한 제한 사항을 고려할 때, 모든 노드 앞에 TCP 프록시를 설정하여 클러스터를 구성할 수 있습니다. 노드로의 모든 통신은 TCP 프록시를 통해 이루어질 것입니다. 이 예시에서는 HAProxy를 선택했습니다.\u003c/p\u003e\n\u003cp\u003e이제 설정으로 넘어갈 수 있습니다. 3개의 파일이 준비되어 있습니다;\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003edocker-compose.yaml\u003c/li\u003e\n\u003cli\u003eredis.sh\u003c/li\u003e\n\u003cli\u003ehaproxy.cfg\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이 파일들을 가지고 명령어를 사용하여 모든 클러스터, 프록시 및 UI를 실행할 수 있어요;\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker compose up\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003edocker-compose.yaml\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e서비스 : \n  redis-node-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7001\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-node-\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7002\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-node-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7003\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-node-\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7004\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-node-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7005\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-node-\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : [\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"10.11.12.13\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7006\"\u003c/span\u003e]\n    볼륨 : \n      - ./redis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/tmp/\u003c/span\u003eredis.\u003cspan class=\"hljs-property\"\u003esh\u003c/span\u003e\n  redis-cluster-creator : \n    이미지 : \u003cspan class=\"hljs-attr\"\u003eredis\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e\n    명령 : redis-cli -a \u003cspan class=\"hljs-string\"\u003e'SUPER_SECRET_PASSWORD'\u003c/span\u003e --cluster create \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7002\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7004\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7005\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e7006\u003c/span\u003e --cluster-replicas \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e --cluster-yes\n    depends_on : \n      - redis-node-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e\n      - redis-proxy\n  redis-proxy : \n    이미지 : haproxytech/haproxy-\u003cspan class=\"hljs-attr\"\u003ealpine\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e2.4\u003c/span\u003e\n    볼륨 : \n      - ./\u003cspan class=\"hljs-attr\"\u003ehaproxy\u003c/span\u003e:\u003cspan class=\"hljs-regexp\"\u003e/usr/\u003c/span\u003elocal/etc/\u003cspan class=\"hljs-attr\"\u003ehaproxy\u003c/span\u003e:ro\n    포트 : \n      - \u003cspan class=\"hljs-number\"\u003e8404\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8404\u003c/span\u003e\n      - \u003cspan class=\"hljs-number\"\u003e7001\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e7006\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e9001\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e9006\u003c/span\u003e\n      - \u003cspan class=\"hljs-number\"\u003e7101\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e7106\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e9101\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e9106\u003c/span\u003e\n    depends_on : \n      - redis-node-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n      - redis-node-\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e\n  redis-insight : \n    container_name : redis-insight\n    이미지 : redislabs/\u003cspan class=\"hljs-attr\"\u003eredisinsight\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1.14\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\n    포트 : \n      - \u003cspan class=\"hljs-number\"\u003e8001\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8001\u003c/span\u003e\n    depends_on : \n      - redis-proxy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e다음을 참고하세요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e6개의 서버 노드\u003c/li\u003e\n\u003cli\u003e1개의 클러스터 생성 노드. 이 컨테이너의 상태는 클러스터 생성 후에 \"중지\"되어야 합니다. (원한다면 어떤 컨테이너로 들어가서 클러스터 명령을 실행할 수 있습니다.)\u003c/li\u003e\n\u003cli\u003eTCP 프록시\u003c/li\u003e\n\u003cli\u003eUI (Redis Insight)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e10.11.12.13은 로컬 머신의 IP입니다 (사실상 TCP 프록시의 IP). 이를 변경해주세요 (예를 들어 PC 이름으로 변경할 수 있습니다).\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003eredis.sh\u003c/h1\u003e\n\u003cp\u003e각 노드마다 별도의 redis.conf 파일을 만드는 대신, 주어진 매개변수에 따라 redis.conf 파일을 생성하는 sh 파일을 만들었습니다. 이 파일을 사용하여 서버를 시작합니다. 이는 데모에 더 유연합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eANNOUNCE_IP\u003c/span\u003e=$1\n\u003cspan class=\"hljs-variable constant_\"\u003eANNOUNCE_PORT\u003c/span\u003e=$(expr $2)\n\u003cspan class=\"hljs-variable constant_\"\u003eANNOUNCE_BUS_PORT\u003c/span\u003e=$(expr $ANNOUNCE_PORT + \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e)\n\n\u003cspan class=\"hljs-variable constant_\"\u003eCONF_FILE\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/tmp/redis.conf\"\u003c/span\u003e\n\n# redis.\u003cspan class=\"hljs-property\"\u003econf\u003c/span\u003e 파일 생성\necho \u003cspan class=\"hljs-string\"\u003e\"port 6379\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly yes\nloglevel debug\nrequirepass SUPER_SECRET_PASSWORD\nmasterauth SUPER_SECRET_PASSWORD\nprotected-mode no\ncluster-announce-ip $ANNOUNCE_IP\ncluster-announce-port $ANNOUNCE_PORT\ncluster-announce-bus-port $ANNOUNCE_BUS_PORT\n\"\u003c/span\u003e \u003e\u003e $CONF_FILE\n\n# 서버 시작\nredis-server $CONF_FILE\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e각 Redis 서버는 포트 6379에서 실행되지만 클러스터 알림 IP 및 포트는 다릅니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003ehaproxy.cfg\u003c/h1\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003eglobal\u003c/span\u003e\n  stats socket /\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e/run/api.\u003cspan class=\"hljs-property\"\u003esock\u003c/span\u003e user haproxy group haproxy mode \u003cspan class=\"hljs-number\"\u003e660\u003c/span\u003e level admin expose-fd listeners\n  log stdout format raw local0 info\n\ndefaults\n  mode tcp\n  timeout client 600s\n  timeout connect 5s\n  timeout server 600s\n  timeout http-request 10s\n  log \u003cspan class=\"hljs-variable language_\"\u003eglobal\u003c/span\u003e\n\nfrontend stats\n  mode http\n  bind *:\u003cspan class=\"hljs-number\"\u003e8404\u003c/span\u003e\n  stats enable\n  stats uri /stats\n  stats refresh 10s\n  stats admin \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eLOCALHOST\u003c/span\u003e\n\n# frontend\nfrontend redisfe\n  bind :\u003cspan class=\"hljs-number\"\u003e9001\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e9006\u003c/span\u003e\n  bind :\u003cspan class=\"hljs-number\"\u003e9101\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e9106\u003c/span\u003e\n  use_backend redisbe1 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9001\u003c/span\u003e }\n  use_backend redisbe2 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9002\u003c/span\u003e }\n  use_backend redisbe3 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9003\u003c/span\u003e }\n  use_backend redisbe4 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9004\u003c/span\u003e }\n  use_backend redisbe5 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9005\u003c/span\u003e }\n  use_backend redisbe6 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9006\u003c/span\u003e }\n  use_backend redisbusbe1 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9101\u003c/span\u003e }\n  use_backend redisbusbe2 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9102\u003c/span\u003e }\n  use_backend redisbusbe3 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9103\u003c/span\u003e }\n  use_backend redisbusbe4 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9104\u003c/span\u003e }\n  use_backend redisbusbe5 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9105\u003c/span\u003e }\n  use_backend redisbusbe6 \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e { dst_port \u003cspan class=\"hljs-number\"\u003e9106\u003c/span\u003e }\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\nbackend redisbe1\n  server be1 redis-node-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe1\n  server busbe1 redis-node-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\nbackend redisbe2\n  server be2 redis-node-\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe2\n  server busbe2 redis-node-\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\nbackend redisbe3\n  server be3 redis-node-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe3\n  server busbe3 redis-node-\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\nbackend redisbe4\n  server be4 redis-node-\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe4\n  server busbe4 redis-node-\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\nbackend redisbe5\n  server be5 redis-node-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe5\n  server busbe5 redis-node-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\n# \u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e\nbackend redisbe6\n  server be6 redis-node-\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e check\n\nbackend redisbusbe6\n  server busbe6 redis-node-\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e16379\u003c/span\u003e check\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHAProxy는 클라이언트 접근을 위해 9001-9006 포트를 수신하며(클라이언트-서버 간), 서버 간 접근을 위해 9101-9106 포트를 수신합니다. HAProxy 통계 정보는 \u003ca href=\"http://localhost:8404/stats%EC%97%90%EC%84%9C\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:8404/stats에서\u003c/a\u003e 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e접근 순서:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eclient =\u003ccode\u003e haproxy-container:700x =\u003c/code\u003e haproxy:900x =` redis-node-x:6379\u003c/li\u003e\n\u003cli\u003eredis-node-* =\u003ccode\u003e haproxy-container:710x =\u003c/code\u003e haproxy:910x =` redis-node-x:16379\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eRedis Insight\u003c/h1\u003e\n\u003cp\u003e레디스 인사이트는 레디스를 위한 정말 좋은 UI입니다. 이 설정에서 \u003ca href=\"http://localhost:8001/%EC%97%90%EC%84%9C\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:8001/에서\u003c/a\u003e 액세스할 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-RedisClusterusingDocker"},"buildId":"CYQjEY3HhSkRTiL0gewc0","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>