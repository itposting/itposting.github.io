<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기 | itposting" data-gatsby-head="true"/><meta property="og:title" content="자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o" data-gatsby-head="true"/><meta name="twitter:title" content="자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 18:50" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/162-4172e84c8e2aa747.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-0fd008072af5a644.js" defer=""></script><script src="/_next/static/FH3Qr-mLAesqA0X5IFRQr/_buildManifest.js" defer=""></script><script src="/_next/static/FH3Qr-mLAesqA0X5IFRQr/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">12<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png" alt="이미지"></p>
<h1>소개</h1>
<p>계약은 비즈니스 거래에 있어서 근본적인 역할을 합니다. 그러나 수동으로 계약 분석을 하는 것은 시간이 많이 소요되며 오류가 발생할 수 있습니다. 이 프로세스를 자동화함으로써 시간을 절약할 뿐만 아니라 철저하고 일관된 위험 평가를 보장할 수 있습니다. 본 프로젝트에서는 Legal-BERT와 GPT-4o를 활용하여 계약 조항 이해와 위험 평가를 자동화하는 AI 도구를 개발했습니다.</p>
<h1>왜 계약 분석을 자동화해야 하는가?</h1>
<p>계약 분석은 법적 준수와 비즈니스 전략에 있어 중요합니다. 자동화된 도구들은 주요 조항을 신속하게 식별하고 위험을 평가하며 자세한 설명을 제공하는 데 도움을 줄 수 있습니다. 이는 법률 전문가와 비즈니스에게 귀중한 자산이 될 것입니다.</p>
<h1>사용된 기술</h1>
<h2>모델 소개:</h2>
<p>Legal-BERT: Legal-BERT는 법적 텍스트의 대규모 말뭉치에 대해 세밀하게 조정된 BERT(Bidirectional Encoder Representations from Transformers)의 특수한 변형입니다. 이는 법적 자연어 처리 작업을 지원하기 위해 법적 언어에 대해 더 정확하고 맥락적으로 관련성 있는 임베딩을 제공하도록 설계되었습니다.</p>
<p>GPT-4o: GPT-4o는 인간과 유사한 텍스트를 이해하고 생성할 수 있는 고급 언어 모델입니다. 자세하고 일관성 있는 설명을 생성하는 데 특히 유용하며, 위험 평가 작업에 적합합니다.</p>
<h2>데이터셋:</h2>
<p>LegalBench: LegalBench 데이터셋은 LLMs에서 법률 추론을 평가하기 위한 포괄적인 벤치마크입니다. 규정, 판례 및 계약과 같은 다양한 법률 텍스트를 포함하므로 현실적인 법률 작업에 대한 모델을 훈련하고 평가하는 데 이상적입니다.</p>
<h2>도구:</h2>
<p>Streamlit: Streamlit은 데이터 과학 및 기계 학습 프로젝트를 위한 상호 작용 웹 애플리케이션을 만들 수 있게 해주는 Python 라이브러리입니다. 이 프로젝트에서는 계약 조항 분류 및 리스크 평가 시스템에 사용자 친화적 인터페이스를 구축하는 데 사용됩니다.</p>
<p>Huggingface Transformers: Huggingface Transformers 라이브러리는 BERT와 GPT와 같은 사전 훈련된 모델에 쉽게 액세스할 수 있습니다. 특정 작업에 대한 이러한 모델을 세밀하게 조정하고 애플리케이션에 통합하는 프로세스를 간소화합니다.</p>
<h1>프로젝트 아키텍처</h1>
<p><img src="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_1.png" alt="Project Architecture"></p>
<p>프로젝트의 워크플로우를 개요로 설명한 아키텍처 다이어그램이 있습니다. 프로세스는 계약 조항 텍스트 입력으로 시작되며, 먼저 Legal BERT 모델을 사용하여 분류됩니다. 그 다음으로, 해당 조항은 GPT-4o를 활용한 위험 분석이 수행됩니다. 마지막으로, 분류 및 위험 분석 결과가 다른 GPT-4o 모델에 의해 통합되어 종합적인 출력 보고서로 형식화됩니다. 이 아키텍처는 잠재적 위험을 평가하기 위해 계약 조항을 자동으로 평가하는 효율적이고 자동화된 시스템을 보장합니다.</p>
<h1>데이터셋 요약 📜</h1>
<p>LegalBench 데이터셋은 대형 언어 모델(Large Language Models, LLMs)에서 법적 추론을 평가하기 위해 선별된 162가지 작업들을 컬렉션한 포괄적인 데이터셋입니다. 이러한 작업들은 40명의 참여자들에 의해 기여되었으며, 이진 분류, 다중 분류, 추출, 생성, 연역 등 다양한 유형을 포함합니다. 법률 텍스트는 법전, 사법 판례, 계약서 등 다양한 분야의 법률 텍스트가 포함되어 있습니다. 각 작업은 법률적 맥락에서 LLMs의 성능을 벤치마킹하기 위해 설계된 학습 및 평가 분할을 포함하고 있습니다. 자세한 정보는 LegalBench 웹사이트를 방문해 주세요.</p>
<h1>데이터 처리</h1>
<p>첫 번째 단계는 계약 조항 데이터 세트를 처리하는 것입니다. 이 데이터 세트에는 감사 조항인지 아닌지를 나타내는 레이블이 지정된 조항이 포함되어 있습니다. 데이터는 정리되고 전처리되어 BERT 토크나이저와 호환되도록 보장됩니다. 이 단계는 Legal BERT 모델의 미세 조정을 위해 데이터를 준비하는 데 중요합니다.</p>
<p>데이터 세트는 그런 다음 train, test 및 validation 세 부분으로 분할됩니다. 훈련 및 검증 데이터 세트는 모델을 훈련하는 데 사용되며, 테스트 데이터 세트는 모델을 보이지 않은 데이터로 평가하는 데 예약됩니다. 훈련 및 검증 데이터 세트는 토큰화되어 Legal BERT 모델의 미세 조정 과정에 공급할 준비가 되어 있습니다. 이를 통해 모델이 효과적으로 학습하고 새로운, 보이지 않는 계약 조항에도 잘 일반화될 수 있도록 합니다.</p>
<pre><code class="hljs language-js"># 토크나이저 및 모델 초기화
tokenizer = <span class="hljs-title class_">BertTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">'nlpaueb/legal-bert-base-uncased'</span>)
model = <span class="hljs-title class_">BertForSequenceClassification</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">'nlpaueb/legal-bert-base-uncased'</span>, num_labels=<span class="hljs-number">2</span>)
model.<span class="hljs-title function_">to</span>(device)

# 입력 데이터를 토큰화
train_encodings = <span class="hljs-title function_">tokenizer</span>(train_data[<span class="hljs-string">'cleaned_text'</span>].<span class="hljs-title function_">tolist</span>(), truncation=<span class="hljs-title class_">True</span>, padding=<span class="hljs-title class_">True</span>, max_length=<span class="hljs-number">512</span>)
val_encodings = <span class="hljs-title function_">tokenizer</span>(val_data[<span class="hljs-string">'cleaned_text'</span>].<span class="hljs-title function_">tolist</span>(), truncation=<span class="hljs-title class_">True</span>, padding=<span class="hljs-title class_">True</span>, max_length=<span class="hljs-number">512</span>)

# 레이블을 텐서로 변환
train_labels = torch.<span class="hljs-title function_">tensor</span>(train_data[<span class="hljs-string">'answer'</span>].<span class="hljs-title function_">apply</span>(lambda <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.<span class="hljs-title function_">lower</span>() == <span class="hljs-string">"yes"</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>).<span class="hljs-title function_">tolist</span>())
val_labels = torch.<span class="hljs-title function_">tensor</span>(val_data[<span class="hljs-string">'answer'</span>].<span class="hljs-title function_">apply</span>(lambda <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.<span class="hljs-title function_">lower</span>() == <span class="hljs-string">"yes"</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>).<span class="hljs-title function_">tolist</span>())

# 데이터셋 클래스 생성
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LegalDataset</span>(torch.<span class="hljs-property">utils</span>.<span class="hljs-property">data</span>.<span class="hljs-property">Dataset</span>):
    def <span class="hljs-title function_">__init__</span>(self, encodings, labels):
        self.<span class="hljs-property">encodings</span> = encodings
        self.<span class="hljs-property">labels</span> = labels

    def <span class="hljs-title function_">__getitem__</span>(self, idx):
        item = {<span class="hljs-attr">key</span>: torch.<span class="hljs-title function_">tensor</span>(val[idx]) <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">in</span> self.<span class="hljs-property">encodings</span>.<span class="hljs-title function_">items</span>()}
        item[<span class="hljs-string">'labels'</span>] = self.<span class="hljs-property">labels</span>[idx]
        <span class="hljs-keyword">return</span> item

    def <span class="hljs-title function_">__len__</span>(self):
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">len</span>(self.<span class="hljs-property">labels</span>)

# 데이터셋 생성
train_dataset = <span class="hljs-title class_">LegalDataset</span>(train_encodings, train_labels)
val_dataset = <span class="hljs-title class_">LegalDataset</span>(val_encodings, val_labels)
</code></pre>
<h1>LEGAL-BERT: 로스쿨에서 나온 머펫들</h1>
<p>LEGAL-BERT는 법적 NLP 작업에 특화된 BERT 모델로, 다양한 영어 법률 텍스트 12GB를 사전 훈련했습니다. 이 모델은 법적 연구, 컴퓨팅 법률, 그리고 법률 기술 응용 프로그램을 지원하며, 일반 BERT 모델보다 도메인 특화 작업에서 우수한 성과를 거두고 있습니다.</p>
<p><img src="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_2.png" alt="Legal-BERT"></p>
<h2>Legal-BERT 세밀 조정</h2>
<p>처리된 데이터셋을 사용하여 Legal BERT 모델을 계약 조항을 분류하는 작업에 특히 맞게 세밀 조정할 수 있습니다. 강건한 모델 성능을 보장하기 위해 K-폴드 교차 검증 방법이 채택되었습니다.</p>
<h2>왜 K-Fold 교차 검증을 사용해야 할까요?</h2>
<p>K-Fold 교차 검증은 데이터 세트를 약간의 동일한 크기로 k개의 하위 세트(폴드)로 분할하는 것을 포함합니다. 모델은 k-1개의 폴드에서 훈련을 받고 남은 폴드에서 유효성을 검사합니다. 이 프로세스는 각각 다른 폴드를 유효성 검사 세트로 사용하여 k번 반복됩니다. 결과는 모델 성능의 더 신뢰할 수 있는 추정을 제공하기 위해 평균화됩니다.</p>
<pre><code class="hljs language-js">kf = <span class="hljs-title class_">StratifiedKFold</span>(n_splits=<span class="hljs-number">5</span>)
accuracies, precisions, recalls, f1s = [], [], [], []
texts = train_data[<span class="hljs-string">'cleaned_text'</span>]
labels = train_data[<span class="hljs-string">'answer'</span>]
i=<span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> train_index, val_index <span class="hljs-keyword">in</span> kf.<span class="hljs-title function_">split</span>(texts, labels):
    train_texts = texts[texts.<span class="hljs-property">index</span>.<span class="hljs-title function_">isin</span>(train_index)]
    val_texts = texts[texts.<span class="hljs-property">index</span>.<span class="hljs-title function_">isin</span>(val_index)]
    train_labels = labels[labels.<span class="hljs-property">index</span>.<span class="hljs-title function_">isin</span>(train_index)]
    val_labels = labels[labels.<span class="hljs-property">index</span>.<span class="hljs-title function_">isin</span>(val_index)]

    # 새 모델 초기화
    model = <span class="hljs-title class_">BertForSequenceClassification</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">'nlpaueb/legal-bert-base-uncased'</span>, num_labels=<span class="hljs-number">2</span>)
    tokenizer = <span class="hljs-title class_">BertTokenizer</span>.<span class="hljs-title function_">from_pretrained</span>(<span class="hljs-string">'nlpaueb/legal-bert-base-uncased'</span>)
    model.<span class="hljs-title function_">to</span>(device)

    accuracy, precision, recall, f1 = <span class="hljs-title function_">train_and_evaluate</span>(train_texts, train_labels, val_texts, val_labels, model, tokenizer)

    accuracies.<span class="hljs-title function_">append</span>(accuracy)
    precisions.<span class="hljs-title function_">append</span>(precision)
    recalls.<span class="hljs-title function_">append</span>(recall)
    f1s.<span class="hljs-title function_">append</span>(f1)

    model.<span class="hljs-title function_">save_pretrained</span>(<span class="hljs-string">'fine-tuned-legal-bert-fold'</span>+<span class="hljs-title function_">str</span>(i))
    tokenizer.<span class="hljs-title function_">save_pretrained</span>(<span class="hljs-string">'fine-tuned-legal-bert-fold'</span>+<span class="hljs-title function_">str</span>(i))
    i+=<span class="hljs-number">1</span>
</code></pre>
<p>이 기술은 모델이 데이터의 다른 하위 집합에서 평가되어 과적합을 완화시키며 정확도, 정밀도, 재현율 및 F1 점수의 포괄적인 평가를 제공합니다. K-Fold 교차 검증을 사용함으로써, 모델이 훈련 데이터뿐만 아니라 새로운, 보지 못한 데이터에 대해 효과적으로 잘 작동하는 것을 보장할 수 있습니다.</p>
<p>학습 결과 해석</p>
<p><img src="/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_3.png" alt="image"></p>
<p>세밀하게 조정된 모델들이 모든 지표에서 무려나게 조금 가르치지 않은 Legal-BERT 모델을 능가하여 학습 과정의 효과를 입증합니다. 가르치지 않은 모델의 낮은 정확도와 정밀도는 올바른 분류에 어려움을 겪으며 높은 재현율에도 불구하고 그것을 보여줍니다. 반면에 k-fold 교차 검증을 통해 평가된 세밀하게 조정된 모델들은 높은 정확도, 정밀도, 재현율, 그리고 F1 점수로 균형 잡힌 성능을 보여 주어 모델이 과적합 없이 잘 일반화되었음을 입증합니다. 이 유효성 검사 방법은 견고한 모델 평가를 보장하여 서로 다른 데이터 분할에서의 일관된 성능 향상을 강조합니다.</p>
<h1>리스크 분석</h1>
<p>법적 BERT 모델을 세밀 조정한 후, 새로운 계약 조항을 분류하는 데 사용됩니다. 분류된 조항은 그 후 GPT-4o에 전달되어 리스크 분석을 진행합니다. GPT-4o는 고급 자연어 이해 능력을 활용하여 조항과 관련된 잠재적인 위험을 식별합니다. 이 분석은 가능한 법적 영향과 우려 사항에 대한 자세한 통찰력을 제공합니다.</p>
<pre><code class="hljs language-js">def <span class="hljs-title function_">run_riskAnalysis</span>(clause):
    # <span class="hljs-variable constant_">GPT</span>-4o를 활용한 리스크 분석
    risk_template = <span class="hljs-string">"당신은 법률 자문가입니다. 주어진 조항에서 잠재적인 위험을 식별하세요."</span>
    prompt = clause
    response = openai.<span class="hljs-property">ChatCompletion</span>.<span class="hljs-title function_">create</span>(
        model=<span class="hljs-string">"gpt-4o"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: risk_template},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}
        ]
    )
    <span class="hljs-keyword">return</span> response[<span class="hljs-string">'choices'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'message'</span>][<span class="hljs-string">'content'</span>]
</code></pre>
<h1>두 모델의 응답 통합</h1>
<p>분류 및 위험 분석 결과를 얻은 후, 우리는 출력을 통합하여 일관된 보고서로 만듭니다. GPT-4o를 다시 활용하여 분류 레이블과 식별된 위험을 종합 설명에 결합합니다. 이 통합 단계는 최종 보고서가 명확하고 정보 제공이며 실행 가능하도록 보장함으로써 사용자가 계약 조항의 잠재적인 위험을 이해하기 쉽게 만듭니다.</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># ChatCompletion endpoint를 사용하여 prompt를 실행하는 기능</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_gpt_integration</span>(<span class="hljs-params">classification_label, risk_analysis, clause</span>):
    prompt = (
        <span class="hljs-string">f"'<span class="hljs-subst">{classification_label}</span>'로 분류된 계약 조항입니다:\n\n"</span>
        <span class="hljs-string">f"'<span class="hljs-subst">{clause}</span>'\n\n"</span>
        <span class="hljs-string">f"이 조항에서 식별된 잠재적 위험은 다음과 같습니다:\n<span class="hljs-subst">{risk_analysis}</span>\n\n"</span>
    )
    response = openai.ChatCompletion.create(
        model=<span class="hljs-string">"gpt-4o"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"당신은 법률 자문사입니다. 이 조항, 그 분류, 그리고 식별된 위험에 대한 통합된, 일관된 설명을 제공해주세요. 다음 템플릿에 맞춰 응답해주세요:"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}
        ]
    )
    <span class="hljs-keyword">return</span> response[<span class="hljs-string">'choices'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'message'</span>][<span class="hljs-string">'content'</span>]
</code></pre>
<h1>챗봇 구축하기</h1>
<p>시스템을 사용자 친화적으로 만들기 위해 Streamlit을 사용하여 챗봇을 만들 수 있습니다. 챗봇 인터페이스를 통해 사용자들이 계약 조항을 입력하고 실시간으로 분류 및 위험 분석 결과를 받을 수 있습니다. 이 챗봇은 분류를 위해 섬세하게 튜닝된 Legal BERT 모델과 위험 분석 및 설명을 생성하기 위해 GPT-4o를 활용합니다. 인터페이스에는 전문적인 외관을 위한 사용자 정의 스타일링이 포함되어 있어 사용자 경험을 향상시키며 계약 분석을 위한 직관적인 도구를 제공합니다.</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># Streamlit 앱</span>
st.title(<span class="hljs-string">"계약 조항 분류 및 위험 탐지"</span>)

<span class="hljs-comment"># 채팅 기록 초기화</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">"messages"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:
    st.session_state.messages = []

<span class="hljs-keyword">if</span> st.session_state.messages:
    <span class="hljs-keyword">for</span> i, chat <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(st.session_state.messages):
        message(chat[<span class="hljs-string">'question'</span>], is_user=<span class="hljs-literal">True</span>, key=<span class="hljs-string">f"user_<span class="hljs-subst">{i}</span>"</span>, avatar_style=<span class="hljs-string">"big-smile"</span>)
        message(chat[<span class="hljs-string">'answer'</span>], key=<span class="hljs-string">f"bot_<span class="hljs-subst">{i}</span>"</span>)
<span class="hljs-keyword">else</span>:
    st.markdown(<span class="hljs-string">"아직 채팅 기록이 없습니다. 계약 조항을 입력하여 시작해보세요."</span>)

user_input = st.chat_input(placeholder=<span class="hljs-string">"계약 조항을 입력하세요..."</span>)

<span class="hljs-keyword">if</span> user_input:
    <span class="hljs-keyword">with</span> st.spinner(<span class="hljs-string">'분석 중입니다. 잠시 기다려주세요...'</span>):
        response = classify_and_analyze_clause(user_input)
    response = classify_and_analyze_clause(user_input)
    st.session_state.messages.append({<span class="hljs-string">"question"</span>: user_input, <span class="hljs-string">"answer"</span>: <span class="hljs-string">"\n"</span>+response})
    st.experimental_rerun()
</code></pre>
<h1>챗봇 데모</h1>
<p>아래 영상에서 작동 중인 챗봇을 확인해주세요. 코드는 제 깃헙 저장소에서 확인할 수 있습니다.</p>
<p>챗봇의 샘플 응답</p>
<pre><code class="hljs language-js">### 조항 설명과 리스크 평가

**조항:**
<span class="hljs-string">'각 당사자는 기본 당사자가 합의한 감사 권리를 제공하기 위해 시급한 조항, 그 적합성을 동반하지 않는 부회사 또는 다른 계열사(온라인 그룹 또는 해당되는 경우 Skype 그룹의 부회사 또는 다른 계열사를 의미)에게 타당한 타당성을 부여해야 한다.'</span>

**조항 분류**: 감사 조항

### 설명:
이 조항은 양 당사자가 부회사 및 다른 계열사가 기본 당사자 자신이 합의한 감사 권리를 제공하도록 보장하도록 요구하는 바입니다. 이 조항은 응시 그룹 또는 <span class="hljs-title class_">Skype</span> 그룹과 관련된 특히 <span class="hljs-string">'온라인 그룹'</span> 또는 <span class="hljs-string">'Skype 그룹'</span>에 관한 계열사 또는 계열사를 명시합니다.

### 잠재적인 위험:
<span class="hljs-number">1.</span> **범위의 모호함**: <span class="hljs-string">'온라인 그룹'</span> 및 <span class="hljs-string">'Skype 그룹'</span>에 대한 명확한 정의의 부족으로 인해 어떤 기관이 이러한 범주에 속하는지에 대해 혼란을 초래할 수 있으며, 감사 권리의 범위와 적용에 대한 분쟁을 유발할 수 있습니다.

<span class="hljs-number">2.</span> **부회사 및 계열사에 대한 통제**: 조항의 효과는 각 당사자가 가진 부회사 및 계열사의 준수를 강제할 수 있는 능력에 달려 있습니다. 당사자가 이러한 기관들에 충분한 통제 능력을 가지지 못한 경우, 이로 인해 준수하지 않고 계약 위반으로 이어질 위험이 있습니다.

<span class="hljs-number">3.</span> **부회사/계열사의 동의**: 부회사 및 계열사는 자체적인 거버넌스를 갖고 있을 수 있으며 외부 감사 요구에 저항할 수 있습니다. 이로 인해 법적 도전이나 운영상의 침략이 발생할 수 있습니다.

<span class="hljs-number">4.</span> **개인정보 보호 및 기밀성 우려**: 감사는 민감한 데이터에 접근할 수 있습니다. 부회사 및 계열사에게 감사 권리를 확장함으로써 기밀 정보에 접근할 수 있는 기관 수가 증가하며, 중대한 프라이버시 및 기밀성 문제를 겪을 수 있습니다.

<span class="hljs-number">5.</span> **관할권 문제**: 여러 관할권에서 운영하는 부회사 및 계열사는 감사 권리의 범위 및 강제성에 영향을 미치는 현지 법률의 영향을 받을 수 있습니다. 각 나라에는 데이터 보호 및 감사 관행에 관한 독특한 규정이 있습니다.

<span class="hljs-number">6.</span> **운영 장애**: 강제 감사는 부회사나 계열사의 정상 운영을 방해할 수 있으며 특히 규모나 지리적으로 분산된 경우 중요한 운영 효율을 저해할 수 있습니다.

<span class="hljs-number">7.</span> **강제 가능성**: 복잡한 구조나 간접적인 통제를 갖고 있는 부회사와 계열사에 걸친 감사 권리를 실질적으로 집행하는 것은 어려울 수 있습니다. 이는 상당한 집행 어려움을 일으킬 수 있습니다.

### 완화 권고사항:
식별된 위험을 대처하기 위해 다음과 같이 조항을 수정하는 것을 고려해보세요:

- **범위 명확히 정의**: 감사 권리가 적용되는 기관을 명확하게 구분하여 <span class="hljs-string">'온라인 그룹'</span> 및 <span class="hljs-string">'Skype 그룹'</span>과 같은 모호한 용어를 제거하세요.
- **집행 가능성 확인**: 각 당사자가 부회사 및 계열사의 준수를 실질적으로 시행할 수 있는지 확인하세요. 통제에 관한 제한 사항을 평가하고 공개하세요.
- **부회사/계열사의 동의**: 부회사 및 계열사로부터 동의를 얻는 필요성과 절차에 대한 규정을 포함하여 그들의 거버넌스 구조를 고려하세요.
- **데이터 개인정보 준수**: 해당되는 데이터 보호 및 개인정보 보호법과 일치하는지 확인하고 민감한 정보 보호를 위한 보호 장치를 추가할 수 있도록 보장하세요.
- **실질적인 고려사항**: 운영상의 방해와 무능률을 완화하기 위해 감사 범위와 빈도에 합리적인 제한 사항을 포함하세요.

조항의 복잡성과 잠재적인 영향을 고려하여 실무, 법률 및 운영적 현실과 조화를 이루도록 사용자 정의하는 것을 강력히 권장합니다.
</code></pre>
<h1>참고 자료</h1>
<ul>
<li>LegalBench 데이터셋</li>
<li>LegalBench 연구 논문</li>
<li>Legal-BERT 사전 학습 모델</li>
<li>Legal-BERT 연구 논문</li>
<li>Hugging Face Transformers</li>
<li>OpenAI API</li>
<li>Streamlit</li>
<li>k-fold Cross-Validation에 대한 친절한 소개</li>
<li>Fine Tuned Legal-Bert</li>
<li>Github 코드</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"자동 계약 조항 이해 및 위험 평가 챗봇 Legal-BERT 및 GPT-4o 세밀하게 조정하기","description":"","date":"2024-06-20 18:50","slug":"2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o","content":"\n\n![이미지](/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png)\n\n# 소개\n\n계약은 비즈니스 거래에 있어서 근본적인 역할을 합니다. 그러나 수동으로 계약 분석을 하는 것은 시간이 많이 소요되며 오류가 발생할 수 있습니다. 이 프로세스를 자동화함으로써 시간을 절약할 뿐만 아니라 철저하고 일관된 위험 평가를 보장할 수 있습니다. 본 프로젝트에서는 Legal-BERT와 GPT-4o를 활용하여 계약 조항 이해와 위험 평가를 자동화하는 AI 도구를 개발했습니다.\n\n# 왜 계약 분석을 자동화해야 하는가?\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n계약 분석은 법적 준수와 비즈니스 전략에 있어 중요합니다. 자동화된 도구들은 주요 조항을 신속하게 식별하고 위험을 평가하며 자세한 설명을 제공하는 데 도움을 줄 수 있습니다. 이는 법률 전문가와 비즈니스에게 귀중한 자산이 될 것입니다.\n\n# 사용된 기술\n\n## 모델 소개:\n\nLegal-BERT: Legal-BERT는 법적 텍스트의 대규모 말뭉치에 대해 세밀하게 조정된 BERT(Bidirectional Encoder Representations from Transformers)의 특수한 변형입니다. 이는 법적 자연어 처리 작업을 지원하기 위해 법적 언어에 대해 더 정확하고 맥락적으로 관련성 있는 임베딩을 제공하도록 설계되었습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nGPT-4o: GPT-4o는 인간과 유사한 텍스트를 이해하고 생성할 수 있는 고급 언어 모델입니다. 자세하고 일관성 있는 설명을 생성하는 데 특히 유용하며, 위험 평가 작업에 적합합니다.\n\n## 데이터셋:\n\nLegalBench: LegalBench 데이터셋은 LLMs에서 법률 추론을 평가하기 위한 포괄적인 벤치마크입니다. 규정, 판례 및 계약과 같은 다양한 법률 텍스트를 포함하므로 현실적인 법률 작업에 대한 모델을 훈련하고 평가하는 데 이상적입니다.\n\n## 도구:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nStreamlit: Streamlit은 데이터 과학 및 기계 학습 프로젝트를 위한 상호 작용 웹 애플리케이션을 만들 수 있게 해주는 Python 라이브러리입니다. 이 프로젝트에서는 계약 조항 분류 및 리스크 평가 시스템에 사용자 친화적 인터페이스를 구축하는 데 사용됩니다.\n\nHuggingface Transformers: Huggingface Transformers 라이브러리는 BERT와 GPT와 같은 사전 훈련된 모델에 쉽게 액세스할 수 있습니다. 특정 작업에 대한 이러한 모델을 세밀하게 조정하고 애플리케이션에 통합하는 프로세스를 간소화합니다.\n\n# 프로젝트 아키텍처\n\n![Project Architecture](/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_1.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n프로젝트의 워크플로우를 개요로 설명한 아키텍처 다이어그램이 있습니다. 프로세스는 계약 조항 텍스트 입력으로 시작되며, 먼저 Legal BERT 모델을 사용하여 분류됩니다. 그 다음으로, 해당 조항은 GPT-4o를 활용한 위험 분석이 수행됩니다. 마지막으로, 분류 및 위험 분석 결과가 다른 GPT-4o 모델에 의해 통합되어 종합적인 출력 보고서로 형식화됩니다. 이 아키텍처는 잠재적 위험을 평가하기 위해 계약 조항을 자동으로 평가하는 효율적이고 자동화된 시스템을 보장합니다.\n\n# 데이터셋 요약 📜\n\nLegalBench 데이터셋은 대형 언어 모델(Large Language Models, LLMs)에서 법적 추론을 평가하기 위해 선별된 162가지 작업들을 컬렉션한 포괄적인 데이터셋입니다. 이러한 작업들은 40명의 참여자들에 의해 기여되었으며, 이진 분류, 다중 분류, 추출, 생성, 연역 등 다양한 유형을 포함합니다. 법률 텍스트는 법전, 사법 판례, 계약서 등 다양한 분야의 법률 텍스트가 포함되어 있습니다. 각 작업은 법률적 맥락에서 LLMs의 성능을 벤치마킹하기 위해 설계된 학습 및 평가 분할을 포함하고 있습니다. 자세한 정보는 LegalBench 웹사이트를 방문해 주세요.\n\n# 데이터 처리\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n첫 번째 단계는 계약 조항 데이터 세트를 처리하는 것입니다. 이 데이터 세트에는 감사 조항인지 아닌지를 나타내는 레이블이 지정된 조항이 포함되어 있습니다. 데이터는 정리되고 전처리되어 BERT 토크나이저와 호환되도록 보장됩니다. 이 단계는 Legal BERT 모델의 미세 조정을 위해 데이터를 준비하는 데 중요합니다.\n\n데이터 세트는 그런 다음 train, test 및 validation 세 부분으로 분할됩니다. 훈련 및 검증 데이터 세트는 모델을 훈련하는 데 사용되며, 테스트 데이터 세트는 모델을 보이지 않은 데이터로 평가하는 데 예약됩니다. 훈련 및 검증 데이터 세트는 토큰화되어 Legal BERT 모델의 미세 조정 과정에 공급할 준비가 되어 있습니다. 이를 통해 모델이 효과적으로 학습하고 새로운, 보이지 않는 계약 조항에도 잘 일반화될 수 있도록 합니다.\n\n```js\n# 토크나이저 및 모델 초기화\ntokenizer = BertTokenizer.from_pretrained('nlpaueb/legal-bert-base-uncased')\nmodel = BertForSequenceClassification.from_pretrained('nlpaueb/legal-bert-base-uncased', num_labels=2)\nmodel.to(device)\n\n# 입력 데이터를 토큰화\ntrain_encodings = tokenizer(train_data['cleaned_text'].tolist(), truncation=True, padding=True, max_length=512)\nval_encodings = tokenizer(val_data['cleaned_text'].tolist(), truncation=True, padding=True, max_length=512)\n\n# 레이블을 텐서로 변환\ntrain_labels = torch.tensor(train_data['answer'].apply(lambda x: 1 if x.lower() == \"yes\" else 0).tolist())\nval_labels = torch.tensor(val_data['answer'].apply(lambda x: 1 if x.lower() == \"yes\" else 0).tolist())\n\n# 데이터셋 클래스 생성\nclass LegalDataset(torch.utils.data.Dataset):\n    def __init__(self, encodings, labels):\n        self.encodings = encodings\n        self.labels = labels\n\n    def __getitem__(self, idx):\n        item = {key: torch.tensor(val[idx]) for key, val in self.encodings.items()}\n        item['labels'] = self.labels[idx]\n        return item\n\n    def __len__(self):\n        return len(self.labels)\n\n# 데이터셋 생성\ntrain_dataset = LegalDataset(train_encodings, train_labels)\nval_dataset = LegalDataset(val_encodings, val_labels)\n```\n\n# LEGAL-BERT: 로스쿨에서 나온 머펫들\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nLEGAL-BERT는 법적 NLP 작업에 특화된 BERT 모델로, 다양한 영어 법률 텍스트 12GB를 사전 훈련했습니다. 이 모델은 법적 연구, 컴퓨팅 법률, 그리고 법률 기술 응용 프로그램을 지원하며, 일반 BERT 모델보다 도메인 특화 작업에서 우수한 성과를 거두고 있습니다.\n\n![Legal-BERT](/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_2.png)\n\n## Legal-BERT 세밀 조정\n\n처리된 데이터셋을 사용하여 Legal BERT 모델을 계약 조항을 분류하는 작업에 특히 맞게 세밀 조정할 수 있습니다. 강건한 모델 성능을 보장하기 위해 K-폴드 교차 검증 방법이 채택되었습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 왜 K-Fold 교차 검증을 사용해야 할까요?\n\nK-Fold 교차 검증은 데이터 세트를 약간의 동일한 크기로 k개의 하위 세트(폴드)로 분할하는 것을 포함합니다. 모델은 k-1개의 폴드에서 훈련을 받고 남은 폴드에서 유효성을 검사합니다. 이 프로세스는 각각 다른 폴드를 유효성 검사 세트로 사용하여 k번 반복됩니다. 결과는 모델 성능의 더 신뢰할 수 있는 추정을 제공하기 위해 평균화됩니다.\n\n```js\nkf = StratifiedKFold(n_splits=5)\naccuracies, precisions, recalls, f1s = [], [], [], []\ntexts = train_data['cleaned_text']\nlabels = train_data['answer']\ni=0\nfor train_index, val_index in kf.split(texts, labels):\n    train_texts = texts[texts.index.isin(train_index)]\n    val_texts = texts[texts.index.isin(val_index)]\n    train_labels = labels[labels.index.isin(train_index)]\n    val_labels = labels[labels.index.isin(val_index)]\n\n    # 새 모델 초기화\n    model = BertForSequenceClassification.from_pretrained('nlpaueb/legal-bert-base-uncased', num_labels=2)\n    tokenizer = BertTokenizer.from_pretrained('nlpaueb/legal-bert-base-uncased')\n    model.to(device)\n\n    accuracy, precision, recall, f1 = train_and_evaluate(train_texts, train_labels, val_texts, val_labels, model, tokenizer)\n\n    accuracies.append(accuracy)\n    precisions.append(precision)\n    recalls.append(recall)\n    f1s.append(f1)\n\n    model.save_pretrained('fine-tuned-legal-bert-fold'+str(i))\n    tokenizer.save_pretrained('fine-tuned-legal-bert-fold'+str(i))\n    i+=1\n```\n\n이 기술은 모델이 데이터의 다른 하위 집합에서 평가되어 과적합을 완화시키며 정확도, 정밀도, 재현율 및 F1 점수의 포괄적인 평가를 제공합니다. K-Fold 교차 검증을 사용함으로써, 모델이 훈련 데이터뿐만 아니라 새로운, 보지 못한 데이터에 대해 효과적으로 잘 작동하는 것을 보장할 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n학습 결과 해석\n\n![image](/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_3.png)\n\n세밀하게 조정된 모델들이 모든 지표에서 무려나게 조금 가르치지 않은 Legal-BERT 모델을 능가하여 학습 과정의 효과를 입증합니다. 가르치지 않은 모델의 낮은 정확도와 정밀도는 올바른 분류에 어려움을 겪으며 높은 재현율에도 불구하고 그것을 보여줍니다. 반면에 k-fold 교차 검증을 통해 평가된 세밀하게 조정된 모델들은 높은 정확도, 정밀도, 재현율, 그리고 F1 점수로 균형 잡힌 성능을 보여 주어 모델이 과적합 없이 잘 일반화되었음을 입증합니다. 이 유효성 검사 방법은 견고한 모델 평가를 보장하여 서로 다른 데이터 분할에서의 일관된 성능 향상을 강조합니다.\n\n# 리스크 분석\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n법적 BERT 모델을 세밀 조정한 후, 새로운 계약 조항을 분류하는 데 사용됩니다. 분류된 조항은 그 후 GPT-4o에 전달되어 리스크 분석을 진행합니다. GPT-4o는 고급 자연어 이해 능력을 활용하여 조항과 관련된 잠재적인 위험을 식별합니다. 이 분석은 가능한 법적 영향과 우려 사항에 대한 자세한 통찰력을 제공합니다.\n\n```js\ndef run_riskAnalysis(clause):\n    # GPT-4o를 활용한 리스크 분석\n    risk_template = \"당신은 법률 자문가입니다. 주어진 조항에서 잠재적인 위험을 식별하세요.\"\n    prompt = clause\n    response = openai.ChatCompletion.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": risk_template},\n            {\"role\": \"user\", \"content\": prompt}\n        ]\n    )\n    return response['choices'][0]['message']['content']\n```\n\n# 두 모델의 응답 통합\n\n분류 및 위험 분석 결과를 얻은 후, 우리는 출력을 통합하여 일관된 보고서로 만듭니다. GPT-4o를 다시 활용하여 분류 레이블과 식별된 위험을 종합 설명에 결합합니다. 이 통합 단계는 최종 보고서가 명확하고 정보 제공이며 실행 가능하도록 보장함으로써 사용자가 계약 조항의 잠재적인 위험을 이해하기 쉽게 만듭니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\n# ChatCompletion endpoint를 사용하여 prompt를 실행하는 기능\ndef run_gpt_integration(classification_label, risk_analysis, clause):\n    prompt = (\n        f\"'{classification_label}'로 분류된 계약 조항입니다:\\n\\n\"\n        f\"'{clause}'\\n\\n\"\n        f\"이 조항에서 식별된 잠재적 위험은 다음과 같습니다:\\n{risk_analysis}\\n\\n\"\n    )\n    response = openai.ChatCompletion.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": \"당신은 법률 자문사입니다. 이 조항, 그 분류, 그리고 식별된 위험에 대한 통합된, 일관된 설명을 제공해주세요. 다음 템플릿에 맞춰 응답해주세요:\"},\n            {\"role\": \"user\", \"content\": prompt}\n        ]\n    )\n    return response['choices'][0]['message']['content']\n```\n\n# 챗봇 구축하기\n\n시스템을 사용자 친화적으로 만들기 위해 Streamlit을 사용하여 챗봇을 만들 수 있습니다. 챗봇 인터페이스를 통해 사용자들이 계약 조항을 입력하고 실시간으로 분류 및 위험 분석 결과를 받을 수 있습니다. 이 챗봇은 분류를 위해 섬세하게 튜닝된 Legal BERT 모델과 위험 분석 및 설명을 생성하기 위해 GPT-4o를 활용합니다. 인터페이스에는 전문적인 외관을 위한 사용자 정의 스타일링이 포함되어 있어 사용자 경험을 향상시키며 계약 분석을 위한 직관적인 도구를 제공합니다.\n\n```python\n# Streamlit 앱\nst.title(\"계약 조항 분류 및 위험 탐지\")\n\n# 채팅 기록 초기화\nif \"messages\" not in st.session_state:\n    st.session_state.messages = []\n\nif st.session_state.messages:\n    for i, chat in enumerate(st.session_state.messages):\n        message(chat['question'], is_user=True, key=f\"user_{i}\", avatar_style=\"big-smile\")\n        message(chat['answer'], key=f\"bot_{i}\")\nelse:\n    st.markdown(\"아직 채팅 기록이 없습니다. 계약 조항을 입력하여 시작해보세요.\")\n\nuser_input = st.chat_input(placeholder=\"계약 조항을 입력하세요...\")\n\nif user_input:\n    with st.spinner('분석 중입니다. 잠시 기다려주세요...'):\n        response = classify_and_analyze_clause(user_input)\n    response = classify_and_analyze_clause(user_input)\n    st.session_state.messages.append({\"question\": user_input, \"answer\": \"\\n\"+response})\n    st.experimental_rerun()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 챗봇 데모\n\n아래 영상에서 작동 중인 챗봇을 확인해주세요. 코드는 제 깃헙 저장소에서 확인할 수 있습니다.\n\n챗봇의 샘플 응답\n\n```js\n### 조항 설명과 리스크 평가\n\n**조항:**\n'각 당사자는 기본 당사자가 합의한 감사 권리를 제공하기 위해 시급한 조항, 그 적합성을 동반하지 않는 부회사 또는 다른 계열사(온라인 그룹 또는 해당되는 경우 Skype 그룹의 부회사 또는 다른 계열사를 의미)에게 타당한 타당성을 부여해야 한다.'\n\n**조항 분류**: 감사 조항\n\n### 설명:\n이 조항은 양 당사자가 부회사 및 다른 계열사가 기본 당사자 자신이 합의한 감사 권리를 제공하도록 보장하도록 요구하는 바입니다. 이 조항은 응시 그룹 또는 Skype 그룹과 관련된 특히 '온라인 그룹' 또는 'Skype 그룹'에 관한 계열사 또는 계열사를 명시합니다.\n\n### 잠재적인 위험:\n1. **범위의 모호함**: '온라인 그룹' 및 'Skype 그룹'에 대한 명확한 정의의 부족으로 인해 어떤 기관이 이러한 범주에 속하는지에 대해 혼란을 초래할 수 있으며, 감사 권리의 범위와 적용에 대한 분쟁을 유발할 수 있습니다.\n\n2. **부회사 및 계열사에 대한 통제**: 조항의 효과는 각 당사자가 가진 부회사 및 계열사의 준수를 강제할 수 있는 능력에 달려 있습니다. 당사자가 이러한 기관들에 충분한 통제 능력을 가지지 못한 경우, 이로 인해 준수하지 않고 계약 위반으로 이어질 위험이 있습니다.\n\n3. **부회사/계열사의 동의**: 부회사 및 계열사는 자체적인 거버넌스를 갖고 있을 수 있으며 외부 감사 요구에 저항할 수 있습니다. 이로 인해 법적 도전이나 운영상의 침략이 발생할 수 있습니다.\n\n4. **개인정보 보호 및 기밀성 우려**: 감사는 민감한 데이터에 접근할 수 있습니다. 부회사 및 계열사에게 감사 권리를 확장함으로써 기밀 정보에 접근할 수 있는 기관 수가 증가하며, 중대한 프라이버시 및 기밀성 문제를 겪을 수 있습니다.\n\n5. **관할권 문제**: 여러 관할권에서 운영하는 부회사 및 계열사는 감사 권리의 범위 및 강제성에 영향을 미치는 현지 법률의 영향을 받을 수 있습니다. 각 나라에는 데이터 보호 및 감사 관행에 관한 독특한 규정이 있습니다.\n\n6. **운영 장애**: 강제 감사는 부회사나 계열사의 정상 운영을 방해할 수 있으며 특히 규모나 지리적으로 분산된 경우 중요한 운영 효율을 저해할 수 있습니다.\n\n7. **강제 가능성**: 복잡한 구조나 간접적인 통제를 갖고 있는 부회사와 계열사에 걸친 감사 권리를 실질적으로 집행하는 것은 어려울 수 있습니다. 이는 상당한 집행 어려움을 일으킬 수 있습니다.\n\n### 완화 권고사항:\n식별된 위험을 대처하기 위해 다음과 같이 조항을 수정하는 것을 고려해보세요:\n\n- **범위 명확히 정의**: 감사 권리가 적용되는 기관을 명확하게 구분하여 '온라인 그룹' 및 'Skype 그룹'과 같은 모호한 용어를 제거하세요.\n- **집행 가능성 확인**: 각 당사자가 부회사 및 계열사의 준수를 실질적으로 시행할 수 있는지 확인하세요. 통제에 관한 제한 사항을 평가하고 공개하세요.\n- **부회사/계열사의 동의**: 부회사 및 계열사로부터 동의를 얻는 필요성과 절차에 대한 규정을 포함하여 그들의 거버넌스 구조를 고려하세요.\n- **데이터 개인정보 준수**: 해당되는 데이터 보호 및 개인정보 보호법과 일치하는지 확인하고 민감한 정보 보호를 위한 보호 장치를 추가할 수 있도록 보장하세요.\n- **실질적인 고려사항**: 운영상의 방해와 무능률을 완화하기 위해 감사 범위와 빈도에 합리적인 제한 사항을 포함하세요.\n\n조항의 복잡성과 잠재적인 영향을 고려하여 실무, 법률 및 운영적 현실과 조화를 이루도록 사용자 정의하는 것을 강력히 권장합니다.\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 참고 자료\n\n- LegalBench 데이터셋\n- LegalBench 연구 논문\n- Legal-BERT 사전 학습 모델\n- Legal-BERT 연구 논문\n- Hugging Face Transformers\n- OpenAI API\n- Streamlit\n- k-fold Cross-Validation에 대한 친절한 소개\n- Fine Tuned Legal-Bert\n- Github 코드","ogImage":{"url":"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png"},"coverImage":"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png","tag":["Tech"],"readingTime":12},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch1\u003e소개\u003c/h1\u003e\n\u003cp\u003e계약은 비즈니스 거래에 있어서 근본적인 역할을 합니다. 그러나 수동으로 계약 분석을 하는 것은 시간이 많이 소요되며 오류가 발생할 수 있습니다. 이 프로세스를 자동화함으로써 시간을 절약할 뿐만 아니라 철저하고 일관된 위험 평가를 보장할 수 있습니다. 본 프로젝트에서는 Legal-BERT와 GPT-4o를 활용하여 계약 조항 이해와 위험 평가를 자동화하는 AI 도구를 개발했습니다.\u003c/p\u003e\n\u003ch1\u003e왜 계약 분석을 자동화해야 하는가?\u003c/h1\u003e\n\u003cp\u003e계약 분석은 법적 준수와 비즈니스 전략에 있어 중요합니다. 자동화된 도구들은 주요 조항을 신속하게 식별하고 위험을 평가하며 자세한 설명을 제공하는 데 도움을 줄 수 있습니다. 이는 법률 전문가와 비즈니스에게 귀중한 자산이 될 것입니다.\u003c/p\u003e\n\u003ch1\u003e사용된 기술\u003c/h1\u003e\n\u003ch2\u003e모델 소개:\u003c/h2\u003e\n\u003cp\u003eLegal-BERT: Legal-BERT는 법적 텍스트의 대규모 말뭉치에 대해 세밀하게 조정된 BERT(Bidirectional Encoder Representations from Transformers)의 특수한 변형입니다. 이는 법적 자연어 처리 작업을 지원하기 위해 법적 언어에 대해 더 정확하고 맥락적으로 관련성 있는 임베딩을 제공하도록 설계되었습니다.\u003c/p\u003e\n\u003cp\u003eGPT-4o: GPT-4o는 인간과 유사한 텍스트를 이해하고 생성할 수 있는 고급 언어 모델입니다. 자세하고 일관성 있는 설명을 생성하는 데 특히 유용하며, 위험 평가 작업에 적합합니다.\u003c/p\u003e\n\u003ch2\u003e데이터셋:\u003c/h2\u003e\n\u003cp\u003eLegalBench: LegalBench 데이터셋은 LLMs에서 법률 추론을 평가하기 위한 포괄적인 벤치마크입니다. 규정, 판례 및 계약과 같은 다양한 법률 텍스트를 포함하므로 현실적인 법률 작업에 대한 모델을 훈련하고 평가하는 데 이상적입니다.\u003c/p\u003e\n\u003ch2\u003e도구:\u003c/h2\u003e\n\u003cp\u003eStreamlit: Streamlit은 데이터 과학 및 기계 학습 프로젝트를 위한 상호 작용 웹 애플리케이션을 만들 수 있게 해주는 Python 라이브러리입니다. 이 프로젝트에서는 계약 조항 분류 및 리스크 평가 시스템에 사용자 친화적 인터페이스를 구축하는 데 사용됩니다.\u003c/p\u003e\n\u003cp\u003eHuggingface Transformers: Huggingface Transformers 라이브러리는 BERT와 GPT와 같은 사전 훈련된 모델에 쉽게 액세스할 수 있습니다. 특정 작업에 대한 이러한 모델을 세밀하게 조정하고 애플리케이션에 통합하는 프로세스를 간소화합니다.\u003c/p\u003e\n\u003ch1\u003e프로젝트 아키텍처\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_1.png\" alt=\"Project Architecture\"\u003e\u003c/p\u003e\n\u003cp\u003e프로젝트의 워크플로우를 개요로 설명한 아키텍처 다이어그램이 있습니다. 프로세스는 계약 조항 텍스트 입력으로 시작되며, 먼저 Legal BERT 모델을 사용하여 분류됩니다. 그 다음으로, 해당 조항은 GPT-4o를 활용한 위험 분석이 수행됩니다. 마지막으로, 분류 및 위험 분석 결과가 다른 GPT-4o 모델에 의해 통합되어 종합적인 출력 보고서로 형식화됩니다. 이 아키텍처는 잠재적 위험을 평가하기 위해 계약 조항을 자동으로 평가하는 효율적이고 자동화된 시스템을 보장합니다.\u003c/p\u003e\n\u003ch1\u003e데이터셋 요약 📜\u003c/h1\u003e\n\u003cp\u003eLegalBench 데이터셋은 대형 언어 모델(Large Language Models, LLMs)에서 법적 추론을 평가하기 위해 선별된 162가지 작업들을 컬렉션한 포괄적인 데이터셋입니다. 이러한 작업들은 40명의 참여자들에 의해 기여되었으며, 이진 분류, 다중 분류, 추출, 생성, 연역 등 다양한 유형을 포함합니다. 법률 텍스트는 법전, 사법 판례, 계약서 등 다양한 분야의 법률 텍스트가 포함되어 있습니다. 각 작업은 법률적 맥락에서 LLMs의 성능을 벤치마킹하기 위해 설계된 학습 및 평가 분할을 포함하고 있습니다. 자세한 정보는 LegalBench 웹사이트를 방문해 주세요.\u003c/p\u003e\n\u003ch1\u003e데이터 처리\u003c/h1\u003e\n\u003cp\u003e첫 번째 단계는 계약 조항 데이터 세트를 처리하는 것입니다. 이 데이터 세트에는 감사 조항인지 아닌지를 나타내는 레이블이 지정된 조항이 포함되어 있습니다. 데이터는 정리되고 전처리되어 BERT 토크나이저와 호환되도록 보장됩니다. 이 단계는 Legal BERT 모델의 미세 조정을 위해 데이터를 준비하는 데 중요합니다.\u003c/p\u003e\n\u003cp\u003e데이터 세트는 그런 다음 train, test 및 validation 세 부분으로 분할됩니다. 훈련 및 검증 데이터 세트는 모델을 훈련하는 데 사용되며, 테스트 데이터 세트는 모델을 보이지 않은 데이터로 평가하는 데 예약됩니다. 훈련 및 검증 데이터 세트는 토큰화되어 Legal BERT 모델의 미세 조정 과정에 공급할 준비가 되어 있습니다. 이를 통해 모델이 효과적으로 학습하고 새로운, 보이지 않는 계약 조항에도 잘 일반화될 수 있도록 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# 토크나이저 및 모델 초기화\ntokenizer = \u003cspan class=\"hljs-title class_\"\u003eBertTokenizer\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efrom_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'nlpaueb/legal-bert-base-uncased'\u003c/span\u003e)\nmodel = \u003cspan class=\"hljs-title class_\"\u003eBertForSequenceClassification\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efrom_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'nlpaueb/legal-bert-base-uncased'\u003c/span\u003e, num_labels=\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\nmodel.\u003cspan class=\"hljs-title function_\"\u003eto\u003c/span\u003e(device)\n\n# 입력 데이터를 토큰화\ntrain_encodings = \u003cspan class=\"hljs-title function_\"\u003etokenizer\u003c/span\u003e(train_data[\u003cspan class=\"hljs-string\"\u003e'cleaned_text'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003etolist\u003c/span\u003e(), truncation=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, padding=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, max_length=\u003cspan class=\"hljs-number\"\u003e512\u003c/span\u003e)\nval_encodings = \u003cspan class=\"hljs-title function_\"\u003etokenizer\u003c/span\u003e(val_data[\u003cspan class=\"hljs-string\"\u003e'cleaned_text'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003etolist\u003c/span\u003e(), truncation=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, padding=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, max_length=\u003cspan class=\"hljs-number\"\u003e512\u003c/span\u003e)\n\n# 레이블을 텐서로 변환\ntrain_labels = torch.\u003cspan class=\"hljs-title function_\"\u003etensor\u003c/span\u003e(train_data[\u003cspan class=\"hljs-string\"\u003e'answer'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e x.\u003cspan class=\"hljs-title function_\"\u003elower\u003c/span\u003e() == \u003cspan class=\"hljs-string\"\u003e\"yes\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003etolist\u003c/span\u003e())\nval_labels = torch.\u003cspan class=\"hljs-title function_\"\u003etensor\u003c/span\u003e(val_data[\u003cspan class=\"hljs-string\"\u003e'answer'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e x.\u003cspan class=\"hljs-title function_\"\u003elower\u003c/span\u003e() == \u003cspan class=\"hljs-string\"\u003e\"yes\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003etolist\u003c/span\u003e())\n\n# 데이터셋 클래스 생성\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eLegalDataset\u003c/span\u003e(torch.\u003cspan class=\"hljs-property\"\u003eutils\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eDataset\u003c/span\u003e):\n    def \u003cspan class=\"hljs-title function_\"\u003e__init__\u003c/span\u003e(self, encodings, labels):\n        self.\u003cspan class=\"hljs-property\"\u003eencodings\u003c/span\u003e = encodings\n        self.\u003cspan class=\"hljs-property\"\u003elabels\u003c/span\u003e = labels\n\n    def \u003cspan class=\"hljs-title function_\"\u003e__getitem__\u003c/span\u003e(self, idx):\n        item = {\u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: torch.\u003cspan class=\"hljs-title function_\"\u003etensor\u003c/span\u003e(val[idx]) \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e key, val \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.\u003cspan class=\"hljs-property\"\u003eencodings\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eitems\u003c/span\u003e()}\n        item[\u003cspan class=\"hljs-string\"\u003e'labels'\u003c/span\u003e] = self.\u003cspan class=\"hljs-property\"\u003elabels\u003c/span\u003e[idx]\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e item\n\n    def \u003cspan class=\"hljs-title function_\"\u003e__len__\u003c/span\u003e(self):\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003elabels\u003c/span\u003e)\n\n# 데이터셋 생성\ntrain_dataset = \u003cspan class=\"hljs-title class_\"\u003eLegalDataset\u003c/span\u003e(train_encodings, train_labels)\nval_dataset = \u003cspan class=\"hljs-title class_\"\u003eLegalDataset\u003c/span\u003e(val_encodings, val_labels)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003eLEGAL-BERT: 로스쿨에서 나온 머펫들\u003c/h1\u003e\n\u003cp\u003eLEGAL-BERT는 법적 NLP 작업에 특화된 BERT 모델로, 다양한 영어 법률 텍스트 12GB를 사전 훈련했습니다. 이 모델은 법적 연구, 컴퓨팅 법률, 그리고 법률 기술 응용 프로그램을 지원하며, 일반 BERT 모델보다 도메인 특화 작업에서 우수한 성과를 거두고 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_2.png\" alt=\"Legal-BERT\"\u003e\u003c/p\u003e\n\u003ch2\u003eLegal-BERT 세밀 조정\u003c/h2\u003e\n\u003cp\u003e처리된 데이터셋을 사용하여 Legal BERT 모델을 계약 조항을 분류하는 작업에 특히 맞게 세밀 조정할 수 있습니다. 강건한 모델 성능을 보장하기 위해 K-폴드 교차 검증 방법이 채택되었습니다.\u003c/p\u003e\n\u003ch2\u003e왜 K-Fold 교차 검증을 사용해야 할까요?\u003c/h2\u003e\n\u003cp\u003eK-Fold 교차 검증은 데이터 세트를 약간의 동일한 크기로 k개의 하위 세트(폴드)로 분할하는 것을 포함합니다. 모델은 k-1개의 폴드에서 훈련을 받고 남은 폴드에서 유효성을 검사합니다. 이 프로세스는 각각 다른 폴드를 유효성 검사 세트로 사용하여 k번 반복됩니다. 결과는 모델 성능의 더 신뢰할 수 있는 추정을 제공하기 위해 평균화됩니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003ekf = \u003cspan class=\"hljs-title class_\"\u003eStratifiedKFold\u003c/span\u003e(n_splits=\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e)\naccuracies, precisions, recalls, f1s = [], [], [], []\ntexts = train_data[\u003cspan class=\"hljs-string\"\u003e'cleaned_text'\u003c/span\u003e]\nlabels = train_data[\u003cspan class=\"hljs-string\"\u003e'answer'\u003c/span\u003e]\ni=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e train_index, val_index \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e kf.\u003cspan class=\"hljs-title function_\"\u003esplit\u003c/span\u003e(texts, labels):\n    train_texts = texts[texts.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisin\u003c/span\u003e(train_index)]\n    val_texts = texts[texts.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisin\u003c/span\u003e(val_index)]\n    train_labels = labels[labels.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisin\u003c/span\u003e(train_index)]\n    val_labels = labels[labels.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisin\u003c/span\u003e(val_index)]\n\n    # 새 모델 초기화\n    model = \u003cspan class=\"hljs-title class_\"\u003eBertForSequenceClassification\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efrom_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'nlpaueb/legal-bert-base-uncased'\u003c/span\u003e, num_labels=\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n    tokenizer = \u003cspan class=\"hljs-title class_\"\u003eBertTokenizer\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efrom_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'nlpaueb/legal-bert-base-uncased'\u003c/span\u003e)\n    model.\u003cspan class=\"hljs-title function_\"\u003eto\u003c/span\u003e(device)\n\n    accuracy, precision, recall, f1 = \u003cspan class=\"hljs-title function_\"\u003etrain_and_evaluate\u003c/span\u003e(train_texts, train_labels, val_texts, val_labels, model, tokenizer)\n\n    accuracies.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(accuracy)\n    precisions.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(precision)\n    recalls.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(recall)\n    f1s.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(f1)\n\n    model.\u003cspan class=\"hljs-title function_\"\u003esave_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fine-tuned-legal-bert-fold'\u003c/span\u003e+\u003cspan class=\"hljs-title function_\"\u003estr\u003c/span\u003e(i))\n    tokenizer.\u003cspan class=\"hljs-title function_\"\u003esave_pretrained\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fine-tuned-legal-bert-fold'\u003c/span\u003e+\u003cspan class=\"hljs-title function_\"\u003estr\u003c/span\u003e(i))\n    i+=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 기술은 모델이 데이터의 다른 하위 집합에서 평가되어 과적합을 완화시키며 정확도, 정밀도, 재현율 및 F1 점수의 포괄적인 평가를 제공합니다. K-Fold 교차 검증을 사용함으로써, 모델이 훈련 데이터뿐만 아니라 새로운, 보지 못한 데이터에 대해 효과적으로 잘 작동하는 것을 보장할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e학습 결과 해석\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o_3.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e세밀하게 조정된 모델들이 모든 지표에서 무려나게 조금 가르치지 않은 Legal-BERT 모델을 능가하여 학습 과정의 효과를 입증합니다. 가르치지 않은 모델의 낮은 정확도와 정밀도는 올바른 분류에 어려움을 겪으며 높은 재현율에도 불구하고 그것을 보여줍니다. 반면에 k-fold 교차 검증을 통해 평가된 세밀하게 조정된 모델들은 높은 정확도, 정밀도, 재현율, 그리고 F1 점수로 균형 잡힌 성능을 보여 주어 모델이 과적합 없이 잘 일반화되었음을 입증합니다. 이 유효성 검사 방법은 견고한 모델 평가를 보장하여 서로 다른 데이터 분할에서의 일관된 성능 향상을 강조합니다.\u003c/p\u003e\n\u003ch1\u003e리스크 분석\u003c/h1\u003e\n\u003cp\u003e법적 BERT 모델을 세밀 조정한 후, 새로운 계약 조항을 분류하는 데 사용됩니다. 분류된 조항은 그 후 GPT-4o에 전달되어 리스크 분석을 진행합니다. GPT-4o는 고급 자연어 이해 능력을 활용하여 조항과 관련된 잠재적인 위험을 식별합니다. 이 분석은 가능한 법적 영향과 우려 사항에 대한 자세한 통찰력을 제공합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edef \u003cspan class=\"hljs-title function_\"\u003erun_riskAnalysis\u003c/span\u003e(clause):\n    # \u003cspan class=\"hljs-variable constant_\"\u003eGPT\u003c/span\u003e-4o를 활용한 리스크 분석\n    risk_template = \u003cspan class=\"hljs-string\"\u003e\"당신은 법률 자문가입니다. 주어진 조항에서 잠재적인 위험을 식별하세요.\"\u003c/span\u003e\n    prompt = clause\n    response = openai.\u003cspan class=\"hljs-property\"\u003eChatCompletion\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e(\n        model=\u003cspan class=\"hljs-string\"\u003e\"gpt-4o\"\u003c/span\u003e,\n        messages=[\n            {\u003cspan class=\"hljs-string\"\u003e\"role\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"system\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e: risk_template},\n            {\u003cspan class=\"hljs-string\"\u003e\"role\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e: prompt}\n        ]\n    )\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response[\u003cspan class=\"hljs-string\"\u003e'choices'\u003c/span\u003e][\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'content'\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e두 모델의 응답 통합\u003c/h1\u003e\n\u003cp\u003e분류 및 위험 분석 결과를 얻은 후, 우리는 출력을 통합하여 일관된 보고서로 만듭니다. GPT-4o를 다시 활용하여 분류 레이블과 식별된 위험을 종합 설명에 결합합니다. 이 통합 단계는 최종 보고서가 명확하고 정보 제공이며 실행 가능하도록 보장함으로써 사용자가 계약 조항의 잠재적인 위험을 이해하기 쉽게 만듭니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# ChatCompletion endpoint를 사용하여 prompt를 실행하는 기능\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erun_gpt_integration\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eclassification_label, risk_analysis, clause\u003c/span\u003e):\n    prompt = (\n        \u003cspan class=\"hljs-string\"\u003ef\"'\u003cspan class=\"hljs-subst\"\u003e{classification_label}\u003c/span\u003e'로 분류된 계약 조항입니다:\\n\\n\"\u003c/span\u003e\n        \u003cspan class=\"hljs-string\"\u003ef\"'\u003cspan class=\"hljs-subst\"\u003e{clause}\u003c/span\u003e'\\n\\n\"\u003c/span\u003e\n        \u003cspan class=\"hljs-string\"\u003ef\"이 조항에서 식별된 잠재적 위험은 다음과 같습니다:\\n\u003cspan class=\"hljs-subst\"\u003e{risk_analysis}\u003c/span\u003e\\n\\n\"\u003c/span\u003e\n    )\n    response = openai.ChatCompletion.create(\n        model=\u003cspan class=\"hljs-string\"\u003e\"gpt-4o\"\u003c/span\u003e,\n        messages=[\n            {\u003cspan class=\"hljs-string\"\u003e\"role\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"system\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"당신은 법률 자문사입니다. 이 조항, 그 분류, 그리고 식별된 위험에 대한 통합된, 일관된 설명을 제공해주세요. 다음 템플릿에 맞춰 응답해주세요:\"\u003c/span\u003e},\n            {\u003cspan class=\"hljs-string\"\u003e\"role\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"content\"\u003c/span\u003e: prompt}\n        ]\n    )\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response[\u003cspan class=\"hljs-string\"\u003e'choices'\u003c/span\u003e][\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'content'\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e챗봇 구축하기\u003c/h1\u003e\n\u003cp\u003e시스템을 사용자 친화적으로 만들기 위해 Streamlit을 사용하여 챗봇을 만들 수 있습니다. 챗봇 인터페이스를 통해 사용자들이 계약 조항을 입력하고 실시간으로 분류 및 위험 분석 결과를 받을 수 있습니다. 이 챗봇은 분류를 위해 섬세하게 튜닝된 Legal BERT 모델과 위험 분석 및 설명을 생성하기 위해 GPT-4o를 활용합니다. 인터페이스에는 전문적인 외관을 위한 사용자 정의 스타일링이 포함되어 있어 사용자 경험을 향상시키며 계약 분석을 위한 직관적인 도구를 제공합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Streamlit 앱\u003c/span\u003e\nst.title(\u003cspan class=\"hljs-string\"\u003e\"계약 조항 분류 및 위험 탐지\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# 채팅 기록 초기화\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"messages\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.session_state:\n    st.session_state.messages = []\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e st.session_state.messages:\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i, chat \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eenumerate\u003c/span\u003e(st.session_state.messages):\n        message(chat[\u003cspan class=\"hljs-string\"\u003e'question'\u003c/span\u003e], is_user=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e, key=\u003cspan class=\"hljs-string\"\u003ef\"user_\u003cspan class=\"hljs-subst\"\u003e{i}\u003c/span\u003e\"\u003c/span\u003e, avatar_style=\u003cspan class=\"hljs-string\"\u003e\"big-smile\"\u003c/span\u003e)\n        message(chat[\u003cspan class=\"hljs-string\"\u003e'answer'\u003c/span\u003e], key=\u003cspan class=\"hljs-string\"\u003ef\"bot_\u003cspan class=\"hljs-subst\"\u003e{i}\u003c/span\u003e\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n    st.markdown(\u003cspan class=\"hljs-string\"\u003e\"아직 채팅 기록이 없습니다. 계약 조항을 입력하여 시작해보세요.\"\u003c/span\u003e)\n\nuser_input = st.chat_input(placeholder=\u003cspan class=\"hljs-string\"\u003e\"계약 조항을 입력하세요...\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e user_input:\n    \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e st.spinner(\u003cspan class=\"hljs-string\"\u003e'분석 중입니다. 잠시 기다려주세요...'\u003c/span\u003e):\n        response = classify_and_analyze_clause(user_input)\n    response = classify_and_analyze_clause(user_input)\n    st.session_state.messages.append({\u003cspan class=\"hljs-string\"\u003e\"question\"\u003c/span\u003e: user_input, \u003cspan class=\"hljs-string\"\u003e\"answer\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\\n\"\u003c/span\u003e+response})\n    st.experimental_rerun()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e챗봇 데모\u003c/h1\u003e\n\u003cp\u003e아래 영상에서 작동 중인 챗봇을 확인해주세요. 코드는 제 깃헙 저장소에서 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e챗봇의 샘플 응답\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e### 조항 설명과 리스크 평가\n\n**조항:**\n\u003cspan class=\"hljs-string\"\u003e'각 당사자는 기본 당사자가 합의한 감사 권리를 제공하기 위해 시급한 조항, 그 적합성을 동반하지 않는 부회사 또는 다른 계열사(온라인 그룹 또는 해당되는 경우 Skype 그룹의 부회사 또는 다른 계열사를 의미)에게 타당한 타당성을 부여해야 한다.'\u003c/span\u003e\n\n**조항 분류**: 감사 조항\n\n### 설명:\n이 조항은 양 당사자가 부회사 및 다른 계열사가 기본 당사자 자신이 합의한 감사 권리를 제공하도록 보장하도록 요구하는 바입니다. 이 조항은 응시 그룹 또는 \u003cspan class=\"hljs-title class_\"\u003eSkype\u003c/span\u003e 그룹과 관련된 특히 \u003cspan class=\"hljs-string\"\u003e'온라인 그룹'\u003c/span\u003e 또는 \u003cspan class=\"hljs-string\"\u003e'Skype 그룹'\u003c/span\u003e에 관한 계열사 또는 계열사를 명시합니다.\n\n### 잠재적인 위험:\n\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e **범위의 모호함**: \u003cspan class=\"hljs-string\"\u003e'온라인 그룹'\u003c/span\u003e 및 \u003cspan class=\"hljs-string\"\u003e'Skype 그룹'\u003c/span\u003e에 대한 명확한 정의의 부족으로 인해 어떤 기관이 이러한 범주에 속하는지에 대해 혼란을 초래할 수 있으며, 감사 권리의 범위와 적용에 대한 분쟁을 유발할 수 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e **부회사 및 계열사에 대한 통제**: 조항의 효과는 각 당사자가 가진 부회사 및 계열사의 준수를 강제할 수 있는 능력에 달려 있습니다. 당사자가 이러한 기관들에 충분한 통제 능력을 가지지 못한 경우, 이로 인해 준수하지 않고 계약 위반으로 이어질 위험이 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e **부회사/계열사의 동의**: 부회사 및 계열사는 자체적인 거버넌스를 갖고 있을 수 있으며 외부 감사 요구에 저항할 수 있습니다. 이로 인해 법적 도전이나 운영상의 침략이 발생할 수 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e4.\u003c/span\u003e **개인정보 보호 및 기밀성 우려**: 감사는 민감한 데이터에 접근할 수 있습니다. 부회사 및 계열사에게 감사 권리를 확장함으로써 기밀 정보에 접근할 수 있는 기관 수가 증가하며, 중대한 프라이버시 및 기밀성 문제를 겪을 수 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e5.\u003c/span\u003e **관할권 문제**: 여러 관할권에서 운영하는 부회사 및 계열사는 감사 권리의 범위 및 강제성에 영향을 미치는 현지 법률의 영향을 받을 수 있습니다. 각 나라에는 데이터 보호 및 감사 관행에 관한 독특한 규정이 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e6.\u003c/span\u003e **운영 장애**: 강제 감사는 부회사나 계열사의 정상 운영을 방해할 수 있으며 특히 규모나 지리적으로 분산된 경우 중요한 운영 효율을 저해할 수 있습니다.\n\n\u003cspan class=\"hljs-number\"\u003e7.\u003c/span\u003e **강제 가능성**: 복잡한 구조나 간접적인 통제를 갖고 있는 부회사와 계열사에 걸친 감사 권리를 실질적으로 집행하는 것은 어려울 수 있습니다. 이는 상당한 집행 어려움을 일으킬 수 있습니다.\n\n### 완화 권고사항:\n식별된 위험을 대처하기 위해 다음과 같이 조항을 수정하는 것을 고려해보세요:\n\n- **범위 명확히 정의**: 감사 권리가 적용되는 기관을 명확하게 구분하여 \u003cspan class=\"hljs-string\"\u003e'온라인 그룹'\u003c/span\u003e 및 \u003cspan class=\"hljs-string\"\u003e'Skype 그룹'\u003c/span\u003e과 같은 모호한 용어를 제거하세요.\n- **집행 가능성 확인**: 각 당사자가 부회사 및 계열사의 준수를 실질적으로 시행할 수 있는지 확인하세요. 통제에 관한 제한 사항을 평가하고 공개하세요.\n- **부회사/계열사의 동의**: 부회사 및 계열사로부터 동의를 얻는 필요성과 절차에 대한 규정을 포함하여 그들의 거버넌스 구조를 고려하세요.\n- **데이터 개인정보 준수**: 해당되는 데이터 보호 및 개인정보 보호법과 일치하는지 확인하고 민감한 정보 보호를 위한 보호 장치를 추가할 수 있도록 보장하세요.\n- **실질적인 고려사항**: 운영상의 방해와 무능률을 완화하기 위해 감사 범위와 빈도에 합리적인 제한 사항을 포함하세요.\n\n조항의 복잡성과 잠재적인 영향을 고려하여 실무, 법률 및 운영적 현실과 조화를 이루도록 사용자 정의하는 것을 강력히 권장합니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e참고 자료\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eLegalBench 데이터셋\u003c/li\u003e\n\u003cli\u003eLegalBench 연구 논문\u003c/li\u003e\n\u003cli\u003eLegal-BERT 사전 학습 모델\u003c/li\u003e\n\u003cli\u003eLegal-BERT 연구 논문\u003c/li\u003e\n\u003cli\u003eHugging Face Transformers\u003c/li\u003e\n\u003cli\u003eOpenAI API\u003c/li\u003e\n\u003cli\u003eStreamlit\u003c/li\u003e\n\u003cli\u003ek-fold Cross-Validation에 대한 친절한 소개\u003c/li\u003e\n\u003cli\u003eFine Tuned Legal-Bert\u003c/li\u003e\n\u003cli\u003eGithub 코드\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-AutomatedContractClauseUnderstandingandRiskAssessmentChatbotwithfine-tunedLegal-BERTandGPT-4o"},"buildId":"FH3Qr-mLAesqA0X5IFRQr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>