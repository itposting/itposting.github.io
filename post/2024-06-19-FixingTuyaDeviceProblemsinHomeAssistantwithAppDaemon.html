<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기 | itposting" data-gatsby-head="true"/><meta property="og:title" content="홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon" data-gatsby-head="true"/><meta name="twitter:title" content="홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-19 05:41" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/kkckKPyxcjJp_o8wb2unW/_buildManifest.js" defer=""></script><script src="/_next/static/kkckKPyxcjJp_o8wb2unW/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 19, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png" alt="2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png">
안녕하세요! 스마트 홈 열정가들에게 이상적인 솔루션으로 떠오르는 홈 어시스턴트는 다양한 생태계의 장치를 연결하는 자유를 찾는 분들에게 완벽한 선택지입니다. 상품 특정 허브와 소프트웨어의 제한에 얽매이지 않고 장치 간 원활한 통신을 가능케 하며 종종 비교할 수 없는 수준의 맞춤 설정과 제어를 제공합니다. 하지만 잘 알려진 안드로이드 vs. iOS 논쟁과 같이, 이 자유는 별도의 어려움을 동반합니다. 주요 단점 중 하나는 홈 어시스턴트가 지원하는 장치에 엄격한 품질 통제가 없다는 점입니다. 때로는 제대로 설계되지 않은 장치 통합이 시스템에 슬쩍 들어가 사용자들에게 많은 당혹감을 야기할 수 있습니다.</p>
<p>본 문서에서는 홈 어시스턴트의 Tuya 통합에서 마주한 특정 문제와 AppDaemon을 사용하여 해결한 경험을 공유하겠습니다.</p>
<h1>문제: 결함이 있는 Tuya 도어벨</h1>
<div class="content-ad"></div>
<p>알리익스프레스에서 싸게 구입한 Wi-Fi 비디오 도어벨이 있어요. 네, 알아요, 조금은 도박 같은 느낌이긴 하죠. 하지만 리뷰가 나쁘지 않았고, 더 인기 있는 대안들처럼 월 구독비를 내고 싶지 않았어요.</p>
<p>도어벨 성능이 실망스러웠어요. 비디오 스트리밍이 느리고, 문을 누르면 홈 어시스턴트에 알림이나 센서가 없었어요. 도어벨이 배터리로 작동하다보니, 배터리가 완전히 소진되기 전에 충전할 방법이 필요했어요. 아쉽게도 홈 어시스턴트의 투야(Tuya) 통합은 배터리 수준을 부정확하게 표시했어요. 백분율이 아니라 100%에 대해 10.0, 65%에 대해 6.5와 같은 값으로 표시되었죠.</p>
<p>홈 어시스턴트 설정에 저의 저전력 경고를 관리하는 자동화가 있어요. 저는 이전에 홈 어시스턴트 템플릿에 관한 글에서 자세히 설명했어요. 이 도어벨 배터리를 위해 별도의 자동화를 만들 수도 있었지만, 9.0이나 6.5와 같은 이상한 배터리 수준을 보는 건 내성적인 제 자신에게 짜증났어요. 그래서 이 문제를 해결하기 위해 다른 옵션을 탐색하기로 결정했어요.</p>
<h1>간단한 해결책 시도: 템플릿 센서 사용</h1>
<div class="content-ad"></div>
<p>배터리 표시 문제를 해결하는 한 가지 간단한 방법은 홈 어시스턴트에 중복 템플릿 센서를 만드는 것이었습니다. 이 센서는 잘못된 배터리 값들을 가져와 값을 정수로 변환한 다음 10을 곱하여 올바른 백분율을 표시했습니다. 이를 수행하는 코드 일부를 제공해드리겠습니다:</p>
<pre><code class="hljs language-js">템플릿:
  센서:
    - 이름: <span class="hljs-string">'도어벨 배터리'</span>
      단위: <span class="hljs-string">'%'</span>
      기기_클래스: 배터리
      상태_클래스: <span class="hljs-string">"측정"</span>
      상태: >
        { 배터리_상태 = 상태(<span class="hljs-string">'센서.smart_video_doorbell_battery'</span>) }
        { 만약 배터리_상태 }
          { (배터리_상태 | <span class="hljs-title function_">int</span>(<span class="hljs-keyword">default</span>=<span class="hljs-number">0</span>)) * <span class="hljs-number">10</span> }
        { 그렇지 않다면 }
          <span class="hljs-number">0</span>
        { 끝만약 }       
      아이콘: >
        { 배터리_상태 = 상태(<span class="hljs-string">'센서.smart_video_doorbell_battery'</span>) }
        { 만약 배터리_상태 }
          { 새_상태 = (배터리_상태 | <span class="hljs-title function_">int</span>(<span class="hljs-keyword">default</span>=<span class="hljs-number">0</span>)) * <span class="hljs-number">10</span> }
          { 만약 새_상태 > <span class="hljs-number">75</span> }
            <span class="hljs-attr">mdi</span>:battery-high
          { 그렇지 않고 새_상태 > <span class="hljs-number">50</span> }
            <span class="hljs-attr">mdi</span>:battery-medium
          { 그렇지 않고 새_상태 > <span class="hljs-number">25</span> }
            <span class="hljs-attr">mdi</span>:battery-low
          { 그 외에 }
            <span class="hljs-attr">mdi</span>:battery-outline
          { 끝만약 }                                            
        { 그렇지 않다면 }
          <span class="hljs-attr">mdi</span>:battery-outline
        { 끝만약 }   
</code></pre>
<p>이 방법으로 문제를 해결할 수는 있었지만, 원래 센서의 잘못된 값들을 실제로 수정하지는 못했습니다.</p>
<h1>더 나은 해결책: AppDaemon을 사용하여 센서 수정하기</h1>
<div class="content-ad"></div>
<p>AppDaemon은 이러한 문제를 처리하는 더 유연하고 동적인 방법을 제공합니다. AppDaemon 문서에 따르면, AppDaemon 앱에서 Home Assistant 엔티티의 값을 설정할 수 있습니다. 이 기능을 사용하여 실시간으로 센서 값을 수정하는 앱을 개발했습니다.</p>
<p>다음은 코드입니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> appdaemon.<span class="hljs-property">plugins</span>.<span class="hljs-property">hass</span>.<span class="hljs-property">hassapi</span> <span class="hljs-keyword">as</span> hass

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SensorMultiplier</span>(hass.<span class="hljs-property">Hass</span>):

    def <span class="hljs-title function_">initialize</span>(self):
        self.<span class="hljs-property">battery_entity</span> = <span class="hljs-string">"sensor.smart_video_doorbell_battery"</span>
        self.<span class="hljs-title function_">listen_state</span>(self.<span class="hljs-property">sensor_changed</span>, self.<span class="hljs-property">battery_entity</span>)

    def <span class="hljs-title function_">sensor_changed</span>(self, entity, attribute, old, <span class="hljs-keyword">new</span>, kwargs):
        <span class="hljs-attr">try</span>:
            battery_value = <span class="hljs-title function_">float</span>(<span class="hljs-keyword">new</span>)
            <span class="hljs-keyword">if</span> battery_value &#x3C;= <span class="hljs-number">10</span>:
                new_value = battery_value * <span class="hljs-number">10</span>

                <span class="hljs-keyword">if</span> new_value > <span class="hljs-number">75</span>:
                    icon = <span class="hljs-string">"mdi:battery-high"</span>
                elif new_value > <span class="hljs-number">50</span>:
                    icon = <span class="hljs-string">"mdi:battery-medium"</span>
                elif new_value > <span class="hljs-number">25</span>:
                    icon = <span class="hljs-string">"mdi:battery-low"</span>
                <span class="hljs-attr">else</span>:
                    icon = <span class="hljs-string">"mdi:battery-outline"</span>

                # <span class="hljs-title class_">Write</span> back the <span class="hljs-keyword">new</span> value to another sensor
                self.<span class="hljs-title function_">set_state</span>(entity, state=new_value,
                    attributes={
                        <span class="hljs-string">"icon"</span>: icon,
                        <span class="hljs-string">"device_class"</span>: <span class="hljs-string">"battery"</span>
                    }
                )
                self.<span class="hljs-title function_">set_state</span>(entity, state=new_value)
        except <span class="hljs-title class_">ValueError</span>:
            self.<span class="hljs-title function_">log</span>(f<span class="hljs-string">"Invalid sensor value: {new}"</span>)
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-attr">sensor_multiplier</span>:
  <span class="hljs-attr">module</span>: sensor_multiplier
  <span class="hljs-attr">class</span>: <span class="hljs-title class_">SensorMultiplier</span>
</code></pre>
<div class="content-ad"></div>
<p>이 앱은 초인종 배터리 센서의 변경 사항을 감지합니다. 변경 사항이 감지되면 배터리 값을 10배로 곱하고 이 변경된 값을 사용하여 센서를 업데이트합니다. 또한 새로운 배터리 레벨에 따라 아이콘을 변경하여 배터리 상태를 빠르게 확인할 수 있습니다.</p>
<p>이 수정으로 배터리 센서가 이제 올바른 값을 표시합니다. Home Assistant에서 기기와 관련된 비슷한 문제를 겪고 있다면 AppDaemon을 시도해 보는 것을 권장합니다.</p>
<p>AppDaemon에 익숙하지 않다면 다른 문서에서 자세히 다룬 내용을 확인할 수 있습니다.</p>
<p>스마트한 가정을 만들어 주세요!</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"홈 어시스턴트에서 AppDaemon을 사용하여 투야Tuya 기기 문제 해결하기","description":"","date":"2024-06-19 05:41","slug":"2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon","content":"\n\n![2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png](/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png)\n안녕하세요! 스마트 홈 열정가들에게 이상적인 솔루션으로 떠오르는 홈 어시스턴트는 다양한 생태계의 장치를 연결하는 자유를 찾는 분들에게 완벽한 선택지입니다. 상품 특정 허브와 소프트웨어의 제한에 얽매이지 않고 장치 간 원활한 통신을 가능케 하며 종종 비교할 수 없는 수준의 맞춤 설정과 제어를 제공합니다. 하지만 잘 알려진 안드로이드 vs. iOS 논쟁과 같이, 이 자유는 별도의 어려움을 동반합니다. 주요 단점 중 하나는 홈 어시스턴트가 지원하는 장치에 엄격한 품질 통제가 없다는 점입니다. 때로는 제대로 설계되지 않은 장치 통합이 시스템에 슬쩍 들어가 사용자들에게 많은 당혹감을 야기할 수 있습니다.\n\n본 문서에서는 홈 어시스턴트의 Tuya 통합에서 마주한 특정 문제와 AppDaemon을 사용하여 해결한 경험을 공유하겠습니다.\n\n# 문제: 결함이 있는 Tuya 도어벨\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n알리익스프레스에서 싸게 구입한 Wi-Fi 비디오 도어벨이 있어요. 네, 알아요, 조금은 도박 같은 느낌이긴 하죠. 하지만 리뷰가 나쁘지 않았고, 더 인기 있는 대안들처럼 월 구독비를 내고 싶지 않았어요.\n\n도어벨 성능이 실망스러웠어요. 비디오 스트리밍이 느리고, 문을 누르면 홈 어시스턴트에 알림이나 센서가 없었어요. 도어벨이 배터리로 작동하다보니, 배터리가 완전히 소진되기 전에 충전할 방법이 필요했어요. 아쉽게도 홈 어시스턴트의 투야(Tuya) 통합은 배터리 수준을 부정확하게 표시했어요. 백분율이 아니라 100%에 대해 10.0, 65%에 대해 6.5와 같은 값으로 표시되었죠.\n\n홈 어시스턴트 설정에 저의 저전력 경고를 관리하는 자동화가 있어요. 저는 이전에 홈 어시스턴트 템플릿에 관한 글에서 자세히 설명했어요. 이 도어벨 배터리를 위해 별도의 자동화를 만들 수도 있었지만, 9.0이나 6.5와 같은 이상한 배터리 수준을 보는 건 내성적인 제 자신에게 짜증났어요. 그래서 이 문제를 해결하기 위해 다른 옵션을 탐색하기로 결정했어요. \n\n# 간단한 해결책 시도: 템플릿 센서 사용\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n배터리 표시 문제를 해결하는 한 가지 간단한 방법은 홈 어시스턴트에 중복 템플릿 센서를 만드는 것이었습니다. 이 센서는 잘못된 배터리 값들을 가져와 값을 정수로 변환한 다음 10을 곱하여 올바른 백분율을 표시했습니다. 이를 수행하는 코드 일부를 제공해드리겠습니다:\n\n```js\n템플릿:\n  센서:\n    - 이름: '도어벨 배터리'\n      단위: '%'\n      기기_클래스: 배터리\n      상태_클래스: \"측정\"\n      상태: \u003e\n        { 배터리_상태 = 상태('센서.smart_video_doorbell_battery') }\n        { 만약 배터리_상태 }\n          { (배터리_상태 | int(default=0)) * 10 }\n        { 그렇지 않다면 }\n          0\n        { 끝만약 }       \n      아이콘: \u003e\n        { 배터리_상태 = 상태('센서.smart_video_doorbell_battery') }\n        { 만약 배터리_상태 }\n          { 새_상태 = (배터리_상태 | int(default=0)) * 10 }\n          { 만약 새_상태 \u003e 75 }\n            mdi:battery-high\n          { 그렇지 않고 새_상태 \u003e 50 }\n            mdi:battery-medium\n          { 그렇지 않고 새_상태 \u003e 25 }\n            mdi:battery-low\n          { 그 외에 }\n            mdi:battery-outline\n          { 끝만약 }                                            \n        { 그렇지 않다면 }\n          mdi:battery-outline\n        { 끝만약 }   \n```\n\n이 방법으로 문제를 해결할 수는 있었지만, 원래 센서의 잘못된 값들을 실제로 수정하지는 못했습니다.\n\n# 더 나은 해결책: AppDaemon을 사용하여 센서 수정하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nAppDaemon은 이러한 문제를 처리하는 더 유연하고 동적인 방법을 제공합니다. AppDaemon 문서에 따르면, AppDaemon 앱에서 Home Assistant 엔티티의 값을 설정할 수 있습니다. 이 기능을 사용하여 실시간으로 센서 값을 수정하는 앱을 개발했습니다.\n\n다음은 코드입니다:\n\n```js\nimport appdaemon.plugins.hass.hassapi as hass\n\nclass SensorMultiplier(hass.Hass):\n\n    def initialize(self):\n        self.battery_entity = \"sensor.smart_video_doorbell_battery\"\n        self.listen_state(self.sensor_changed, self.battery_entity)\n\n    def sensor_changed(self, entity, attribute, old, new, kwargs):\n        try:\n            battery_value = float(new)\n            if battery_value \u003c= 10:\n                new_value = battery_value * 10\n\n                if new_value \u003e 75:\n                    icon = \"mdi:battery-high\"\n                elif new_value \u003e 50:\n                    icon = \"mdi:battery-medium\"\n                elif new_value \u003e 25:\n                    icon = \"mdi:battery-low\"\n                else:\n                    icon = \"mdi:battery-outline\"\n\n                # Write back the new value to another sensor\n                self.set_state(entity, state=new_value,\n                    attributes={\n                        \"icon\": icon,\n                        \"device_class\": \"battery\"\n                    }\n                )\n                self.set_state(entity, state=new_value)\n        except ValueError:\n            self.log(f\"Invalid sensor value: {new}\")\n```\n\n```js\nsensor_multiplier:\n  module: sensor_multiplier\n  class: SensorMultiplier\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 앱은 초인종 배터리 센서의 변경 사항을 감지합니다. 변경 사항이 감지되면 배터리 값을 10배로 곱하고 이 변경된 값을 사용하여 센서를 업데이트합니다. 또한 새로운 배터리 레벨에 따라 아이콘을 변경하여 배터리 상태를 빠르게 확인할 수 있습니다.\n\n이 수정으로 배터리 센서가 이제 올바른 값을 표시합니다. Home Assistant에서 기기와 관련된 비슷한 문제를 겪고 있다면 AppDaemon을 시도해 보는 것을 권장합니다.\n\nAppDaemon에 익숙하지 않다면 다른 문서에서 자세히 다룬 내용을 확인할 수 있습니다.\n\n스마트한 가정을 만들어 주세요!","ogImage":{"url":"/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png"},"coverImage":"/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png","tag":["Tech"],"readingTime":5},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png\" alt=\"2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon_0.png\"\u003e\n안녕하세요! 스마트 홈 열정가들에게 이상적인 솔루션으로 떠오르는 홈 어시스턴트는 다양한 생태계의 장치를 연결하는 자유를 찾는 분들에게 완벽한 선택지입니다. 상품 특정 허브와 소프트웨어의 제한에 얽매이지 않고 장치 간 원활한 통신을 가능케 하며 종종 비교할 수 없는 수준의 맞춤 설정과 제어를 제공합니다. 하지만 잘 알려진 안드로이드 vs. iOS 논쟁과 같이, 이 자유는 별도의 어려움을 동반합니다. 주요 단점 중 하나는 홈 어시스턴트가 지원하는 장치에 엄격한 품질 통제가 없다는 점입니다. 때로는 제대로 설계되지 않은 장치 통합이 시스템에 슬쩍 들어가 사용자들에게 많은 당혹감을 야기할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e본 문서에서는 홈 어시스턴트의 Tuya 통합에서 마주한 특정 문제와 AppDaemon을 사용하여 해결한 경험을 공유하겠습니다.\u003c/p\u003e\n\u003ch1\u003e문제: 결함이 있는 Tuya 도어벨\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e알리익스프레스에서 싸게 구입한 Wi-Fi 비디오 도어벨이 있어요. 네, 알아요, 조금은 도박 같은 느낌이긴 하죠. 하지만 리뷰가 나쁘지 않았고, 더 인기 있는 대안들처럼 월 구독비를 내고 싶지 않았어요.\u003c/p\u003e\n\u003cp\u003e도어벨 성능이 실망스러웠어요. 비디오 스트리밍이 느리고, 문을 누르면 홈 어시스턴트에 알림이나 센서가 없었어요. 도어벨이 배터리로 작동하다보니, 배터리가 완전히 소진되기 전에 충전할 방법이 필요했어요. 아쉽게도 홈 어시스턴트의 투야(Tuya) 통합은 배터리 수준을 부정확하게 표시했어요. 백분율이 아니라 100%에 대해 10.0, 65%에 대해 6.5와 같은 값으로 표시되었죠.\u003c/p\u003e\n\u003cp\u003e홈 어시스턴트 설정에 저의 저전력 경고를 관리하는 자동화가 있어요. 저는 이전에 홈 어시스턴트 템플릿에 관한 글에서 자세히 설명했어요. 이 도어벨 배터리를 위해 별도의 자동화를 만들 수도 있었지만, 9.0이나 6.5와 같은 이상한 배터리 수준을 보는 건 내성적인 제 자신에게 짜증났어요. 그래서 이 문제를 해결하기 위해 다른 옵션을 탐색하기로 결정했어요.\u003c/p\u003e\n\u003ch1\u003e간단한 해결책 시도: 템플릿 센서 사용\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e배터리 표시 문제를 해결하는 한 가지 간단한 방법은 홈 어시스턴트에 중복 템플릿 센서를 만드는 것이었습니다. 이 센서는 잘못된 배터리 값들을 가져와 값을 정수로 변환한 다음 10을 곱하여 올바른 백분율을 표시했습니다. 이를 수행하는 코드 일부를 제공해드리겠습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e템플릿:\n  센서:\n    - 이름: \u003cspan class=\"hljs-string\"\u003e'도어벨 배터리'\u003c/span\u003e\n      단위: \u003cspan class=\"hljs-string\"\u003e'%'\u003c/span\u003e\n      기기_클래스: 배터리\n      상태_클래스: \u003cspan class=\"hljs-string\"\u003e\"측정\"\u003c/span\u003e\n      상태: \u003e\n        { 배터리_상태 = 상태(\u003cspan class=\"hljs-string\"\u003e'센서.smart_video_doorbell_battery'\u003c/span\u003e) }\n        { 만약 배터리_상태 }\n          { (배터리_상태 | \u003cspan class=\"hljs-title function_\"\u003eint\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) * \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e }\n        { 그렇지 않다면 }\n          \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n        { 끝만약 }       \n      아이콘: \u003e\n        { 배터리_상태 = 상태(\u003cspan class=\"hljs-string\"\u003e'센서.smart_video_doorbell_battery'\u003c/span\u003e) }\n        { 만약 배터리_상태 }\n          { 새_상태 = (배터리_상태 | \u003cspan class=\"hljs-title function_\"\u003eint\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) * \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e }\n          { 만약 새_상태 \u003e \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e }\n            \u003cspan class=\"hljs-attr\"\u003emdi\u003c/span\u003e:battery-high\n          { 그렇지 않고 새_상태 \u003e \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e }\n            \u003cspan class=\"hljs-attr\"\u003emdi\u003c/span\u003e:battery-medium\n          { 그렇지 않고 새_상태 \u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e }\n            \u003cspan class=\"hljs-attr\"\u003emdi\u003c/span\u003e:battery-low\n          { 그 외에 }\n            \u003cspan class=\"hljs-attr\"\u003emdi\u003c/span\u003e:battery-outline\n          { 끝만약 }                                            \n        { 그렇지 않다면 }\n          \u003cspan class=\"hljs-attr\"\u003emdi\u003c/span\u003e:battery-outline\n        { 끝만약 }   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 방법으로 문제를 해결할 수는 있었지만, 원래 센서의 잘못된 값들을 실제로 수정하지는 못했습니다.\u003c/p\u003e\n\u003ch1\u003e더 나은 해결책: AppDaemon을 사용하여 센서 수정하기\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eAppDaemon은 이러한 문제를 처리하는 더 유연하고 동적인 방법을 제공합니다. AppDaemon 문서에 따르면, AppDaemon 앱에서 Home Assistant 엔티티의 값을 설정할 수 있습니다. 이 기능을 사용하여 실시간으로 센서 값을 수정하는 앱을 개발했습니다.\u003c/p\u003e\n\u003cp\u003e다음은 코드입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e appdaemon.\u003cspan class=\"hljs-property\"\u003eplugins\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehass\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehassapi\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e hass\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSensorMultiplier\u003c/span\u003e(hass.\u003cspan class=\"hljs-property\"\u003eHass\u003c/span\u003e):\n\n    def \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(self):\n        self.\u003cspan class=\"hljs-property\"\u003ebattery_entity\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"sensor.smart_video_doorbell_battery\"\u003c/span\u003e\n        self.\u003cspan class=\"hljs-title function_\"\u003elisten_state\u003c/span\u003e(self.\u003cspan class=\"hljs-property\"\u003esensor_changed\u003c/span\u003e, self.\u003cspan class=\"hljs-property\"\u003ebattery_entity\u003c/span\u003e)\n\n    def \u003cspan class=\"hljs-title function_\"\u003esensor_changed\u003c/span\u003e(self, entity, attribute, old, \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e, kwargs):\n        \u003cspan class=\"hljs-attr\"\u003etry\u003c/span\u003e:\n            battery_value = \u003cspan class=\"hljs-title function_\"\u003efloat\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e)\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e battery_value \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e:\n                new_value = battery_value * \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e\n\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e new_value \u003e \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e:\n                    icon = \u003cspan class=\"hljs-string\"\u003e\"mdi:battery-high\"\u003c/span\u003e\n                elif new_value \u003e \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e:\n                    icon = \u003cspan class=\"hljs-string\"\u003e\"mdi:battery-medium\"\u003c/span\u003e\n                elif new_value \u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e:\n                    icon = \u003cspan class=\"hljs-string\"\u003e\"mdi:battery-low\"\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n                    icon = \u003cspan class=\"hljs-string\"\u003e\"mdi:battery-outline\"\u003c/span\u003e\n\n                # \u003cspan class=\"hljs-title class_\"\u003eWrite\u003c/span\u003e back the \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e value to another sensor\n                self.\u003cspan class=\"hljs-title function_\"\u003eset_state\u003c/span\u003e(entity, state=new_value,\n                    attributes={\n                        \u003cspan class=\"hljs-string\"\u003e\"icon\"\u003c/span\u003e: icon,\n                        \u003cspan class=\"hljs-string\"\u003e\"device_class\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"battery\"\u003c/span\u003e\n                    }\n                )\n                self.\u003cspan class=\"hljs-title function_\"\u003eset_state\u003c/span\u003e(entity, state=new_value)\n        except \u003cspan class=\"hljs-title class_\"\u003eValueError\u003c/span\u003e:\n            self.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"Invalid sensor value: {new}\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003esensor_multiplier\u003c/span\u003e:\n  \u003cspan class=\"hljs-attr\"\u003emodule\u003c/span\u003e: sensor_multiplier\n  \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eSensorMultiplier\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 앱은 초인종 배터리 센서의 변경 사항을 감지합니다. 변경 사항이 감지되면 배터리 값을 10배로 곱하고 이 변경된 값을 사용하여 센서를 업데이트합니다. 또한 새로운 배터리 레벨에 따라 아이콘을 변경하여 배터리 상태를 빠르게 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e이 수정으로 배터리 센서가 이제 올바른 값을 표시합니다. Home Assistant에서 기기와 관련된 비슷한 문제를 겪고 있다면 AppDaemon을 시도해 보는 것을 권장합니다.\u003c/p\u003e\n\u003cp\u003eAppDaemon에 익숙하지 않다면 다른 문서에서 자세히 다룬 내용을 확인할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e스마트한 가정을 만들어 주세요!\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-19-FixingTuyaDeviceProblemsinHomeAssistantwithAppDaemon"},"buildId":"kkckKPyxcjJp_o8wb2unW","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>