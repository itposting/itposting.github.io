<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>예제와 함께 배우는 Zabbix 외부 검사 방법 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-22-ZabbixExternalchecksbyexample" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="예제와 함께 배우는 Zabbix 외부 검사 방법 | itposting" data-gatsby-head="true"/><meta property="og:title" content="예제와 함께 배우는 Zabbix 외부 검사 방법 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-22-ZabbixExternalchecksbyexample" data-gatsby-head="true"/><meta name="twitter:title" content="예제와 함께 배우는 Zabbix 외부 검사 방법 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-22 18:20" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/QYe6gFAUryFKFgjKBoIfo/_buildManifest.js" defer=""></script><script src="/_next/static/QYe6gFAUryFKFgjKBoIfo/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">예제와 함께 배우는 Zabbix 외부 검사 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="예제와 함께 배우는 Zabbix 외부 검사 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 22, 2024</span><span class="posts_reading_time__f7YPP">4<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-22-ZabbixExternalchecksbyexample&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<h2>샤오미 미지아 센서에서 데이터 가져오기</h2>
<p>얼마 전에 샤오미 미지아에서 온도 및 습도 센서를 구입했어요. 정확히 말하면 LYWSD03MMC예요. 빨리 매우 유용하다는 것이 증명되었지만, 측정값을 보기 위해 걸어가야 한다는 것은 상당히 귀찮았어요. 고민거리가 많은 세상이죠.</p>
<p>물론 휴대폰 앱을 사용하거나 샤오미 홈 허브를 구입할 수도 있겠지만, 그런 건 재미가 없잖아요? 대신 내가 이미 가지고 있는 것을 활용하기로 결정했어요 — 제 자신의 자비스 인스턴스. 그래서 여기 있어요.</p>
<h2>외부 점검</h2>
<div class="content-ad"></div>
<p>외부 검사(가끔 "외부 스크립트"라고 함)는 에이전트 미리 설치 방식의 모니터링 방법으로, Zabbix 에이전트가 필요하지 않습니다. 대신에 특정 스크립트가 호스트 설정에 따라 서버나 프록시 수준에서 실행됩니다. Zabbix가 스크립트를 실행하고 표준 출력에 표시될 것들을 수집합니다. 종료 코드는 고려되지 않습니다. 이 말은 스크립트가 중요한 것만을 표준 출력에 작성해야 한다는 것을 의미합니다.</p>
<h2>스크립트 준비</h2>
<p>의외로 누군가가 이 센서에서 데이터를 읽을 수 있는 스크립트를 이미 만들어 놓았습니다. GitHub에서 설치 지침과 함께 찾을 수 있지만, 완벽함을 위해 다음 명령어를 실행해야 합니다:</p>
<pre><code class="hljs language-js"># apt install python3 bluez python3-pip wget
# pip3 install bluepy requests
# wget <span class="hljs-attr">https</span>:<span class="hljs-comment">//raw.githubusercontent.com/JsBergbau/MiTemperature2/master/LYWSD03MMC.py -O /tmp/LYWSD03MMC.py</span>
</code></pre>
<div class="content-ad"></div>
<p>이 단계를 완료한 후에는 스크립트를 적절한 디렉토리에 배치해야 합니다. 정확한 경로는 서버 및 프록시 구성 파일에서 찾을 수있는 ExternalScripts 설정에 따라 다릅니다 (기본적으로 /usr/local/share/zabbix/externalscripts이지만 저는 /usr/lib/zabbix/externalscripts/를 사용하는 경향이 있습니다). External checks는 Zabbix 설치 중에 생성 된 zabbix 사용자로 실행됩니다. 모두 함께 넣어 봅시다.</p>
<pre><code class="hljs language-js"># cp /tmp/<span class="hljs-title class_">LYWSD03MMC</span>.<span class="hljs-property">py</span> /usr/lib/zabbix/externalscripts/
# chown <span class="hljs-attr">zabbix</span>:zabbix /usr/lib/zabbix/externalscripts<span class="hljs-comment">/*
# chmod ug+x /usr/lib/zabbix/externalscripts/LYWSD03MMC.py
</span></code></pre>
<p>zabbix 사용자가 어떠한 문제없이 실행할 수 있는지 확인하는 것이 중요합니다. Python 스크립트의 경우 대부분의 경우에 잘 작동하지만 쉘 스크립트의 경우 항상 그렇지는 않습니다. 일부 명령은 상위 권한이 필요할 수 있습니다.</p>
<p>장치의 실제 블루투스 주소로 <code>BT_MAC</code>을(를) 대체하는 것이 중요합니다. 찾는 가장 쉬운 방법은 Xiaomi Home 앱을 사용하는 것이며 센서를 등록하여 블루투스 연결을 활성화해야 합니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"># cd /usr/lib/zabbix/externalscripts/
# sudo -u zabbix ./<span class="hljs-title class_">LYWSD03MMC</span>.<span class="hljs-property">py</span> --device &#x3C;<span class="hljs-variable constant_">BT_MAC</span>> -c <span class="hljs-number">1</span>
---------------------------------------------
<span class="hljs-title class_">MiTemperature2</span> / <span class="hljs-variable constant_">ATC</span> <span class="hljs-title class_">Thermometer</span> version <span class="hljs-number">3.1</span>
---------------------------------------------
&#x3C;<span class="hljs-variable constant_">BT_MAC</span>>에 연결을 시도 중
온도: <span class="hljs-number">25.01</span>
습도: <span class="hljs-number">73</span>
배터리 전압: <span class="hljs-number">2.846</span> V
배터리 레벨: <span class="hljs-number">75</span>
측정값이 <span class="hljs-number">1</span>개 수집되었습니다. 잠시 후에 종료됩니다.
</code></pre>
<p>위의 단편과 유사한 내용을 확인할 수 있어야 합니다. 만약 실패한다면 문제를 해결하고 나서 진행하십시오. 또 다른 고려해야 할 점은 스크립트가 실행되는 시간입니다. 스크립트 실행 시간을 측정하고 실행 시간보다 약간 더 긴 값으로 Timeout 매개변수를 설정해야 합니다. 기본적으로 Timeout 매개변수는 3초입니다.</p>
<pre><code class="hljs language-js"># time ./<span class="hljs-title class_">LYWSD03MMC</span>.<span class="hljs-property">py</span> --device &#x3C;<span class="hljs-variable constant_">BT_MAC</span>> -c <span class="hljs-number">1</span>
---------------------------------------------
<span class="hljs-title class_">MiTemperature2</span> / <span class="hljs-variable constant_">ATC</span> <span class="hljs-title class_">Thermometer</span> version <span class="hljs-number">3.1</span>
---------------------------------------------
&#x3C;<span class="hljs-variable constant_">BT_MAC</span>>에 연결을 시도 중
온도: <span class="hljs-number">25.0</span>
습도: <span class="hljs-number">73</span>
배터리 전압: <span class="hljs-number">2.846</span> V
배터리 레벨: <span class="hljs-number">75</span>
측정값이 <span class="hljs-number">1</span>개 수집되었습니다. 잠시 후에 종료됩니다.
실제    <span class="hljs-number">0</span>분 <span class="hljs-number">14.956</span>초
사용자    <span class="hljs-number">0</span>분 <span class="hljs-number">3.670</span>초
시스템     <span class="hljs-number">0</span>분 <span class="hljs-number">0.373</span>초
</code></pre>
<p>15초가 걸렸다는 것을 알 수 있습니다. 스크립트가 fluke가 아니라 실행 시간이 실행마다 일관되게 나오는지 확인하기 위해 스크립트를 여러 번 실행하는 것이 좋습니다. 실행 시간이 30초를 넘어가면 최대 Timeout 값이 정확히 30초이므로 운이 좋지 못한 상황입니다. 사용자 정의 Zabbix 설치를 사용할 수 있지만, 스크립트를 최적화하거나 Zabbix 트랩을 사용하는 것이 좋은 해결책입니다.</p>
<div class="content-ad"></div>
<h2>항목 설정</h2>
<p>이 작업을 완료하면 템플릿 디자인으로 넘어갈 수 있습니다. 우리의 출력물이 평문인 만큼, 우리는 정규 표현식 전처리를 사용하는 종속 항목을 만들 것입니다. 그러나 먼저 외부 검사 자체를 생성해야 합니다.</p>
<p><img src="/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png" alt="image"></p>
<p>위 그림에서 볼 수 있듯이, 항목 키는 스크립트의 이름과 확장자를 포함합니다. 그런 다음 대괄호 안에는 스크립트에 전달되는 모든 매개변수가 포함됩니다. 해당 데이터는 종속 항목에서 추출될 것이므로 이 항목에 대한 히스토리를 저장하지 않습니다. 예를 들어, 온도 측정 항목은 다음과 같이 구성됩니다.</p>
<div class="content-ad"></div>
<p><code>&#x3C;img src="/assets/img/2024-06-22-ZabbixExternalchecksbyexample_1.png" /></code></p>
<p>이 방법으로는 Master 항목에서 모든 데이터를 그대로 복사합니다. 특정 부분만 추출하려면 전처리를 사용해야 합니다. 이 경우 캡처 그룹과 함께 정규식을 사용합니다.</p>
<p><code>&#x3C;img src="/assets/img/2024-06-22-ZabbixExternalchecksbyexample_2.png" /></code></p>
<h1>결론</h1>
<div class="content-ad"></div>
<p>이 기사에서는 Zabbix 기능 중 하나인 '외부 체크'에 대해 자세히 살펴보았습니다. 우리가 볼 수 있듯이, 이를 사용하여 다양한 소스에서 데이터를 수집할 수 있습니다. 그러나 지나치게 남용하지 않도록 주의하세요. 이는 Zabbix 성능에 상당한 감소를 일으킬 수 있습니다.</p>
<p>언제든지 궁금한 점이 있으시면 말씀해주세요. 전체 템플릿은 여기서 찾을 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"예제와 함께 배우는 Zabbix 외부 검사 방법","description":"","date":"2024-06-22 18:20","slug":"2024-06-22-ZabbixExternalchecksbyexample","content":"\n\n## 샤오미 미지아 센서에서 데이터 가져오기\n\n얼마 전에 샤오미 미지아에서 온도 및 습도 센서를 구입했어요. 정확히 말하면 LYWSD03MMC예요. 빨리 매우 유용하다는 것이 증명되었지만, 측정값을 보기 위해 걸어가야 한다는 것은 상당히 귀찮았어요. 고민거리가 많은 세상이죠.\n\n물론 휴대폰 앱을 사용하거나 샤오미 홈 허브를 구입할 수도 있겠지만, 그런 건 재미가 없잖아요? 대신 내가 이미 가지고 있는 것을 활용하기로 결정했어요 — 제 자신의 자비스 인스턴스. 그래서 여기 있어요.\n\n## 외부 점검\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n외부 검사(가끔 \"외부 스크립트\"라고 함)는 에이전트 미리 설치 방식의 모니터링 방법으로, Zabbix 에이전트가 필요하지 않습니다. 대신에 특정 스크립트가 호스트 설정에 따라 서버나 프록시 수준에서 실행됩니다. Zabbix가 스크립트를 실행하고 표준 출력에 표시될 것들을 수집합니다. 종료 코드는 고려되지 않습니다. 이 말은 스크립트가 중요한 것만을 표준 출력에 작성해야 한다는 것을 의미합니다.\n\n## 스크립트 준비\n\n의외로 누군가가 이 센서에서 데이터를 읽을 수 있는 스크립트를 이미 만들어 놓았습니다. GitHub에서 설치 지침과 함께 찾을 수 있지만, 완벽함을 위해 다음 명령어를 실행해야 합니다:\n\n```js\n# apt install python3 bluez python3-pip wget\n# pip3 install bluepy requests\n# wget https://raw.githubusercontent.com/JsBergbau/MiTemperature2/master/LYWSD03MMC.py -O /tmp/LYWSD03MMC.py\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 단계를 완료한 후에는 스크립트를 적절한 디렉토리에 배치해야 합니다. 정확한 경로는 서버 및 프록시 구성 파일에서 찾을 수있는 ExternalScripts 설정에 따라 다릅니다 (기본적으로 /usr/local/share/zabbix/externalscripts이지만 저는 /usr/lib/zabbix/externalscripts/를 사용하는 경향이 있습니다). External checks는 Zabbix 설치 중에 생성 된 zabbix 사용자로 실행됩니다. 모두 함께 넣어 봅시다.\n\n```js\n# cp /tmp/LYWSD03MMC.py /usr/lib/zabbix/externalscripts/\n# chown zabbix:zabbix /usr/lib/zabbix/externalscripts/*\n# chmod ug+x /usr/lib/zabbix/externalscripts/LYWSD03MMC.py\n```\n\nzabbix 사용자가 어떠한 문제없이 실행할 수 있는지 확인하는 것이 중요합니다. Python 스크립트의 경우 대부분의 경우에 잘 작동하지만 쉘 스크립트의 경우 항상 그렇지는 않습니다. 일부 명령은 상위 권한이 필요할 수 있습니다.\n\n장치의 실제 블루투스 주소로 `BT_MAC`을(를) 대체하는 것이 중요합니다. 찾는 가장 쉬운 방법은 Xiaomi Home 앱을 사용하는 것이며 센서를 등록하여 블루투스 연결을 활성화해야 합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n# cd /usr/lib/zabbix/externalscripts/\n# sudo -u zabbix ./LYWSD03MMC.py --device \u003cBT_MAC\u003e -c 1\n---------------------------------------------\nMiTemperature2 / ATC Thermometer version 3.1\n---------------------------------------------\n\u003cBT_MAC\u003e에 연결을 시도 중\n온도: 25.01\n습도: 73\n배터리 전압: 2.846 V\n배터리 레벨: 75\n측정값이 1개 수집되었습니다. 잠시 후에 종료됩니다.\n```\n\n위의 단편과 유사한 내용을 확인할 수 있어야 합니다. 만약 실패한다면 문제를 해결하고 나서 진행하십시오. 또 다른 고려해야 할 점은 스크립트가 실행되는 시간입니다. 스크립트 실행 시간을 측정하고 실행 시간보다 약간 더 긴 값으로 Timeout 매개변수를 설정해야 합니다. 기본적으로 Timeout 매개변수는 3초입니다. \n\n```js\n# time ./LYWSD03MMC.py --device \u003cBT_MAC\u003e -c 1\n---------------------------------------------\nMiTemperature2 / ATC Thermometer version 3.1\n---------------------------------------------\n\u003cBT_MAC\u003e에 연결을 시도 중\n온도: 25.0\n습도: 73\n배터리 전압: 2.846 V\n배터리 레벨: 75\n측정값이 1개 수집되었습니다. 잠시 후에 종료됩니다.\n실제    0분 14.956초\n사용자    0분 3.670초\n시스템     0분 0.373초\n```\n\n15초가 걸렸다는 것을 알 수 있습니다. 스크립트가 fluke가 아니라 실행 시간이 실행마다 일관되게 나오는지 확인하기 위해 스크립트를 여러 번 실행하는 것이 좋습니다. 실행 시간이 30초를 넘어가면 최대 Timeout 값이 정확히 30초이므로 운이 좋지 못한 상황입니다. 사용자 정의 Zabbix 설치를 사용할 수 있지만, 스크립트를 최적화하거나 Zabbix 트랩을 사용하는 것이 좋은 해결책입니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 항목 설정\n\n이 작업을 완료하면 템플릿 디자인으로 넘어갈 수 있습니다. 우리의 출력물이 평문인 만큼, 우리는 정규 표현식 전처리를 사용하는 종속 항목을 만들 것입니다. 그러나 먼저 외부 검사 자체를 생성해야 합니다.\n\n![image](/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png)\n\n위 그림에서 볼 수 있듯이, 항목 키는 스크립트의 이름과 확장자를 포함합니다. 그런 다음 대괄호 안에는 스크립트에 전달되는 모든 매개변수가 포함됩니다. 해당 데이터는 종속 항목에서 추출될 것이므로 이 항목에 대한 히스토리를 저장하지 않습니다. 예를 들어, 온도 측정 항목은 다음과 같이 구성됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n`\u003cimg src=\"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_1.png\" /\u003e`\n\n이 방법으로는 Master 항목에서 모든 데이터를 그대로 복사합니다. 특정 부분만 추출하려면 전처리를 사용해야 합니다. 이 경우 캡처 그룹과 함께 정규식을 사용합니다.\n\n`\u003cimg src=\"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_2.png\" /\u003e`\n\n# 결론\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 기사에서는 Zabbix 기능 중 하나인 '외부 체크'에 대해 자세히 살펴보았습니다. 우리가 볼 수 있듯이, 이를 사용하여 다양한 소스에서 데이터를 수집할 수 있습니다. 그러나 지나치게 남용하지 않도록 주의하세요. 이는 Zabbix 성능에 상당한 감소를 일으킬 수 있습니다.\n\n언제든지 궁금한 점이 있으시면 말씀해주세요. 전체 템플릿은 여기서 찾을 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png"},"coverImage":"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png","tag":["Tech"],"readingTime":4},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003ch2\u003e샤오미 미지아 센서에서 데이터 가져오기\u003c/h2\u003e\n\u003cp\u003e얼마 전에 샤오미 미지아에서 온도 및 습도 센서를 구입했어요. 정확히 말하면 LYWSD03MMC예요. 빨리 매우 유용하다는 것이 증명되었지만, 측정값을 보기 위해 걸어가야 한다는 것은 상당히 귀찮았어요. 고민거리가 많은 세상이죠.\u003c/p\u003e\n\u003cp\u003e물론 휴대폰 앱을 사용하거나 샤오미 홈 허브를 구입할 수도 있겠지만, 그런 건 재미가 없잖아요? 대신 내가 이미 가지고 있는 것을 활용하기로 결정했어요 — 제 자신의 자비스 인스턴스. 그래서 여기 있어요.\u003c/p\u003e\n\u003ch2\u003e외부 점검\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e외부 검사(가끔 \"외부 스크립트\"라고 함)는 에이전트 미리 설치 방식의 모니터링 방법으로, Zabbix 에이전트가 필요하지 않습니다. 대신에 특정 스크립트가 호스트 설정에 따라 서버나 프록시 수준에서 실행됩니다. Zabbix가 스크립트를 실행하고 표준 출력에 표시될 것들을 수집합니다. 종료 코드는 고려되지 않습니다. 이 말은 스크립트가 중요한 것만을 표준 출력에 작성해야 한다는 것을 의미합니다.\u003c/p\u003e\n\u003ch2\u003e스크립트 준비\u003c/h2\u003e\n\u003cp\u003e의외로 누군가가 이 센서에서 데이터를 읽을 수 있는 스크립트를 이미 만들어 놓았습니다. GitHub에서 설치 지침과 함께 찾을 수 있지만, 완벽함을 위해 다음 명령어를 실행해야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# apt install python3 bluez python3-pip wget\n# pip3 install bluepy requests\n# wget \u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//raw.githubusercontent.com/JsBergbau/MiTemperature2/master/LYWSD03MMC.py -O /tmp/LYWSD03MMC.py\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 단계를 완료한 후에는 스크립트를 적절한 디렉토리에 배치해야 합니다. 정확한 경로는 서버 및 프록시 구성 파일에서 찾을 수있는 ExternalScripts 설정에 따라 다릅니다 (기본적으로 /usr/local/share/zabbix/externalscripts이지만 저는 /usr/lib/zabbix/externalscripts/를 사용하는 경향이 있습니다). External checks는 Zabbix 설치 중에 생성 된 zabbix 사용자로 실행됩니다. 모두 함께 넣어 봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# cp /tmp/\u003cspan class=\"hljs-title class_\"\u003eLYWSD03MMC\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e /usr/lib/zabbix/externalscripts/\n# chown \u003cspan class=\"hljs-attr\"\u003ezabbix\u003c/span\u003e:zabbix /usr/lib/zabbix/externalscripts\u003cspan class=\"hljs-comment\"\u003e/*\n# chmod ug+x /usr/lib/zabbix/externalscripts/LYWSD03MMC.py\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ezabbix 사용자가 어떠한 문제없이 실행할 수 있는지 확인하는 것이 중요합니다. Python 스크립트의 경우 대부분의 경우에 잘 작동하지만 쉘 스크립트의 경우 항상 그렇지는 않습니다. 일부 명령은 상위 권한이 필요할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e장치의 실제 블루투스 주소로 \u003ccode\u003eBT_MAC\u003c/code\u003e을(를) 대체하는 것이 중요합니다. 찾는 가장 쉬운 방법은 Xiaomi Home 앱을 사용하는 것이며 센서를 등록하여 블루투스 연결을 활성화해야 합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# cd /usr/lib/zabbix/externalscripts/\n# sudo -u zabbix ./\u003cspan class=\"hljs-title class_\"\u003eLYWSD03MMC\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e --device \u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eBT_MAC\u003c/span\u003e\u003e -c \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n---------------------------------------------\n\u003cspan class=\"hljs-title class_\"\u003eMiTemperature2\u003c/span\u003e / \u003cspan class=\"hljs-variable constant_\"\u003eATC\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eThermometer\u003c/span\u003e version \u003cspan class=\"hljs-number\"\u003e3.1\u003c/span\u003e\n---------------------------------------------\n\u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eBT_MAC\u003c/span\u003e\u003e에 연결을 시도 중\n온도: \u003cspan class=\"hljs-number\"\u003e25.01\u003c/span\u003e\n습도: \u003cspan class=\"hljs-number\"\u003e73\u003c/span\u003e\n배터리 전압: \u003cspan class=\"hljs-number\"\u003e2.846\u003c/span\u003e V\n배터리 레벨: \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e\n측정값이 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e개 수집되었습니다. 잠시 후에 종료됩니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위의 단편과 유사한 내용을 확인할 수 있어야 합니다. 만약 실패한다면 문제를 해결하고 나서 진행하십시오. 또 다른 고려해야 할 점은 스크립트가 실행되는 시간입니다. 스크립트 실행 시간을 측정하고 실행 시간보다 약간 더 긴 값으로 Timeout 매개변수를 설정해야 합니다. 기본적으로 Timeout 매개변수는 3초입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e# time ./\u003cspan class=\"hljs-title class_\"\u003eLYWSD03MMC\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e --device \u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eBT_MAC\u003c/span\u003e\u003e -c \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n---------------------------------------------\n\u003cspan class=\"hljs-title class_\"\u003eMiTemperature2\u003c/span\u003e / \u003cspan class=\"hljs-variable constant_\"\u003eATC\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eThermometer\u003c/span\u003e version \u003cspan class=\"hljs-number\"\u003e3.1\u003c/span\u003e\n---------------------------------------------\n\u0026#x3C;\u003cspan class=\"hljs-variable constant_\"\u003eBT_MAC\u003c/span\u003e\u003e에 연결을 시도 중\n온도: \u003cspan class=\"hljs-number\"\u003e25.0\u003c/span\u003e\n습도: \u003cspan class=\"hljs-number\"\u003e73\u003c/span\u003e\n배터리 전압: \u003cspan class=\"hljs-number\"\u003e2.846\u003c/span\u003e V\n배터리 레벨: \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e\n측정값이 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e개 수집되었습니다. 잠시 후에 종료됩니다.\n실제    \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e분 \u003cspan class=\"hljs-number\"\u003e14.956\u003c/span\u003e초\n사용자    \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e분 \u003cspan class=\"hljs-number\"\u003e3.670\u003c/span\u003e초\n시스템     \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e분 \u003cspan class=\"hljs-number\"\u003e0.373\u003c/span\u003e초\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e15초가 걸렸다는 것을 알 수 있습니다. 스크립트가 fluke가 아니라 실행 시간이 실행마다 일관되게 나오는지 확인하기 위해 스크립트를 여러 번 실행하는 것이 좋습니다. 실행 시간이 30초를 넘어가면 최대 Timeout 값이 정확히 30초이므로 운이 좋지 못한 상황입니다. 사용자 정의 Zabbix 설치를 사용할 수 있지만, 스크립트를 최적화하거나 Zabbix 트랩을 사용하는 것이 좋은 해결책입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e항목 설정\u003c/h2\u003e\n\u003cp\u003e이 작업을 완료하면 템플릿 디자인으로 넘어갈 수 있습니다. 우리의 출력물이 평문인 만큼, 우리는 정규 표현식 전처리를 사용하는 종속 항목을 만들 것입니다. 그러나 먼저 외부 검사 자체를 생성해야 합니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e위 그림에서 볼 수 있듯이, 항목 키는 스크립트의 이름과 확장자를 포함합니다. 그런 다음 대괄호 안에는 스크립트에 전달되는 모든 매개변수가 포함됩니다. 해당 데이터는 종속 항목에서 추출될 것이므로 이 항목에 대한 히스토리를 저장하지 않습니다. 예를 들어, 온도 측정 항목은 다음과 같이 구성됩니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003e\u0026#x3C;img src=\"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_1.png\" /\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e이 방법으로는 Master 항목에서 모든 데이터를 그대로 복사합니다. 특정 부분만 추출하려면 전처리를 사용해야 합니다. 이 경우 캡처 그룹과 함께 정규식을 사용합니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\u0026#x3C;img src=\"/assets/img/2024-06-22-ZabbixExternalchecksbyexample_2.png\" /\u003e\u003c/code\u003e\u003c/p\u003e\n\u003ch1\u003e결론\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 기사에서는 Zabbix 기능 중 하나인 '외부 체크'에 대해 자세히 살펴보았습니다. 우리가 볼 수 있듯이, 이를 사용하여 다양한 소스에서 데이터를 수집할 수 있습니다. 그러나 지나치게 남용하지 않도록 주의하세요. 이는 Zabbix 성능에 상당한 감소를 일으킬 수 있습니다.\u003c/p\u003e\n\u003cp\u003e언제든지 궁금한 점이 있으시면 말씀해주세요. 전체 템플릿은 여기서 찾을 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-22-ZabbixExternalchecksbyexample"},"buildId":"QYe6gFAUryFKFgjKBoIfo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>