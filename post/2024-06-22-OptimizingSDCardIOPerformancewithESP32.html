<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>ESP32로 SD 카드 IO 성능 최적화하는 방법 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-22-OptimizingSDCardIOPerformancewithESP32" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="ESP32로 SD 카드 IO 성능 최적화하는 방법 | itposting" data-gatsby-head="true"/><meta property="og:title" content="ESP32로 SD 카드 IO 성능 최적화하는 방법 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-22-OptimizingSDCardIOPerformancewithESP32" data-gatsby-head="true"/><meta name="twitter:title" content="ESP32로 SD 카드 IO 성능 최적화하는 방법 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-22 18:42" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/QYe6gFAUryFKFgjKBoIfo/_buildManifest.js" defer=""></script><script src="/_next/static/QYe6gFAUryFKFgjKBoIfo/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">ESP32로 SD 카드 IO 성능 최적화하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="ESP32로 SD 카드 IO 성능 최적화하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 22, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-22-OptimizingSDCardIOPerformancewithESP32&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<h1>저에 대해</h1>
<p>안녕하세요, 저는 지위 마오입니다. 지반공학 기술자이자 IoT 시스템에 열정을 가진 사람입니다. 저는 저전력 마이크로컨트롤러와 LoRa 통신 시스템을 연구하여 취미로 사용할 수 있는 원격 모니터링 솔루션부터 산업용 모니터링 또는 제어 시스템을 구축하고 있습니다. 제 웹사이트를 방문해주세요: <a href="https://www.qiweimao.dev/blog" rel="nofollow" target="_blank">https://www.qiweimao.dev/blog</a></p>
<p>LinkedIn | Github | Reddit | X</p>
<h1>많은 파일로 인해 SD 카드 I/O 속도가 느려지는 이유</h1>
<div class="content-ad"></div>
<p>SD 카드의 단일 폴더에 대량의 파일을 축적하면 파일 시스템(FAT32 또는 exFAT과 같은 SD 카드용)이 파일을 찾거나 열기 위해 디렉터리 항목을 검색해야 합니다. 파일이 증가함에 따라 이 디렉터리 검색 프로세스는 느려질 수 있습니다. 그 이유는 다음과 같습니다:</p>
<ul>
<li>디렉터리 항목: FAT32와 exFAT은 디렉터리 항목을 선형 목록에 저장합니다. 파일이 늘어날수록 이 목록을 검색하는 시간이 선형적으로 증가하므로 특정 파일을 찾거나 열 때 상당히 더 많은 시간이 걸릴 수 있습니다.</li>
<li>단편화: 파일이 생성되고 삭제되며 수정되면 시간이 지남에 따라 단편화가 발생할 수 있습니다. 이는 파일의 일부가 SD 카드의 다른 물리적 위치에 퍼져 있을 수 있어 파일을 읽는 데 걸리는 시간을 증가시킬 수 있습니다.</li>
<li>클러스터 할당: 각 파일 및 디렉터리 항목에는 클러스터 할당이 필요하며, 이는 파일 할당 테이블(FAT)에 의해 관리됩니다. 많은 파일을 처리할수록 이러한 할당을 업데이트하고 관리하는 과정이 더 복잡하고 시간이 많이 소요됩니다.</li>
</ul>
<h1>입출력 테스트</h1>
<p>다음은 단일 디렉터리의 모든 파일을 기록하는 것과 하위 폴더 전략을 사용하는 것 사이의 속도 차이를 비교하는 두 테스트 프로그램에 대한 개요입니다. 이 프로그램은 각 쓰기 동작에 걸리는 시간을 기록하고 이 정보를 로그 파일에 저장할 것입니다. ESP32는 500ms마다 파일 쓰기 동작을 시작할 것입니다.</p>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png" alt="Optimizing SD Card I/O Performance with ESP32"></p>
<p>ESP32에서 SD 카드 I/O의 성능 분석 결과, 파일을 하나의 폴더에 저장하는 것과 분 단위로 서브폴더에 구성하는 것 사이에 명확한 추세 차이가 나타납니다.</p>
<p>하나의 폴더에 순차적으로 파일을 저장하는 경우 파일 수가 증가함에 따라 파일 I/O 시간이 선형적으로 증가하는 것을 확인할 수 있습니다. 이는 대량 디렉토리 내의 파일 접근 및 관리가 검색 및 검색 시간이 증가하여 점진적으로 느려진다는 것을 시사합니다. 반면에, 서브폴더 접근 방식은 초기에는 I/O 시간이 비슷하게 증가하지만 새 파일이 새로운 서브폴더로 이동함에 따라 접근 시간이 간헐적으로 감소합니다.</p>
<p>이 현상은 파일을 작은 시간 기반 클러스터로 조직화하는 것이 단일 폴더 저장 과정에서 관찰된 성능 하락을 완화하는 것을 나타냅니다. 이러한 조직 전략은 액세스 속도를 최적화할 뿐만 아니라 저장 부하를 관리 가능한 하위 집합에 분산하여 전체 시스템 효율성을 향상시킬 수 있습니다.</p>
<div class="content-ad"></div>
<h3>프로그램 1: 단일 디렉토리 로깅</h3>
<pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;Arduino.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;SD.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;SPI.h></span></span>

<span class="hljs-type">const</span> <span class="hljs-type">int</span> chipSelect = <span class="hljs-number">5</span>;
<span class="hljs-type">const</span> String dataFolder = <span class="hljs-string">"/data"</span>;
<span class="hljs-type">const</span> String logFileName = <span class="hljs-string">"/io_time_log_single.txt"</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> interval = <span class="hljs-number">500</span>; <span class="hljs-comment">// 1분 간격</span>
<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> previousMillis = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  Serial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>);
  <span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">begin</span>(chipSelect)) {
    Serial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"카드 연결 실패 또는 없음"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>);
  }
  <span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">exists</span>(dataFolder)) {
    SD.<span class="hljs-built_in">mkdir</span>(dataFolder);
  }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">logData</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start = <span class="hljs-built_in">millis</span>();
  String fileName = dataFolder + <span class="hljs-string">"/data_"</span> + <span class="hljs-built_in">String</span>(start) + <span class="hljs-string">".txt"</span>;
  File dataFile = SD.<span class="hljs-built_in">open</span>(fileName, FILE_WRITE);

  <span class="hljs-keyword">if</span> (dataFile) {
    dataFile.<span class="hljs-built_in">println</span>(<span class="hljs-string">"더미 시계열 데이터"</span>);
    dataFile.<span class="hljs-built_in">close</span>();
  }

  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> end = <span class="hljs-built_in">millis</span>();
  File logFile = SD.<span class="hljs-built_in">open</span>(logFileName, FILE_APPEND);
  <span class="hljs-keyword">if</span> (logFile) {
    logFile.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">String</span>(start) + <span class="hljs-string">","</span> + <span class="hljs-built_in">String</span>(end - start));
    logFile.<span class="hljs-built_in">close</span>();
  }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> currentMillis = <span class="hljs-built_in">millis</span>();
  <span class="hljs-keyword">if</span> (currentMillis - previousMillis >= interval) {
    previousMillis = currentMillis;
    <span class="hljs-built_in">logData</span>();
  }
}
</code></pre>
<h3>프로그램 2: 서브폴더 전략 로깅</h3>
<pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;Arduino.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;SD.h></span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&#x3C;SPI.h></span></span>
<span class="hljs-type">const</span> <span class="hljs-type">int</span> chipSelect = <span class="hljs-number">5</span>;
<span class="hljs-type">const</span> String dataFolder = <span class="hljs-string">"/data"</span>;
<span class="hljs-type">const</span> String logFileName = <span class="hljs-string">"/io_time_log_subfolder.txt"</span>;
<span class="hljs-type">const</span> <span class="hljs-type">int</span> interval = <span class="hljs-number">500</span>; <span class="hljs-comment">// 1분 간격</span>
<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> previousMillis = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
 Serial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>);
 <span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">begin</span>(chipSelect)) {
 Serial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"카드 연결 실패 또는 없음"</span>);
 <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>);
 }
 <span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">exists</span>(dataFolder)) {
 SD.<span class="hljs-built_in">mkdir</span>(dataFolder);
 }
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createDirectories</span><span class="hljs-params">(String path)</span> </span>{
 String subPath = <span class="hljs-string">""</span>;
 <span class="hljs-type">int</span> start = <span class="hljs-number">0</span>;
 <span class="hljs-type">int</span> end = path.<span class="hljs-built_in">indexOf</span>(<span class="hljs-string">'/'</span>, start);
<span class="hljs-keyword">while</span> (end != <span class="hljs-number">-1</span>) {
 subPath = path.<span class="hljs-built_in">substring</span>(<span class="hljs-number">0</span>, end);
 <span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">exists</span>(subPath)) {
 SD.<span class="hljs-built_in">mkdir</span>(subPath);
 }
 start = end + <span class="hljs-number">1</span>;
 end = path.<span class="hljs-built_in">indexOf</span>(<span class="hljs-string">'/'</span>, start);
 }
<span class="hljs-keyword">if</span> (!SD.<span class="hljs-built_in">exists</span>(path)) {
 SD.<span class="hljs-built_in">mkdir</span>(path);
 }
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">logData</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start = <span class="hljs-built_in">millis</span>();
 
 <span class="hljs-comment">// 현재 밀리초 단위 시간을 기준으로 서브폴더 생성</span>
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> totalMinutes = start / <span class="hljs-number">60000</span>;
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> totalHours = totalMinutes / <span class="hljs-number">60</span>;
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> totalDays = totalHours / <span class="hljs-number">24</span>;
String day = <span class="hljs-built_in">String</span>(totalDays);
 String hour = <span class="hljs-built_in">String</span>(totalHours % <span class="hljs-number">24</span>);
 String minute = <span class="hljs-built_in">String</span>(totalMinutes % <span class="hljs-number">60</span>);
String subFolder = dataFolder + <span class="hljs-string">"/"</span> + day + <span class="hljs-string">"/"</span> + hour + <span class="hljs-string">"/"</span> + minute;
 <span class="hljs-built_in">createDirectories</span>(subFolder);
String fileName = subFolder + <span class="hljs-string">"/data_"</span> + <span class="hljs-built_in">String</span>(start) + <span class="hljs-string">".txt"</span>;
 
 start = <span class="hljs-built_in">millis</span>();
 File dataFile = SD.<span class="hljs-built_in">open</span>(fileName, FILE_WRITE);
 <span class="hljs-keyword">if</span> (dataFile) {
 dataFile.<span class="hljs-built_in">println</span>(<span class="hljs-string">"더미 시계열 데이터"</span>);
 dataFile.<span class="hljs-built_in">close</span>();
 }
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> end = <span class="hljs-built_in">millis</span>();
 
 File logFile = SD.<span class="hljs-built_in">open</span>(logFileName, FILE_APPEND);
 <span class="hljs-keyword">if</span> (logFile) {
 logFile.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">String</span>(start) + <span class="hljs-string">","</span> + <span class="hljs-built_in">String</span>(end - start));
 logFile.<span class="hljs-built_in">close</span>();
 }
}
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
 <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> currentMillis = <span class="hljs-built_in">millis</span>();
 <span class="hljs-keyword">if</span> (currentMillis - previousMillis >= interval) {
 previousMillis = currentMillis;
 <span class="hljs-built_in">logData</span>();
 }
}
</code></pre>
<div class="content-ad"></div>
<h1>결론</h1>
<p>파일을 하위 디렉터리로 구성하고, 바이너리 형식을 사용하며, 메모리 내 메타데이터를 유지하고, 쓰기와 읽기 모두 최적화된 파일 구조를 사용함으로써 ESP32 데이터 로거의 I/O 성능을 크게 향상시킬 수 있습니다. 이러한 전략은 많은 수의 파일을 관리하고 LoRa 네트워크를 통해 효율적인 데이터 검색 및 전송을 보장하는 데 도움이 될 것입니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ESP32로 SD 카드 IO 성능 최적화하는 방법","description":"","date":"2024-06-22 18:42","slug":"2024-06-22-OptimizingSDCardIOPerformancewithESP32","content":"\n\n# 저에 대해\n\n안녕하세요, 저는 지위 마오입니다. 지반공학 기술자이자 IoT 시스템에 열정을 가진 사람입니다. 저는 저전력 마이크로컨트롤러와 LoRa 통신 시스템을 연구하여 취미로 사용할 수 있는 원격 모니터링 솔루션부터 산업용 모니터링 또는 제어 시스템을 구축하고 있습니다. 제 웹사이트를 방문해주세요: https://www.qiweimao.dev/blog\n\nLinkedIn | Github | Reddit | X\n\n# 많은 파일로 인해 SD 카드 I/O 속도가 느려지는 이유\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nSD 카드의 단일 폴더에 대량의 파일을 축적하면 파일 시스템(FAT32 또는 exFAT과 같은 SD 카드용)이 파일을 찾거나 열기 위해 디렉터리 항목을 검색해야 합니다. 파일이 증가함에 따라 이 디렉터리 검색 프로세스는 느려질 수 있습니다. 그 이유는 다음과 같습니다:\n\n- 디렉터리 항목: FAT32와 exFAT은 디렉터리 항목을 선형 목록에 저장합니다. 파일이 늘어날수록 이 목록을 검색하는 시간이 선형적으로 증가하므로 특정 파일을 찾거나 열 때 상당히 더 많은 시간이 걸릴 수 있습니다.\n- 단편화: 파일이 생성되고 삭제되며 수정되면 시간이 지남에 따라 단편화가 발생할 수 있습니다. 이는 파일의 일부가 SD 카드의 다른 물리적 위치에 퍼져 있을 수 있어 파일을 읽는 데 걸리는 시간을 증가시킬 수 있습니다.\n- 클러스터 할당: 각 파일 및 디렉터리 항목에는 클러스터 할당이 필요하며, 이는 파일 할당 테이블(FAT)에 의해 관리됩니다. 많은 파일을 처리할수록 이러한 할당을 업데이트하고 관리하는 과정이 더 복잡하고 시간이 많이 소요됩니다.\n\n# 입출력 테스트\n\n다음은 단일 디렉터리의 모든 파일을 기록하는 것과 하위 폴더 전략을 사용하는 것 사이의 속도 차이를 비교하는 두 테스트 프로그램에 대한 개요입니다. 이 프로그램은 각 쓰기 동작에 걸리는 시간을 기록하고 이 정보를 로그 파일에 저장할 것입니다. ESP32는 500ms마다 파일 쓰기 동작을 시작할 것입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![Optimizing SD Card I/O Performance with ESP32](/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png)\n\nESP32에서 SD 카드 I/O의 성능 분석 결과, 파일을 하나의 폴더에 저장하는 것과 분 단위로 서브폴더에 구성하는 것 사이에 명확한 추세 차이가 나타납니다.\n\n하나의 폴더에 순차적으로 파일을 저장하는 경우 파일 수가 증가함에 따라 파일 I/O 시간이 선형적으로 증가하는 것을 확인할 수 있습니다. 이는 대량 디렉토리 내의 파일 접근 및 관리가 검색 및 검색 시간이 증가하여 점진적으로 느려진다는 것을 시사합니다. 반면에, 서브폴더 접근 방식은 초기에는 I/O 시간이 비슷하게 증가하지만 새 파일이 새로운 서브폴더로 이동함에 따라 접근 시간이 간헐적으로 감소합니다.\n\n이 현상은 파일을 작은 시간 기반 클러스터로 조직화하는 것이 단일 폴더 저장 과정에서 관찰된 성능 하락을 완화하는 것을 나타냅니다. 이러한 조직 전략은 액세스 속도를 최적화할 뿐만 아니라 저장 부하를 관리 가능한 하위 집합에 분산하여 전체 시스템 효율성을 향상시킬 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n### 프로그램 1: 단일 디렉토리 로깅\n\n```cpp\n#include \u003cArduino.h\u003e\n#include \u003cSD.h\u003e\n#include \u003cSPI.h\u003e\n\nconst int chipSelect = 5;\nconst String dataFolder = \"/data\";\nconst String logFileName = \"/io_time_log_single.txt\";\nconst int interval = 500; // 1분 간격\nunsigned long previousMillis = 0;\n\nvoid setup() {\n  Serial.begin(115200);\n  if (!SD.begin(chipSelect)) {\n    Serial.println(\"카드 연결 실패 또는 없음\");\n    while (1);\n  }\n  if (!SD.exists(dataFolder)) {\n    SD.mkdir(dataFolder);\n  }\n}\n\nvoid logData() {\n  unsigned long start = millis();\n  String fileName = dataFolder + \"/data_\" + String(start) + \".txt\";\n  File dataFile = SD.open(fileName, FILE_WRITE);\n\n  if (dataFile) {\n    dataFile.println(\"더미 시계열 데이터\");\n    dataFile.close();\n  }\n\n  unsigned long end = millis();\n  File logFile = SD.open(logFileName, FILE_APPEND);\n  if (logFile) {\n    logFile.println(String(start) + \",\" + String(end - start));\n    logFile.close();\n  }\n}\n\nvoid loop() {\n  unsigned long currentMillis = millis();\n  if (currentMillis - previousMillis \u003e= interval) {\n    previousMillis = currentMillis;\n    logData();\n  }\n}\n```\n\n### 프로그램 2: 서브폴더 전략 로깅\n\n```cpp\n#include \u003cArduino.h\u003e\n#include \u003cSD.h\u003e\n#include \u003cSPI.h\u003e\nconst int chipSelect = 5;\nconst String dataFolder = \"/data\";\nconst String logFileName = \"/io_time_log_subfolder.txt\";\nconst int interval = 500; // 1분 간격\nunsigned long previousMillis = 0;\nvoid setup() {\n Serial.begin(115200);\n if (!SD.begin(chipSelect)) {\n Serial.println(\"카드 연결 실패 또는 없음\");\n while (1);\n }\n if (!SD.exists(dataFolder)) {\n SD.mkdir(dataFolder);\n }\n}\nvoid createDirectories(String path) {\n String subPath = \"\";\n int start = 0;\n int end = path.indexOf('/', start);\nwhile (end != -1) {\n subPath = path.substring(0, end);\n if (!SD.exists(subPath)) {\n SD.mkdir(subPath);\n }\n start = end + 1;\n end = path.indexOf('/', start);\n }\nif (!SD.exists(path)) {\n SD.mkdir(path);\n }\n}\nvoid logData() {\n unsigned long start = millis();\n \n // 현재 밀리초 단위 시간을 기준으로 서브폴더 생성\n unsigned long totalMinutes = start / 60000;\n unsigned long totalHours = totalMinutes / 60;\n unsigned long totalDays = totalHours / 24;\nString day = String(totalDays);\n String hour = String(totalHours % 24);\n String minute = String(totalMinutes % 60);\nString subFolder = dataFolder + \"/\" + day + \"/\" + hour + \"/\" + minute;\n createDirectories(subFolder);\nString fileName = subFolder + \"/data_\" + String(start) + \".txt\";\n \n start = millis();\n File dataFile = SD.open(fileName, FILE_WRITE);\n if (dataFile) {\n dataFile.println(\"더미 시계열 데이터\");\n dataFile.close();\n }\n unsigned long end = millis();\n \n File logFile = SD.open(logFileName, FILE_APPEND);\n if (logFile) {\n logFile.println(String(start) + \",\" + String(end - start));\n logFile.close();\n }\n}\nvoid loop() {\n unsigned long currentMillis = millis();\n if (currentMillis - previousMillis \u003e= interval) {\n previousMillis = currentMillis;\n logData();\n }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 결론\n\n파일을 하위 디렉터리로 구성하고, 바이너리 형식을 사용하며, 메모리 내 메타데이터를 유지하고, 쓰기와 읽기 모두 최적화된 파일 구조를 사용함으로써 ESP32 데이터 로거의 I/O 성능을 크게 향상시킬 수 있습니다. 이러한 전략은 많은 수의 파일을 관리하고 LoRa 네트워크를 통해 효율적인 데이터 검색 및 전송을 보장하는 데 도움이 될 것입니다.","ogImage":{"url":"/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png"},"coverImage":"/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png","tag":["Tech"],"readingTime":5},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003ch1\u003e저에 대해\u003c/h1\u003e\n\u003cp\u003e안녕하세요, 저는 지위 마오입니다. 지반공학 기술자이자 IoT 시스템에 열정을 가진 사람입니다. 저는 저전력 마이크로컨트롤러와 LoRa 통신 시스템을 연구하여 취미로 사용할 수 있는 원격 모니터링 솔루션부터 산업용 모니터링 또는 제어 시스템을 구축하고 있습니다. 제 웹사이트를 방문해주세요: \u003ca href=\"https://www.qiweimao.dev/blog\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://www.qiweimao.dev/blog\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eLinkedIn | Github | Reddit | X\u003c/p\u003e\n\u003ch1\u003e많은 파일로 인해 SD 카드 I/O 속도가 느려지는 이유\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eSD 카드의 단일 폴더에 대량의 파일을 축적하면 파일 시스템(FAT32 또는 exFAT과 같은 SD 카드용)이 파일을 찾거나 열기 위해 디렉터리 항목을 검색해야 합니다. 파일이 증가함에 따라 이 디렉터리 검색 프로세스는 느려질 수 있습니다. 그 이유는 다음과 같습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e디렉터리 항목: FAT32와 exFAT은 디렉터리 항목을 선형 목록에 저장합니다. 파일이 늘어날수록 이 목록을 검색하는 시간이 선형적으로 증가하므로 특정 파일을 찾거나 열 때 상당히 더 많은 시간이 걸릴 수 있습니다.\u003c/li\u003e\n\u003cli\u003e단편화: 파일이 생성되고 삭제되며 수정되면 시간이 지남에 따라 단편화가 발생할 수 있습니다. 이는 파일의 일부가 SD 카드의 다른 물리적 위치에 퍼져 있을 수 있어 파일을 읽는 데 걸리는 시간을 증가시킬 수 있습니다.\u003c/li\u003e\n\u003cli\u003e클러스터 할당: 각 파일 및 디렉터리 항목에는 클러스터 할당이 필요하며, 이는 파일 할당 테이블(FAT)에 의해 관리됩니다. 많은 파일을 처리할수록 이러한 할당을 업데이트하고 관리하는 과정이 더 복잡하고 시간이 많이 소요됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e입출력 테스트\u003c/h1\u003e\n\u003cp\u003e다음은 단일 디렉터리의 모든 파일을 기록하는 것과 하위 폴더 전략을 사용하는 것 사이의 속도 차이를 비교하는 두 테스트 프로그램에 대한 개요입니다. 이 프로그램은 각 쓰기 동작에 걸리는 시간을 기록하고 이 정보를 로그 파일에 저장할 것입니다. ESP32는 500ms마다 파일 쓰기 동작을 시작할 것입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-OptimizingSDCardIOPerformancewithESP32_0.png\" alt=\"Optimizing SD Card I/O Performance with ESP32\"\u003e\u003c/p\u003e\n\u003cp\u003eESP32에서 SD 카드 I/O의 성능 분석 결과, 파일을 하나의 폴더에 저장하는 것과 분 단위로 서브폴더에 구성하는 것 사이에 명확한 추세 차이가 나타납니다.\u003c/p\u003e\n\u003cp\u003e하나의 폴더에 순차적으로 파일을 저장하는 경우 파일 수가 증가함에 따라 파일 I/O 시간이 선형적으로 증가하는 것을 확인할 수 있습니다. 이는 대량 디렉토리 내의 파일 접근 및 관리가 검색 및 검색 시간이 증가하여 점진적으로 느려진다는 것을 시사합니다. 반면에, 서브폴더 접근 방식은 초기에는 I/O 시간이 비슷하게 증가하지만 새 파일이 새로운 서브폴더로 이동함에 따라 접근 시간이 간헐적으로 감소합니다.\u003c/p\u003e\n\u003cp\u003e이 현상은 파일을 작은 시간 기반 클러스터로 조직화하는 것이 단일 폴더 저장 과정에서 관찰된 성능 하락을 완화하는 것을 나타냅니다. 이러한 조직 전략은 액세스 속도를 최적화할 뿐만 아니라 저장 부하를 관리 가능한 하위 집합에 분산하여 전체 시스템 효율성을 향상시킬 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch3\u003e프로그램 1: 단일 디렉토리 로깅\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;Arduino.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;SD.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;SPI.h\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e chipSelect = \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e String dataFolder = \u003cspan class=\"hljs-string\"\u003e\"/data\"\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e String logFileName = \u003cspan class=\"hljs-string\"\u003e\"/io_time_log_single.txt\"\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e interval = \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 1분 간격\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e previousMillis = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetup\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n  Serial.\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e115200\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e(chipSelect)) {\n    Serial.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"카드 연결 실패 또는 없음\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003eexists\u003c/span\u003e(dataFolder)) {\n    SD.\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e(dataFolder);\n  }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003elogData\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e start = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n  String fileName = dataFolder + \u003cspan class=\"hljs-string\"\u003e\"/data_\"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(start) + \u003cspan class=\"hljs-string\"\u003e\".txt\"\u003c/span\u003e;\n  File dataFile = SD.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(fileName, FILE_WRITE);\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (dataFile) {\n    dataFile.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"더미 시계열 데이터\"\u003c/span\u003e);\n    dataFile.\u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e();\n  }\n\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e end = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n  File logFile = SD.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(logFileName, FILE_APPEND);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (logFile) {\n    logFile.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(start) + \u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(end - start));\n    logFile.\u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e();\n  }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloop\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e currentMillis = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (currentMillis - previousMillis \u003e= interval) {\n    previousMillis = currentMillis;\n    \u003cspan class=\"hljs-built_in\"\u003elogData\u003c/span\u003e();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e프로그램 2: 서브폴더 전략 로깅\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;Arduino.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;SD.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x3C;SPI.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e chipSelect = \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e String dataFolder = \u003cspan class=\"hljs-string\"\u003e\"/data\"\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e String logFileName = \u003cspan class=\"hljs-string\"\u003e\"/io_time_log_subfolder.txt\"\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e interval = \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 1분 간격\u003c/span\u003e\n\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e previousMillis = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetup\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n Serial.\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e115200\u003c/span\u003e);\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e(chipSelect)) {\n Serial.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"카드 연결 실패 또는 없음\"\u003c/span\u003e);\n \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n }\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003eexists\u003c/span\u003e(dataFolder)) {\n SD.\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e(dataFolder);\n }\n}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateDirectories\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(String path)\u003c/span\u003e \u003c/span\u003e{\n String subPath = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e;\n \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e start = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e end = path.\u003cspan class=\"hljs-built_in\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, start);\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (end != \u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) {\n subPath = path.\u003cspan class=\"hljs-built_in\"\u003esubstring\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, end);\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003eexists\u003c/span\u003e(subPath)) {\n SD.\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e(subPath);\n }\n start = end + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n end = path.\u003cspan class=\"hljs-built_in\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e, start);\n }\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!SD.\u003cspan class=\"hljs-built_in\"\u003eexists\u003c/span\u003e(path)) {\n SD.\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e(path);\n }\n}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003elogData\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e start = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n \n \u003cspan class=\"hljs-comment\"\u003e// 현재 밀리초 단위 시간을 기준으로 서브폴더 생성\u003c/span\u003e\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e totalMinutes = start / \u003cspan class=\"hljs-number\"\u003e60000\u003c/span\u003e;\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e totalHours = totalMinutes / \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e;\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e totalDays = totalHours / \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e;\nString day = \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(totalDays);\n String hour = \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(totalHours % \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e);\n String minute = \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(totalMinutes % \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e);\nString subFolder = dataFolder + \u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e + day + \u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e + hour + \u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e + minute;\n \u003cspan class=\"hljs-built_in\"\u003ecreateDirectories\u003c/span\u003e(subFolder);\nString fileName = subFolder + \u003cspan class=\"hljs-string\"\u003e\"/data_\"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(start) + \u003cspan class=\"hljs-string\"\u003e\".txt\"\u003c/span\u003e;\n \n start = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n File dataFile = SD.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(fileName, FILE_WRITE);\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (dataFile) {\n dataFile.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"더미 시계열 데이터\"\u003c/span\u003e);\n dataFile.\u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e();\n }\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e end = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n \n File logFile = SD.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(logFileName, FILE_APPEND);\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (logFile) {\n logFile.\u003cspan class=\"hljs-built_in\"\u003eprintln\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(start) + \u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003eString\u003c/span\u003e(end - start));\n logFile.\u003cspan class=\"hljs-built_in\"\u003eclose\u003c/span\u003e();\n }\n}\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloop\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e currentMillis = \u003cspan class=\"hljs-built_in\"\u003emillis\u003c/span\u003e();\n \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (currentMillis - previousMillis \u003e= interval) {\n previousMillis = currentMillis;\n \u003cspan class=\"hljs-built_in\"\u003elogData\u003c/span\u003e();\n }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e결론\u003c/h1\u003e\n\u003cp\u003e파일을 하위 디렉터리로 구성하고, 바이너리 형식을 사용하며, 메모리 내 메타데이터를 유지하고, 쓰기와 읽기 모두 최적화된 파일 구조를 사용함으로써 ESP32 데이터 로거의 I/O 성능을 크게 향상시킬 수 있습니다. 이러한 전략은 많은 수의 파일을 관리하고 LoRa 네트워크를 통해 효율적인 데이터 검색 및 전송을 보장하는 데 도움이 될 것입니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-22-OptimizingSDCardIOPerformancewithESP32"},"buildId":"QYe6gFAUryFKFgjKBoIfo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>