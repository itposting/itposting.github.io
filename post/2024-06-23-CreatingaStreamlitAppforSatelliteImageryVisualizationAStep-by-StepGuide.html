<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드 | itposting" data-gatsby-head="true"/><meta property="og:title" content="위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide" data-gatsby-head="true"/><meta name="twitter:title" content="위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 15:59" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/kkckKPyxcjJp_o8wb2unW/_buildManifest.js" defer=""></script><script src="/_next/static/kkckKPyxcjJp_o8wb2unW/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">16<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*DZ2rEeyOTUZ2bWq8FnvJ2w.gif" alt="image"></p>
<h1>Table of Contents</h1>
<ul>
<li>🌟 Introduction</li>
<li>📌 Setup</li>
<li>💾 Design the pages</li>
<li>🌍 Functions for Map Visualization</li>
<li>📄 Conclusion</li>
<li>📚 References</li>
</ul>
<h2>🌟 Introduction</h2>
<div class="content-ad"></div>
<p>공유는 우리 삶의 필수적인 부분이 되었습니다. 매 순간 X, Instagram, TikTok 등 다양한 플랫폼에 수많은 사진과 비디오가 업로드되며, 이는 다른 사람들과 순간을 공유하기 위한 것입니다. 코딩도 예외가 아니며, 우리가 코드를 다른 사람들과 공유할 수 있는 플랫폼 중 하나가 Streamlit입니다. 저는 이전에 다양한 방법을 사용하여 위성 이미지를 다운로드하고 시각화하는 것에 관한 여러 포스트를 게시해 왔습니다. 이번 포스트에서는 인증 설정이 필요 없는 Streamlit 앱을 개발하는 방법을 보여 드리겠습니다. 이 앱은 지구상의 어떤 지점과 기간에 캡처된 Sentinel-2의 사용 가능한 이미지를 나열하고, 사용자들이 해당 목록에서 이미지를 선택하고 해당 위치의 RGB 이미지와 씬 분류를 시각화할 수 있게 합니다. 이 포스트는 다른 사람들과 공유하기 위해 이 앱을 개발하는 단계별 가이드입니다. 더 알고 싶다면 계속 읽어보세요!</p>
<h2>📌 설정</h2>
<p>Streamlit을 사용하여 어떤 앱을 만들든, 첫 번째 단계는 임의의 이름을 가진 폴더를 만들고 그 안에 두 가지를 설정하는 것입니다. 첫 번째는 우리의 주요 코드를 포함할 빈 Python 스크립트입니다. 두 번째로 옵션인데, .streamlit이라는 하위 폴더를 만드는 것입니다. 이 하위 폴더는 웹 앱에 로그인하는 데 사용되는 사용자 이름과 비밀번호(자격 증명)을 저장하는 데 사용됩니다. 앱에 로그인 페이지를 원치 않는 경우 이 하위 폴더를 무시할 수 있습니다. 그렇지 않으면 메모장을 열어 아래 형식으로 사용자 이름과 비밀번호를 작성하고 secrets.toml이라는 이름으로 저장하세요.</p>
<pre><code class="hljs language-js">[passwords]
# 규칙을 따라 입력하세요: username = <span class="hljs-string">"password"</span>
<span class="hljs-title class_">Mahyar</span> = <span class="hljs-string">"abc123"</span>
</code></pre>
<div class="content-ad"></div>
<p>만약 설정 단계를 따르면 폴더에 이러한 파일이 있어야 합니다:</p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png" alt="Image 1"></p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_1.png" alt="Image 2"></p>
<p>💾 페이지 디자인하기</p>
<div class="content-ad"></div>
<p>다음 단계는 사용자 경험을 향상시키기 위해 앱에 추가할 요소를 고려하는 것입니다. 사용자를 안내하는 텍스트 정보, 앱 실행에 필요한 사용자로부터 필요한 정보, 그리고 단계별로 앱을 실행하는 버튼을 포함합니다. 사용자가 어떤 위치와 기간의 위성 이미지를 볼 수 있도록 하는 것이 목표이므로, 다음 요소들을 페이지에 포함해야 합니다:</p>
<ul>
<li>로그인 페이지</li>
<li>환영 메시지</li>
<li>페이지 제목</li>
<li>위성 이름에 관한 정보</li>
<li>위치 및 위치 주변의 버퍼</li>
<li>검색 기간</li>
<li>구름 덮인 정도</li>
</ul>
<p>세 개의 버튼: 이용 가능한 목록을 가져오는 버튼, 목록을 다운로드하는 버튼, 선택한 이미지를 시각화하는 버튼.
모든 이 요소들은 다음과 같은 메인 스크립트의 라인을 사용하여 구현할 수 있습니다:</p>
<p>Part 1: 필수 라이브러리 및 사용자 인증</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> streamlit <span class="hljs-keyword">as</span> st
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.<span class="hljs-property">pyplot</span> <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> st_files_connection <span class="hljs-keyword">import</span> <span class="hljs-title class_">FilesConnection</span>
<span class="hljs-keyword">from</span> pystac_client <span class="hljs-keyword">import</span> <span class="hljs-title class_">Client</span>
<span class="hljs-keyword">from</span> odc.<span class="hljs-property">stac</span> <span class="hljs-keyword">import</span> load
<span class="hljs-keyword">import</span> hmac


def <span class="hljs-title function_">check_password</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"Returns `True` if the user had a correct password."</span><span class="hljs-string">""</span>

    def <span class="hljs-title function_">login_form</span>():
        <span class="hljs-string">""</span><span class="hljs-string">"Form with widgets to collect user information"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">with</span> st.<span class="hljs-title function_">form</span>(<span class="hljs-string">"Credentials"</span>):
            st.<span class="hljs-title function_">text_input</span>(<span class="hljs-string">"Username"</span>, key=<span class="hljs-string">"username"</span>)
            st.<span class="hljs-title function_">text_input</span>(<span class="hljs-string">"Password"</span>, type=<span class="hljs-string">"password"</span>, key=<span class="hljs-string">"password"</span>)
            st.<span class="hljs-title function_">form_submit_button</span>(<span class="hljs-string">"Log in"</span>, on_click=password_entered)

    def <span class="hljs-title function_">password_entered</span>():
        <span class="hljs-string">""</span><span class="hljs-string">"Checks whether a password entered by the user is correct."</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> st.<span class="hljs-property">session_state</span>[<span class="hljs-string">"username"</span>] <span class="hljs-keyword">in</span> st.<span class="hljs-property">secrets</span>[
            <span class="hljs-string">"passwords"</span>
        ] and hmac.<span class="hljs-title function_">compare_digest</span>(
            st.<span class="hljs-property">session_state</span>[<span class="hljs-string">"password"</span>],
            st.<span class="hljs-property">secrets</span>.<span class="hljs-property">passwords</span>[st.<span class="hljs-property">session_state</span>[<span class="hljs-string">"username"</span>]],
        ):
            st.<span class="hljs-property">session_state</span>[<span class="hljs-string">"password_correct"</span>] = <span class="hljs-title class_">True</span>
            del st.<span class="hljs-property">session_state</span>[<span class="hljs-string">"password"</span>]  # <span class="hljs-title class_">Don</span><span class="hljs-string">'t store the username or password.
            del st.session_state["username"]
        else:
            st.session_state["password_correct"] = False

    # Return True if the username + password is validated.
    if st.session_state.get("password_correct", False):
        return True

    # Show inputs for username + password.
    login_form()
    if "password_correct" in st.session_state:
        st.error("😕 User not known or password incorrect")
    return False


if not check_password():
    st.stop()
</span></code></pre>
<p>이 코드는 위성 이미지를 시각화하는 Streamlit 앱을 설정합니다. 웹 앱을 구축하는 데 필요한 필수 라이브러리를 가져옵니다. 데이터 조작 및 숫자 연산을 위해 pandas 및 numpy, 파일 연결을 위한 st_files_connection, 보안 비밀번호 비교를 위해 HMAC를 포함하여 필요한 라이브러리를 가져옵니다.</p>
<p>check_password() 함수는 사용자 인증을 처리합니다. 입력된 자격 증명을 HMAC를 사용하여 저장된 자격 증명과 비교하여 확인하는 login_form()을 생성합니다. 주요 check_password() 함수는 로그인 프로세스의 상태를 관리하고 로그인이 실패하는 경우 오류 메시지를 표시합니다. 사용자가 인증되지 않은 경우 앱을 중지합니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-python"><span class="hljs-comment"># Main Streamlit app starts here</span>
st.write(<span class="hljs-string">"스트림릿에 오신 것을 환영합니다! 위성 시각화 앱입니다..."</span>)

<span class="hljs-comment"># Display Title</span>
st.title(<span class="hljs-string">"위성 지도 포털"</span>)
st.markdown(<span class="hljs-string">"아래 데이터를 입력하세요."</span>)

<span class="hljs-comment"># Initialize session state for date_labels and user_date</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">'date_labels'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:
    st.session_state.date_labels = []

<span class="hljs-keyword">if</span> <span class="hljs-string">'data'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:
    st.session_state.data = <span class="hljs-literal">None</span>

<span class="hljs-keyword">if</span> <span class="hljs-string">'user_date'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:
    st.session_state.user_date = <span class="hljs-literal">None</span>

<span class="hljs-keyword">if</span> <span class="hljs-string">'user_date_index'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:
    st.session_state.user_date_index = <span class="hljs-number">0</span>

collections=[<span class="hljs-string">"sentinel-2-l2a"</span>]
columns = [<span class="hljs-string">'collection'</span>, <span class="hljs-string">'start_date'</span>, <span class="hljs-string">'end_date'</span>, <span class="hljs-string">'min_cloud_cover'</span>, <span class="hljs-string">'max_cloud_cover'</span>, <span class="hljs-string">'longitude'</span>, <span class="hljs-string">'latitude'</span>,<span class="hljs-string">'buffer'</span>]

<span class="hljs-keyword">with</span> st.form(key=<span class="hljs-string">"test"</span>):
    
    collection=st.selectbox(<span class="hljs-string">"컬렉션*"</span>,options=collections,index=<span class="hljs-literal">None</span>)
    start_date = st.date_input(label=<span class="hljs-string">"시작 날짜*"</span>)
    end_date = st.date_input(label=<span class="hljs-string">"끝 날짜*"</span>)
    max_cloud_cover  = st.number_input(label=<span class="hljs-string">"최대 구름 덮인 정도*"</span>,value=<span class="hljs-number">10</span>)
    longitude=st.number_input(label=<span class="hljs-string">"경도*"</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">"%.4f"</span>,value=-<span class="hljs-number">119.7513</span>)
    latitude=st.number_input(label=<span class="hljs-string">"위도*"</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">"%.4f"</span>,value=<span class="hljs-number">37.2502</span>)
    buffer=st.number_input(label=<span class="hljs-string">"버퍼 (0.01 = 1 km)*"</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">"%.2f"</span>,value=<span class="hljs-number">0.01</span>)

    <span class="hljs-comment"># Mark Mandatory fields</span>
    st.markdown(<span class="hljs-string">"**필수 입력란*"</span>)

    submit_button_run = st.form_submit_button(label=<span class="hljs-string">"실행"</span>)
    submit_button_list = st.form_submit_button(label=<span class="hljs-string">"가능한 이미지 목록 표시"</span>)
    submit_button_viz = st.form_submit_button(label=<span class="hljs-string">"시각화"</span>)
</code></pre>
<div class="content-ad"></div>
<p><code>C:\Users\Streamlit</code> streamlit run streamlit_app_authen_sentinel_2.py 실행하면 브라우저에서 로그인 및 주요 페이지를 볼 수 있습니다:</p>
<p>부분 1: 로그인 페이지</p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_2.png" alt="이미지"></p>
<div class="content-ad"></div>
<h2>제2부: 메인 페이지</h2>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_3.png" alt="이미지"></p>
<h2>🌍 지도 시각화 기능</h2>
<p>지금까지 로그인 페이지를 만들고 메인 페이지를 디자인했습니다. 현재 메인 페이지에서는 사용자 입력을 수집하고 아직 기능이 구현되지 않은 세 개의 버튼이 있습니다. 이 섹션에서는 이 버튼을 작동하도록 코드를 완성할 것입니다. 첫 번째 버튼은 "실행"이며, 이 버튼은 사용자 입력 매개변수를 사용하여 클라우드 데이터베이스를 검색하고 DataFrame에 있는 사용 가능한 이미지를 표시하는 기능을 합니다. 이 버튼에 기능을 추가하기 위해 두 가지 추가 부분(Part 3 및 Part 4)을 포함했습니다.</p>
<div class="content-ad"></div>
<p>Part 3: 검색 기능 정의</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_satellite_images</span>(<span class="hljs-params">collection=<span class="hljs-string">"sentinel-2-l2a"</span>,
                            bbox=[-<span class="hljs-number">120.15</span>,<span class="hljs-number">38.93</span>,-<span class="hljs-number">119.88</span>,<span class="hljs-number">39.25</span>],
                            date=<span class="hljs-string">"2023-06-01/2023-06-30"</span>,
                            cloud_cover=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">10</span></span>)</span>):
    
    <span class="hljs-comment"># 검색 클라이언트 정의</span>
    client=Client.<span class="hljs-built_in">open</span>(<span class="hljs-string">"https://earth-search.aws.element84.com/v1"</span>)
    search = client.search(collections=[collection],
                            bbox=bbox,
                            datetime=date,
                            query=[<span class="hljs-string">f"eo:cloud_cover&#x3C;<span class="hljs-subst">{cloud_cover[<span class="hljs-number">1</span>]}</span>"</span>, <span class="hljs-string">f"eo:cloud_cover><span class="hljs-subst">{cloud_cover[<span class="hljs-number">0</span>]}</span>"</span>])

    <span class="hljs-comment"># 일치하는 항목 수 출력</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"찾은 이미지 수: <span class="hljs-subst">{search.matched()}</span>"</span>)

    data = load(search.items(), bbox=bbox, groupby=<span class="hljs-string">"solar_day"</span>, chunks={})

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"데이터에 있는 날짜 수: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data.time)}</span>"</span>)

    <span class="hljs-keyword">return</span> data

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_bbox_with_buffer</span>(<span class="hljs-params">latitude=<span class="hljs-number">37.2502</span>, longitude=-<span class="hljs-number">119.7513</span>, buffer=<span class="hljs-number">0.01</span></span>):
    
    min_lat = latitude - buffer
    max_lat = latitude + buffer
    min_lon = longitude - buffer
    max_lon = longitude + buffer
    
    bbox = [min_lon, min_lat, max_lon, max_lat]
    <span class="hljs-keyword">return</span> bbox
</code></pre>
<p>Part 3은 사용자가 지정한 매개변수에 따라 STAC API에 연결하여 위성 이미지를 검색하는 search_satellite_images 함수를 정의하는 것으로 시작합니다. 해당 함수는 일치하는 데이터를 반환합니다. 다른 함수 get_bbox_with_buffer는 지정된 위도, 경도 주변에 특정 버퍼를 설정하여 경계 상자를 계산합니다.</p>
<p>Part 4: 실행 버튼</p>
<div class="content-ad"></div>
<h1>이러한 열이 있는 빈 DataFrame을 만듭니다</h1>
<p>df = pd.DataFrame(columns=columns)</p>
<p>if "mdf" not in st.session_state:
st.session_state.mdf = pd.DataFrame(columns=df.columns)</p>
<h1>새 데이터</h1>
<p>with st.form(key="test"):</p>
<pre><code>collection=st.selectbox("collection*",options=collections,index=None)
start_date = st.date_input(label="start_date*")
end_date = st.date_input(label="end_date*")
max_cloud_cover  = st.number_input(label="max_cloud_cover*",value=10)
longitude=st.number_input(label="longitude*", format="%.4f",value=-119.7513)
latitude=st.number_input(label="latitude*", format="%.4f",value=37.2502)
buffer=st.number_input(label="buffer (0.01 = 1 km)*", format="%.2f",value=0.01)

# 필수 사항 표시
st.markdown("**필수*")

submit_button_run = st.form_submit_button(label="Run")
submit_button_list = st.form_submit_button(label="List Available Images")
submit_button_viz = st.form_submit_button(label="Visualize")

if submit_button_run:
    new_df=pd.DataFrame(
        [
            {   
                "collection": collection,
                "start_date":start_date.strftime("%Y-%m-%d"),
                "end_date": end_date.strftime("%Y-%m-%d"),
                "max_cloud_cover":max_cloud_cover,
                "longitude": longitude,
                "latitude": latitude,
                "buffer": buffer,

            }

        ]
    )
    
    st.session_state.mdf = pd.concat([st.session_state.mdf, new_df], axis=0)
    st.dataframe(st.session_state.mdf)
    st.success("Your request successfully submitted!")

    data = search_satellite_images(collection=collection,
                                   date=f"{start_date}/{end_date}",
                                   cloud_cover=(0, max_cloud_cover),
                                   bbox=get_bbox_with_buffer(latitude=latitude, longitude=longitude, buffer=buffer))
    st.session_state.data = data

    date_labels = []
    # 시간 단계 수 결정
    numb_days = len(data.time)
    # 각 시간 단계 반복
    for t in range(numb_days):
        scl_image = data[["scl"]].isel(time=t).to_array()
        dt = pd.to_datetime(scl_image.time.values)
        year = dt.year
        month = dt.month
        day = dt.day
        date_string = f"{year}-{month:02d}-{day:02d}"
        date_labels.append(date_string)
    
    st.session_state.date_labels= date_labels
</code></pre>
<p>두 번째 부분에서 주 어플리케이션 로직은 빈 DataFrame을 초기화하고 세션 상태에 DataFrame이 있는지 확인합니다.</p>
<p>“Run” 버튼을 클릭하면 사용자 입력 값으로 새 DataFrame 항목을 생성하고 세션 상태를 업데이트하며 업데이트된 DataFrame을 표시합니다. 그런 다음 search_satellite_images를 호출하여 데이터를 가져 오고 이 데이터를 처리하여 날짜 레이블을 추출하고 형식을 맞추어 세션 상태에 저장합니다. 이러한 설정을 통해 사용자는 매개 변수를 입력하고 위성 이미지를 검색하며 결과를 시각화 할 수 있습니다.</p>
<p>이 시점에서 Streamlit 앱을 실행하면 지정된 위치 및 날짜에 대해 다음과 같은 테이블이 표시됩니다:</p>
<div class="content-ad"></div>
<p>아래는 "Run" 버튼을 활성화한 후 "List Available Images" 버튼을 활성화하는 단계입니다. 이 버튼을 클릭하면 사용자가 지정한 위치, 날짜 및 구름 양에 따라 Sentinel-2에 의해 촬영된 사용 가능한 이미지가 표시됩니다.</p>
<p>파트 5: List Available Images 버튼</p>
<pre><code class="hljs language-js">    <span class="hljs-keyword">if</span> <span class="hljs-attr">submit_button_list</span>:
        user_date=st.<span class="hljs-title function_">selectbox</span>(<span class="hljs-string">"Available Images*"</span>,options=st.<span class="hljs-property">session_state</span>.<span class="hljs-property">date_labels</span>,index=<span class="hljs-title class_">None</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-attr">user_date</span>:
            st.<span class="hljs-property">session_state</span>.<span class="hljs-property">user_date</span> = user_date
            st.<span class="hljs-property">session_state</span>.<span class="hljs-property">user_date_index</span> = user_date.<span class="hljs-title function_">index</span>()
</code></pre>
<div class="content-ad"></div>
<p>"List Available Images" 버튼을 클릭하면 이 코드가 위성 이미지의 사용 가능한 날짜를 나열하는 드롭다운 메뉴를 생성합니다. 사용자가 날짜를 선택하면 해당 날짜와 인덱스를 저장하는 세션 상태를 업데이트하여 사용자의 선택에 기반한 추가 작업을 가능하게 합니다.</p>
<p>이제 앱을 다시 실행하고 "List Available Images" 버튼을 클릭하면 사용 가능한 이미지를 나열하는 드롭다운 메뉴가 표시됩니다. 이 중 하나를 선택해주세요:</p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_5.png" alt="이미지"></p>
<p>사용 가능한 이미지 중 하나를 선택한 후 마지막 단계는 "Visualize" 버튼을 완료하고 활성화하는 것입니다. "Visualize" 버튼의 목표는 사용자가 지정한 위치와 버퍼에 대해 선택한 위성 이미지를 표시하는 것입니다. 시각화에 관한 이 메시지에서 설명된 코드를 사용했지만 오른쪽에 장면 분류의 파이 차트를 표시하는 추가 기능을 추가했습니다. 이를 위해 각 장면 클래스의 개수를 반환하는 함수를 정의하고 시각화 버튼에서 사용해야 합니다:</p>
<div class="content-ad"></div>
<p>파트 6: Count 함수</p>
<pre><code class="hljs language-js">def <span class="hljs-title function_">count_classified_pixels</span>(data,num):
    
    scl_image = data[[<span class="hljs-string">"scl"</span>]].<span class="hljs-title function_">isel</span>(time=num).<span class="hljs-title function_">to_array</span>()
 
    # 분류된 픽셀 수 세기 
    count_saturated = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">1</span>)        # 포화 또는 결함
    count_dark = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">2</span>)             # 어두운 지역 픽셀
    count_cloud_shadow = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">3</span>)     # 구름 그림자
    count_vegetation = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">4</span>)       # 식물
    count_soil = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">5</span>)             # 노출된 토양
    count_water = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">6</span>)            # 물
    count_clouds_low= np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">7</span>)        # 낮은 확률 구름 / 분류되지 않은 구름
    count_clouds_med = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">8</span>)       # 중간 확률 구름
    count_clouds_high = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">9</span>)      # 높은 확률 구름
    count_clouds_cirrus = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">10</span>)   # 시르러스 구름
    count_clouds_snow = np.<span class="hljs-title function_">count_nonzero</span>(scl_image == <span class="hljs-number">11</span>)     # 눈

    counts = {
    <span class="hljs-string">'어둠/밝은 영역'</span>: count_cloud_shadow +count_dark+count_clouds_low+count_clouds_med+count_clouds_high+count_clouds_cirrus +count_clouds_snow +count_saturated,
    <span class="hljs-string">'식물'</span>: count_vegetation,
    <span class="hljs-string">'노출된 토양'</span>: count_soil,
    <span class="hljs-string">'물'</span>: count_water,
    }

    <span class="hljs-keyword">return</span> counts
</code></pre>
<p>파트 7: 시각화 버튼</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> <span class="hljs-attr">submit_button_viz</span>:
        
        date_string_title= f<span class="hljs-string">"타겟 지역의 Sentinel-2 이미지"</span>
        fig, axs = plt.<span class="hljs-title function_">subplots</span>(nrows=<span class="hljs-number">1</span>, ncols=<span class="hljs-number">2</span>, figsize=(<span class="hljs-number">16</span>, <span class="hljs-number">8</span>))  

        rgb = st.<span class="hljs-property">session_state</span>.<span class="hljs-property">data</span>[[<span class="hljs-string">"red"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"blue"</span>]].<span class="hljs-title function_">isel</span>(time=st.<span class="hljs-property">session_state</span>.<span class="hljs-property">user_date_index</span>).<span class="hljs-title function_">to_array</span>()
        rgb.<span class="hljs-property">plot</span>.<span class="hljs-title function_">imshow</span>(robust=<span class="hljs-title class_">True</span>, ax=axs[<span class="hljs-number">0</span>])
        axs[<span class="hljs-number">0</span>].<span class="hljs-title function_">axis</span>(<span class="hljs-string">'off'</span>)  # 축 눈금과 레이블 숨기기
        axs[<span class="hljs-number">0</span>].<span class="hljs-title function_">set_title</span>(date_string_title)

        # 데이터 준비 
        counts = <span class="hljs-title function_">count_classified_pixels</span>(st.<span class="hljs-property">session_state</span>.<span class="hljs-property">data</span>, st.<span class="hljs-property">session_state</span>.<span class="hljs-property">user_date_index</span> )
        labels = <span class="hljs-title function_">list</span>(counts.<span class="hljs-title function_">keys</span>())
        values = <span class="hljs-title function_">list</span>(counts.<span class="hljs-title function_">values</span>())
        colors = [<span class="hljs-string">'DarkGrey'</span>, <span class="hljs-string">'chartreuse'</span>, <span class="hljs-string">'DarkOrange'</span>, <span class="hljs-string">'cyan'</span>]
        explode = (<span class="hljs-number">0.3</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>)  # 첫 번째 조각 튀어나오기

        # 파이 차트 그리기 
        axs[<span class="hljs-number">1</span>].<span class="hljs-title function_">pie</span>(values, labels=labels, colors=colors, autopct=<span class="hljs-string">'%1.0f%%'</span>, startangle=<span class="hljs-number">140</span>, explode=explode)
        axs[<span class="hljs-number">1</span>].<span class="hljs-title function_">legend</span>(labels, loc=<span class="hljs-string">'best'</span>, bbox_to_anchor=(<span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>))
        axs[<span class="hljs-number">1</span>].<span class="hljs-title function_">axis</span>(<span class="hljs-string">'equal'</span>)  # 파이 차트를 원으로 만들기
        axs[<span class="hljs-number">1</span>].<span class="hljs-title function_">set_title</span>(<span class="hljs-string">'클래스 분포'</span>)

        # 그림을 <span class="hljs-title class_">Streamlit</span>에 표시
        st.<span class="hljs-title function_">pyplot</span>(fig)
</code></pre>
<div class="content-ad"></div>
<p>"Visualize" 버튼을 클릭하면 코드가 관심 영역(AOI) 위의 Sentinel-2 이미지를 나타내는 제목이 있는 플롯을 설정합니다. 두 개의 서브플롯이 나란히 만들어집니다. RGB 이미지가 선택된 날짜의 세션 상태 데이터에서 추출되어 시각적 명확성을 높이기 위해 첫 번째 서브플롯에 축 레이블 없이 표시됩니다. 모든 버튼이 활성화된 상태에서 앱을 한 번 더 실행해 봅시다:</p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_6.png" alt="이미지"></p>
<p><img src="/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_7.png" alt="이미지"></p>
<p>구름 양, 날짜 및 좌표의 기본값을 변경하여 시각화에 어떻게 영향을 주는지 확인해 보세요.</p>
<div class="content-ad"></div>
<h2>📄 결론</h2>
<p>이 가이드에서는 지구상의 어떤 지점에서든 언제든 위성 이미지를 시각화하기 위한 Streamlit 애플리케이션을 만드는 과정을 안내했습니다. 우리는 앱을 안전하게 보호하기 위해 로그인 페이지를 설정한 후 사용자 입력을 수집하는 주 페이지를 디자인하는 것으로 시작했습니다. "실행" 버튼 기능을 구현하여 사용 가능한 위성 이미지를 검색하고, "사용 가능한 이미지 목록" 버튼을 클릭하면 사용 가능한 이미지의 드롭다운 메뉴가 표시되고, "시각화" 버튼을 클릭하여 선택한 위성 이미지를 표시할 수 있도록 했습니다. 이 인터랙티브한 방식은 사용자들이 코드를 커뮤니티와 쉽게 공유하고 위성 이미지를 효과적으로 탐색하고 다양한 시나리오를 탐구하여 인사이트를 얻을 수 있도록 합니다.</p>
<h2>📚 참고 자료</h2>
<p><a href="https://github.com/stac-utils/pystac-client/blob/main/docs/quickstart.rst" rel="nofollow" target="_blank">https://github.com/stac-utils/pystac-client/blob/main/docs/quickstart.rst</a></p>
<div class="content-ad"></div>
<p><a href="https://www.element84.com/earth-search/examples/" rel="nofollow" target="_blank">https://www.element84.com/earth-search/examples/</a></p>
<p>Copernicus Sentinel 데이터 [2024]에 대한 센티넬 데이터</p>
<p>Copernicus 서비스 정보 [2024]에 대한 코퍼니커스 서비스 정보.</p>
<p>📱더 많은 흥미로운 콘텐츠를 보기 위해 다른 플랫폼에서 저와 연결하세요! LinkedIn, ResearchGate, Github 및 Twitter.</p>
<div class="content-ad"></div>
<p>이 링크를 통해 확인할 수 있는 관련 게시물이 있습니다:</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"위성 이미지 시각화를 위한 Streamlit 앱 만들기 단계별 가이드","description":"","date":"2024-06-23 15:59","slug":"2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide","content":"\n\n\n![image](https://miro.medium.com/v2/resize:fit:1400/1*DZ2rEeyOTUZ2bWq8FnvJ2w.gif)\n\n# Table of Contents\n\n- 🌟 Introduction\n- 📌 Setup\n- 💾 Design the pages\n- 🌍 Functions for Map Visualization\n- 📄 Conclusion\n- 📚 References\n\n## 🌟 Introduction\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n공유는 우리 삶의 필수적인 부분이 되었습니다. 매 순간 X, Instagram, TikTok 등 다양한 플랫폼에 수많은 사진과 비디오가 업로드되며, 이는 다른 사람들과 순간을 공유하기 위한 것입니다. 코딩도 예외가 아니며, 우리가 코드를 다른 사람들과 공유할 수 있는 플랫폼 중 하나가 Streamlit입니다. 저는 이전에 다양한 방법을 사용하여 위성 이미지를 다운로드하고 시각화하는 것에 관한 여러 포스트를 게시해 왔습니다. 이번 포스트에서는 인증 설정이 필요 없는 Streamlit 앱을 개발하는 방법을 보여 드리겠습니다. 이 앱은 지구상의 어떤 지점과 기간에 캡처된 Sentinel-2의 사용 가능한 이미지를 나열하고, 사용자들이 해당 목록에서 이미지를 선택하고 해당 위치의 RGB 이미지와 씬 분류를 시각화할 수 있게 합니다. 이 포스트는 다른 사람들과 공유하기 위해 이 앱을 개발하는 단계별 가이드입니다. 더 알고 싶다면 계속 읽어보세요!\n\n## 📌 설정\n\nStreamlit을 사용하여 어떤 앱을 만들든, 첫 번째 단계는 임의의 이름을 가진 폴더를 만들고 그 안에 두 가지를 설정하는 것입니다. 첫 번째는 우리의 주요 코드를 포함할 빈 Python 스크립트입니다. 두 번째로 옵션인데, .streamlit이라는 하위 폴더를 만드는 것입니다. 이 하위 폴더는 웹 앱에 로그인하는 데 사용되는 사용자 이름과 비밀번호(자격 증명)을 저장하는 데 사용됩니다. 앱에 로그인 페이지를 원치 않는 경우 이 하위 폴더를 무시할 수 있습니다. 그렇지 않으면 메모장을 열어 아래 형식으로 사용자 이름과 비밀번호를 작성하고 secrets.toml이라는 이름으로 저장하세요.\n\n```js\n[passwords]\n# 규칙을 따라 입력하세요: username = \"password\"\nMahyar = \"abc123\"\n```  \n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n만약 설정 단계를 따르면 폴더에 이러한 파일이 있어야 합니다:\n\n![Image 1](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png)\n\n![Image 2](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_1.png)\n\n💾 페이지 디자인하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n다음 단계는 사용자 경험을 향상시키기 위해 앱에 추가할 요소를 고려하는 것입니다. 사용자를 안내하는 텍스트 정보, 앱 실행에 필요한 사용자로부터 필요한 정보, 그리고 단계별로 앱을 실행하는 버튼을 포함합니다. 사용자가 어떤 위치와 기간의 위성 이미지를 볼 수 있도록 하는 것이 목표이므로, 다음 요소들을 페이지에 포함해야 합니다:\n\n- 로그인 페이지\n- 환영 메시지\n- 페이지 제목\n- 위성 이름에 관한 정보\n- 위치 및 위치 주변의 버퍼\n- 검색 기간\n- 구름 덮인 정도\n\n세 개의 버튼: 이용 가능한 목록을 가져오는 버튼, 목록을 다운로드하는 버튼, 선택한 이미지를 시각화하는 버튼.\n모든 이 요소들은 다음과 같은 메인 스크립트의 라인을 사용하여 구현할 수 있습니다:\n\nPart 1: 필수 라이브러리 및 사용자 인증\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport streamlit as st\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom st_files_connection import FilesConnection\nfrom pystac_client import Client\nfrom odc.stac import load\nimport hmac\n\n\ndef check_password():\n    \"\"\"Returns `True` if the user had a correct password.\"\"\"\n\n    def login_form():\n        \"\"\"Form with widgets to collect user information\"\"\"\n        with st.form(\"Credentials\"):\n            st.text_input(\"Username\", key=\"username\")\n            st.text_input(\"Password\", type=\"password\", key=\"password\")\n            st.form_submit_button(\"Log in\", on_click=password_entered)\n\n    def password_entered():\n        \"\"\"Checks whether a password entered by the user is correct.\"\"\"\n        if st.session_state[\"username\"] in st.secrets[\n            \"passwords\"\n        ] and hmac.compare_digest(\n            st.session_state[\"password\"],\n            st.secrets.passwords[st.session_state[\"username\"]],\n        ):\n            st.session_state[\"password_correct\"] = True\n            del st.session_state[\"password\"]  # Don't store the username or password.\n            del st.session_state[\"username\"]\n        else:\n            st.session_state[\"password_correct\"] = False\n\n    # Return True if the username + password is validated.\n    if st.session_state.get(\"password_correct\", False):\n        return True\n\n    # Show inputs for username + password.\n    login_form()\n    if \"password_correct\" in st.session_state:\n        st.error(\"😕 User not known or password incorrect\")\n    return False\n\n\nif not check_password():\n    st.stop()\n``` \n\n이 코드는 위성 이미지를 시각화하는 Streamlit 앱을 설정합니다. 웹 앱을 구축하는 데 필요한 필수 라이브러리를 가져옵니다. 데이터 조작 및 숫자 연산을 위해 pandas 및 numpy, 파일 연결을 위한 st_files_connection, 보안 비밀번호 비교를 위해 HMAC를 포함하여 필요한 라이브러리를 가져옵니다.\n\ncheck_password() 함수는 사용자 인증을 처리합니다. 입력된 자격 증명을 HMAC를 사용하여 저장된 자격 증명과 비교하여 확인하는 login_form()을 생성합니다. 주요 check_password() 함수는 로그인 프로세스의 상태를 관리하고 로그인이 실패하는 경우 오류 메시지를 표시합니다. 사용자가 인증되지 않은 경우 앱을 중지합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```python\n# Main Streamlit app starts here\nst.write(\"스트림릿에 오신 것을 환영합니다! 위성 시각화 앱입니다...\")\n\n# Display Title\nst.title(\"위성 지도 포털\")\nst.markdown(\"아래 데이터를 입력하세요.\")\n\n# Initialize session state for date_labels and user_date\nif 'date_labels' not in st.session_state:\n    st.session_state.date_labels = []\n\nif 'data' not in st.session_state:\n    st.session_state.data = None\n\nif 'user_date' not in st.session_state:\n    st.session_state.user_date = None\n\nif 'user_date_index' not in st.session_state:\n    st.session_state.user_date_index = 0\n\ncollections=[\"sentinel-2-l2a\"]\ncolumns = ['collection', 'start_date', 'end_date', 'min_cloud_cover', 'max_cloud_cover', 'longitude', 'latitude','buffer']\n\nwith st.form(key=\"test\"):\n    \n    collection=st.selectbox(\"컬렉션*\",options=collections,index=None)\n    start_date = st.date_input(label=\"시작 날짜*\")\n    end_date = st.date_input(label=\"끝 날짜*\")\n    max_cloud_cover  = st.number_input(label=\"최대 구름 덮인 정도*\",value=10)\n    longitude=st.number_input(label=\"경도*\", format=\"%.4f\",value=-119.7513)\n    latitude=st.number_input(label=\"위도*\", format=\"%.4f\",value=37.2502)\n    buffer=st.number_input(label=\"버퍼 (0.01 = 1 km)*\", format=\"%.2f\",value=0.01)\n\n    # Mark Mandatory fields\n    st.markdown(\"**필수 입력란*\")\n\n    submit_button_run = st.form_submit_button(label=\"실행\")\n    submit_button_list = st.form_submit_button(label=\"가능한 이미지 목록 표시\")\n    submit_button_viz = st.form_submit_button(label=\"시각화\")\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n`C:\\Users\\Streamlit` streamlit run streamlit_app_authen_sentinel_2.py 실행하면 브라우저에서 로그인 및 주요 페이지를 볼 수 있습니다:\n\n부분 1: 로그인 페이지\n\n![이미지](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_2.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 제2부: 메인 페이지\n\n![이미지](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_3.png)\n\n## 🌍 지도 시각화 기능\n\n지금까지 로그인 페이지를 만들고 메인 페이지를 디자인했습니다. 현재 메인 페이지에서는 사용자 입력을 수집하고 아직 기능이 구현되지 않은 세 개의 버튼이 있습니다. 이 섹션에서는 이 버튼을 작동하도록 코드를 완성할 것입니다. 첫 번째 버튼은 \"실행\"이며, 이 버튼은 사용자 입력 매개변수를 사용하여 클라우드 데이터베이스를 검색하고 DataFrame에 있는 사용 가능한 이미지를 표시하는 기능을 합니다. 이 버튼에 기능을 추가하기 위해 두 가지 추가 부분(Part 3 및 Part 4)을 포함했습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nPart 3: 검색 기능 정의\n\n```python\ndef search_satellite_images(collection=\"sentinel-2-l2a\",\n                            bbox=[-120.15,38.93,-119.88,39.25],\n                            date=\"2023-06-01/2023-06-30\",\n                            cloud_cover=(0, 10)):\n    \n    # 검색 클라이언트 정의\n    client=Client.open(\"https://earth-search.aws.element84.com/v1\")\n    search = client.search(collections=[collection],\n                            bbox=bbox,\n                            datetime=date,\n                            query=[f\"eo:cloud_cover\u003c{cloud_cover[1]}\", f\"eo:cloud_cover\u003e{cloud_cover[0]}\"])\n\n    # 일치하는 항목 수 출력\n    print(f\"찾은 이미지 수: {search.matched()}\")\n\n    data = load(search.items(), bbox=bbox, groupby=\"solar_day\", chunks={})\n\n    print(f\"데이터에 있는 날짜 수: {len(data.time)}\")\n\n    return data\n\ndef get_bbox_with_buffer(latitude=37.2502, longitude=-119.7513, buffer=0.01):\n    \n    min_lat = latitude - buffer\n    max_lat = latitude + buffer\n    min_lon = longitude - buffer\n    max_lon = longitude + buffer\n    \n    bbox = [min_lon, min_lat, max_lon, max_lat]\n    return bbox\n```\n\nPart 3은 사용자가 지정한 매개변수에 따라 STAC API에 연결하여 위성 이미지를 검색하는 search_satellite_images 함수를 정의하는 것으로 시작합니다. 해당 함수는 일치하는 데이터를 반환합니다. 다른 함수 get_bbox_with_buffer는 지정된 위도, 경도 주변에 특정 버퍼를 설정하여 경계 상자를 계산합니다.\n\nPart 4: 실행 버튼\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n# 이러한 열이 있는 빈 DataFrame을 만듭니다\r\ndf = pd.DataFrame(columns=columns)\r\n\r\nif \"mdf\" not in st.session_state:\r\n    st.session_state.mdf = pd.DataFrame(columns=df.columns)\r\n\r\n\r\n# 새 데이터\r\nwith st.form(key=\"test\"):\r\n    \r\n    collection=st.selectbox(\"collection*\",options=collections,index=None)\r\n    start_date = st.date_input(label=\"start_date*\")\r\n    end_date = st.date_input(label=\"end_date*\")\r\n    max_cloud_cover  = st.number_input(label=\"max_cloud_cover*\",value=10)\r\n    longitude=st.number_input(label=\"longitude*\", format=\"%.4f\",value=-119.7513)\r\n    latitude=st.number_input(label=\"latitude*\", format=\"%.4f\",value=37.2502)\r\n    buffer=st.number_input(label=\"buffer (0.01 = 1 km)*\", format=\"%.2f\",value=0.01)\r\n\r\n    # 필수 사항 표시\r\n    st.markdown(\"**필수*\")\r\n\r\n    submit_button_run = st.form_submit_button(label=\"Run\")\r\n    submit_button_list = st.form_submit_button(label=\"List Available Images\")\r\n    submit_button_viz = st.form_submit_button(label=\"Visualize\")\r\n\r\n    if submit_button_run:\r\n        new_df=pd.DataFrame(\r\n            [\r\n                {   \r\n                    \"collection\": collection,\r\n                    \"start_date\":start_date.strftime(\"%Y-%m-%d\"),\r\n                    \"end_date\": end_date.strftime(\"%Y-%m-%d\"),\r\n                    \"max_cloud_cover\":max_cloud_cover,\r\n                    \"longitude\": longitude,\r\n                    \"latitude\": latitude,\r\n                    \"buffer\": buffer,\r\n\r\n                }\r\n\r\n            ]\r\n        )\r\n        \r\n        st.session_state.mdf = pd.concat([st.session_state.mdf, new_df], axis=0)\r\n        st.dataframe(st.session_state.mdf)\r\n        st.success(\"Your request successfully submitted!\")\r\n\r\n        data = search_satellite_images(collection=collection,\r\n                                       date=f\"{start_date}/{end_date}\",\r\n                                       cloud_cover=(0, max_cloud_cover),\r\n                                       bbox=get_bbox_with_buffer(latitude=latitude, longitude=longitude, buffer=buffer))\r\n        st.session_state.data = data\r\n\r\n        date_labels = []\r\n        # 시간 단계 수 결정\r\n        numb_days = len(data.time)\r\n        # 각 시간 단계 반복\r\n        for t in range(numb_days):\r\n            scl_image = data[[\"scl\"]].isel(time=t).to_array()\r\n            dt = pd.to_datetime(scl_image.time.values)\r\n            year = dt.year\r\n            month = dt.month\r\n            day = dt.day\r\n            date_string = f\"{year}-{month:02d}-{day:02d}\"\r\n            date_labels.append(date_string)\r\n        \r\n        st.session_state.date_labels= date_labels\r\n\n\r\n두 번째 부분에서 주 어플리케이션 로직은 빈 DataFrame을 초기화하고 세션 상태에 DataFrame이 있는지 확인합니다.\r\n\r\n“Run” 버튼을 클릭하면 사용자 입력 값으로 새 DataFrame 항목을 생성하고 세션 상태를 업데이트하며 업데이트된 DataFrame을 표시합니다. 그런 다음 search_satellite_images를 호출하여 데이터를 가져 오고 이 데이터를 처리하여 날짜 레이블을 추출하고 형식을 맞추어 세션 상태에 저장합니다. 이러한 설정을 통해 사용자는 매개 변수를 입력하고 위성 이미지를 검색하며 결과를 시각화 할 수 있습니다.\r\n\r\n이 시점에서 Streamlit 앱을 실행하면 지정된 위치 및 날짜에 대해 다음과 같은 테이블이 표시됩니다:\r\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래는 \"Run\" 버튼을 활성화한 후 \"List Available Images\" 버튼을 활성화하는 단계입니다. 이 버튼을 클릭하면 사용자가 지정한 위치, 날짜 및 구름 양에 따라 Sentinel-2에 의해 촬영된 사용 가능한 이미지가 표시됩니다.\n\n파트 5: List Available Images 버튼\n\n```js\n    if submit_button_list:\n        user_date=st.selectbox(\"Available Images*\",options=st.session_state.date_labels,index=None)\n        if user_date:\n            st.session_state.user_date = user_date\n            st.session_state.user_date_index = user_date.index()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\"List Available Images\" 버튼을 클릭하면 이 코드가 위성 이미지의 사용 가능한 날짜를 나열하는 드롭다운 메뉴를 생성합니다. 사용자가 날짜를 선택하면 해당 날짜와 인덱스를 저장하는 세션 상태를 업데이트하여 사용자의 선택에 기반한 추가 작업을 가능하게 합니다.\n\n이제 앱을 다시 실행하고 \"List Available Images\" 버튼을 클릭하면 사용 가능한 이미지를 나열하는 드롭다운 메뉴가 표시됩니다. 이 중 하나를 선택해주세요:\n\n![이미지](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_5.png)\n\n사용 가능한 이미지 중 하나를 선택한 후 마지막 단계는 \"Visualize\" 버튼을 완료하고 활성화하는 것입니다. \"Visualize\" 버튼의 목표는 사용자가 지정한 위치와 버퍼에 대해 선택한 위성 이미지를 표시하는 것입니다. 시각화에 관한 이 메시지에서 설명된 코드를 사용했지만 오른쪽에 장면 분류의 파이 차트를 표시하는 추가 기능을 추가했습니다. 이를 위해 각 장면 클래스의 개수를 반환하는 함수를 정의하고 시각화 버튼에서 사용해야 합니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n파트 6: Count 함수\n\n```js\ndef count_classified_pixels(data,num):\n    \n    scl_image = data[[\"scl\"]].isel(time=num).to_array()\n \n    # 분류된 픽셀 수 세기 \n    count_saturated = np.count_nonzero(scl_image == 1)        # 포화 또는 결함\n    count_dark = np.count_nonzero(scl_image == 2)             # 어두운 지역 픽셀\n    count_cloud_shadow = np.count_nonzero(scl_image == 3)     # 구름 그림자\n    count_vegetation = np.count_nonzero(scl_image == 4)       # 식물\n    count_soil = np.count_nonzero(scl_image == 5)             # 노출된 토양\n    count_water = np.count_nonzero(scl_image == 6)            # 물\n    count_clouds_low= np.count_nonzero(scl_image == 7)        # 낮은 확률 구름 / 분류되지 않은 구름\n    count_clouds_med = np.count_nonzero(scl_image == 8)       # 중간 확률 구름\n    count_clouds_high = np.count_nonzero(scl_image == 9)      # 높은 확률 구름\n    count_clouds_cirrus = np.count_nonzero(scl_image == 10)   # 시르러스 구름\n    count_clouds_snow = np.count_nonzero(scl_image == 11)     # 눈\n\n    counts = {\n    '어둠/밝은 영역': count_cloud_shadow +count_dark+count_clouds_low+count_clouds_med+count_clouds_high+count_clouds_cirrus +count_clouds_snow +count_saturated,\n    '식물': count_vegetation,\n    '노출된 토양': count_soil,\n    '물': count_water,\n    }\n\n    return counts\n```\n\n파트 7: 시각화 버튼\n\n```js\nif submit_button_viz:\n        \n        date_string_title= f\"타겟 지역의 Sentinel-2 이미지\"\n        fig, axs = plt.subplots(nrows=1, ncols=2, figsize=(16, 8))  \n\n        rgb = st.session_state.data[[\"red\", \"green\", \"blue\"]].isel(time=st.session_state.user_date_index).to_array()\n        rgb.plot.imshow(robust=True, ax=axs[0])\n        axs[0].axis('off')  # 축 눈금과 레이블 숨기기\n        axs[0].set_title(date_string_title)\n\n        # 데이터 준비 \n        counts = count_classified_pixels(st.session_state.data, st.session_state.user_date_index )\n        labels = list(counts.keys())\n        values = list(counts.values())\n        colors = ['DarkGrey', 'chartreuse', 'DarkOrange', 'cyan']\n        explode = (0.3, 0.1, 0.1, 0.1)  # 첫 번째 조각 튀어나오기\n\n        # 파이 차트 그리기 \n        axs[1].pie(values, labels=labels, colors=colors, autopct='%1.0f%%', startangle=140, explode=explode)\n        axs[1].legend(labels, loc='best', bbox_to_anchor=(1, 0.5))\n        axs[1].axis('equal')  # 파이 차트를 원으로 만들기\n        axs[1].set_title('클래스 분포')\n\n        # 그림을 Streamlit에 표시\n        st.pyplot(fig)\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\"Visualize\" 버튼을 클릭하면 코드가 관심 영역(AOI) 위의 Sentinel-2 이미지를 나타내는 제목이 있는 플롯을 설정합니다. 두 개의 서브플롯이 나란히 만들어집니다. RGB 이미지가 선택된 날짜의 세션 상태 데이터에서 추출되어 시각적 명확성을 높이기 위해 첫 번째 서브플롯에 축 레이블 없이 표시됩니다. 모든 버튼이 활성화된 상태에서 앱을 한 번 더 실행해 봅시다:\n\n![이미지](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_6.png)\n\n![이미지](/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_7.png)\n\n구름 양, 날짜 및 좌표의 기본값을 변경하여 시각화에 어떻게 영향을 주는지 확인해 보세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 📄 결론\n\n이 가이드에서는 지구상의 어떤 지점에서든 언제든 위성 이미지를 시각화하기 위한 Streamlit 애플리케이션을 만드는 과정을 안내했습니다. 우리는 앱을 안전하게 보호하기 위해 로그인 페이지를 설정한 후 사용자 입력을 수집하는 주 페이지를 디자인하는 것으로 시작했습니다. \"실행\" 버튼 기능을 구현하여 사용 가능한 위성 이미지를 검색하고, \"사용 가능한 이미지 목록\" 버튼을 클릭하면 사용 가능한 이미지의 드롭다운 메뉴가 표시되고, \"시각화\" 버튼을 클릭하여 선택한 위성 이미지를 표시할 수 있도록 했습니다. 이 인터랙티브한 방식은 사용자들이 코드를 커뮤니티와 쉽게 공유하고 위성 이미지를 효과적으로 탐색하고 다양한 시나리오를 탐구하여 인사이트를 얻을 수 있도록 합니다.\n\n## 📚 참고 자료\n\nhttps://github.com/stac-utils/pystac-client/blob/main/docs/quickstart.rst\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nhttps://www.element84.com/earth-search/examples/\n\nCopernicus Sentinel 데이터 [2024]에 대한 센티넬 데이터\n\nCopernicus 서비스 정보 [2024]에 대한 코퍼니커스 서비스 정보.\n\n📱더 많은 흥미로운 콘텐츠를 보기 위해 다른 플랫폼에서 저와 연결하세요! LinkedIn, ResearchGate, Github 및 Twitter.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 링크를 통해 확인할 수 있는 관련 게시물이 있습니다:","ogImage":{"url":"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png"},"coverImage":"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png","tag":["Tech"],"readingTime":16},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:1400/1*DZ2rEeyOTUZ2bWq8FnvJ2w.gif\" alt=\"image\"\u003e\u003c/p\u003e\n\u003ch1\u003eTable of Contents\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e🌟 Introduction\u003c/li\u003e\n\u003cli\u003e📌 Setup\u003c/li\u003e\n\u003cli\u003e💾 Design the pages\u003c/li\u003e\n\u003cli\u003e🌍 Functions for Map Visualization\u003c/li\u003e\n\u003cli\u003e📄 Conclusion\u003c/li\u003e\n\u003cli\u003e📚 References\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e🌟 Introduction\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e공유는 우리 삶의 필수적인 부분이 되었습니다. 매 순간 X, Instagram, TikTok 등 다양한 플랫폼에 수많은 사진과 비디오가 업로드되며, 이는 다른 사람들과 순간을 공유하기 위한 것입니다. 코딩도 예외가 아니며, 우리가 코드를 다른 사람들과 공유할 수 있는 플랫폼 중 하나가 Streamlit입니다. 저는 이전에 다양한 방법을 사용하여 위성 이미지를 다운로드하고 시각화하는 것에 관한 여러 포스트를 게시해 왔습니다. 이번 포스트에서는 인증 설정이 필요 없는 Streamlit 앱을 개발하는 방법을 보여 드리겠습니다. 이 앱은 지구상의 어떤 지점과 기간에 캡처된 Sentinel-2의 사용 가능한 이미지를 나열하고, 사용자들이 해당 목록에서 이미지를 선택하고 해당 위치의 RGB 이미지와 씬 분류를 시각화할 수 있게 합니다. 이 포스트는 다른 사람들과 공유하기 위해 이 앱을 개발하는 단계별 가이드입니다. 더 알고 싶다면 계속 읽어보세요!\u003c/p\u003e\n\u003ch2\u003e📌 설정\u003c/h2\u003e\n\u003cp\u003eStreamlit을 사용하여 어떤 앱을 만들든, 첫 번째 단계는 임의의 이름을 가진 폴더를 만들고 그 안에 두 가지를 설정하는 것입니다. 첫 번째는 우리의 주요 코드를 포함할 빈 Python 스크립트입니다. 두 번째로 옵션인데, .streamlit이라는 하위 폴더를 만드는 것입니다. 이 하위 폴더는 웹 앱에 로그인하는 데 사용되는 사용자 이름과 비밀번호(자격 증명)을 저장하는 데 사용됩니다. 앱에 로그인 페이지를 원치 않는 경우 이 하위 폴더를 무시할 수 있습니다. 그렇지 않으면 메모장을 열어 아래 형식으로 사용자 이름과 비밀번호를 작성하고 secrets.toml이라는 이름으로 저장하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e[passwords]\n# 규칙을 따라 입력하세요: username = \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e\n\u003cspan class=\"hljs-title class_\"\u003eMahyar\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"abc123\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e만약 설정 단계를 따르면 폴더에 이러한 파일이 있어야 합니다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_0.png\" alt=\"Image 1\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_1.png\" alt=\"Image 2\"\u003e\u003c/p\u003e\n\u003cp\u003e💾 페이지 디자인하기\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e다음 단계는 사용자 경험을 향상시키기 위해 앱에 추가할 요소를 고려하는 것입니다. 사용자를 안내하는 텍스트 정보, 앱 실행에 필요한 사용자로부터 필요한 정보, 그리고 단계별로 앱을 실행하는 버튼을 포함합니다. 사용자가 어떤 위치와 기간의 위성 이미지를 볼 수 있도록 하는 것이 목표이므로, 다음 요소들을 페이지에 포함해야 합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e로그인 페이지\u003c/li\u003e\n\u003cli\u003e환영 메시지\u003c/li\u003e\n\u003cli\u003e페이지 제목\u003c/li\u003e\n\u003cli\u003e위성 이름에 관한 정보\u003c/li\u003e\n\u003cli\u003e위치 및 위치 주변의 버퍼\u003c/li\u003e\n\u003cli\u003e검색 기간\u003c/li\u003e\n\u003cli\u003e구름 덮인 정도\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e세 개의 버튼: 이용 가능한 목록을 가져오는 버튼, 목록을 다운로드하는 버튼, 선택한 이미지를 시각화하는 버튼.\n모든 이 요소들은 다음과 같은 메인 스크립트의 라인을 사용하여 구현할 수 있습니다:\u003c/p\u003e\n\u003cp\u003ePart 1: 필수 라이브러리 및 사용자 인증\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e streamlit \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e st\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e pd\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e np\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.\u003cspan class=\"hljs-property\"\u003epyplot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e st_files_connection \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFilesConnection\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pystac_client \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eClient\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e odc.\u003cspan class=\"hljs-property\"\u003estac\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e load\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e hmac\n\n\ndef \u003cspan class=\"hljs-title function_\"\u003echeck_password\u003c/span\u003e():\n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"Returns `True` if the user had a correct password.\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\n    def \u003cspan class=\"hljs-title function_\"\u003elogin_form\u003c/span\u003e():\n        \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"Form with widgets to collect user information\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e st.\u003cspan class=\"hljs-title function_\"\u003eform\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Credentials\"\u003c/span\u003e):\n            st.\u003cspan class=\"hljs-title function_\"\u003etext_input\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Username\"\u003c/span\u003e, key=\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e)\n            st.\u003cspan class=\"hljs-title function_\"\u003etext_input\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Password\"\u003c/span\u003e, type=\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e, key=\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e)\n            st.\u003cspan class=\"hljs-title function_\"\u003eform_submit_button\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Log in\"\u003c/span\u003e, on_click=password_entered)\n\n    def \u003cspan class=\"hljs-title function_\"\u003epassword_entered\u003c/span\u003e():\n        \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"Checks whether a password entered by the user is correct.\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.\u003cspan class=\"hljs-property\"\u003esecrets\u003c/span\u003e[\n            \u003cspan class=\"hljs-string\"\u003e\"passwords\"\u003c/span\u003e\n        ] and hmac.\u003cspan class=\"hljs-title function_\"\u003ecompare_digest\u003c/span\u003e(\n            st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e],\n            st.\u003cspan class=\"hljs-property\"\u003esecrets\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epasswords\u003c/span\u003e[st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e]],\n        ):\n            st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"password_correct\"\u003c/span\u003e] = \u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e\n            del st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e]  # \u003cspan class=\"hljs-title class_\"\u003eDon\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e't store the username or password.\n            del st.session_state[\"username\"]\n        else:\n            st.session_state[\"password_correct\"] = False\n\n    # Return True if the username + password is validated.\n    if st.session_state.get(\"password_correct\", False):\n        return True\n\n    # Show inputs for username + password.\n    login_form()\n    if \"password_correct\" in st.session_state:\n        st.error(\"😕 User not known or password incorrect\")\n    return False\n\n\nif not check_password():\n    st.stop()\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 코드는 위성 이미지를 시각화하는 Streamlit 앱을 설정합니다. 웹 앱을 구축하는 데 필요한 필수 라이브러리를 가져옵니다. 데이터 조작 및 숫자 연산을 위해 pandas 및 numpy, 파일 연결을 위한 st_files_connection, 보안 비밀번호 비교를 위해 HMAC를 포함하여 필요한 라이브러리를 가져옵니다.\u003c/p\u003e\n\u003cp\u003echeck_password() 함수는 사용자 인증을 처리합니다. 입력된 자격 증명을 HMAC를 사용하여 저장된 자격 증명과 비교하여 확인하는 login_form()을 생성합니다. 주요 check_password() 함수는 로그인 프로세스의 상태를 관리하고 로그인이 실패하는 경우 오류 메시지를 표시합니다. 사용자가 인증되지 않은 경우 앱을 중지합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Main Streamlit app starts here\u003c/span\u003e\nst.write(\u003cspan class=\"hljs-string\"\u003e\"스트림릿에 오신 것을 환영합니다! 위성 시각화 앱입니다...\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Display Title\u003c/span\u003e\nst.title(\u003cspan class=\"hljs-string\"\u003e\"위성 지도 포털\"\u003c/span\u003e)\nst.markdown(\u003cspan class=\"hljs-string\"\u003e\"아래 데이터를 입력하세요.\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Initialize session state for date_labels and user_date\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'date_labels'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.session_state:\n    st.session_state.date_labels = []\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'data'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.session_state:\n    st.session_state.data = \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'user_date'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.session_state:\n    st.session_state.user_date = \u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'user_date_index'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e st.session_state:\n    st.session_state.user_date_index = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\ncollections=[\u003cspan class=\"hljs-string\"\u003e\"sentinel-2-l2a\"\u003c/span\u003e]\ncolumns = [\u003cspan class=\"hljs-string\"\u003e'collection'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'start_date'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'end_date'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'min_cloud_cover'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'max_cloud_cover'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'longitude'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'latitude'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'buffer'\u003c/span\u003e]\n\n\u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e st.form(key=\u003cspan class=\"hljs-string\"\u003e\"test\"\u003c/span\u003e):\n    \n    collection=st.selectbox(\u003cspan class=\"hljs-string\"\u003e\"컬렉션*\"\u003c/span\u003e,options=collections,index=\u003cspan class=\"hljs-literal\"\u003eNone\u003c/span\u003e)\n    start_date = st.date_input(label=\u003cspan class=\"hljs-string\"\u003e\"시작 날짜*\"\u003c/span\u003e)\n    end_date = st.date_input(label=\u003cspan class=\"hljs-string\"\u003e\"끝 날짜*\"\u003c/span\u003e)\n    max_cloud_cover  = st.number_input(label=\u003cspan class=\"hljs-string\"\u003e\"최대 구름 덮인 정도*\"\u003c/span\u003e,value=\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e)\n    longitude=st.number_input(label=\u003cspan class=\"hljs-string\"\u003e\"경도*\"\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eformat\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"%.4f\"\u003c/span\u003e,value=-\u003cspan class=\"hljs-number\"\u003e119.7513\u003c/span\u003e)\n    latitude=st.number_input(label=\u003cspan class=\"hljs-string\"\u003e\"위도*\"\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eformat\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"%.4f\"\u003c/span\u003e,value=\u003cspan class=\"hljs-number\"\u003e37.2502\u003c/span\u003e)\n    buffer=st.number_input(label=\u003cspan class=\"hljs-string\"\u003e\"버퍼 (0.01 = 1 km)*\"\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eformat\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"%.2f\"\u003c/span\u003e,value=\u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-comment\"\u003e# Mark Mandatory fields\u003c/span\u003e\n    st.markdown(\u003cspan class=\"hljs-string\"\u003e\"**필수 입력란*\"\u003c/span\u003e)\n\n    submit_button_run = st.form_submit_button(label=\u003cspan class=\"hljs-string\"\u003e\"실행\"\u003c/span\u003e)\n    submit_button_list = st.form_submit_button(label=\u003cspan class=\"hljs-string\"\u003e\"가능한 이미지 목록 표시\"\u003c/span\u003e)\n    submit_button_viz = st.form_submit_button(label=\u003cspan class=\"hljs-string\"\u003e\"시각화\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eC:\\Users\\Streamlit\u003c/code\u003e streamlit run streamlit_app_authen_sentinel_2.py 실행하면 브라우저에서 로그인 및 주요 페이지를 볼 수 있습니다:\u003c/p\u003e\n\u003cp\u003e부분 1: 로그인 페이지\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_2.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e제2부: 메인 페이지\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_3.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e🌍 지도 시각화 기능\u003c/h2\u003e\n\u003cp\u003e지금까지 로그인 페이지를 만들고 메인 페이지를 디자인했습니다. 현재 메인 페이지에서는 사용자 입력을 수집하고 아직 기능이 구현되지 않은 세 개의 버튼이 있습니다. 이 섹션에서는 이 버튼을 작동하도록 코드를 완성할 것입니다. 첫 번째 버튼은 \"실행\"이며, 이 버튼은 사용자 입력 매개변수를 사용하여 클라우드 데이터베이스를 검색하고 DataFrame에 있는 사용 가능한 이미지를 표시하는 기능을 합니다. 이 버튼에 기능을 추가하기 위해 두 가지 추가 부분(Part 3 및 Part 4)을 포함했습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003ePart 3: 검색 기능 정의\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esearch_satellite_images\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecollection=\u003cspan class=\"hljs-string\"\u003e\"sentinel-2-l2a\"\u003c/span\u003e,\n                            bbox=[-\u003cspan class=\"hljs-number\"\u003e120.15\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e38.93\u003c/span\u003e,-\u003cspan class=\"hljs-number\"\u003e119.88\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e39.25\u003c/span\u003e],\n                            date=\u003cspan class=\"hljs-string\"\u003e\"2023-06-01/2023-06-30\"\u003c/span\u003e,\n                            cloud_cover=(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e):\n    \n    \u003cspan class=\"hljs-comment\"\u003e# 검색 클라이언트 정의\u003c/span\u003e\n    client=Client.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"https://earth-search.aws.element84.com/v1\"\u003c/span\u003e)\n    search = client.search(collections=[collection],\n                            bbox=bbox,\n                            datetime=date,\n                            query=[\u003cspan class=\"hljs-string\"\u003ef\"eo:cloud_cover\u0026#x3C;\u003cspan class=\"hljs-subst\"\u003e{cloud_cover[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]}\u003c/span\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003ef\"eo:cloud_cover\u003e\u003cspan class=\"hljs-subst\"\u003e{cloud_cover[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]}\u003c/span\u003e\"\u003c/span\u003e])\n\n    \u003cspan class=\"hljs-comment\"\u003e# 일치하는 항목 수 출력\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"찾은 이미지 수: \u003cspan class=\"hljs-subst\"\u003e{search.matched()}\u003c/span\u003e\"\u003c/span\u003e)\n\n    data = load(search.items(), bbox=bbox, groupby=\u003cspan class=\"hljs-string\"\u003e\"solar_day\"\u003c/span\u003e, chunks={})\n\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"데이터에 있는 날짜 수: \u003cspan class=\"hljs-subst\"\u003e{\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(data.time)}\u003c/span\u003e\"\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e data\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_bbox_with_buffer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003elatitude=\u003cspan class=\"hljs-number\"\u003e37.2502\u003c/span\u003e, longitude=-\u003cspan class=\"hljs-number\"\u003e119.7513\u003c/span\u003e, buffer=\u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e\u003c/span\u003e):\n    \n    min_lat = latitude - buffer\n    max_lat = latitude + buffer\n    min_lon = longitude - buffer\n    max_lon = longitude + buffer\n    \n    bbox = [min_lon, min_lat, max_lon, max_lat]\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e bbox\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePart 3은 사용자가 지정한 매개변수에 따라 STAC API에 연결하여 위성 이미지를 검색하는 search_satellite_images 함수를 정의하는 것으로 시작합니다. 해당 함수는 일치하는 데이터를 반환합니다. 다른 함수 get_bbox_with_buffer는 지정된 위도, 경도 주변에 특정 버퍼를 설정하여 경계 상자를 계산합니다.\u003c/p\u003e\n\u003cp\u003ePart 4: 실행 버튼\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e이러한 열이 있는 빈 DataFrame을 만듭니다\u003c/h1\u003e\n\u003cp\u003edf = pd.DataFrame(columns=columns)\u003c/p\u003e\n\u003cp\u003eif \"mdf\" not in st.session_state:\r\nst.session_state.mdf = pd.DataFrame(columns=df.columns)\u003c/p\u003e\n\u003ch1\u003e새 데이터\u003c/h1\u003e\n\u003cp\u003ewith st.form(key=\"test\"):\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecollection=st.selectbox(\"collection*\",options=collections,index=None)\r\nstart_date = st.date_input(label=\"start_date*\")\r\nend_date = st.date_input(label=\"end_date*\")\r\nmax_cloud_cover  = st.number_input(label=\"max_cloud_cover*\",value=10)\r\nlongitude=st.number_input(label=\"longitude*\", format=\"%.4f\",value=-119.7513)\r\nlatitude=st.number_input(label=\"latitude*\", format=\"%.4f\",value=37.2502)\r\nbuffer=st.number_input(label=\"buffer (0.01 = 1 km)*\", format=\"%.2f\",value=0.01)\r\n\r\n# 필수 사항 표시\r\nst.markdown(\"**필수*\")\r\n\r\nsubmit_button_run = st.form_submit_button(label=\"Run\")\r\nsubmit_button_list = st.form_submit_button(label=\"List Available Images\")\r\nsubmit_button_viz = st.form_submit_button(label=\"Visualize\")\r\n\r\nif submit_button_run:\r\n    new_df=pd.DataFrame(\r\n        [\r\n            {   \r\n                \"collection\": collection,\r\n                \"start_date\":start_date.strftime(\"%Y-%m-%d\"),\r\n                \"end_date\": end_date.strftime(\"%Y-%m-%d\"),\r\n                \"max_cloud_cover\":max_cloud_cover,\r\n                \"longitude\": longitude,\r\n                \"latitude\": latitude,\r\n                \"buffer\": buffer,\r\n\r\n            }\r\n\r\n        ]\r\n    )\r\n    \r\n    st.session_state.mdf = pd.concat([st.session_state.mdf, new_df], axis=0)\r\n    st.dataframe(st.session_state.mdf)\r\n    st.success(\"Your request successfully submitted!\")\r\n\r\n    data = search_satellite_images(collection=collection,\r\n                                   date=f\"{start_date}/{end_date}\",\r\n                                   cloud_cover=(0, max_cloud_cover),\r\n                                   bbox=get_bbox_with_buffer(latitude=latitude, longitude=longitude, buffer=buffer))\r\n    st.session_state.data = data\r\n\r\n    date_labels = []\r\n    # 시간 단계 수 결정\r\n    numb_days = len(data.time)\r\n    # 각 시간 단계 반복\r\n    for t in range(numb_days):\r\n        scl_image = data[[\"scl\"]].isel(time=t).to_array()\r\n        dt = pd.to_datetime(scl_image.time.values)\r\n        year = dt.year\r\n        month = dt.month\r\n        day = dt.day\r\n        date_string = f\"{year}-{month:02d}-{day:02d}\"\r\n        date_labels.append(date_string)\r\n    \r\n    st.session_state.date_labels= date_labels\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e두 번째 부분에서 주 어플리케이션 로직은 빈 DataFrame을 초기화하고 세션 상태에 DataFrame이 있는지 확인합니다.\u003c/p\u003e\n\u003cp\u003e“Run” 버튼을 클릭하면 사용자 입력 값으로 새 DataFrame 항목을 생성하고 세션 상태를 업데이트하며 업데이트된 DataFrame을 표시합니다. 그런 다음 search_satellite_images를 호출하여 데이터를 가져 오고 이 데이터를 처리하여 날짜 레이블을 추출하고 형식을 맞추어 세션 상태에 저장합니다. 이러한 설정을 통해 사용자는 매개 변수를 입력하고 위성 이미지를 검색하며 결과를 시각화 할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e이 시점에서 Streamlit 앱을 실행하면 지정된 위치 및 날짜에 대해 다음과 같은 테이블이 표시됩니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e아래는 \"Run\" 버튼을 활성화한 후 \"List Available Images\" 버튼을 활성화하는 단계입니다. 이 버튼을 클릭하면 사용자가 지정한 위치, 날짜 및 구름 양에 따라 Sentinel-2에 의해 촬영된 사용 가능한 이미지가 표시됩니다.\u003c/p\u003e\n\u003cp\u003e파트 5: List Available Images 버튼\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esubmit_button_list\u003c/span\u003e:\n        user_date=st.\u003cspan class=\"hljs-title function_\"\u003eselectbox\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Available Images*\"\u003c/span\u003e,options=st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edate_labels\u003c/span\u003e,index=\u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003euser_date\u003c/span\u003e:\n            st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euser_date\u003c/span\u003e = user_date\n            st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euser_date_index\u003c/span\u003e = user_date.\u003cspan class=\"hljs-title function_\"\u003eindex\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\"List Available Images\" 버튼을 클릭하면 이 코드가 위성 이미지의 사용 가능한 날짜를 나열하는 드롭다운 메뉴를 생성합니다. 사용자가 날짜를 선택하면 해당 날짜와 인덱스를 저장하는 세션 상태를 업데이트하여 사용자의 선택에 기반한 추가 작업을 가능하게 합니다.\u003c/p\u003e\n\u003cp\u003e이제 앱을 다시 실행하고 \"List Available Images\" 버튼을 클릭하면 사용 가능한 이미지를 나열하는 드롭다운 메뉴가 표시됩니다. 이 중 하나를 선택해주세요:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_5.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e사용 가능한 이미지 중 하나를 선택한 후 마지막 단계는 \"Visualize\" 버튼을 완료하고 활성화하는 것입니다. \"Visualize\" 버튼의 목표는 사용자가 지정한 위치와 버퍼에 대해 선택한 위성 이미지를 표시하는 것입니다. 시각화에 관한 이 메시지에서 설명된 코드를 사용했지만 오른쪽에 장면 분류의 파이 차트를 표시하는 추가 기능을 추가했습니다. 이를 위해 각 장면 클래스의 개수를 반환하는 함수를 정의하고 시각화 버튼에서 사용해야 합니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e파트 6: Count 함수\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edef \u003cspan class=\"hljs-title function_\"\u003ecount_classified_pixels\u003c/span\u003e(data,num):\n    \n    scl_image = data[[\u003cspan class=\"hljs-string\"\u003e\"scl\"\u003c/span\u003e]].\u003cspan class=\"hljs-title function_\"\u003eisel\u003c/span\u003e(time=num).\u003cspan class=\"hljs-title function_\"\u003eto_array\u003c/span\u003e()\n \n    # 분류된 픽셀 수 세기 \n    count_saturated = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)        # 포화 또는 결함\n    count_dark = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)             # 어두운 지역 픽셀\n    count_cloud_shadow = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)     # 구름 그림자\n    count_vegetation = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)       # 식물\n    count_soil = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e)             # 노출된 토양\n    count_water = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e)            # 물\n    count_clouds_low= np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e)        # 낮은 확률 구름 / 분류되지 않은 구름\n    count_clouds_med = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e)       # 중간 확률 구름\n    count_clouds_high = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e)      # 높은 확률 구름\n    count_clouds_cirrus = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e)   # 시르러스 구름\n    count_clouds_snow = np.\u003cspan class=\"hljs-title function_\"\u003ecount_nonzero\u003c/span\u003e(scl_image == \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e)     # 눈\n\n    counts = {\n    \u003cspan class=\"hljs-string\"\u003e'어둠/밝은 영역'\u003c/span\u003e: count_cloud_shadow +count_dark+count_clouds_low+count_clouds_med+count_clouds_high+count_clouds_cirrus +count_clouds_snow +count_saturated,\n    \u003cspan class=\"hljs-string\"\u003e'식물'\u003c/span\u003e: count_vegetation,\n    \u003cspan class=\"hljs-string\"\u003e'노출된 토양'\u003c/span\u003e: count_soil,\n    \u003cspan class=\"hljs-string\"\u003e'물'\u003c/span\u003e: count_water,\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e counts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e파트 7: 시각화 버튼\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esubmit_button_viz\u003c/span\u003e:\n        \n        date_string_title= f\u003cspan class=\"hljs-string\"\u003e\"타겟 지역의 Sentinel-2 이미지\"\u003c/span\u003e\n        fig, axs = plt.\u003cspan class=\"hljs-title function_\"\u003esubplots\u003c/span\u003e(nrows=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, ncols=\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, figsize=(\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e))  \n\n        rgb = st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e[[\u003cspan class=\"hljs-string\"\u003e\"red\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"green\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"blue\"\u003c/span\u003e]].\u003cspan class=\"hljs-title function_\"\u003eisel\u003c/span\u003e(time=st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euser_date_index\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eto_array\u003c/span\u003e()\n        rgb.\u003cspan class=\"hljs-property\"\u003eplot\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eimshow\u003c/span\u003e(robust=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, ax=axs[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e])\n        axs[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eaxis\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'off'\u003c/span\u003e)  # 축 눈금과 레이블 숨기기\n        axs[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eset_title\u003c/span\u003e(date_string_title)\n\n        # 데이터 준비 \n        counts = \u003cspan class=\"hljs-title function_\"\u003ecount_classified_pixels\u003c/span\u003e(st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e, st.\u003cspan class=\"hljs-property\"\u003esession_state\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euser_date_index\u003c/span\u003e )\n        labels = \u003cspan class=\"hljs-title function_\"\u003elist\u003c/span\u003e(counts.\u003cspan class=\"hljs-title function_\"\u003ekeys\u003c/span\u003e())\n        values = \u003cspan class=\"hljs-title function_\"\u003elist\u003c/span\u003e(counts.\u003cspan class=\"hljs-title function_\"\u003evalues\u003c/span\u003e())\n        colors = [\u003cspan class=\"hljs-string\"\u003e'DarkGrey'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'chartreuse'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'DarkOrange'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'cyan'\u003c/span\u003e]\n        explode = (\u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.1\u003c/span\u003e)  # 첫 번째 조각 튀어나오기\n\n        # 파이 차트 그리기 \n        axs[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003epie\u003c/span\u003e(values, labels=labels, colors=colors, autopct=\u003cspan class=\"hljs-string\"\u003e'%1.0f%%'\u003c/span\u003e, startangle=\u003cspan class=\"hljs-number\"\u003e140\u003c/span\u003e, explode=explode)\n        axs[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003elegend\u003c/span\u003e(labels, loc=\u003cspan class=\"hljs-string\"\u003e'best'\u003c/span\u003e, bbox_to_anchor=(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e))\n        axs[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eaxis\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'equal'\u003c/span\u003e)  # 파이 차트를 원으로 만들기\n        axs[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eset_title\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'클래스 분포'\u003c/span\u003e)\n\n        # 그림을 \u003cspan class=\"hljs-title class_\"\u003eStreamlit\u003c/span\u003e에 표시\n        st.\u003cspan class=\"hljs-title function_\"\u003epyplot\u003c/span\u003e(fig)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\"Visualize\" 버튼을 클릭하면 코드가 관심 영역(AOI) 위의 Sentinel-2 이미지를 나타내는 제목이 있는 플롯을 설정합니다. 두 개의 서브플롯이 나란히 만들어집니다. RGB 이미지가 선택된 날짜의 세션 상태 데이터에서 추출되어 시각적 명확성을 높이기 위해 첫 번째 서브플롯에 축 레이블 없이 표시됩니다. 모든 버튼이 활성화된 상태에서 앱을 한 번 더 실행해 봅시다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_6.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide_7.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e구름 양, 날짜 및 좌표의 기본값을 변경하여 시각화에 어떻게 영향을 주는지 확인해 보세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e📄 결론\u003c/h2\u003e\n\u003cp\u003e이 가이드에서는 지구상의 어떤 지점에서든 언제든 위성 이미지를 시각화하기 위한 Streamlit 애플리케이션을 만드는 과정을 안내했습니다. 우리는 앱을 안전하게 보호하기 위해 로그인 페이지를 설정한 후 사용자 입력을 수집하는 주 페이지를 디자인하는 것으로 시작했습니다. \"실행\" 버튼 기능을 구현하여 사용 가능한 위성 이미지를 검색하고, \"사용 가능한 이미지 목록\" 버튼을 클릭하면 사용 가능한 이미지의 드롭다운 메뉴가 표시되고, \"시각화\" 버튼을 클릭하여 선택한 위성 이미지를 표시할 수 있도록 했습니다. 이 인터랙티브한 방식은 사용자들이 코드를 커뮤니티와 쉽게 공유하고 위성 이미지를 효과적으로 탐색하고 다양한 시나리오를 탐구하여 인사이트를 얻을 수 있도록 합니다.\u003c/p\u003e\n\u003ch2\u003e📚 참고 자료\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/stac-utils/pystac-client/blob/main/docs/quickstart.rst\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://github.com/stac-utils/pystac-client/blob/main/docs/quickstart.rst\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://www.element84.com/earth-search/examples/\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://www.element84.com/earth-search/examples/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eCopernicus Sentinel 데이터 [2024]에 대한 센티넬 데이터\u003c/p\u003e\n\u003cp\u003eCopernicus 서비스 정보 [2024]에 대한 코퍼니커스 서비스 정보.\u003c/p\u003e\n\u003cp\u003e📱더 많은 흥미로운 콘텐츠를 보기 위해 다른 플랫폼에서 저와 연결하세요! LinkedIn, ResearchGate, Github 및 Twitter.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 링크를 통해 확인할 수 있는 관련 게시물이 있습니다:\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-CreatingaStreamlitAppforSatelliteImageryVisualizationAStep-by-StepGuide"},"buildId":"kkckKPyxcjJp_o8wb2unW","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>