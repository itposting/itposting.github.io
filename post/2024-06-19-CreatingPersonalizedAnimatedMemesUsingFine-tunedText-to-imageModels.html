<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기 | itposting" data-gatsby-head="true"/><meta property="og:title" content="개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels" data-gatsby-head="true"/><meta name="twitter:title" content="개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-19 21:00" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_buildManifest.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 19, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<h2>Stable Diffusion과 Deforum을 사용한 개인 맞춤형 미미 생성</h2>
<p>안녕하세요! 이 블로그 포스트에서는 Deforum과 섬세하게 조정된 Stable Diffusion(SD) 모델을 사용하여 맞춤형 및 애니메이션 미미를 만드는 과정을 소개하고, 스타일 전이 도구로 사용한 Visual Guide 출처의 몇 가지 미미 예제를 제시할 예정입니다.</p>
<p>시작하기 전에, 아직 저의 블로그에서 섬세하게 조정된 SD 모델을 사용하여 미미 이미지를 생성한 내용을 확인하지 않으셨다면 아래 링크를 확인해보세요:</p>
<p>전체 코드는 저의 GitHub 페이지에서 확인할 수 있습니다. 필요한 부분은 여기 있어요.</p>
<div class="content-ad"></div>
<h1>단계 1: 모델 파인 튜닝</h1>
<p>첫 번째 단계는 SD 모델을 파인 튜닥하는 것입니다. 저는 SD1.5 모델을 선택하고 해당 모델의 가중치를 여기서 다운로드 받았습니다. 그런 다음에는 제 PC가 10GB VRAM을 가진 RTX3080을 사용하기 때문에 로컬에서 학습 알고리즘을 실행했습니다. 충분히 강력한 성능을 가진 듯합니다.</p>
<p>파인 튜닥에 사용할 이미지를 선택할 때 주의하세요. 서로 다른 배경과 표정을 가진 이미지를 사용해 보세요. 저는 다음과 같은 이미지들을 사용했습니다.</p>
<p><img src="/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png" alt="이미지"></p>
<div class="content-ad"></div>
<p>훈련 후 모델 체크포인트 파일을 리포지토리의 models/ 하위 폴더로 이동해주세요.</p>
<p><img src="/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_1.png" alt="이미지"></p>
<h1>단계 2: 메멘티콘 템플릿 준비</h1>
<p>두 번째 단계는 Deforum 알고리즘을 실행하기 위해 필요한 파일을 준비하는 것입니다: 확산할 소스 비디오, 마스크 비디오 및 설정 파일. 더 쉽게 따라올 수 있도록, 이러한 단계를 세 가지 하위 섹션으로 설명하겠습니다.</p>
<div class="content-ad"></div>
<h2>단계 2.1: 확산할 소스 비디오 다운로드하기</h2>
<p>이 단계에서는 우리의 템플릿으로 사용할 비디오를 간단히 다운로드합니다. 사람이 포함된 비디오면 어떤 비디오든 사용할 수 있습니다. 저는 아래 비디오를 선택했습니다. 해당 비디오를 다운로드하고 templates/dimitri_finds_out/source.mp4 경로에 저장했습니다.</p>
<h2>단계 2.2: 마스크 비디오 생성</h2>
<p>디포럼 알고리즘은 마스크 비디오를 입력으로 사용할 수 있습니다. 마스크 비디오는 확산을 원하는 입력 비디오와 동일한 프레임 수를 가져야 합니다. 각 프레임은 확산을 위한 ROI가 검정색이고 터치하지 않을 부분이 흰색인 이진 강도로 구성됩니다. 그런 다음, 이것은 이진 분할 문제가 되며, 이에 대한 알고리즘은 문헌에서 흔히 사용할 수 있습니다.</p>
<div class="content-ad"></div>
<p>저는 PixelLib이라는 사용하기 쉬운 라이브러리를 알고 있습니다. 이 라이브러리는 기본적으로 PointRend를 기반으로 한 시맨틱 세그멘테이션 라이브러리입니다. 몇 줄의 코드로 세그먼트된 프레임을 생성할 수 있게 해줍니다. 사용하려면 이 링크에서 PointRend 모델을 다운로드하여 models/ 하위폴더로 이동해야 합니다.</p>
<p>마스크 생성을 자동화하는 스크립트 create_mask.py를 작성했습니다. 이 스크립트는 소스 비디오 경로와 출력 마스크 비디오를 저장할 경로 두 가지를 입력받습니다.</p>
<pre><code class="hljs language-js">python create_mask.<span class="hljs-property">py</span> \
  --video_path=<span class="hljs-string">"templates/dimitri_finds_out/source.mp4"</span> \
  --save_path=<span class="hljs-string">"templates/dimitri_finds_out/mask.mp4"</span>
</code></pre>
<p>PixelLib은 시맨틱 세그멘테이션 라이브러리이므로 프레임에서 감지된 각 사람에 대한 마스크를 제공합니다. 우리가 관심 영역을 선택하기 위해, 모든 감지된 사람 중에서 면적이 가장 큰 사람을 선택하는 절차를 구현했습니다. 이는 다음 두 함수에 의해 수행됩니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">def <span class="hljs-title function_">max_nonzero_channel</span>(arr):
    # 채널 차원을 제외한 모든 차원을 합산합니다
    channel_sums = np.<span class="hljs-title function_">sum</span>(arr != <span class="hljs-number">0</span>, axis=<span class="hljs-title function_">tuple</span>(<span class="hljs-title function_">range</span>(arr.<span class="hljs-property">ndim</span>-<span class="hljs-number">1</span>)))
    # 가장 높은 합을 가진 채널의 인덱스를 찾습니다
    max_channel_index = np.<span class="hljs-title function_">argmax</span>(channel_sums)
    <span class="hljs-keyword">return</span> max_channel_index

def <span class="hljs-title function_">frame_segmentation</span>(path_to_extracted_frames, frame_count, save_path_for_mask_frames):
    <span class="hljs-title function_">create_folder</span>(save_path_for_mask_frames) # 폴더가 없을 경우 생성합니다
    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-title function_">tqdm</span>(<span class="hljs-title function_">range</span>(frame_count)):
        # 비디오의 각 프레임에 대해 <span class="hljs-title class_">PointRend</span>를 실행합니다
        r, output = ins.<span class="hljs-title function_">segmentImage</span>(f<span class="hljs-string">"{path_to_extracted_frames}frame{index}.jpg"</span>, 
                                     show_bboxes=<span class="hljs-title class_">True</span>, segment_target_classes=target_classes, 
                                     save_extracted_objects=<span class="hljs-title class_">False</span>, mask_points_values=<span class="hljs-title class_">False</span>, 
                                     extract_segmented_objects=<span class="hljs-title class_">True</span>, output_image_name=<span class="hljs-title class_">None</span>)
        # 사람이 감지되었다면 최대 nonzero 픽셀 개수를 가진 채널을 선택합니다
        <span class="hljs-keyword">if</span> r[<span class="hljs-string">"masks"</span>].<span class="hljs-property">ndim</span> == <span class="hljs-number">3</span>:
            picked_object = <span class="hljs-title function_">int</span>(<span class="hljs-title function_">max_nonzero_channel</span>(r[<span class="hljs-string">"masks"</span>][:, :, :]))
            cv2.<span class="hljs-title function_">imwrite</span>(f<span class="hljs-string">"{save_path_for_mask_frames}mask{index:05}.png"</span>, (<span class="hljs-number">1</span> - r[<span class="hljs-string">"masks"</span>][:, :, picked_object]).<span class="hljs-title function_">astype</span>(int) * <span class="hljs-number">255</span>)
        # 그렇지 않으면 흰 프레임을 생성합니다
        <span class="hljs-attr">else</span>:
            cv2.<span class="hljs-title function_">imwrite</span>(f<span class="hljs-string">"{save_path_for_mask_frames}mask{index:05}.png"</span>, np.<span class="hljs-title function_">ones</span>((output.<span class="hljs-property">shape</span>)).<span class="hljs-title function_">astype</span>(int) * <span class="hljs-number">255</span>)
</code></pre>
<p>다음 비디오는 PointRend의 출력 및 후처리된 마스크 비디오로 선택한 소스 비디오의 내용을 보여줍니다.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1200/1*YSFCLiOQ-kPB-bf_4MQQ1g.gif" alt="비디오 링크"></p>
<p>create_mask.py를 실행한 후, 마스크 비디오가 템플릿의 하위 폴더에 있음을 확인해주세요.</p>
<div class="content-ad"></div>
<h2>단계 2.3: Deforum 설정 준비</h2>
<p>마지막 단계는 템플릿용 Deforum 알고리즘을 위한 settings.txt 파일을 생성하는 것입니다. 이 파일은 기본적으로 Deforum 매개변수 목록으로, 여기에 중요한 몇 가지가 있습니다: seed_behavior, animation_prompts, video_init_path, 그리고 video_mask_path.</p>
<p>seed_behavior: Deforum은 일반적으로 SD 실행을 위해 무작위 시드를 사용하지만, 애니메이션 일관성을 위해 "고정"으로 설정해야 합니다. 이렇게 하면 확산된 영역의 색상과 세부 사항이 연속된 프레임 내에서 의사 일관되게 유지됩니다.</p>
<p>animation_prompts: 일반적인 SD 프롬프팅과 달리 우리는 풍경에 대한 많은 세부 정보와 신호 입력할 필요가 없습니다. 입력 비디오를 공급하면 공간 영역의 대부분 세부 사항이 보존됩니다. 따라서 “sks 사람 사진, 현실적인 얼굴”과 같은 스타일 신호 몇 가지만 입력해도 충분합니다. 저의 비디오에는 웃고 춤추는 남성이 포함되어 있으므로 입력한 프롬프트는 “댄스 클럽에서 웃고 춤추는 sks 남성 사진, 현실적인 얼굴, 초상화 세부 사항, 강조 조명…”입니다.</p>
<div class="content-ad"></div>
<p>video_init_path 및 video_mask_path: 이러한 매개변수는 각각 source.mp4 및 mask.mp4의 경로입니다.</p>
<p>dimitri_finds_out 템플릿 설정 중 일부는 다음과 같습니다:</p>
<pre><code class="hljs language-js">{
    <span class="hljs-string">"ENABLE_STORY_MODE"</span>:<span class="hljs-string">"True"</span>,
    <span class="hljs-string">"batch_name"</span>:<span class="hljs-string">"dimitri_finds_out"</span>,
    <span class="hljs-string">"width"</span>:<span class="hljs-number">900</span>,
    <span class="hljs-string">"height"</span>:<span class="hljs-number">900</span>,
    <span class="hljs-string">"bit_depth_output"</span>:<span class="hljs-number">8</span>,
    <span class="hljs-string">"seed"</span>:-<span class="hljs-number">1</span> ,
    <span class="hljs-string">"seed_behavior"</span>:<span class="hljs-string">"fixed"</span>,
    <span class="hljs-string">"sampler"</span>:<span class="hljs-string">"euler_ancestral"</span>,
    <span class="hljs-string">"steps"</span>:<span class="hljs-number">70</span>,
    <span class="hljs-string">"scale"</span>:<span class="hljs-number">15</span>,
    <span class="hljs-string">"ddim_eta"</span>:<span class="hljs-number">0.0</span>,
    <span class="hljs-string">"filename_format"</span>:<span class="hljs-string">"{timestring}_{index}_{prompt}.png"</span>,
    <span class="hljs-string">"use_init"</span>:<span class="hljs-literal">false</span>,
    <span class="hljs-string">"init_image"</span>:<span class="hljs-string">""</span>,
    <span class="hljs-string">"strength"</span>:<span class="hljs-number">0.75</span>,
    <span class="hljs-string">"use_mask"</span>:<span class="hljs-literal">false</span>,
    <span class="hljs-string">"use_alpha_as_mask"</span>:<span class="hljs-literal">false</span>,
    <span class="hljs-string">"invert_mask"</span>:<span class="hljs-literal">false</span>,
    <span class="hljs-string">"animation_prompts"</span>:{
 <span class="hljs-string">"0"</span>: <span class="hljs-string">"picture of laughing sks man in a dance club, realistic face, ultra detailed face, accent lighting, extremely detailed, ultra detailed, intricate details, high composition, 8k, cinematic lighting, blurry:-1, disfigured:-1, ugly:-1, deformed:-1, bad anatomy:-1, poorly drawn face:-1, poorly drawn hands:-1, malformed hands:-1, disgusting:-1, poorly drawn:-1, poorly drawn face:-1"</span>
    },
    <span class="hljs-string">"animation_mode"</span>:<span class="hljs-string">"Video Input"</span>,
    <span class="hljs-string">"max_frames"</span>:<span class="hljs-number">348</span>,
    <span class="hljs-string">"diffusion_cadence"</span>:<span class="hljs-string">"6"</span>,
    <span class="hljs-string">"border"</span>:<span class="hljs-string">"warp"</span>,
    <span class="hljs-string">"video_init_path"</span>:<span class="hljs-string">"templates/dimitri_finds_out/source.mp4"</span>,
    <span class="hljs-string">"extract_nth_frame"</span>:<span class="hljs-number">1</span>,
    <span class="hljs-string">"overwrite_extracted_frames"</span>:<span class="hljs-literal">true</span>,
    <span class="hljs-string">"use_mask_video"</span>:<span class="hljs-literal">true</span>,
    <span class="hljs-string">"video_mask_path"</span>:<span class="hljs-string">"templates/dimitri_finds_out/mask.mp4"</span>,
    <span class="hljs-string">"interpolate_key_frames"</span>:<span class="hljs-literal">false</span>,
    <span class="hljs-string">"fps"</span>:<span class="hljs-number">24</span>
}
</code></pre>
<p>설정 파일을 settings.txt로 저장합니다. 아래에 나타낸대로, 소스 비디오, 마스크 비디오, 및 설정 파일은 templates/dimitri_finds_out/ 하위 폴더에 저장됩니다.</p>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_2.png">
<h1>단계 3: Deforum 실행하기</h1>
<p>이제 Deforum 스크립트를 실행할 준비가 되었습니다. 저는 Deforum 기능을 제어하는 메타 스크립트인 run.py를 만들었습니다. 다음과 같이 명령줄에 두 가지 인자를 제공해야 합니다. 템플릿 이름과 여러분의 미세 조정된 모델의 이름입니다:</p>
<pre><code class="hljs language-js">python run.<span class="hljs-property">py</span> \
  --meme_template=<span class="hljs-string">"dimitri_finds_out"</span> \
  --finetuned_model_path=<span class="hljs-string">"your_finetuned_model.ckpt"</span>
</code></pre>
<div class="content-ad"></div>
<p>하드웨어에 따라 스크립트 실행이 몇 분 정도 걸릴 수 있습니다. 제 경우에는 약 5분이 소요됩니다. 결과 동영상은 output/ 폴더에 저장됩니다.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1200/1*SlWST_jBJkg7rUxj2aHUMQ.gif" alt="이미지"></p>
<h1>단계 4: 동영상에 텍스트 추가</h1>
<p>상상력과 유머 감각이 발휘되는 단계입니다. 우리는 동영상에 텍스트를 추가하여 미eme의 필수 요소인 비디오에 텍스트를 추가합니다. 제 메타 스크립트에는 텍스트 추가 기능이 구현되어 있지 않습니다(곧 추가할 예정). ffmpeg를 사용하여 명령줄을 통해 동영상에 텍스트를 추가할 수 있습니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-bash">ffmpeg -i 경로/비디오 -vf <span class="hljs-string">"drawtext=text='당신의 텍스트':x=(w-tw)/2:y=(h-th)/12:fontfile=C:/Windows/Fonts/Arial.ttf:fontsize=40:fontcolor=white"</span> 경로/출력/비디오
</code></pre>
<p>아래는 제가 한 작업입니다:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1200/1*BjphB2HVk5ANzpA_f1y-fA.gif" alt="이미지"></p>
<p>제 블로그를 읽어주셔서 감사합니다. 곧 비슷한 콘텐츠 생성을 위해 ControlNet을 사용하는 또 다른 블로그를 작성할 예정입니다.</p>
<div class="content-ad"></div>
<p>좋은 하루 보내세요!</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"개성있는 애니메이션 미미 만들기 세밀하게 조정된 텍스트-이미지 모델 사용하기","description":"","date":"2024-06-19 21:00","slug":"2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels","content":"\n\n## Stable Diffusion과 Deforum을 사용한 개인 맞춤형 미미 생성\n\n안녕하세요! 이 블로그 포스트에서는 Deforum과 섬세하게 조정된 Stable Diffusion(SD) 모델을 사용하여 맞춤형 및 애니메이션 미미를 만드는 과정을 소개하고, 스타일 전이 도구로 사용한 Visual Guide 출처의 몇 가지 미미 예제를 제시할 예정입니다.\n\n시작하기 전에, 아직 저의 블로그에서 섬세하게 조정된 SD 모델을 사용하여 미미 이미지를 생성한 내용을 확인하지 않으셨다면 아래 링크를 확인해보세요:\n\n전체 코드는 저의 GitHub 페이지에서 확인할 수 있습니다. 필요한 부분은 여기 있어요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 단계 1: 모델 파인 튜닝\n\n첫 번째 단계는 SD 모델을 파인 튜닥하는 것입니다. 저는 SD1.5 모델을 선택하고 해당 모델의 가중치를 여기서 다운로드 받았습니다. 그런 다음에는 제 PC가 10GB VRAM을 가진 RTX3080을 사용하기 때문에 로컬에서 학습 알고리즘을 실행했습니다. 충분히 강력한 성능을 가진 듯합니다.\n\n파인 튜닥에 사용할 이미지를 선택할 때 주의하세요. 서로 다른 배경과 표정을 가진 이미지를 사용해 보세요. 저는 다음과 같은 이미지들을 사용했습니다.\n\n![이미지](/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n훈련 후 모델 체크포인트 파일을 리포지토리의 models/ 하위 폴더로 이동해주세요.\n\n![이미지](/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_1.png)\n\n# 단계 2: 메멘티콘 템플릿 준비\n\n두 번째 단계는 Deforum 알고리즘을 실행하기 위해 필요한 파일을 준비하는 것입니다: 확산할 소스 비디오, 마스크 비디오 및 설정 파일. 더 쉽게 따라올 수 있도록, 이러한 단계를 세 가지 하위 섹션으로 설명하겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 단계 2.1: 확산할 소스 비디오 다운로드하기\n\n이 단계에서는 우리의 템플릿으로 사용할 비디오를 간단히 다운로드합니다. 사람이 포함된 비디오면 어떤 비디오든 사용할 수 있습니다. 저는 아래 비디오를 선택했습니다. 해당 비디오를 다운로드하고 templates/dimitri_finds_out/source.mp4 경로에 저장했습니다.\n\n## 단계 2.2: 마스크 비디오 생성\n\n디포럼 알고리즘은 마스크 비디오를 입력으로 사용할 수 있습니다. 마스크 비디오는 확산을 원하는 입력 비디오와 동일한 프레임 수를 가져야 합니다. 각 프레임은 확산을 위한 ROI가 검정색이고 터치하지 않을 부분이 흰색인 이진 강도로 구성됩니다. 그런 다음, 이것은 이진 분할 문제가 되며, 이에 대한 알고리즘은 문헌에서 흔히 사용할 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저는 PixelLib이라는 사용하기 쉬운 라이브러리를 알고 있습니다. 이 라이브러리는 기본적으로 PointRend를 기반으로 한 시맨틱 세그멘테이션 라이브러리입니다. 몇 줄의 코드로 세그먼트된 프레임을 생성할 수 있게 해줍니다. 사용하려면 이 링크에서 PointRend 모델을 다운로드하여 models/ 하위폴더로 이동해야 합니다.\n\n마스크 생성을 자동화하는 스크립트 create_mask.py를 작성했습니다. 이 스크립트는 소스 비디오 경로와 출력 마스크 비디오를 저장할 경로 두 가지를 입력받습니다.\n\n```js\npython create_mask.py \\\n  --video_path=\"templates/dimitri_finds_out/source.mp4\" \\\n  --save_path=\"templates/dimitri_finds_out/mask.mp4\"\n```\n\nPixelLib은 시맨틱 세그멘테이션 라이브러리이므로 프레임에서 감지된 각 사람에 대한 마스크를 제공합니다. 우리가 관심 영역을 선택하기 위해, 모든 감지된 사람 중에서 면적이 가장 큰 사람을 선택하는 절차를 구현했습니다. 이는 다음 두 함수에 의해 수행됩니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ndef max_nonzero_channel(arr):\n    # 채널 차원을 제외한 모든 차원을 합산합니다\n    channel_sums = np.sum(arr != 0, axis=tuple(range(arr.ndim-1)))\n    # 가장 높은 합을 가진 채널의 인덱스를 찾습니다\n    max_channel_index = np.argmax(channel_sums)\n    return max_channel_index\n\ndef frame_segmentation(path_to_extracted_frames, frame_count, save_path_for_mask_frames):\n    create_folder(save_path_for_mask_frames) # 폴더가 없을 경우 생성합니다\n    for index in tqdm(range(frame_count)):\n        # 비디오의 각 프레임에 대해 PointRend를 실행합니다\n        r, output = ins.segmentImage(f\"{path_to_extracted_frames}frame{index}.jpg\", \n                                     show_bboxes=True, segment_target_classes=target_classes, \n                                     save_extracted_objects=False, mask_points_values=False, \n                                     extract_segmented_objects=True, output_image_name=None)\n        # 사람이 감지되었다면 최대 nonzero 픽셀 개수를 가진 채널을 선택합니다\n        if r[\"masks\"].ndim == 3:\n            picked_object = int(max_nonzero_channel(r[\"masks\"][:, :, :]))\n            cv2.imwrite(f\"{save_path_for_mask_frames}mask{index:05}.png\", (1 - r[\"masks\"][:, :, picked_object]).astype(int) * 255)\n        # 그렇지 않으면 흰 프레임을 생성합니다\n        else:\n            cv2.imwrite(f\"{save_path_for_mask_frames}mask{index:05}.png\", np.ones((output.shape)).astype(int) * 255)\n```\n\n다음 비디오는 PointRend의 출력 및 후처리된 마스크 비디오로 선택한 소스 비디오의 내용을 보여줍니다.\n\n![비디오 링크](https://miro.medium.com/v2/resize:fit:1200/1*YSFCLiOQ-kPB-bf_4MQQ1g.gif)\n\ncreate_mask.py를 실행한 후, 마스크 비디오가 템플릿의 하위 폴더에 있음을 확인해주세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 단계 2.3: Deforum 설정 준비\n\n마지막 단계는 템플릿용 Deforum 알고리즘을 위한 settings.txt 파일을 생성하는 것입니다. 이 파일은 기본적으로 Deforum 매개변수 목록으로, 여기에 중요한 몇 가지가 있습니다: seed_behavior, animation_prompts, video_init_path, 그리고 video_mask_path.\n\nseed_behavior: Deforum은 일반적으로 SD 실행을 위해 무작위 시드를 사용하지만, 애니메이션 일관성을 위해 \"고정\"으로 설정해야 합니다. 이렇게 하면 확산된 영역의 색상과 세부 사항이 연속된 프레임 내에서 의사 일관되게 유지됩니다.\n\nanimation_prompts: 일반적인 SD 프롬프팅과 달리 우리는 풍경에 대한 많은 세부 정보와 신호 입력할 필요가 없습니다. 입력 비디오를 공급하면 공간 영역의 대부분 세부 사항이 보존됩니다. 따라서 “sks 사람 사진, 현실적인 얼굴”과 같은 스타일 신호 몇 가지만 입력해도 충분합니다. 저의 비디오에는 웃고 춤추는 남성이 포함되어 있으므로 입력한 프롬프트는 “댄스 클럽에서 웃고 춤추는 sks 남성 사진, 현실적인 얼굴, 초상화 세부 사항, 강조 조명…”입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nvideo_init_path 및 video_mask_path: 이러한 매개변수는 각각 source.mp4 및 mask.mp4의 경로입니다.\n\ndimitri_finds_out 템플릿 설정 중 일부는 다음과 같습니다:\n\n```js\n{\n    \"ENABLE_STORY_MODE\":\"True\",\n    \"batch_name\":\"dimitri_finds_out\",\n    \"width\":900,\n    \"height\":900,\n    \"bit_depth_output\":8,\n    \"seed\":-1 ,\n    \"seed_behavior\":\"fixed\",\n    \"sampler\":\"euler_ancestral\",\n    \"steps\":70,\n    \"scale\":15,\n    \"ddim_eta\":0.0,\n    \"filename_format\":\"{timestring}_{index}_{prompt}.png\",\n    \"use_init\":false,\n    \"init_image\":\"\",\n    \"strength\":0.75,\n    \"use_mask\":false,\n    \"use_alpha_as_mask\":false,\n    \"invert_mask\":false,\n    \"animation_prompts\":{\n \"0\": \"picture of laughing sks man in a dance club, realistic face, ultra detailed face, accent lighting, extremely detailed, ultra detailed, intricate details, high composition, 8k, cinematic lighting, blurry:-1, disfigured:-1, ugly:-1, deformed:-1, bad anatomy:-1, poorly drawn face:-1, poorly drawn hands:-1, malformed hands:-1, disgusting:-1, poorly drawn:-1, poorly drawn face:-1\"\n    },\n    \"animation_mode\":\"Video Input\",\n    \"max_frames\":348,\n    \"diffusion_cadence\":\"6\",\n    \"border\":\"warp\",\n    \"video_init_path\":\"templates/dimitri_finds_out/source.mp4\",\n    \"extract_nth_frame\":1,\n    \"overwrite_extracted_frames\":true,\n    \"use_mask_video\":true,\n    \"video_mask_path\":\"templates/dimitri_finds_out/mask.mp4\",\n    \"interpolate_key_frames\":false,\n    \"fps\":24\n}\n```\n\n설정 파일을 settings.txt로 저장합니다. 아래에 나타낸대로, 소스 비디오, 마스크 비디오, 및 설정 파일은 templates/dimitri_finds_out/ 하위 폴더에 저장됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_2.png\" /\u003e\n\n# 단계 3: Deforum 실행하기\n\n이제 Deforum 스크립트를 실행할 준비가 되었습니다. 저는 Deforum 기능을 제어하는 메타 스크립트인 run.py를 만들었습니다. 다음과 같이 명령줄에 두 가지 인자를 제공해야 합니다. 템플릿 이름과 여러분의 미세 조정된 모델의 이름입니다:\n\n```js\npython run.py \\\n  --meme_template=\"dimitri_finds_out\" \\\n  --finetuned_model_path=\"your_finetuned_model.ckpt\"\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n하드웨어에 따라 스크립트 실행이 몇 분 정도 걸릴 수 있습니다. 제 경우에는 약 5분이 소요됩니다. 결과 동영상은 output/ 폴더에 저장됩니다.\n\n![이미지](https://miro.medium.com/v2/resize:fit:1200/1*SlWST_jBJkg7rUxj2aHUMQ.gif)\n\n# 단계 4: 동영상에 텍스트 추가\n\n상상력과 유머 감각이 발휘되는 단계입니다. 우리는 동영상에 텍스트를 추가하여 미eme의 필수 요소인 비디오에 텍스트를 추가합니다. 제 메타 스크립트에는 텍스트 추가 기능이 구현되어 있지 않습니다(곧 추가할 예정). ffmpeg를 사용하여 명령줄을 통해 동영상에 텍스트를 추가할 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```bash\nffmpeg -i 경로/비디오 -vf \"drawtext=text='당신의 텍스트':x=(w-tw)/2:y=(h-th)/12:fontfile=C:/Windows/Fonts/Arial.ttf:fontsize=40:fontcolor=white\" 경로/출력/비디오\n```\n\n아래는 제가 한 작업입니다:\n\n![이미지](https://miro.medium.com/v2/resize:fit:1200/1*BjphB2HVk5ANzpA_f1y-fA.gif)\n\n제 블로그를 읽어주셔서 감사합니다. 곧 비슷한 콘텐츠 생성을 위해 ControlNet을 사용하는 또 다른 블로그를 작성할 예정입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n좋은 하루 보내세요!","ogImage":{"url":"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png"},"coverImage":"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003ch2\u003eStable Diffusion과 Deforum을 사용한 개인 맞춤형 미미 생성\u003c/h2\u003e\n\u003cp\u003e안녕하세요! 이 블로그 포스트에서는 Deforum과 섬세하게 조정된 Stable Diffusion(SD) 모델을 사용하여 맞춤형 및 애니메이션 미미를 만드는 과정을 소개하고, 스타일 전이 도구로 사용한 Visual Guide 출처의 몇 가지 미미 예제를 제시할 예정입니다.\u003c/p\u003e\n\u003cp\u003e시작하기 전에, 아직 저의 블로그에서 섬세하게 조정된 SD 모델을 사용하여 미미 이미지를 생성한 내용을 확인하지 않으셨다면 아래 링크를 확인해보세요:\u003c/p\u003e\n\u003cp\u003e전체 코드는 저의 GitHub 페이지에서 확인할 수 있습니다. 필요한 부분은 여기 있어요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e단계 1: 모델 파인 튜닝\u003c/h1\u003e\n\u003cp\u003e첫 번째 단계는 SD 모델을 파인 튜닥하는 것입니다. 저는 SD1.5 모델을 선택하고 해당 모델의 가중치를 여기서 다운로드 받았습니다. 그런 다음에는 제 PC가 10GB VRAM을 가진 RTX3080을 사용하기 때문에 로컬에서 학습 알고리즘을 실행했습니다. 충분히 강력한 성능을 가진 듯합니다.\u003c/p\u003e\n\u003cp\u003e파인 튜닥에 사용할 이미지를 선택할 때 주의하세요. 서로 다른 배경과 표정을 가진 이미지를 사용해 보세요. 저는 다음과 같은 이미지들을 사용했습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e훈련 후 모델 체크포인트 파일을 리포지토리의 models/ 하위 폴더로 이동해주세요.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch1\u003e단계 2: 메멘티콘 템플릿 준비\u003c/h1\u003e\n\u003cp\u003e두 번째 단계는 Deforum 알고리즘을 실행하기 위해 필요한 파일을 준비하는 것입니다: 확산할 소스 비디오, 마스크 비디오 및 설정 파일. 더 쉽게 따라올 수 있도록, 이러한 단계를 세 가지 하위 섹션으로 설명하겠습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e단계 2.1: 확산할 소스 비디오 다운로드하기\u003c/h2\u003e\n\u003cp\u003e이 단계에서는 우리의 템플릿으로 사용할 비디오를 간단히 다운로드합니다. 사람이 포함된 비디오면 어떤 비디오든 사용할 수 있습니다. 저는 아래 비디오를 선택했습니다. 해당 비디오를 다운로드하고 templates/dimitri_finds_out/source.mp4 경로에 저장했습니다.\u003c/p\u003e\n\u003ch2\u003e단계 2.2: 마스크 비디오 생성\u003c/h2\u003e\n\u003cp\u003e디포럼 알고리즘은 마스크 비디오를 입력으로 사용할 수 있습니다. 마스크 비디오는 확산을 원하는 입력 비디오와 동일한 프레임 수를 가져야 합니다. 각 프레임은 확산을 위한 ROI가 검정색이고 터치하지 않을 부분이 흰색인 이진 강도로 구성됩니다. 그런 다음, 이것은 이진 분할 문제가 되며, 이에 대한 알고리즘은 문헌에서 흔히 사용할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e저는 PixelLib이라는 사용하기 쉬운 라이브러리를 알고 있습니다. 이 라이브러리는 기본적으로 PointRend를 기반으로 한 시맨틱 세그멘테이션 라이브러리입니다. 몇 줄의 코드로 세그먼트된 프레임을 생성할 수 있게 해줍니다. 사용하려면 이 링크에서 PointRend 모델을 다운로드하여 models/ 하위폴더로 이동해야 합니다.\u003c/p\u003e\n\u003cp\u003e마스크 생성을 자동화하는 스크립트 create_mask.py를 작성했습니다. 이 스크립트는 소스 비디오 경로와 출력 마스크 비디오를 저장할 경로 두 가지를 입력받습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epython create_mask.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e \\\n  --video_path=\u003cspan class=\"hljs-string\"\u003e\"templates/dimitri_finds_out/source.mp4\"\u003c/span\u003e \\\n  --save_path=\u003cspan class=\"hljs-string\"\u003e\"templates/dimitri_finds_out/mask.mp4\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePixelLib은 시맨틱 세그멘테이션 라이브러리이므로 프레임에서 감지된 각 사람에 대한 마스크를 제공합니다. 우리가 관심 영역을 선택하기 위해, 모든 감지된 사람 중에서 면적이 가장 큰 사람을 선택하는 절차를 구현했습니다. 이는 다음 두 함수에 의해 수행됩니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edef \u003cspan class=\"hljs-title function_\"\u003emax_nonzero_channel\u003c/span\u003e(arr):\n    # 채널 차원을 제외한 모든 차원을 합산합니다\n    channel_sums = np.\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(arr != \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, axis=\u003cspan class=\"hljs-title function_\"\u003etuple\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(arr.\u003cspan class=\"hljs-property\"\u003endim\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n    # 가장 높은 합을 가진 채널의 인덱스를 찾습니다\n    max_channel_index = np.\u003cspan class=\"hljs-title function_\"\u003eargmax\u003c/span\u003e(channel_sums)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e max_channel_index\n\ndef \u003cspan class=\"hljs-title function_\"\u003eframe_segmentation\u003c/span\u003e(path_to_extracted_frames, frame_count, save_path_for_mask_frames):\n    \u003cspan class=\"hljs-title function_\"\u003ecreate_folder\u003c/span\u003e(save_path_for_mask_frames) # 폴더가 없을 경우 생성합니다\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e index \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003etqdm\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(frame_count)):\n        # 비디오의 각 프레임에 대해 \u003cspan class=\"hljs-title class_\"\u003ePointRend\u003c/span\u003e를 실행합니다\n        r, output = ins.\u003cspan class=\"hljs-title function_\"\u003esegmentImage\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"{path_to_extracted_frames}frame{index}.jpg\"\u003c/span\u003e, \n                                     show_bboxes=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, segment_target_classes=target_classes, \n                                     save_extracted_objects=\u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e, mask_points_values=\u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e, \n                                     extract_segmented_objects=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, output_image_name=\u003cspan class=\"hljs-title class_\"\u003eNone\u003c/span\u003e)\n        # 사람이 감지되었다면 최대 nonzero 픽셀 개수를 가진 채널을 선택합니다\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e r[\u003cspan class=\"hljs-string\"\u003e\"masks\"\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003endim\u003c/span\u003e == \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e:\n            picked_object = \u003cspan class=\"hljs-title function_\"\u003eint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003emax_nonzero_channel\u003c/span\u003e(r[\u003cspan class=\"hljs-string\"\u003e\"masks\"\u003c/span\u003e][:, :, :]))\n            cv2.\u003cspan class=\"hljs-title function_\"\u003eimwrite\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"{save_path_for_mask_frames}mask{index:05}.png\"\u003c/span\u003e, (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - r[\u003cspan class=\"hljs-string\"\u003e\"masks\"\u003c/span\u003e][:, :, picked_object]).\u003cspan class=\"hljs-title function_\"\u003eastype\u003c/span\u003e(int) * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e)\n        # 그렇지 않으면 흰 프레임을 생성합니다\n        \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n            cv2.\u003cspan class=\"hljs-title function_\"\u003eimwrite\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"{save_path_for_mask_frames}mask{index:05}.png\"\u003c/span\u003e, np.\u003cspan class=\"hljs-title function_\"\u003eones\u003c/span\u003e((output.\u003cspan class=\"hljs-property\"\u003eshape\u003c/span\u003e)).\u003cspan class=\"hljs-title function_\"\u003eastype\u003c/span\u003e(int) * \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e다음 비디오는 PointRend의 출력 및 후처리된 마스크 비디오로 선택한 소스 비디오의 내용을 보여줍니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:1200/1*YSFCLiOQ-kPB-bf_4MQQ1g.gif\" alt=\"비디오 링크\"\u003e\u003c/p\u003e\n\u003cp\u003ecreate_mask.py를 실행한 후, 마스크 비디오가 템플릿의 하위 폴더에 있음을 확인해주세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e단계 2.3: Deforum 설정 준비\u003c/h2\u003e\n\u003cp\u003e마지막 단계는 템플릿용 Deforum 알고리즘을 위한 settings.txt 파일을 생성하는 것입니다. 이 파일은 기본적으로 Deforum 매개변수 목록으로, 여기에 중요한 몇 가지가 있습니다: seed_behavior, animation_prompts, video_init_path, 그리고 video_mask_path.\u003c/p\u003e\n\u003cp\u003eseed_behavior: Deforum은 일반적으로 SD 실행을 위해 무작위 시드를 사용하지만, 애니메이션 일관성을 위해 \"고정\"으로 설정해야 합니다. 이렇게 하면 확산된 영역의 색상과 세부 사항이 연속된 프레임 내에서 의사 일관되게 유지됩니다.\u003c/p\u003e\n\u003cp\u003eanimation_prompts: 일반적인 SD 프롬프팅과 달리 우리는 풍경에 대한 많은 세부 정보와 신호 입력할 필요가 없습니다. 입력 비디오를 공급하면 공간 영역의 대부분 세부 사항이 보존됩니다. 따라서 “sks 사람 사진, 현실적인 얼굴”과 같은 스타일 신호 몇 가지만 입력해도 충분합니다. 저의 비디오에는 웃고 춤추는 남성이 포함되어 있으므로 입력한 프롬프트는 “댄스 클럽에서 웃고 춤추는 sks 남성 사진, 현실적인 얼굴, 초상화 세부 사항, 강조 조명…”입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003evideo_init_path 및 video_mask_path: 이러한 매개변수는 각각 source.mp4 및 mask.mp4의 경로입니다.\u003c/p\u003e\n\u003cp\u003edimitri_finds_out 템플릿 설정 중 일부는 다음과 같습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e{\n    \u003cspan class=\"hljs-string\"\u003e\"ENABLE_STORY_MODE\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"True\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"batch_name\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"dimitri_finds_out\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"width\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e900\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"height\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e900\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"bit_depth_output\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"seed\"\u003c/span\u003e:-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ,\n    \u003cspan class=\"hljs-string\"\u003e\"seed_behavior\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"fixed\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"sampler\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"euler_ancestral\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"steps\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e70\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"scale\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"ddim_eta\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"filename_format\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"{timestring}_{index}_{prompt}.png\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"use_init\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"init_image\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"strength\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e0.75\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"use_mask\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"use_alpha_as_mask\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"invert_mask\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"animation_prompts\"\u003c/span\u003e:{\n \u003cspan class=\"hljs-string\"\u003e\"0\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"picture of laughing sks man in a dance club, realistic face, ultra detailed face, accent lighting, extremely detailed, ultra detailed, intricate details, high composition, 8k, cinematic lighting, blurry:-1, disfigured:-1, ugly:-1, deformed:-1, bad anatomy:-1, poorly drawn face:-1, poorly drawn hands:-1, malformed hands:-1, disgusting:-1, poorly drawn:-1, poorly drawn face:-1\"\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-string\"\u003e\"animation_mode\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"Video Input\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"max_frames\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e348\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"diffusion_cadence\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"6\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"border\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"warp\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"video_init_path\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"templates/dimitri_finds_out/source.mp4\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"extract_nth_frame\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"overwrite_extracted_frames\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"use_mask_video\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"video_mask_path\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"templates/dimitri_finds_out/mask.mp4\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"interpolate_key_frames\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"fps\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e설정 파일을 settings.txt로 저장합니다. 아래에 나타낸대로, 소스 비디오, 마스크 비디오, 및 설정 파일은 templates/dimitri_finds_out/ 하위 폴더에 저장됩니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels_2.png\"\u003e\n\u003ch1\u003e단계 3: Deforum 실행하기\u003c/h1\u003e\n\u003cp\u003e이제 Deforum 스크립트를 실행할 준비가 되었습니다. 저는 Deforum 기능을 제어하는 메타 스크립트인 run.py를 만들었습니다. 다음과 같이 명령줄에 두 가지 인자를 제공해야 합니다. 템플릿 이름과 여러분의 미세 조정된 모델의 이름입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epython run.\u003cspan class=\"hljs-property\"\u003epy\u003c/span\u003e \\\n  --meme_template=\u003cspan class=\"hljs-string\"\u003e\"dimitri_finds_out\"\u003c/span\u003e \\\n  --finetuned_model_path=\u003cspan class=\"hljs-string\"\u003e\"your_finetuned_model.ckpt\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e하드웨어에 따라 스크립트 실행이 몇 분 정도 걸릴 수 있습니다. 제 경우에는 약 5분이 소요됩니다. 결과 동영상은 output/ 폴더에 저장됩니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:1200/1*SlWST_jBJkg7rUxj2aHUMQ.gif\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch1\u003e단계 4: 동영상에 텍스트 추가\u003c/h1\u003e\n\u003cp\u003e상상력과 유머 감각이 발휘되는 단계입니다. 우리는 동영상에 텍스트를 추가하여 미eme의 필수 요소인 비디오에 텍스트를 추가합니다. 제 메타 스크립트에는 텍스트 추가 기능이 구현되어 있지 않습니다(곧 추가할 예정). ffmpeg를 사용하여 명령줄을 통해 동영상에 텍스트를 추가할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003effmpeg -i 경로/비디오 -vf \u003cspan class=\"hljs-string\"\u003e\"drawtext=text='당신의 텍스트':x=(w-tw)/2:y=(h-th)/12:fontfile=C:/Windows/Fonts/Arial.ttf:fontsize=40:fontcolor=white\"\u003c/span\u003e 경로/출력/비디오\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e아래는 제가 한 작업입니다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:1200/1*BjphB2HVk5ANzpA_f1y-fA.gif\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e제 블로그를 읽어주셔서 감사합니다. 곧 비슷한 콘텐츠 생성을 위해 ControlNet을 사용하는 또 다른 블로그를 작성할 예정입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e좋은 하루 보내세요!\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-19-CreatingPersonalizedAnimatedMemesUsingFine-tunedText-to-imageModels"},"buildId":"CYQjEY3HhSkRTiL0gewc0","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>