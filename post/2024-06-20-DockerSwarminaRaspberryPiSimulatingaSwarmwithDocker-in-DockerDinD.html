<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기 | itposting</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://itposting.github.io///post/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기 | itposting" data-gatsby-head="true"/><meta property="og:title" content="라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기 | itposting" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://itposting.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://itposting.github.io///post/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD" data-gatsby-head="true"/><meta name="twitter:title" content="라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기 | itposting" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | itposting" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 17:31" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-23YXDLKDCL"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-23YXDLKDCL');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-d849684d6d83f07a.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_buildManifest.js" defer=""></script><script src="/_next/static/CYQjEY3HhSkRTiL0gewc0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">IT Posting</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">IT Posting</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png" alt="이미지"></p>
<p>이 프로젝트에서는 Raspberry Pi 4B 4Gb Raspberry Pi OS Lite 64비트 및 도커를 사용하여 놀고 있었어요. 가이드가 아닌 과정 보고서이니 먼저 전체 내용을 읽어보시는 걸 추천해요.</p>
<h2>1) Raspberry Pi OS Lite 64비트에 도커 설치하기</h2>
<h2>2) 매니저 설정하기</h2>
<div class="content-ad"></div>
<h2>3) 작업자를 배포하세요.</h2>
<h2>4) Docker Swarm을 Docker-in-Docker (DinD)로 시뮬레이션하는 단계</h2>
<h2>1) Raspberry Pi OS Lite 64비트에 Docker 설치하기</h2>
<pre><code class="hljs language-js">sudo apt-get update &#x26;&#x26; sudo apt-get upgrade -y
<span class="hljs-keyword">for</span> pkg <span class="hljs-keyword">in</span> docker.<span class="hljs-property">io</span> docker-doc docker-compose podman-docker containerd runc; <span class="hljs-keyword">do</span> sudo apt-get remove $pkg; done
# 도커의 공식 <span class="hljs-variable constant_">GPG</span> 키 추가:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m <span class="hljs-number">0755</span> -d /etc/apt/keyrings
sudo curl -fsSL <span class="hljs-attr">https</span>:<span class="hljs-comment">//download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc</span>
sudo chmod a+r /etc/apt/keyrings/docker.<span class="hljs-property">asc</span>
# <span class="hljs-title class_">Apt</span> 소스에 저장소 추가:
echo <span class="hljs-string">"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian $(. /etc/os-release &#x26;&#x26; echo "</span>$VERSION_CODENAME<span class="hljs-string">") stable"</span> | sudo tee /etc/apt/sources.<span class="hljs-property">list</span>.<span class="hljs-property">d</span>/docker.<span class="hljs-property">list</span> > <span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span>
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.<span class="hljs-property">io</span> docker-buildx-plugin docker-compose-plugin
sudo docker run hello-world
</code></pre>
<div class="content-ad"></div>
<h2>매니저 설정하기</h2>
<p>다음 단계에서는 tmux를 사용하는 것이 좋습니다.</p>
<p><img src="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_1.png" alt="이미지"></p>
<p>저는 호스트 머신을 위해 하나의 큰 수평 창을 사용했고, 워커들을 위해 두 개의 수직 창을 사용했어요.</p>
<div class="content-ad"></div>
<p>이 명령어 중 하나를 사용하여 IP를 확인해보세요.</p>
<pre><code class="hljs language-js">docker swarm init --advertise-addr &#x3C;매니저-<span class="hljs-variable constant_">IP</span>>
</code></pre>
<pre><code class="hljs language-js">docker swarm init --advertise-addr <span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.100</span>
스웜이 초기화되었습니다: 현재 노드 (dxn1zf6l61qsb1josjja83ngz)가 이제 매니저가 되었습니다.
</code></pre>
<pre><code class="hljs language-js">이 스웜에 워커를 추가하려면 다음 명령어를 실행하세요:
    docker swarm join \
    --token <span class="hljs-variable constant_">SWMTKN</span>-<span class="hljs-number">1</span>-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
    <span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.100</span>:<span class="hljs-number">2377</span>
매니저를 추가하려면 <span class="hljs-string">'docker swarm join-token manager'</span>를 실행하고 안내를 따르세요.
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_2.png" alt="이미지"></p>
<h2>워커들을 배포하세요.</h2>
<p>먼저 워커들을 위한 OS 이미지가 필요합니다:</p>
<pre><code class="hljs language-js">sudo docker pull alpine
</code></pre>
<div class="content-ad"></div>
<p>안녕하세요! 아치를 사용해보려고 했는데 아치64용 빌드가 없었어요.</p>
<p>(참고: 알파인 이미지는 종종 /bin/bash 대신에 /bin/sh를 사용합니다.)</p>
<p><img src="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_3.png" alt="이미지"></p>
<p>운영 체제 이미지를 받은 후에 워커들을 배포해야 해요. 여기서 두 가지 상황이 있어요. <code>sudo docker run alpine</code>으로 컨테이너를 만드는 경우 랜덤한 이름이 생성되므로, 이름을 얻으려면 <code>docker ps -a</code>를 사용하고, 그 후 새 이름으로 변경해야 해요.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">sudo docker rename helloworld<span class="hljs-number">.1</span>.6mwtenk3wdxik9kpposg6hd3j <span class="hljs-title class_">Worker1</span>
sudo docker start <span class="hljs-title class_">Worker1</span>
sudo docker exec -it <span class="hljs-title class_">Worker1</span> /bin/sh
</code></pre>
<p>두 번째 시나리오에서는 사용자 정의 이름으로 컨테이너를 직접 설정했습니다:</p>
<pre><code class="hljs language-js">sudo docker run -itd --name worker2 alpine /bin/sh
sudo docker exec -it worker2 /bin/sh
</code></pre>
<p>이 방법은 VM이나 클러스터를 사용하는 경우에 적합하지만, 제 경우에는 도커 내부에서 도커를 실행해야 합니다:</p>
<div class="content-ad"></div>
<h2>도커 인 디 도커 (DinD)를 사용하여 도커 스웜 시뮬레이션하기</h2>
<p>도커 스웜을 설정하려면 워커 노드는 도커 컨테이너가 아닌 물리적 또는 가상 머신이어야 합니다. 도커 스웜은 각 호스트 머신(물리 서버, VM 또는 클라우드 인스턴스)의 도커 데몬이 통신하여 스웜을 형성하는 방식으로 작동합니다. 컨테이너 자체는 도커 데몬을 실행하지 않으며 직접 스웜에 참여할 수 없습니다.</p>
<p>그러나 도커 스웜 환경을 도커 컨테이너를 사용하여 단일 호스트에서 시뮬레이션하려고 합니다. 따라서 도커 인 디 도커 (DinD)를 사용할 것입니다. 이는 도커 컨테이너 내부에서 도커를 실행하는 것을 의미합니다.</p>
<pre><code class="hljs language-js">#호스트 머신
sudo docker pull <span class="hljs-attr">docker</span>:<span class="hljs-number">19.03</span>-dind
docker swarm init --advertise-addr <span class="hljs-title class_">Your</span>_IP #만약 이전에 수행했다면 다시 수행할 필요가 없습니다

#워커 추가 토큰을 잊어버린 경우 다음을 사용하세요:
sudo docker swarm join-token worker

#워커<span class="hljs-number">1</span> 창:
sudo docker run -d --privileged --name worker1 <span class="hljs-attr">docker</span>:<span class="hljs-number">19.03</span>-dind
sudo docker exec -it worker1 /bin/sh
docker swarm join --token <span class="hljs-variable constant_">YOUR_TOKEN</span> <span class="hljs-variable constant_">YOUR_IP_PORT</span>

#워커<span class="hljs-number">2</span> 창:
sudo docker run -d --privileged --name worker2 <span class="hljs-attr">docker</span>:<span class="hljs-number">19.03</span>-dind
sudo docker exec -it worker2 /bin/sh
docker swarm join --token <span class="hljs-variable constant_">YOUR_TOKEN</span> <span class="hljs-variable constant_">YOUR_IP_PORT</span>
</code></pre>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_4.png">
<p>이제 중첩된 도커 컨테이너가 작동 중이지만 몇 번의 시도 끝에 각 워커에 작업을 제대로 배포할 수 없었습니다.</p>
<p>이것은 실험으로써 도커 명령어와 스왐 관리 방법을 배우는 흥미로운 방법이지만, 경험을 통해 굴러간 뒤에는, 하나의 라즈베리파이에 도커를 중첩하는 대신 세 개 이상의 라즈베리파이를 사용하는 것을 권장드립니다. 그러나 DinD는 다른 많은 작업에 유용할 수 있으며 하나의 싱글 보드 컴퓨터에서 도커를 사용하여 여러 개의 운영 체제를 실행할 수 있다는 것은 정말 놀라운 일이죠.</p>
<h1>참고사항:</h1>
<div class="content-ad"></div>
<p>아래는 Alpine 컨테이너에 neofetch를 설치하는 방법입니다. Alpine의 커뮤니티 저장소를 활성화해야 합니다.</p>
<pre><code class="hljs language-sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">"http://dl-cdn.alpinelinux.org/alpine/edge/community"</span> >> /etc/apk/repositories
apk update
apk add neofetch
</code></pre>
<p>기존 컨테이너를 중지하고 제거하는 방법은 다음과 같습니다.</p>
<pre><code class="hljs language-sh">sudo docker ps -a
sudo docker stop worker1 worker2
sudo docker <span class="hljs-built_in">rm</span> worker1 worker2
</code></pre>
<div class="content-ad"></div>
<p>가상 머신/머신에 작업자를 배포하는 방법 안내서</p>
<p><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/" rel="nofollow" target="_blank">https://docs.docker.com/engine/swarm/swarm-tutorial/</a></p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"라즈베리 파이에서 도커 스웜 도커 인 도커DinD로 스웜 시뮬레이션하기","description":"","date":"2024-06-20 17:31","slug":"2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD","content":"\n\n![이미지](/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png)\n\n이 프로젝트에서는 Raspberry Pi 4B 4Gb Raspberry Pi OS Lite 64비트 및 도커를 사용하여 놀고 있었어요. 가이드가 아닌 과정 보고서이니 먼저 전체 내용을 읽어보시는 걸 추천해요.\n\n## 1) Raspberry Pi OS Lite 64비트에 도커 설치하기\n\n## 2) 매니저 설정하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 3) 작업자를 배포하세요.\n\n## 4) Docker Swarm을 Docker-in-Docker (DinD)로 시뮬레이션하는 단계\n\n## 1) Raspberry Pi OS Lite 64비트에 Docker 설치하기\n\n```js\nsudo apt-get update \u0026\u0026 sudo apt-get upgrade -y\nfor pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done\n# 도커의 공식 GPG 키 추가:\nsudo apt-get update\nsudo apt-get install ca-certificates curl\nsudo install -m 0755 -d /etc/apt/keyrings\nsudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc\nsudo chmod a+r /etc/apt/keyrings/docker.asc\n# Apt 소스에 저장소 추가:\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian $(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\nsudo docker run hello-world\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 매니저 설정하기\n\n다음 단계에서는 tmux를 사용하는 것이 좋습니다.\n\n![이미지](/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_1.png)\n\n저는 호스트 머신을 위해 하나의 큰 수평 창을 사용했고, 워커들을 위해 두 개의 수직 창을 사용했어요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이 명령어 중 하나를 사용하여 IP를 확인해보세요.\n\n```js\ndocker swarm init --advertise-addr \u003c매니저-IP\u003e\n```\n\n```js\ndocker swarm init --advertise-addr 192.168.99.100\n스웜이 초기화되었습니다: 현재 노드 (dxn1zf6l61qsb1josjja83ngz)가 이제 매니저가 되었습니다.\n```\n\n```js\n이 스웜에 워커를 추가하려면 다음 명령어를 실행하세요:\n    docker swarm join \\\n    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \\\n    192.168.99.100:2377\n매니저를 추가하려면 'docker swarm join-token manager'를 실행하고 안내를 따르세요.\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![이미지](/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_2.png)\n\n## 워커들을 배포하세요.\n\n먼저 워커들을 위한 OS 이미지가 필요합니다:\n\n```js\nsudo docker pull alpine\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n안녕하세요! 아치를 사용해보려고 했는데 아치64용 빌드가 없었어요.\n\n(참고: 알파인 이미지는 종종 /bin/bash 대신에 /bin/sh를 사용합니다.)\n\n![이미지](/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_3.png)\n\n운영 체제 이미지를 받은 후에 워커들을 배포해야 해요. 여기서 두 가지 상황이 있어요. `sudo docker run alpine`으로 컨테이너를 만드는 경우 랜덤한 이름이 생성되므로, 이름을 얻으려면 `docker ps -a`를 사용하고, 그 후 새 이름으로 변경해야 해요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n```js\nsudo docker rename helloworld.1.6mwtenk3wdxik9kpposg6hd3j Worker1\nsudo docker start Worker1\nsudo docker exec -it Worker1 /bin/sh\n```\n\n두 번째 시나리오에서는 사용자 정의 이름으로 컨테이너를 직접 설정했습니다:\n\n```js\nsudo docker run -itd --name worker2 alpine /bin/sh\nsudo docker exec -it worker2 /bin/sh\n```\n\n이 방법은 VM이나 클러스터를 사용하는 경우에 적합하지만, 제 경우에는 도커 내부에서 도커를 실행해야 합니다:\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 도커 인 디 도커 (DinD)를 사용하여 도커 스웜 시뮬레이션하기\n\n도커 스웜을 설정하려면 워커 노드는 도커 컨테이너가 아닌 물리적 또는 가상 머신이어야 합니다. 도커 스웜은 각 호스트 머신(물리 서버, VM 또는 클라우드 인스턴스)의 도커 데몬이 통신하여 스웜을 형성하는 방식으로 작동합니다. 컨테이너 자체는 도커 데몬을 실행하지 않으며 직접 스웜에 참여할 수 없습니다.\n\n그러나 도커 스웜 환경을 도커 컨테이너를 사용하여 단일 호스트에서 시뮬레이션하려고 합니다. 따라서 도커 인 디 도커 (DinD)를 사용할 것입니다. 이는 도커 컨테이너 내부에서 도커를 실행하는 것을 의미합니다.\n\n```js\n#호스트 머신\nsudo docker pull docker:19.03-dind\ndocker swarm init --advertise-addr Your_IP #만약 이전에 수행했다면 다시 수행할 필요가 없습니다\n\n#워커 추가 토큰을 잊어버린 경우 다음을 사용하세요:\nsudo docker swarm join-token worker\n\n#워커1 창:\nsudo docker run -d --privileged --name worker1 docker:19.03-dind\nsudo docker exec -it worker1 /bin/sh\ndocker swarm join --token YOUR_TOKEN YOUR_IP_PORT\n\n#워커2 창:\nsudo docker run -d --privileged --name worker2 docker:19.03-dind\nsudo docker exec -it worker2 /bin/sh\ndocker swarm join --token YOUR_TOKEN YOUR_IP_PORT\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_4.png\" /\u003e\n\n이제 중첩된 도커 컨테이너가 작동 중이지만 몇 번의 시도 끝에 각 워커에 작업을 제대로 배포할 수 없었습니다.\n\n이것은 실험으로써 도커 명령어와 스왐 관리 방법을 배우는 흥미로운 방법이지만, 경험을 통해 굴러간 뒤에는, 하나의 라즈베리파이에 도커를 중첩하는 대신 세 개 이상의 라즈베리파이를 사용하는 것을 권장드립니다. 그러나 DinD는 다른 많은 작업에 유용할 수 있으며 하나의 싱글 보드 컴퓨터에서 도커를 사용하여 여러 개의 운영 체제를 실행할 수 있다는 것은 정말 놀라운 일이죠.\n\n# 참고사항:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래는 Alpine 컨테이너에 neofetch를 설치하는 방법입니다. Alpine의 커뮤니티 저장소를 활성화해야 합니다.\n\n```sh\necho \"http://dl-cdn.alpinelinux.org/alpine/edge/community\" \u003e\u003e /etc/apk/repositories\napk update\napk add neofetch\n```\n\n기존 컨테이너를 중지하고 제거하는 방법은 다음과 같습니다.\n\n```sh\nsudo docker ps -a\nsudo docker stop worker1 worker2\nsudo docker rm worker1 worker2\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n가상 머신/머신에 작업자를 배포하는 방법 안내서\n\nhttps://docs.docker.com/engine/swarm/swarm-tutorial/","ogImage":{"url":"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png"},"coverImage":"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png","tag":["Tech"],"readingTime":5},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e이 프로젝트에서는 Raspberry Pi 4B 4Gb Raspberry Pi OS Lite 64비트 및 도커를 사용하여 놀고 있었어요. 가이드가 아닌 과정 보고서이니 먼저 전체 내용을 읽어보시는 걸 추천해요.\u003c/p\u003e\n\u003ch2\u003e1) Raspberry Pi OS Lite 64비트에 도커 설치하기\u003c/h2\u003e\n\u003ch2\u003e2) 매니저 설정하기\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e3) 작업자를 배포하세요.\u003c/h2\u003e\n\u003ch2\u003e4) Docker Swarm을 Docker-in-Docker (DinD)로 시뮬레이션하는 단계\u003c/h2\u003e\n\u003ch2\u003e1) Raspberry Pi OS Lite 64비트에 Docker 설치하기\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esudo apt-get update \u0026#x26;\u0026#x26; sudo apt-get upgrade -y\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e pkg \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e docker.\u003cspan class=\"hljs-property\"\u003eio\u003c/span\u003e docker-doc docker-compose podman-docker containerd runc; \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e sudo apt-get remove $pkg; done\n# 도커의 공식 \u003cspan class=\"hljs-variable constant_\"\u003eGPG\u003c/span\u003e 키 추가:\nsudo apt-get update\nsudo apt-get install ca-certificates curl\nsudo install -m \u003cspan class=\"hljs-number\"\u003e0755\u003c/span\u003e -d /etc/apt/keyrings\nsudo curl -fsSL \u003cspan class=\"hljs-attr\"\u003ehttps\u003c/span\u003e:\u003cspan class=\"hljs-comment\"\u003e//download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc\u003c/span\u003e\nsudo chmod a+r /etc/apt/keyrings/docker.\u003cspan class=\"hljs-property\"\u003easc\u003c/span\u003e\n# \u003cspan class=\"hljs-title class_\"\u003eApt\u003c/span\u003e 소스에 저장소 추가:\necho \u003cspan class=\"hljs-string\"\u003e\"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian $(. /etc/os-release \u0026#x26;\u0026#x26; echo \"\u003c/span\u003e$VERSION_CODENAME\u003cspan class=\"hljs-string\"\u003e\") stable\"\u003c/span\u003e | sudo tee /etc/apt/sources.\u003cspan class=\"hljs-property\"\u003elist\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ed\u003c/span\u003e/docker.\u003cspan class=\"hljs-property\"\u003elist\u003c/span\u003e \u003e \u003cspan class=\"hljs-regexp\"\u003e/dev/\u003c/span\u003e\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.\u003cspan class=\"hljs-property\"\u003eio\u003c/span\u003e docker-buildx-plugin docker-compose-plugin\nsudo docker run hello-world\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e매니저 설정하기\u003c/h2\u003e\n\u003cp\u003e다음 단계에서는 tmux를 사용하는 것이 좋습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e저는 호스트 머신을 위해 하나의 큰 수평 창을 사용했고, 워커들을 위해 두 개의 수직 창을 사용했어요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이 명령어 중 하나를 사용하여 IP를 확인해보세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker swarm init --advertise-addr \u0026#x3C;매니저-\u003cspan class=\"hljs-variable constant_\"\u003eIP\u003c/span\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker swarm init --advertise-addr \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.99\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.100\u003c/span\u003e\n스웜이 초기화되었습니다: 현재 노드 (dxn1zf6l61qsb1josjja83ngz)가 이제 매니저가 되었습니다.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e이 스웜에 워커를 추가하려면 다음 명령어를 실행하세요:\n    docker swarm join \\\n    --token \u003cspan class=\"hljs-variable constant_\"\u003eSWMTKN\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \\\n    \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.99\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.100\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e2377\u003c/span\u003e\n매니저를 추가하려면 \u003cspan class=\"hljs-string\"\u003e'docker swarm join-token manager'\u003c/span\u003e를 실행하고 안내를 따르세요.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_2.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e워커들을 배포하세요.\u003c/h2\u003e\n\u003cp\u003e먼저 워커들을 위한 OS 이미지가 필요합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esudo docker pull alpine\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e안녕하세요! 아치를 사용해보려고 했는데 아치64용 빌드가 없었어요.\u003c/p\u003e\n\u003cp\u003e(참고: 알파인 이미지는 종종 /bin/bash 대신에 /bin/sh를 사용합니다.)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_3.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e운영 체제 이미지를 받은 후에 워커들을 배포해야 해요. 여기서 두 가지 상황이 있어요. \u003ccode\u003esudo docker run alpine\u003c/code\u003e으로 컨테이너를 만드는 경우 랜덤한 이름이 생성되므로, 이름을 얻으려면 \u003ccode\u003edocker ps -a\u003c/code\u003e를 사용하고, 그 후 새 이름으로 변경해야 해요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esudo docker rename helloworld\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e.6mwtenk3wdxik9kpposg6hd3j \u003cspan class=\"hljs-title class_\"\u003eWorker1\u003c/span\u003e\nsudo docker start \u003cspan class=\"hljs-title class_\"\u003eWorker1\u003c/span\u003e\nsudo docker exec -it \u003cspan class=\"hljs-title class_\"\u003eWorker1\u003c/span\u003e /bin/sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e두 번째 시나리오에서는 사용자 정의 이름으로 컨테이너를 직접 설정했습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003esudo docker run -itd --name worker2 alpine /bin/sh\nsudo docker exec -it worker2 /bin/sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 방법은 VM이나 클러스터를 사용하는 경우에 적합하지만, 제 경우에는 도커 내부에서 도커를 실행해야 합니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e도커 인 디 도커 (DinD)를 사용하여 도커 스웜 시뮬레이션하기\u003c/h2\u003e\n\u003cp\u003e도커 스웜을 설정하려면 워커 노드는 도커 컨테이너가 아닌 물리적 또는 가상 머신이어야 합니다. 도커 스웜은 각 호스트 머신(물리 서버, VM 또는 클라우드 인스턴스)의 도커 데몬이 통신하여 스웜을 형성하는 방식으로 작동합니다. 컨테이너 자체는 도커 데몬을 실행하지 않으며 직접 스웜에 참여할 수 없습니다.\u003c/p\u003e\n\u003cp\u003e그러나 도커 스웜 환경을 도커 컨테이너를 사용하여 단일 호스트에서 시뮬레이션하려고 합니다. 따라서 도커 인 디 도커 (DinD)를 사용할 것입니다. 이는 도커 컨테이너 내부에서 도커를 실행하는 것을 의미합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e#호스트 머신\nsudo docker pull \u003cspan class=\"hljs-attr\"\u003edocker\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e19.03\u003c/span\u003e-dind\ndocker swarm init --advertise-addr \u003cspan class=\"hljs-title class_\"\u003eYour\u003c/span\u003e_IP #만약 이전에 수행했다면 다시 수행할 필요가 없습니다\n\n#워커 추가 토큰을 잊어버린 경우 다음을 사용하세요:\nsudo docker swarm join-token worker\n\n#워커\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e 창:\nsudo docker run -d --privileged --name worker1 \u003cspan class=\"hljs-attr\"\u003edocker\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e19.03\u003c/span\u003e-dind\nsudo docker exec -it worker1 /bin/sh\ndocker swarm join --token \u003cspan class=\"hljs-variable constant_\"\u003eYOUR_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eYOUR_IP_PORT\u003c/span\u003e\n\n#워커\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e 창:\nsudo docker run -d --privileged --name worker2 \u003cspan class=\"hljs-attr\"\u003edocker\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e19.03\u003c/span\u003e-dind\nsudo docker exec -it worker2 /bin/sh\ndocker swarm join --token \u003cspan class=\"hljs-variable constant_\"\u003eYOUR_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eYOUR_IP_PORT\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD_4.png\"\u003e\n\u003cp\u003e이제 중첩된 도커 컨테이너가 작동 중이지만 몇 번의 시도 끝에 각 워커에 작업을 제대로 배포할 수 없었습니다.\u003c/p\u003e\n\u003cp\u003e이것은 실험으로써 도커 명령어와 스왐 관리 방법을 배우는 흥미로운 방법이지만, 경험을 통해 굴러간 뒤에는, 하나의 라즈베리파이에 도커를 중첩하는 대신 세 개 이상의 라즈베리파이를 사용하는 것을 권장드립니다. 그러나 DinD는 다른 많은 작업에 유용할 수 있으며 하나의 싱글 보드 컴퓨터에서 도커를 사용하여 여러 개의 운영 체제를 실행할 수 있다는 것은 정말 놀라운 일이죠.\u003c/p\u003e\n\u003ch1\u003e참고사항:\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e아래는 Alpine 컨테이너에 neofetch를 설치하는 방법입니다. Alpine의 커뮤니티 저장소를 활성화해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-sh\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"http://dl-cdn.alpinelinux.org/alpine/edge/community\"\u003c/span\u003e \u003e\u003e /etc/apk/repositories\napk update\napk add neofetch\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e기존 컨테이너를 중지하고 제거하는 방법은 다음과 같습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-sh\"\u003esudo docker ps -a\nsudo docker stop worker1 worker2\nsudo docker \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e worker1 worker2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e가상 머신/머신에 작업자를 배포하는 방법 안내서\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.docker.com/engine/swarm/swarm-tutorial/\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://docs.docker.com/engine/swarm/swarm-tutorial/\u003c/a\u003e\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-DockerSwarminaRaspberryPiSimulatingaSwarmwithDocker-in-DockerDinD"},"buildId":"CYQjEY3HhSkRTiL0gewc0","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>