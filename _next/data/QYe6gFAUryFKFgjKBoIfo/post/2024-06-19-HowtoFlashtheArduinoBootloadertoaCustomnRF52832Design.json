{"pageProps":{"post":{"title":"커스텀 nRF52832 디자인에 아두이노 부트로더를 플래싱하는 방법","description":"","date":"2024-06-19 17:49","slug":"2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design","content":"\n\n\n![이미지](/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_0.png)\n\n내가 사용 중인 사용자 정의 nRF52832 보드 디자인 작업 중이었고, 장치에 데모 소프트웨어를 프로그래밍하고 싶었습니다. 제품 보드는 Zephyr RTOS를 실행하지만 Arduino로 빠르고 더러운 프로토타입 환경을 원했습니다.\n\n부트로더를 프로그래밍하려면 어떤 종류의 J-Link 프로그래머가 필요합니다. nRF52832 개발 키트, J-Link EDU Mini (취미 프로젝트용) 또는 완전한 J-Link 프로그래머(상용 프로젝트용)를 사용할 수 있습니다.\n\n부트로더를 설치한 후 이와 같은 UART에서 USB 변환기가 필요합니다. 이것은 부트로더가 설치된 후 Arduino IDE에서 nRF52832를 플래싱하는 데 사용될 것입니다.\n\n\n<div class=\"content-ad\"></div>\n\nBLE 모듈을 사용하여 몇 가지 예시 연결을 이 가이드에서 사용할 예정이지만, 이 단계들을 여러분의 디자인에 맞게 조정할 수 있어요.\n\n이제부터는 여러분의 디자인이 UART RX와 UART TX 핀으로 P0.30 및 P0.31 핀을 노출한다고 가정해보도록 합시다:\n\n![image](/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_1.png)\n\n# 부트로더 구성하기\n\n<div class=\"content-ad\"></div>\n\nAdafruit_nRF52_Bootloader 저장소를 컴퓨터로 복제해야 합니다. 저장소의 src ` boards 디렉터리에서 부트로더가 지원하는 보드 목록을 확인할 수 있습니다.\n\n우리의 최종 목표와 가장 일치하는 feather_nrf52832의 부트로더 구성을 수정할 것입니다.\n\nsrc ` boards ` feather_nrf52832 ` board.h로 이동하세요. LED, BUTTON 및 UART에 대한 다른 섹션을 확인할 수 있습니다. 이러한 섹션을 PCB 디자인과 일치하도록 업데이트해야 합니다.\n\nUART 구성부터 시작하여 핀을 디자인에 맞게 업데이트하세요. 저희 경우에는 P0.31 = TX 및 P0.30 = RX입니다. 하드웨어 흐름 제어를 사용하지 않기 때문에 CTS 및 RTS 핀 정의를 무시할 수 있습니다.\n\n<div class=\"content-ad\"></div>\n\n변환기의 RX는 마이크로컨트롤러의 TX에 연결되어야 하며, 변환기의 TX는 마이크로컨트롤러의 RX에 연결되어야 합니다.\n\n```js\n/*------------------------------------------------------------------*/\n/* UART (nRF52832에서만 사용)\n *------------------------------------------------------------------*/\n#define RX_PIN_NUMBER      30\n#define TX_PIN_NUMBER      31\n#define CTS_PIN_NUMBER     0\n#define RTS_PIN_NUMBER     0\n#define HWFC               false\n```\n\n다음으로 LED 섹션을 살펴볼 수 있습니다. 이 부분은 내장 표시 LED가 있는 디자인에만 해당됩니다. 여기에서 지정한 LED는 장치가 부트로더 모드에 있고 Arduino IDE로 플래시될 준비가 되었음을 나타냅니다. 제 디자인에는 내장 LED가 없기 때문에 LED_PRIMARY_PIN을 임의의 GPIO 핀에 할당하고 있습니다.\n\n```js\n/*------------------------------------------------------------------*/\n/* LED\n *------------------------------------------------------------------*/\n#define LEDS_NUMBER        1\n#define LED_PRIMARY_PIN    17\n#define LED_STATE_ON       1\n```\n\n<div class=\"content-ad\"></div>\n\n마지막으로, 버튼 섹션을 살펴봅시다.\n\nBUTTON_1은 DFU 버튼으로 사용됩니다. 전원 사이클이나 리셋 중에 이 버튼을 누르면 nRF52가 부트로더 모드로 강제 전환됩니다. BUTTON_2는 FRST 버튼으로 사용됩니다. 이 버튼을 누르면 리셋 중에 이전에 로드된 Arduino 코드를 지우는 공장 초기화가 수행됩니다.\n\nDFU와 FRST 버튼에 대해 더 자세히 알아보세요.\n\n내 디자인에는 버튼을 사용하지 않을 것입니다. 대신 부트로더 모드에서 일시 중지한 후 일정 기간 후에 Arduino 코드를 로드하게 될 것입니다. 이에 대해 더 자세히 이야기하겠습니다.\n\n<div class=\"content-ad\"></div>\n\n한번 더 랜덤 핀을 2개 버튼 섹션에 할당하겠습니다.\n\n그러나 이 핀들이 시작할 때 GND에 연결돼 있다면(액티브 로우), 부트로더를 종료하는데 문제가 발생할 수 있습니다. 버튼이 눌린 것으로 인식되어 부트로더를 종료시키는 문제가 발생할 수 있습니다.\n\n만약 2개의 버튼을 정의하지 않으면, 빌드 오류가 발생할 수 있습니다.\n\n```js\n/*------------------------------------------------------------------*/\n/* BUTTON\n *------------------------------------------------------------------*/\n#define BUTTONS_NUMBER     2\n#define BUTTON_1           23\n#define BUTTON_2           24\n#define BUTTON_PULL        NRF_GPIO_PIN_PULLUP\n```\n\n<div class=\"content-ad\"></div>\n\n버튼을 사용하지 않는 디자인을 사용하고 있기 때문에 부트로더 기간을 수정하여 코드 업로드를 쉽게 만들기로 결정했습니다. 기본적으로 부트로더는 리셋 후 1초 동안 일시 정지하여 Arduino IDE에서 오는 새 코드를 기다립니다.\n\n저는 새 코드를 업로드하기 위해 리셋 타이밍을 조정하기 쉽도록 이 기다리는 기간을 연장하기로 결정했습니다. 이것은 엄격히 선택 사항입니다만, DFU 버튼 없이 진행하는 경우 권장됩니다.\n\n이 지연 시간은 src ` main.c 안의 DFU_SERIAL_STARTUP_INTERVAL을 수정하여 늘릴 수 있습니다.\n\n```js\n#define DFU_SERIAL_STARTUP_INTERVAL     20000 // ms\n```\n\n<div class=\"content-ad\"></div>\n\n위에서 볼 수 있듯이, 내 사용자 정의 부트로더는 리셋 후 20초 동안 새로운 아두이노 코드를 기다린 후 아두이노 스케치를로드합니다.\n\n# 당신의 nRF52 디자인을 위한 아두이노 부트로더 빌드\n\n먼저, 컴퓨터에 ARM GCC 툴체인이 설치되어 있는지 확인하세요.\n\n최신 릴리스를 선택하고 운영 체제에 필요한 설치 프로그램을 다운로드하세요. 나중에 문제가 발생하면 설치 경로를 메모해두세요. 또한 프롬프트가 나타나면 \"PATH에 추가\"를 선택하세요.\n\n<div class=\"content-ad\"></div>\n\n로컬 Adafruit UF2 부트로더 사본 내에서 새 터미널 창을 열어주세요.\n\n다음 명령을 실행하여 서브모듈을 초기화하세요:\n\n```js\ngit submodule update --init\n```\n\n그 다음에는 다음을 실행하여 가상 파이썬 환경을 생성하고 활성화하세요:\n\n<div class=\"content-ad\"></div>\n\n```js\npython3 -m venv myenv\nsource myenv/bin/activate\n```\n\n빌드 시스템에 필요한 파이썬 종속성을 설치하세요:\n\n```js\npip3 install intelhex\npip3 install adafruit-nrfutil\n```\n\n이제 부트로더를 빌드하기 위해 make 명령어를 실행하세요:\n\n<div class=\"content-ad\"></div>\n\n```js\nBOARD=feather_nrf52832을 사용하여 make all 명령어를 실행하세요.\n\n이 명령어에 의해 생성되는 새로운 _build 폴더에 주목하세요. 부트로더 구성을 변경할 때마다 이 폴더를 삭제하는 것이 좋습니다. 이렇게 하면 모든 것이 다시 빌드되는지 확인할 수 있습니다.\n\nJLINK 프로그래머에서 다음 핀을 nRF52832 모듈로 연결하세요:\n\n- SWDIO\n- SWCLK\n- 3V3\n- GND\n```\n\n<div class=\"content-ad\"></div>\n\n다음으로 플래시 명령을 실행하세요:\n\n```js\nmake flash\n```\n\n이제 Arduino IDE 및 UART to Serial 컨버터로 보드를 프로그래밍할 수 있어야 합니다! nRF52832 Feather 보드 옵션 및 UART to Serial 컨버터를 포트 옵션으로 선택해야합니다.\n\n(여기에 설명된 대로 nRF52 보드 지원 패키지가 설치되어 있는지 확인하세요)\n\n<div class=\"content-ad\"></div>\n\n만약 DFU 버튼이 있으면: 그 버튼을 누른 채로 모듈을 재설정(또는 전원 주기)한 다음, DFU 버튼을 놓아서 부트로더 모드로 진입하십시오.\n\n그렇지 않은 경우, DFU_SERIAL_STARTUP_INTERVAL을 의존한다면, Arduino IDE가 스케치를 업로드하기 전에 보드를 재설정해야 합니다.\n\n한 가지 유의할 점: 사용자 지정 보드에서 시리얼 출력을 얻으려면 Serial.begin 호출 전에 UART 핀을 설정해야 할 수 있습니다. 이 예시에서는 다음과 같이 보일 것입니다:\n\n```js\nSerial.setPins(30, 31);\nSerial.begin(115200);\n```","ogImage":{"url":"/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_0.png"},"coverImage":"/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_0.png","tag":["Tech"],"readingTime":5},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_0.png\" alt=\"이미지\"></p>\n<p>내가 사용 중인 사용자 정의 nRF52832 보드 디자인 작업 중이었고, 장치에 데모 소프트웨어를 프로그래밍하고 싶었습니다. 제품 보드는 Zephyr RTOS를 실행하지만 Arduino로 빠르고 더러운 프로토타입 환경을 원했습니다.</p>\n<p>부트로더를 프로그래밍하려면 어떤 종류의 J-Link 프로그래머가 필요합니다. nRF52832 개발 키트, J-Link EDU Mini (취미 프로젝트용) 또는 완전한 J-Link 프로그래머(상용 프로젝트용)를 사용할 수 있습니다.</p>\n<p>부트로더를 설치한 후 이와 같은 UART에서 USB 변환기가 필요합니다. 이것은 부트로더가 설치된 후 Arduino IDE에서 nRF52832를 플래싱하는 데 사용될 것입니다.</p>\n<div class=\"content-ad\"></div>\n<p>BLE 모듈을 사용하여 몇 가지 예시 연결을 이 가이드에서 사용할 예정이지만, 이 단계들을 여러분의 디자인에 맞게 조정할 수 있어요.</p>\n<p>이제부터는 여러분의 디자인이 UART RX와 UART TX 핀으로 P0.30 및 P0.31 핀을 노출한다고 가정해보도록 합시다:</p>\n<p><img src=\"/assets/img/2024-06-19-HowtoFlashtheArduinoBootloadertoaCustomnRF52832Design_1.png\" alt=\"image\"></p>\n<h1>부트로더 구성하기</h1>\n<div class=\"content-ad\"></div>\n<p>Adafruit_nRF52_Bootloader 저장소를 컴퓨터로 복제해야 합니다. 저장소의 src ` boards 디렉터리에서 부트로더가 지원하는 보드 목록을 확인할 수 있습니다.</p>\n<p>우리의 최종 목표와 가장 일치하는 feather_nrf52832의 부트로더 구성을 수정할 것입니다.</p>\n<p>src <code>boards</code> feather_nrf52832 ` board.h로 이동하세요. LED, BUTTON 및 UART에 대한 다른 섹션을 확인할 수 있습니다. 이러한 섹션을 PCB 디자인과 일치하도록 업데이트해야 합니다.</p>\n<p>UART 구성부터 시작하여 핀을 디자인에 맞게 업데이트하세요. 저희 경우에는 P0.31 = TX 및 P0.30 = RX입니다. 하드웨어 흐름 제어를 사용하지 않기 때문에 CTS 및 RTS 핀 정의를 무시할 수 있습니다.</p>\n<div class=\"content-ad\"></div>\n<p>변환기의 RX는 마이크로컨트롤러의 TX에 연결되어야 하며, 변환기의 TX는 마이크로컨트롤러의 RX에 연결되어야 합니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">/*------------------------------------------------------------------*/</span>\n<span class=\"hljs-comment\">/* UART (nRF52832에서만 사용)\n *------------------------------------------------------------------*/</span>\n#define <span class=\"hljs-variable constant_\">RX_PIN_NUMBER</span>      <span class=\"hljs-number\">30</span>\n#define <span class=\"hljs-variable constant_\">TX_PIN_NUMBER</span>      <span class=\"hljs-number\">31</span>\n#define <span class=\"hljs-variable constant_\">CTS_PIN_NUMBER</span>     <span class=\"hljs-number\">0</span>\n#define <span class=\"hljs-variable constant_\">RTS_PIN_NUMBER</span>     <span class=\"hljs-number\">0</span>\n#define <span class=\"hljs-variable constant_\">HWFC</span>               <span class=\"hljs-literal\">false</span>\n</code></pre>\n<p>다음으로 LED 섹션을 살펴볼 수 있습니다. 이 부분은 내장 표시 LED가 있는 디자인에만 해당됩니다. 여기에서 지정한 LED는 장치가 부트로더 모드에 있고 Arduino IDE로 플래시될 준비가 되었음을 나타냅니다. 제 디자인에는 내장 LED가 없기 때문에 LED_PRIMARY_PIN을 임의의 GPIO 핀에 할당하고 있습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">/*------------------------------------------------------------------*/</span>\n<span class=\"hljs-comment\">/* LED\n *------------------------------------------------------------------*/</span>\n#define <span class=\"hljs-variable constant_\">LEDS_NUMBER</span>        <span class=\"hljs-number\">1</span>\n#define <span class=\"hljs-variable constant_\">LED_PRIMARY_PIN</span>    <span class=\"hljs-number\">17</span>\n#define <span class=\"hljs-variable constant_\">LED_STATE_ON</span>       <span class=\"hljs-number\">1</span>\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>마지막으로, 버튼 섹션을 살펴봅시다.</p>\n<p>BUTTON_1은 DFU 버튼으로 사용됩니다. 전원 사이클이나 리셋 중에 이 버튼을 누르면 nRF52가 부트로더 모드로 강제 전환됩니다. BUTTON_2는 FRST 버튼으로 사용됩니다. 이 버튼을 누르면 리셋 중에 이전에 로드된 Arduino 코드를 지우는 공장 초기화가 수행됩니다.</p>\n<p>DFU와 FRST 버튼에 대해 더 자세히 알아보세요.</p>\n<p>내 디자인에는 버튼을 사용하지 않을 것입니다. 대신 부트로더 모드에서 일시 중지한 후 일정 기간 후에 Arduino 코드를 로드하게 될 것입니다. 이에 대해 더 자세히 이야기하겠습니다.</p>\n<div class=\"content-ad\"></div>\n<p>한번 더 랜덤 핀을 2개 버튼 섹션에 할당하겠습니다.</p>\n<p>그러나 이 핀들이 시작할 때 GND에 연결돼 있다면(액티브 로우), 부트로더를 종료하는데 문제가 발생할 수 있습니다. 버튼이 눌린 것으로 인식되어 부트로더를 종료시키는 문제가 발생할 수 있습니다.</p>\n<p>만약 2개의 버튼을 정의하지 않으면, 빌드 오류가 발생할 수 있습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">/*------------------------------------------------------------------*/</span>\n<span class=\"hljs-comment\">/* BUTTON\n *------------------------------------------------------------------*/</span>\n#define <span class=\"hljs-variable constant_\">BUTTONS_NUMBER</span>     <span class=\"hljs-number\">2</span>\n#define <span class=\"hljs-variable constant_\">BUTTON_1</span>           <span class=\"hljs-number\">23</span>\n#define <span class=\"hljs-variable constant_\">BUTTON_2</span>           <span class=\"hljs-number\">24</span>\n#define <span class=\"hljs-variable constant_\">BUTTON_PULL</span>        <span class=\"hljs-variable constant_\">NRF_GPIO_PIN_PULLUP</span>\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>버튼을 사용하지 않는 디자인을 사용하고 있기 때문에 부트로더 기간을 수정하여 코드 업로드를 쉽게 만들기로 결정했습니다. 기본적으로 부트로더는 리셋 후 1초 동안 일시 정지하여 Arduino IDE에서 오는 새 코드를 기다립니다.</p>\n<p>저는 새 코드를 업로드하기 위해 리셋 타이밍을 조정하기 쉽도록 이 기다리는 기간을 연장하기로 결정했습니다. 이것은 엄격히 선택 사항입니다만, DFU 버튼 없이 진행하는 경우 권장됩니다.</p>\n<p>이 지연 시간은 src ` main.c 안의 DFU_SERIAL_STARTUP_INTERVAL을 수정하여 늘릴 수 있습니다.</p>\n<pre><code class=\"hljs language-js\">#define <span class=\"hljs-variable constant_\">DFU_SERIAL_STARTUP_INTERVAL</span>     <span class=\"hljs-number\">20000</span> <span class=\"hljs-comment\">// ms</span>\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>위에서 볼 수 있듯이, 내 사용자 정의 부트로더는 리셋 후 20초 동안 새로운 아두이노 코드를 기다린 후 아두이노 스케치를로드합니다.</p>\n<h1>당신의 nRF52 디자인을 위한 아두이노 부트로더 빌드</h1>\n<p>먼저, 컴퓨터에 ARM GCC 툴체인이 설치되어 있는지 확인하세요.</p>\n<p>최신 릴리스를 선택하고 운영 체제에 필요한 설치 프로그램을 다운로드하세요. 나중에 문제가 발생하면 설치 경로를 메모해두세요. 또한 프롬프트가 나타나면 \"PATH에 추가\"를 선택하세요.</p>\n<div class=\"content-ad\"></div>\n<p>로컬 Adafruit UF2 부트로더 사본 내에서 새 터미널 창을 열어주세요.</p>\n<p>다음 명령을 실행하여 서브모듈을 초기화하세요:</p>\n<pre><code class=\"hljs language-js\">git submodule update --init\n</code></pre>\n<p>그 다음에는 다음을 실행하여 가상 파이썬 환경을 생성하고 활성화하세요:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\">python3 -m venv myenv\nsource myenv/bin/activate\n</code></pre>\n<p>빌드 시스템에 필요한 파이썬 종속성을 설치하세요:</p>\n<pre><code class=\"hljs language-js\">pip3 install intelhex\npip3 install adafruit-nrfutil\n</code></pre>\n<p>이제 부트로더를 빌드하기 위해 make 명령어를 실행하세요:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable constant_\">BOARD</span>=feather_nrf52832을 사용하여 make all 명령어를 실행하세요.\n\n이 명령어에 의해 생성되는 새로운 _build 폴더에 주목하세요. 부트로더 구성을 변경할 때마다 이 폴더를 삭제하는 것이 좋습니다. 이렇게 하면 모든 것이 다시 빌드되는지 확인할 수 있습니다.\n\n<span class=\"hljs-variable constant_\">JLINK</span> 프로그래머에서 다음 핀을 nRF52832 모듈로 연결하세요:\n\n- <span class=\"hljs-variable constant_\">SWDIO</span>\n- <span class=\"hljs-variable constant_\">SWCLK</span>\n- 3V3\n- <span class=\"hljs-variable constant_\">GND</span>\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>다음으로 플래시 명령을 실행하세요:</p>\n<pre><code class=\"hljs language-js\">make flash\n</code></pre>\n<p>이제 Arduino IDE 및 UART to Serial 컨버터로 보드를 프로그래밍할 수 있어야 합니다! nRF52832 Feather 보드 옵션 및 UART to Serial 컨버터를 포트 옵션으로 선택해야합니다.</p>\n<p>(여기에 설명된 대로 nRF52 보드 지원 패키지가 설치되어 있는지 확인하세요)</p>\n<div class=\"content-ad\"></div>\n<p>만약 DFU 버튼이 있으면: 그 버튼을 누른 채로 모듈을 재설정(또는 전원 주기)한 다음, DFU 버튼을 놓아서 부트로더 모드로 진입하십시오.</p>\n<p>그렇지 않은 경우, DFU_SERIAL_STARTUP_INTERVAL을 의존한다면, Arduino IDE가 스케치를 업로드하기 전에 보드를 재설정해야 합니다.</p>\n<p>한 가지 유의할 점: 사용자 지정 보드에서 시리얼 출력을 얻으려면 Serial.begin 호출 전에 UART 핀을 설정해야 할 수 있습니다. 이 예시에서는 다음과 같이 보일 것입니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title class_\">Serial</span>.<span class=\"hljs-title function_\">setPins</span>(<span class=\"hljs-number\">30</span>, <span class=\"hljs-number\">31</span>);\n<span class=\"hljs-title class_\">Serial</span>.<span class=\"hljs-title function_\">begin</span>(<span class=\"hljs-number\">115200</span>);\n</code></pre>\n</body>\n</html>\n"},"__N_SSG":true}