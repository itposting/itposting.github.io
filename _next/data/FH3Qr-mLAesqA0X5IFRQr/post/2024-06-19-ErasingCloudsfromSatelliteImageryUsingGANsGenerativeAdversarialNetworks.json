{"pageProps":{"post":{"title":"ìœ„ì„± ì´ë¯¸ì§€ì—ì„œ GANsì ëŒ€ì  ìƒì„± ì‹ ê²½ë§ì„ ì‚¬ìš©í•˜ì—¬ êµ¬ë¦„ ì œê±°í•˜ê¸°","description":"","date":"2024-06-19 18:49","slug":"2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks","content":"\n\n## íŒŒì´ì¬ìœ¼ë¡œë¶€í„° GAN(Generative Adversarial Networks) ë§Œë“¤ì–´ ë³´ê¸°\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_0.png)\n\nGAN(Generative Adversarial Networks)ì´ë¼ëŠ” ì•„ì´ë””ì–´ëŠ” 2014ë…„ Goodfellowì™€ ê·¸ ë™ë£Œë“¤ì— ì˜í•´ ì†Œê°œë˜ì—ˆê³ , ê³§ ê·¸ ì´í›„ì— ì»´í“¨í„° ë¹„ì „ ë° ì´ë¯¸ì§€ ìƒì„± ë¶„ì•¼ì—ì„œ ê·¹ë„ë¡œ ì¸ê¸°ë¥¼ ëŒê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œì˜ ê¸‰ì†í•œ ë°œì „ê³¼ ìƒˆë¡œìš´ ì•Œê³ ë¦¬ì¦˜ì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ë”ë¼ë„, ì´ ê°œë…ì˜ ë‹¨ìˆœí•¨ê³¼ ì°½ì˜ì„±ì€ ì—¬ì „íˆ ë§¤ìš° ì¸ìƒì ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ ì´ëŸ¬í•œ ë„¤íŠ¸ì›Œí¬ê°€ ì–¼ë§ˆë‚˜ ê°•ë ¥í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ìœ„ì„± RGB(ë¹¨ê°•, ë…¹ìƒ‰, íŒŒë‘) ì´ë¯¸ì§€ì—ì„œ êµ¬ë¦„ì„ ì œê±°í•˜ëŠ” ì‹œë„ë¥¼ í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.\n\nì ì ˆíˆ ê· í˜• ì¡íˆê³  ì¶©ë¶„íˆ í¬ë©° ì˜¬ë°”ë¥´ê²Œ ì „ì²˜ë¦¬ëœ ì»´í“¨í„° ë¹„ì „ ë°ì´í„°ì…‹ì„ ì¤€ë¹„í•˜ëŠ” ë°ì—ëŠ” ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ë¯€ë¡œ, ì €ëŠ” Kaggleì— ì–´ë–¤ ê²ƒì´ ìˆëŠ”ì§€ ì‚´í´ë³´ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì— ê°€ì¥ ì í•©í•˜ë‹¤ê³  ìƒê°í•œ ë°ì´í„°ì…‹ì€ EuroSatì´ë©°, ì´ëŠ” ì˜¤í”ˆ ë¼ì´ì„ ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ë°ì´í„°ì…‹ì€ Sentinel-2ì—ì„œ 64x64 í”½ì…€ì˜ 27000ê°œì˜ ë ˆì´ë¸”ì´ ì§€ì •ëœ RGB ì´ë¯¸ì§€ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , ë‹¤ì¤‘ í´ë˜ìŠ¤ ë¶„ë¥˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_1.png)\n\nìš°ë¦¬ëŠ” ë¶„ë¥˜ ìì²´ì— í¥ë¯¸ê°€ ì—†ì§€ë§Œ EuroSat ë°ì´í„°ì…‹ì˜ ì£¼ìš” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” ëª¨ë“  ì´ë¯¸ì§€ì— ë§‘ì€ í•˜ëŠ˜ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ê²ƒì´ ì •í™•íˆ ìš°ë¦¬ê°€ í•„ìš”í•œ ê²ƒì…ë‹ˆë‹¤. [3]ì—ì„œ ì´ ì ‘ê·¼ë²•ì„ ì±„íƒí•˜ì—¬, ìš°ë¦¬ëŠ” ì´ Sentinel-2 ìƒ·ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì…ë ¥ì„ ì¶”ê°€í•˜ì—¬ (êµ¬ë¦„) ë…¸ì´ì¦ˆë¥¼ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.\n\nê·¸ë˜ì„œ ìš°ë¦¬ê°€ GANsì— ëŒ€í•´ ì‹¤ì œë¡œ ì´ì•¼ê¸°í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ì¤€ë¹„í•´ ë´…ì‹œë‹¤. ìš°ì„ , ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ëª¨ë“  í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ì˜ ë””ë ‰í† ë¦¬ë¡œ ë³‘í•©í•´ì•¼ í•©ë‹ˆë‹¤.\n\nğŸì „ì²´ Python ì½”ë“œ: GitHub.\n\n\n<div class=\"content-ad\"></div>\n\n```js\nimport numpy as np\nimport pandas as pd\nimport random\n\nfrom os import listdir, mkdir, rename\nfrom os.path import join, exists\nimport shutil\nimport datetime\n\nimport matplotlib.pyplot as plt\nfrom highlight_text import ax_text, fig_text\nfrom PIL import Image\n\nimport warnings\n\nwarnings.filterwarnings('ignore')\n```\n\n```js\nclasses = listdir('./EuroSat')\npath_target = './EuroSat/all_targets'\npath_input = './EuroSat/all_inputs'\n\n\"\"\"UNPACKí•œ ì•„ì¹´ì´ë¸Œ íŒŒì¼ì˜ íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ ë‹¨ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ì„¸ìš”\"\"\"\nmkdir(path_input)\nmkdir(path_target)\nk = 1\nfor kind in classes:\n  path = join('./EuroSat', str(kind))\n  for i, f in enumerate(listdir(path)):\n    shutil.copyfile(join(path, f),\n                  join(path_target, f))\n    rename(join(path_target, f), join(path_target, f'{k}.jpg'))\n    k += 1\n```\n\nì¤‘ìš”í•œ ë‘ ë²ˆì§¸ ë‹¨ê³„ëŠ” ë…¸ì´ì¦ˆ ìƒì„±ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì˜ˆë¥¼ ë“¤ì–´ ì¼ë¶€ í”½ì…€ì„ ë¬´ì‘ìœ„ë¡œ ë§ˆìŠ¤í‚¹í•˜ê±°ë‚˜ ê°€ìš°ì‹œì•ˆ ë…¸ì´ì¦ˆë¥¼ ì¶”ê°€í•˜ëŠ” ë“±ì˜ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê¸€ì—ì„œëŠ” ì €ëŠ” ìƒˆë¡œìš´ ë°©ì‹ì¸ Perlin ë…¸ì´ì¦ˆë¥¼ ì‹œë„í•´ ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤. Perlin ë…¸ì´ì¦ˆëŠ” 80ë…„ëŒ€ì— Ken Perlinì´ ì˜í™” ì—°ê¸° íš¨ê³¼ë¥¼ ê°œë°œí•  ë•Œ ë°œëª…í–ˆìŠµë‹ˆë‹¤. ì´ ì¢…ë¥˜ì˜ ë…¸ì´ì¦ˆëŠ” ì¼ë°˜ì ì¸ ëœë¤ ë…¸ì´ì¦ˆì— ë¹„í•´ ë” ìœ ê¸°ì ì¸ ì™¸ê´€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì €ì—ê²Œ ì´ë¥¼ ì¦ëª…í•˜ëŠ” ê¸°íšŒë¥¼ ì£¼ì„¸ìš”.\n\n```js\ndef generate_perlin_noise(width, height, scale, octaves, persistence, lacunarity):\n    noise = np.zeros((height, width))\n    for i in range(height):\n        for j in range(width):\n            noise[i][j] = pnoise2(i / scale,\n                                  j / scale,\n                                  octaves=octaves,\n                                  persistence=persistence,\n                                  lacunarity=lacunarity,\n                                  repeatx=width,\n                                  repeaty=height,\n                                  base=0)\n    return noise\n\ndef normalize_noise(noise):\n    min_val = noise.min()\n    max_val = noise.max()\n    return (noise - min_val) / (max_val - min_val)\n\ndef generate_clouds(width, height, base_scale, octaves, persistence, lacunarity):\n    clouds = np.zeros((height, width))\n    for octave in range(1, octaves + 1):\n        scale = base_scale / octave\n        layer = generate_perlin_noise(width, height, scale, 1, persistence, lacunarity)\n        clouds += layer * (persistence ** octave)\n\n    clouds = normalize_noise(clouds)\n    return clouds\n\ndef overlay_clouds(image, clouds, alpha=0.5):\n\n    clouds_rgb = np.stack([clouds] * 3, axis=-1)\n\n    image = image.astype(float) / 255.0\n    clouds_rgb = clouds_rgb.astype(float)\n\n    blended = image * (1 - alpha) + clouds_rgb * alpha\n\n    blended = (blended * 255).astype(np.uint8)\n    return blended\n```\n\n<div class=\"content-ad\"></div>\n\n```js\nê°€ë¡œ, ì„¸ë¡œ = 64, 64\nì˜¥íƒ€ë¸Œ = 12  # í•©ì³ì§€ëŠ” ì¡ìŒ ë ˆì´ì–´ì˜ ìˆ˜\nì§€ì†ì„± = 0.5  # ë‚®ì€ ì§€ì†ì„±ì€ ë†’ì€ ì£¼íŒŒìˆ˜ ì˜¥íƒ€ë¸Œì˜ ì§„í­ì„ ì¤„ì…ë‹ˆë‹¤.\në¼ì¿ ë‚˜ë¦¬í‹° = 2  # ë†’ì€ ë¼ì¿ ë‚˜ë¦¬í‹°ëŠ” ë†’ì€ ì£¼íŒŒìˆ˜ ì˜¥íƒ€ë¸Œì˜ ì£¼íŒŒìˆ˜ë¥¼ ëŠ˜ë¦½ë‹ˆë‹¤.\nfor i in range(len(listdir(path_target))):\n  ê¸°ë³¸_ìŠ¤ì¼€ì¼ = random.uniform(5, 120)  # ì¡ìŒ ì£¼íŒŒìˆ˜\n  ì•ŒíŒŒ = random.uniform(0, 1)  # íˆ¬ëª…ë„\n\n  êµ¬ë¦„ = generate_clouds(ê°€ë¡œ, ì„¸ë¡œ, ê¸°ë³¸_ìŠ¤ì¼€ì¼, ì˜¥íƒ€ë¸Œ, ì§€ì†ì„±, ë¼ì¿ ë‚˜ë¦¬í‹°)\n\n  ì´ë¯¸ì§€ = np.asarray(Image.open(join(path_target, f'{i+1}.jpg')))\n  ì´ë¯¸ì§€ = Image.fromarray(overlay_clouds(ì´ë¯¸ì§€, êµ¬ë¦„, ì•ŒíŒŒ))\n  ì´ë¯¸ì§€.save(join(path_input, f'{i+1}.jpg'))\n  print(f'{i+1}/{len(listdir(path_target))}ë²ˆì§¸ ì²˜ë¦¬ ì™„ë£Œ')\n```\n\n```js\nì¸ë±ìŠ¤ = np.random.randint(27000)\nfig, ax = plt.subplots(1,2)\nax[0].imshow(np.asarray(Image.open(join(path_target, f'{ì¸ë±ìŠ¤}.jpg')))\nax[1].imshow(np.asarray(Image.open(join(path_input, f'{ì¸ë±ìŠ¤}.jpg')))\nax[0].set_title(\"ì›ë³¸\")\nax[0].axis('off')\nax[1].set_title(\"ì…ë ¥\")\nax[1].axis('off')\nplt.show()\n```\n\n<img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_2.png\" />\n\nìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ì´ë¯¸ì§€ì˜ êµ¬ë¦„ì€ ë§¤ìš° í˜„ì‹¤ì ì´ë©° ë‹¤ì–‘í•œ \"ë°€ë„\"ì™€ ì§ˆê°ì„ ê°€ì§€ë©° ì‹¤ì œ êµ¬ë¦„ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\në§Œì•½ ì €ì²˜ëŸ¼ Perlin ì†ŒìŒì— í¥ë¯¸ë¥¼ ëŠë‚€ë‹¤ë©´, ê²Œì„ ê°œë°œ ì‚°ì—…ì—ì„œ ì´ ì†ŒìŒì´ ì–´ë–»ê²Œ ì ìš©ë  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë§ ë©‹ì§„ ë¹„ë””ì˜¤ê°€ ìˆì–´ìš”!\n\nì´ì œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ëœ ë°ì´í„°ì…‹ì´ ìˆìœ¼ë‹ˆ, GANsì— ëŒ€í•´ ì´ì•¼ê¸°í•´ ë³´ê² ìŠµë‹ˆë‹¤.\n\n# ìƒì„±ì  ì ëŒ€ ì‹ ê²½ë§\n\nì´ ì•„ì´ë””ì–´ë¥¼ ë” ì˜ ì„¤ëª…í•˜ê¸° ìœ„í•´, ë™ë‚¨ì•„ì‹œì•„ë¥¼ ì—¬í–‰í•˜ë‹¤ê°€ ë°–ì´ ë„ˆë¬´ ì¶¥ë‹¤ê³  ëŠë‚„ ë•Œ í›„ë””ê°€ ì ˆì‹¤í•˜ê²Œ í•„ìš”í•˜ë‹¤ê³  ìƒìƒí•´ ë³´ì„¸ìš”. ê°€ì¥ ê°€ê¹Œìš´ ê±°ë¦¬ ì‹œì¥ì— ê°€ë³´ë‹ˆ, ëª‡ ê°€ì§€ ë¸Œëœë“œ ì˜ë¥˜ê°€ ìˆëŠ” ì‘ì€ ê°€ê²Œë¥¼ ë°œê²¬í–ˆì–´ìš”. íŒë§¤ìê°€ ìœ ëª…í•œ ë¸Œëœë“œ ExpensiveButNotWorthItì˜ í›„ë””ë¥¼ ì‹œë„í•´ë³´ë¼ë©° ê´œì°®ì€ í›„ë””ë¥¼ ê°€ì ¸ë‹¤ì¤ë‹ˆë‹¤. ë” ìì„¸íˆ ì‚´í´ë³´ê³  ë¶„ëª…íˆ ê°€ì§œë¼ê³  ê²°ë¡  ë‚´ë¦¬ê²Œ ë©ë‹ˆë‹¤. íŒë§¤ìê°€ ë§í•©ë‹ˆë‹¤: 'ì ì‹œë§Œìš”, ì§„ì§œ ê²ƒì´ ìˆì–´ìš”.' ê·¸ê°€ ë‹¤ë¥¸ í›„ë””ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë°, ë¸Œëœë“œ ì œí’ˆê³¼ ë” ë‹®ì•˜ì§€ë§Œ ì—¬ì „íˆ ê°€ì§œì…ë‹ˆë‹¤. ì´ì™€ ê°™ì€ ë°˜ë³µ ì‘ì—…ì„ ëª‡ ë²ˆ ê±°ì¹œ í›„, íŒë§¤ìê°€ ì „ì„¤ì ì¸ ExpensiveButNotWorthItì˜ êµ¬ë³„ì´ ì–´ë ¤ìš´ ì‚¬ë³¸ì„ ê°€ì ¸ì™€ ì—¬ëŸ¬ë¶„ì€ ê¸°êº¼ì´ êµ¬ë§¤í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ GANsê°€ ì‘ë™í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤!\n\n<div class=\"content-ad\"></div>\n\nGANì˜ ê²½ìš°, ë‹¹ì‹ ì€ íŒë³„ì(D)ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. íŒë³„ìì˜ ëª©í‘œëŠ” ì§„ì§œ ë¬¼ì²´ì™€ ê°€ì§œ ë¬¼ì²´ë¥¼ êµ¬ë³„í•˜ê±°ë‚˜ ì´ì§„ ë¶„ë¥˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ì— ë°˜í•´, ìƒì„±ì(G)ëŠ” ë†’ì€ í’ˆì§ˆì˜ ê°€ì§œë¥¼ ìƒì„±í•˜ë ¤ê³  í•˜ëŠ” íŒë§¤ìë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. íŒë³„ìì™€ ìƒì„±ìëŠ” ì„œë¡œ ëŠ¥ê°€í•˜ê¸° ìœ„í•´ ë…ë¦½ì ìœ¼ë¡œ í›ˆë ¨ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ìµœì¢…ì ìœ¼ë¡œ ìš°ë¦¬ëŠ” ë†’ì€ í’ˆì§ˆì˜ ê°€ì§œë¥¼ ì–»ìŠµë‹ˆë‹¤.\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_3.png)\n\ní›ˆë ¨ ê³¼ì •ì€ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ë©ë‹ˆë‹¤:\n\n- ì…ë ¥ ë…¸ì´ì¦ˆë¥¼ ìƒ˜í”Œë§í•©ë‹ˆë‹¤ (ìš°ë¦¬ì˜ ê²½ìš° êµ¬ë¦„ì´ ìˆëŠ” ì´ë¯¸ì§€).\n- ë…¸ì´ì¦ˆë¥¼ ìƒì„±ì(G)ì— ê³µê¸‰í•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n- D ì†ì‹¤ì„ ê³„ì‚°í•©ë‹ˆë‹¤. Gì˜ ì¶œë ¥ì— ëŒ€í•œ í•˜ë‚˜ì™€ ì‹¤ì œ ë°ì´í„°ì— ëŒ€í•œ ë‹¤ë¥¸ ì˜ˆì¸¡ì„ ì–»ì–´ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n- Dì˜ ê°€ì¤‘ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.\n- ë‹¤ì‹œ ì…ë ¥ ë…¸ì´ì¦ˆë¥¼ ìƒ˜í”Œë§í•©ë‹ˆë‹¤.\n- ë…¸ì´ì¦ˆë¥¼ ìƒì„±ì(G)ì— ê³µê¸‰í•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.\n- G ì†ì‹¤ì„ ê³„ì‚°í•©ë‹ˆë‹¤. Gì˜ ì˜ˆì¸¡ì„ Dì— ê³µê¸‰í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n- Gì˜ ê°€ì¤‘ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n\n![Erasing Clouds from Satellite Imagery Using GANs](/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_4.png)\n\nIn other words, we can define a value function V(G,D):\n\n![Value function V(G,D)](/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_5.png)\n\nwhere we want to minimize the term log(1-D(G(z))) to train G and maximize log D(x) to train D (in this notation x â€” real data sample and z â€” noise).\n\n\n<div class=\"content-ad\"></div>\n\nì´ì œ íŒŒì´í† ì¹˜ì—ì„œ êµ¬í˜„í•´ ë´…ì‹œë‹¤!\n\nì›ë³¸ ë…¼ë¬¸ì—ì„œ ì €ìë“¤ì€ Multilayer Perceptron (MLP)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ ì–¸ê¸‰í•©ë‹ˆë‹¤; ì´ê²ƒì€ ANNìœ¼ë¡œ ê°„ë‹¨íˆë„ ë¶ˆë¦½ë‹ˆë‹¤ë§Œ, ì €ëŠ” ë¯¸ì„¸í•œ ì ‘ê·¼ì„ ì‹œë„í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤ â€” Generatorë¡œ UNet [5] ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•˜ê³ , Discriminatorë¡œëŠ” ResNet [6]ì„ ì‚¬ìš©í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ì´ë“¤ì€ ë‘˜ ë‹¤ ì˜ ì•Œë ¤ì§„ CNN ì•„í‚¤í…ì²˜ì´ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œ ì„¤ëª…í•˜ì§€ëŠ” ì•Šê² ìŠµë‹ˆë‹¤ (ëŒ“ê¸€ì—ì„œ ë³„ë„ì˜ ê¸€ì„ ì“¸ì§€ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”).\n\nì´ì œ êµ¬ì¶•í•´ ë´…ì‹œë‹¤. Discriminator:\n\n```python\nimport torch\nimport torch.nn as nn\nimport torch.optim as optim\nimport torch.nn.functional as F\nfrom torch.utils.data import Dataset, DataLoader\nfrom torchvision import transforms\nfrom torch.utils.data import Subset\n```\n\n<div class=\"content-ad\"></div>\n\n```js\nclass ResidualBlock(nn.Module):\n    def __init__(self, in_channels, out_channels, stride = 1, downsample = None):\n        super(ResidualBlock, self).__init__()\n        self.conv1 = nn.Sequential(\n                        nn.Conv2d(in_channels, out_channels, kernel_size = 3, stride = stride, padding = 1),\n                        nn.BatchNorm2d(out_channels),\n                        nn.ReLU())\n        self.conv2 = nn.Sequential(\n                        nn.Conv2d(out_channels, out_channels, kernel_size = 3, stride = 1, padding = 1),\n                        nn.BatchNorm2d(out_channels))\n        self.downsample = downsample\n        self.relu = nn.ReLU()\n        self.out_channels = out_channels\n\n    def forward(self, x):\n        residual = x\n        out = self.conv1(x)\n        out = self.conv2(out)\n        if self.downsample:\n            residual = self.downsample(x)\n        out += residual\n        out = self.relu(out)\n        return out\n\n\nclass ResNet(nn.Module):\n    def __init__(self, block=ResidualBlock, all_connections=[3,4,6,3]):\n        super(ResNet, self).__init__()\n        self.inputs = 16\n        self.conv1 = nn.Sequential(\n                        nn.Conv2d(3, 16, kernel_size = 3, stride = 1, padding = 1),\n                        nn.BatchNorm2d(16),\n                        nn.ReLU()) #16x64x64\n        self.maxpool = nn.MaxPool2d(kernel_size = 2, stride = 2) #16x32x32\n\n\n        self.layer0 = self.makeLayer(block, 16, all_connections[0], stride = 1) #connections = 3, shape: 16x32x32\n        self.layer1 = self.makeLayer(block, 32, all_connections[1], stride = 2)#connections = 4, shape: 32x16x16\n        self.layer2 = self.makeLayer(block, 128, all_connections[2], stride = 2)#connections = 6, shape: 1281x8x8\n        self.layer3 = self.makeLayer(block, 256, all_connections[3], stride = 2)#connections = 3, shape: 256x4x4\n        self.avgpool = nn.AvgPool2d(4, stride=1)\n        self.fc = nn.Linear(256, 1)\n\n    def makeLayer(self, block, outputs, connections, stride=1):\n        downsample = None\n        if stride != 1 or self.inputs != outputs:\n            downsample = nn.Sequential(\n                nn.Conv2d(self.inputs, outputs, kernel_size=1, stride=stride),\n                nn.BatchNorm2d(outputs),\n            )\n        layers = []\n        layers.append(block(self.inputs, outputs, stride, downsample))\n        self.inputs = outputs\n        for i in range(1, connections):\n            layers.append(block(self.inputs, outputs))\n\n        return nn.Sequential(*layers)\n\n\n    def forward(self, x):\n        x = self.conv1(x)\n        x = self.maxpool(x)\n        x = self.layer0(x)\n        x = self.layer1(x)\n        x = self.layer2(x)\n        x = self.layer3(x)\n        x = self.avgpool(x)\n        x = x.view(-1, 256)\n        x = self.fc(x).flatten()\n        return F.sigmoid(x)\n```\n\nGenerator:\n\n```js\nclass DoubleConv(nn.Module):\n    def __init__(self, in_channels, out_channels):\n        super(DoubleConv, self).__init__()\n        self.double_conv = nn.Sequential(\n            nn.Conv2d(in_channels, out_channels, kernel_size=3, padding=1),\n            nn.BatchNorm2d(out_channels),\n            nn.ReLU(inplace=True),\n            nn.Conv2d(out_channels, out_channels, kernel_size=3, padding=1),\n            nn.BatchNorm2d(out_channels),\n            nn.ReLU(inplace=True)\n        )\n\n    def forward(self, x):\n        return self.double_conv(x)\n\nclass UNet(nn.Module):\n    def __init__(self):\n      super().__init__()\n      self.conv_1 = DoubleConv(3, 32) # 32x64x64\n      self.pool_1 = nn.MaxPool2d(kernel_size=2, stride=2) # 32x32x32\n\n      self.conv_2 = DoubleConv(32, 64)  #64x32x32\n      self.pool_2 = nn.MaxPool2d(kernel_size=2, stride=2) #64x16x16\n\n      self.conv_3 = DoubleConv(64, 128)  #128x16x16\n      self.pool_3 = nn.MaxPool2d(kernel_size=2, stride=2) #128x8x8\n\n      self.conv_4 = DoubleConv(128, 256)  #256x8x8\n      self.pool_4 = nn.MaxPool2d(kernel_size=2, stride=2) #256x4x4\n\n      self.conv_5 = DoubleConv(256, 512)  #512x2x2\n\n      #DECODER\n      self.upconv_1 = nn.ConvTranspose2d(512, 256, kernel_size=2, stride=2) #256x4x4\n      self.conv_6 = DoubleConv(512, 256) #256x4x4\n\n\n      self.upconv_2 = nn.ConvTranspose2d(256, 128, kernel_size=2, stride=2) #128x8x8\n      self.conv_7 = DoubleConv(256, 128)  #128x8x8\n\n      self.upconv_3 = nn.ConvTranspose2d(128, 64, kernel_size=2, stride=2) #64x16x16\n      self.conv_8 = DoubleConv(128, 64)  #64x16x16\n\n      self.upconv_4 = nn.ConvTranspose2d(64, 32, kernel_size=2, stride=2) #32x32x32\n      self.conv_9 = DoubleConv(64, 32)  #32x32x32\n\n      self.output = nn.Conv2d(32, 3, kernel_size = 3, stride = 1, padding = 1) #3x64x64\n\n    def forward(self, batch):\n\n      conv_1_out = self.conv_1(batch)\n      conv_2_out = self.conv_2(self.pool_1(conv_1_out))\n      conv_3_out = self.conv_3(self.pool_2(conv_2_out))\n      conv_4_out = self.conv_4(self.pool_3(conv_3_out))\n      conv_5_out = self.conv_5(self.pool_4(conv_4_out))\n\n      conv_6_out = self.conv_6(torch.cat([self.upconv_1(conv_5_out), conv_4_out], dim=1))\n      conv_7_out = self.conv_7(torch.cat([self.upconv_2(conv_6_out), conv_3_out], dim=1))\n      conv_8_out = self.conv_8(torch.cat([self.upconv_3(conv_7_out), conv_2_out], dim=1))\n      conv_9_out = self.conv_9(torch.cat([self.upconv_4(conv_8_out), conv_1_out], dim=1))\n\n      output = self.output(conv_9_out)\n\n\n      return F.sigmoid(output)\n```\n\nì´ì œ ë°ì´í„°ë¥¼ í›ˆë ¨/í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë¶„í• í•˜ê³  torch ë°ì´í„° ì„¸íŠ¸ë¡œ ë˜í•‘í•´ì•¼í•©ë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```python\nclass dataset(Dataset):\n    def __init__(self, batch_size, images_paths, targets, img_size=64):\n        self.batch_size = batch_size\n        self.img_size = img_size\n        self.images_paths = images_paths\n        self.targets = targets\n        self.len = len(self.images_paths) // batch_size\n\n        self.transform = transforms.Compose([\n            transforms.ToTensor(),\n        ])\n\n        self.batch_im = [self.images_paths[idx * self.batch_size:(idx + 1) * self.batch_size] for idx in range(self.len)]\n        self.batch_t = [self.targets[idx * self.batch_size:(idx + 1) * self.batch_size] for idx in range(self.len)]\n\n    def __getitem__(self, idx):\n        pred = torch.stack([\n            self.transform(Image.open(join(path_input, file_name)))\n            for file_name in self.batch_im[idx]\n        ])\n        target = torch.stack([\n            self.transform(Image.open(join(path_target, file_name)))\n            for file_name in self.batch_im[idx]\n        ])\n        return pred, target\n\n    def __len__(self):\n        return self.len\n```\n\në©‹ì ¸ìš”. ì´ì œ í›ˆë ¨ ë£¨í”„ë¥¼ ì‘ì„±í•  ì‹œê°„ì…ë‹ˆë‹¤. ê·¸ ì „ì— ì†ì‹¤ í•¨ìˆ˜ì™€ ì˜µí‹°ë§ˆì´ì €ë¥¼ ì •ì˜í•´ ë´…ì‹œë‹¤:\n\n```python\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\nbatch_size = 64\nnum_epochs = 15\nlearning_rate_D = 1e-5\nlearning_rate_G = 1e-4\n\ndiscriminator = ResNet()\ngenerator = UNet()\n\nbce = nn.BCEWithLogitsLoss()\nl1loss = nn.L1Loss()\n\noptimizer_D = optim.Adam(discriminator.parameters(), lr=learning_rate_D)\noptimizer_G = optim.Adam(generator.parameters(), lr=learning_rate_G)\n\nscheduler_D = optim.lr_scheduler.StepLR(optimizer_D, step_size=10, gamma=0.1)\nscheduler_G = optim.lr_scheduler.StepLR(optimizer_G, step_size=10, gamma=0.1)\n```\n\nì´ì „ GAN ì•Œê³ ë¦¬ì¦˜ ê·¸ë¦¼ì˜ ì†ì‹¤ í•¨ìˆ˜ì™€ëŠ” ë‹¤ë¥¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ L1 ì†ì‹¤ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ ì•„ì´ë””ì–´ëŠ” ìš°ë¦¬ê°€ ë¬´ì‘ìœ„ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì…ë ¥ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ì •ë³´ë¥¼ ìœ ì§€í•˜ê³  ë…¸ì´ì¦ˆë§Œ ì œê±°í•˜ë ¤ê³  í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ G ì†ì‹¤ì€ ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì…ë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n\nG_loss = log(1 âˆ’ D(G(z))) + ğ€ |G(z)-y|\n\ninstead of just\n\nG_loss = log(1 âˆ’ D(G(z)))\n\nğ€ is an arbitrary coefficient, which balances two components of the losses.\n\n\n<div class=\"content-ad\"></div>\n\nì´ì œ ë°ì´í„°ë¥¼ ë¶„í• í•˜ì—¬ í›ˆë ¨ ê³¼ì •ì„ ì‹œì‘í•´ë´…ì‹œë‹¤:\n\n```js\ntest_ratio, train_ratio = 0.3, 0.7\nnum_test = int(len(listdir(path_target)) * test_ratio)\nnum_train = int((int(len(listdir(path_target))) - num_test))\n\nimg_size = (64, 64)\n\nprint(\"í›ˆë ¨ ìƒ˜í”Œ ìˆ˜:\", num_train)\nprint(\"í…ŒìŠ¤íŠ¸ ìƒ˜í”Œ ìˆ˜:\", num_test)\n\nrandom.seed(231)\ntrain_idxs = np.array(random.sample(range(num_test + num_train), num_train))\nmask = np.ones(num_train + num_test, dtype=bool)\nmask[train_idxs] = False\n\nimages = {}\nfeatures = random.sample(listdir(path_input), num_test + num_train)\ntargets = random.sample(listdir(path_target), num_test + num_train)\n\nrandom.Random(231).shuffle(features)\nrandom.Random(231).shuffle(targets)\n\ntrain_input_img_paths = np.array(features)[train_idxs]\ntrain_target_img_path = np.array(targets)[train_idxs]\ntest_input_img_paths = np.array(features)[mask]\ntest_target_img_path = np.array(targets)[mask]\n\ntrain_loader = dataset(batch_size=batch_size, img_size=img_size, images_paths=train_input_img_paths, targets=train_target_img_path)\ntest_loader = dataset(batch_size=batch_size, img_size=img_size, images_paths=test_input_img_paths, targets=test_target_img_path)\n```\n\nì´ì œ í›ˆë ¨ ë£¨í”„ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤:\n\n```js\ntrain_loss_G, train_loss_D, val_loss_G, val_loss_D = [], [], [], []\nall_loss_G, all_loss_D = [], []\nbest_generator_epoch_val_loss, best_discriminator_epoch_val_loss = -np.inf, -np.inf\nfor epoch in range(num_epochs):\n\n    discriminator.train()\n    generator.train()\n\n    discriminator_epoch_loss, generator_epoch_loss = 0, 0\n\n    for inputs, targets in train_loader:\n        inputs, true = inputs, targets\n\n        '''1. íŒë³„ì (ResNet) í›ˆë ¨í•˜ê¸°'''\n        optimizer_D.zero_grad()\n\n        fake = generator(inputs).detach()\n\n        pred_fake = discriminator(fake).to(device)\n        loss_fake = bce(pred_fake, torch.zeros(batch_size, device=device))\n\n        pred_real = discriminator(true).to(device)\n        loss_real = bce(pred_real, torch.ones(batch_size, device=device))\n\n        loss_D = (loss_fake + loss_real) / 2\n\n        loss_D.backward()\n        optimizer_D.step()\n\n        discriminator_epoch_loss += loss_D.item()\n        all_loss_D.append(loss_D.item())\n\n        '''2. ìƒì„±ì (UNet) í›ˆë ¨í•˜ê¸°'''\n        optimizer_G.zero_grad()\n\n        fake = generator(inputs)\n        pred_fake = discriminator(fake).to(device)\n\n        loss_G_bce = bce(pred_fake, torch.ones_like(pred_fake, device=device))\n        loss_G_l1 = l1loss(fake, targets) * 100\n        loss_G = loss_G_bce + loss_G_l1\n        loss_G.backward()\n        optimizer_G.step()\n\n        generator_epoch_loss += loss_G.item()\n        all_loss_G.append(loss_G.item())\n\n    discriminator_epoch_loss /= len(train_loader)\n    generator_epoch_loss /= len(train_loader)\n    train_loss_D.append(discriminator_epoch_loss)\n    train_loss_G.append(generator_epoch_loss)\n\n    discriminator.eval()\n    generator.eval()\n\n    discriminator_epoch_val_loss, generator_epoch_val_loss = 0, 0\n\n    with torch.no_grad():\n        for inputs, targets in test_loader:\n            inputs, targets = inputs, targets\n\n            fake = generator(inputs)\n            pred = discriminator(fake).to(device)\n\n            loss_G_bce = bce(fake, torch.ones_like(fake, device=device))\n            loss_G_l1 = l1loss(fake, targets) * 100\n            loss_G = loss_G_bce + loss_G_l1\n            loss_D = bce(pred.to(device), torch.zeros(batch_size, device=device))\n\n            discriminator_epoch_val_loss += loss_D.item()\n            generator_epoch_val_loss += loss_G.item()\n\n    discriminator_epoch_val_loss /= len(test_loader)\n    generator_epoch_val_loss /= len(test_loader)\n\n    val_loss_D.append(discriminator_epoch_val_loss)\n    val_loss_G.append(generator_epoch_val_loss)\n\n    print(f\"------ì—í¬í¬ [{epoch+1}/{num_epochs}]------\\ní›ˆë ¨ ì†ì‹¤ D: {discriminator_epoch_loss:.4f}, ê²€ì¦ ì†ì‹¤ D: {discriminator_epoch_val_loss:.4f}\")\n    print(f'í›ˆë ¨ ì†ì‹¤ G: {generator_epoch_loss:.4f}, ê²€ì¦ ì†ì‹¤ G: {generator_epoch_val_loss:.4f}')\n\n    if discriminator_epoch_val_loss > best_discriminator_epoch_val_loss:\n        discriminator_epoch_val_loss = best_discriminator_epoch_val_loss\n        torch.save(discriminator.state_dict(), \"discriminator.pth\")\n    if generator_epoch_val_loss > best_generator_epoch_val_loss:\n        generator_epoch_val_loss = best_generator_epoch_val_loss\n        torch.save(generator.state_dict(), \"generator.pth\")\n\n    fig, ax = plt.subplots(1,3)\n    ax[0].imshow(np.transpose(inputs.numpy()[7], (1,2,0)))\n    ax[1].imshow(np.transpose(targets.numpy()[7], (1,2,0)))\n    ax[2].imshow(np.transpose(fake.detach().numpy()[7], (1,2,0)))\n    plt.show()\n```\n\n<div class=\"content-ad\"></div>\n\nì½”ë“œê°€ ëë‚˜ë©´ ì†ì‹¤ì„ ê·¸ë˜í”„ë¡œ ê·¸ë ¤ë³¼ ìˆ˜ ìˆì–´ìš”. ì´ ì½”ë“œëŠ” ì´ ë©‹ì§„ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì¼ë¶€ ì±„íƒë˜ì—ˆì–´ìš”:\n\n```js\nfrom matplotlib.font_manager import FontProperties\n\nbackground_color = '#001219'\nfont = FontProperties(fname='LexendDeca-VariableFont_wght.ttf')\nfig, ax = plt.subplots(1, 2, figsize=(16, 9))\nfig.set_facecolor(background_color)\nax[0].set_facecolor(background_color)\nax[1].set_facecolor(background_color)\n\nax[0].plot(range(len(all_loss_G)), all_loss_G, color='#bc6c25', lw=0.5) \nax[1].plot(range(len(all_loss_D)), all_loss_D, color='#00b4d8', lw=0.5)\n\nax[0].scatter(\n      [np.array(all_loss_G).argmax(), np.array(all_loss_G).argmin()],\n      [np.array(all_loss_G).max(), np.array(all_loss_G).min()],\n      s=30, color='#bc6c25',\n   )\nax[1].scatter(\n      [np.array(all_loss_D).argmax(), np.array(all_loss_D).argmin()],\n      [np.array(all_loss_D).max(), np.array(all_loss_D).min()],\n      s=30, color='#00b4d8',\n   )\n\nax.text(\n      np.array(all_loss_G).argmax()+60, np.array(all_loss_G).max()+0.1,\n      f'{round(np.array(all_loss_G).max(),1)}',\n      fontsize=13, color='#bc6c25',\n      font=font,\n      ax=ax[0]\n   )\nax.text(\n      np.array(all_loss_G).argmin()+60, np.array(all_loss_G).min()-0.1,\n      f'{round(np.array(all_loss_G).min(),1)}',\n      fontsize=13, color='#bc6c25',\n      font=font,\n      ax=ax[0]\n   )\n\nax.text(\n      np.array(all_loss_D).argmax()+60, np.array(all_loss_D).max()+0.01,\n      f'{round(np.array(all_loss_D).max(),1)}',\n      fontsize=13, color='#00b4d8',\n      font=font,\n      ax=ax[1]\n   )\nax.text(\n      np.array(all_loss_D).argmin()+60, np.array(all_loss_D).min()-0.005,\n      f'{round(np.array(all_loss_D).min(),1)}',\n      fontsize=13, color='#00b4d8',\n      font=font,\n      ax=ax[1]\n   )\nfor i in range(2):\n    ax[i].tick_params(axis='x', colors='white')\n    ax[i].tick_params(axis='y', colors='white')\n    ax[i].spines['left'].set_color('white') \n    ax[i].spines['bottom'].set_color('white') \n    ax[i].set_xlabel('Epoch', color='white', fontproperties=font, fontsize=13)\n    ax[i].set_ylabel('Loss', color='white', fontproperties=font, fontsize=13)\n\nax[0].set_title('Generator', color='white', fontproperties=font, fontsize=18)\nax[1].set_title('Discriminator', color='white', fontproperties=font, fontsize=18)\nplt.savefig('Loss.jpg')\nplt.show()\n# ax[0].set_axis_off()\n# ax[1].set_axis_off()\n```\n\në˜í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ì—ì„œ ì„ì˜ì˜ ìƒ˜í”Œì„ ì‹œê°í™”í• ê²Œìš”:\n\n```js\nrandom.Random(2).shuffle(test_target_img_path)\nrandom.Random(2).shuffle(test_input_img_paths)\nsubset_loader = dataset(batch_size=5, img_size=img_size, images_paths=test_input_img_paths,\n                        targets=test_target_img_path)\ngenerator = UNet()\ngenerator.load_state_dict(torch.load('generator.pth'))\n\ngenerator.eval()\nfor X, y in subset_loader:\n    fig, axes = plt.subplots(5, 3, figsize=(9, 9))\n\n    for i in range(5):\n        axes[i, 0].imshow(np.transpose(X.numpy()[i], (1, 2, 0)))\n        axes[i, 0].set_title(\"Input\")\n        axes[i, 0].axis('off')\n        \n        axes[i, 1].imshow(np.transpose(y.numpy()[i], (1, 2, 0)))\n        axes[i, 1].set_title(\"Target\")\n        axes[i, 1].axis('off')\n        \n        generated_image = generator(X[i].unsqueeze(0)).detach().numpy()[0]\n        axes[i, 2].imshow(np.transpose(generated_image, (1, 2, 0)))\n        axes[i, 2].set_title(\"Generated\")\n        axes[i, 2].axis('off')\n    \n    # ë ˆì´ì•„ì›ƒ ì¡°ì •\n    plt.tight_layout()\n    plt.savefig('Test.jpg')\n    plt.show()\n    break \n```\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_6.png\" />\n\nì—¬ê¸°ì„œ ë³´ì‹œë‹¤ì‹œí”¼, ê²°ê³¼ëŠ” ì™„ë²½í•˜ì§€ ì•Šê³  ë•…ì»¤ë²„ ìœ í˜•ì— ë§¤ìš° ì˜ì¡´í•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³ , êµ¬ì¶•ëœ ëª¨ë¸ì€ ì´ë¯¸ì§€ì—ì„œ êµ¬ë¦„ì„ ì œê±°í•˜ë©°, G ë° D ê¹Šì´ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒìœ¼ë¡œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìœ ë§í•œ ì „ëµì€ ì„œë¡œ ë‹¤ë¥¸ ë•…ì»¤ë²„ ìœ í˜•ì„ ìœ„í•´ ë³„ë„ì˜ ëª¨ë¸ì„ í›ˆë ¨ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‘ë¬¼ë°­ê³¼ ë¬¼ íˆ¬êµ¬ëŠ” ë¶„ëª…íˆ ë‹¤ë¥¸ ê³µê°„ì  íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜í™” ëª¨ë¸ì˜ ëŠ¥ë ¥ì— ì˜í–¥ì„ ì£¼ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.\n\nì´ ê¸°ì‚¬ê°€ ì§€ë¦¬ì •ë³´ ë„ë©”ì¸ì—ì„œ ì‹¬ì¸µ í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•˜ëŠ” ë° ìƒˆë¡œìš´ ì‹œê°ì„ ì œê³µí•´ ë“œë ¸ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ë‚´ ìƒê°ì—ëŠ”, GANsëŠ” ë°ì´í„° ê³¼í•™ìê°€ í™œìš©í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ê°•ë ¥í•œ ë„êµ¬ ì¤‘ í•˜ë‚˜ì´ë©°, ì—¬ëŸ¬ë¶„ì˜ ë„êµ¬ ìƒìì˜ í•„ìˆ˜ì ì¸ ë¶€ë¶„ì´ ë˜ê¸¸ í¬ë§í•©ë‹ˆë‹¤!\n\n===========================================\n\n<div class=\"content-ad\"></div>\n\nì°¸ê³ ë¬¸í—Œ:\n\n1. Goodfellow, Ian, Jean Pouget-Abadie, Mehdi Mirza, Bing Xu, David Warde-Farley, Sherjil Ozair, Aaron Courville ë° Yoshua Bengio. â€œGenerative adversarial nets.â€ Advances in neural information processing systems 27 (2014). [ë…¼ë¬¸ ë§í¬](https://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf)\n\n2. Helber, Patrick, Benjamin Bischke, Andreas Dengel ë° Damian Borth. â€œEurosat: A novel dataset and deep learning benchmark for land use and land cover classification.â€ IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing 12, no. 7 (2019): 2217â€“2226. [ë…¼ë¬¸ ë§í¬](https://arxiv.org/pdf/1709.00029)\n\n3. Wen, Xue, Zongxu Pan, Yuxin Hu ë° Jiayin Liu. â€œGenerative adversarial learning in YUV color space for thin cloud removal on satellite imagery.â€ Remote Sensing 13, no. 6 (2021): 1079. [ë…¼ë¬¸ ë§í¬](https://www.mdpi.com/2072-4292/13/6/1079)\n\n<div class=\"content-ad\"></div>\n\n5. Ronneberger, Olaf, Philipp Fischer, and Thomas Brox. â€œU-net: Convolutional networks for biomedical image segmentation.â€ In Medical image computing and computer-assisted interventionâ€“MICCAI 2015: 18th international conference, Munich, Germany, October 5â€“9, 2015, proceedings, part III 18, pp. 234â€“241. Springer International Publishing, 2015. [Link](https://arxiv.org/pdf/1505.04597)\n\n6. He, Kaiming, et al. â€œDeep residual learning for image recognition.â€ Proceedings of the IEEE conference on computer vision and pattern recognition. 2016. [Link](https://openaccess.thecvf.com/content_cvpr_2016/papers/He_Deep_Residual_Learning_CVPR_2016_paper.pdf)\n\n===========================================\n\n<div class=\"content-ad\"></div>\n\nì œ Mediumì˜ ëª¨ë“  ê²Œì‹œë¬¼ì€ ë¬´ë£Œì´ë©° ê³µê°œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì—¬ê¸°ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì‹œë©´ ì •ë§ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!\n\nP.s. ì €ëŠ” (ì§€ë¦¬)ë°ì´í„° ê³¼í•™, ë¨¸ì‹  ëŸ¬ë‹/ì¸ê³µì§€ëŠ¥, ê¸°í›„ ë³€í™”ì— ëŒ€í•´ ì—´ì •ì ìœ¼ë¡œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì–´ë–¤ í”„ë¡œì íŠ¸ì—ì„œ í•¨ê»˜ ì‘ì—…í•˜ê³  ì‹¶ë‹¤ë©´ LinkedInì—ì„œ ì—°ë½ ì£¼ì„¸ìš”.\n\nğŸ›°ï¸ë” ë§ì€ ì†Œì‹ì„ ë°›ì•„ë³´ë ¤ë©´ íŒ”ë¡œìš°í•˜ì„¸ìš”!ğŸ›°ï¸","ogImage":{"url":"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_0.png"},"coverImage":"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_0.png","tag":["Tech"],"readingTime":25},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>íŒŒì´ì¬ìœ¼ë¡œë¶€í„° GAN(Generative Adversarial Networks) ë§Œë“¤ì–´ ë³´ê¸°</h2>\n<p><img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_0.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>GAN(Generative Adversarial Networks)ì´ë¼ëŠ” ì•„ì´ë””ì–´ëŠ” 2014ë…„ Goodfellowì™€ ê·¸ ë™ë£Œë“¤ì— ì˜í•´ ì†Œê°œë˜ì—ˆê³ , ê³§ ê·¸ ì´í›„ì— ì»´í“¨í„° ë¹„ì „ ë° ì´ë¯¸ì§€ ìƒì„± ë¶„ì•¼ì—ì„œ ê·¹ë„ë¡œ ì¸ê¸°ë¥¼ ëŒê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œì˜ ê¸‰ì†í•œ ë°œì „ê³¼ ìƒˆë¡œìš´ ì•Œê³ ë¦¬ì¦˜ì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ë”ë¼ë„, ì´ ê°œë…ì˜ ë‹¨ìˆœí•¨ê³¼ ì°½ì˜ì„±ì€ ì—¬ì „íˆ ë§¤ìš° ì¸ìƒì ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ ì´ëŸ¬í•œ ë„¤íŠ¸ì›Œí¬ê°€ ì–¼ë§ˆë‚˜ ê°•ë ¥í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ìœ„ì„± RGB(ë¹¨ê°•, ë…¹ìƒ‰, íŒŒë‘) ì´ë¯¸ì§€ì—ì„œ êµ¬ë¦„ì„ ì œê±°í•˜ëŠ” ì‹œë„ë¥¼ í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.</p>\n<p>ì ì ˆíˆ ê· í˜• ì¡íˆê³  ì¶©ë¶„íˆ í¬ë©° ì˜¬ë°”ë¥´ê²Œ ì „ì²˜ë¦¬ëœ ì»´í“¨í„° ë¹„ì „ ë°ì´í„°ì…‹ì„ ì¤€ë¹„í•˜ëŠ” ë°ì—ëŠ” ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë˜ë¯€ë¡œ, ì €ëŠ” Kaggleì— ì–´ë–¤ ê²ƒì´ ìˆëŠ”ì§€ ì‚´í´ë³´ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì— ê°€ì¥ ì í•©í•˜ë‹¤ê³  ìƒê°í•œ ë°ì´í„°ì…‹ì€ EuroSatì´ë©°, ì´ëŠ” ì˜¤í”ˆ ë¼ì´ì„ ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ë°ì´í„°ì…‹ì€ Sentinel-2ì—ì„œ 64x64 í”½ì…€ì˜ 27000ê°œì˜ ë ˆì´ë¸”ì´ ì§€ì •ëœ RGB ì´ë¯¸ì§€ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , ë‹¤ì¤‘ í´ë˜ìŠ¤ ë¶„ë¥˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>\n<p><img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_1.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>ìš°ë¦¬ëŠ” ë¶„ë¥˜ ìì²´ì— í¥ë¯¸ê°€ ì—†ì§€ë§Œ EuroSat ë°ì´í„°ì…‹ì˜ ì£¼ìš” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” ëª¨ë“  ì´ë¯¸ì§€ì— ë§‘ì€ í•˜ëŠ˜ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ê²ƒì´ ì •í™•íˆ ìš°ë¦¬ê°€ í•„ìš”í•œ ê²ƒì…ë‹ˆë‹¤. [3]ì—ì„œ ì´ ì ‘ê·¼ë²•ì„ ì±„íƒí•˜ì—¬, ìš°ë¦¬ëŠ” ì´ Sentinel-2 ìƒ·ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì…ë ¥ì„ ì¶”ê°€í•˜ì—¬ (êµ¬ë¦„) ë…¸ì´ì¦ˆë¥¼ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ ìš°ë¦¬ê°€ GANsì— ëŒ€í•´ ì‹¤ì œë¡œ ì´ì•¼ê¸°í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ì¤€ë¹„í•´ ë´…ì‹œë‹¤. ìš°ì„ , ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ëª¨ë“  í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ì˜ ë””ë ‰í† ë¦¬ë¡œ ë³‘í•©í•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>ğŸì „ì²´ Python ì½”ë“œ: GitHub.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> random\n\n<span class=\"hljs-keyword\">from</span> os <span class=\"hljs-keyword\">import</span> listdir, mkdir, rename\n<span class=\"hljs-keyword\">from</span> os.<span class=\"hljs-property\">path</span> <span class=\"hljs-keyword\">import</span> join, exists\n<span class=\"hljs-keyword\">import</span> shutil\n<span class=\"hljs-keyword\">import</span> datetime\n\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">from</span> highlight_text <span class=\"hljs-keyword\">import</span> ax_text, fig_text\n<span class=\"hljs-keyword\">from</span> <span class=\"hljs-variable constant_\">PIL</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Image</span>\n\n<span class=\"hljs-keyword\">import</span> warnings\n\nwarnings.<span class=\"hljs-title function_\">filterwarnings</span>(<span class=\"hljs-string\">'ignore'</span>)\n</code></pre>\n<pre><code class=\"hljs language-js\">classes = <span class=\"hljs-title function_\">listdir</span>(<span class=\"hljs-string\">'./EuroSat'</span>)\npath_target = <span class=\"hljs-string\">'./EuroSat/all_targets'</span>\npath_input = <span class=\"hljs-string\">'./EuroSat/all_inputs'</span>\n\n<span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"UNPACKí•œ ì•„ì¹´ì´ë¸Œ íŒŒì¼ì˜ íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ ë‹¨ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ì„¸ìš”\"</span><span class=\"hljs-string\">\"\"</span>\n<span class=\"hljs-title function_\">mkdir</span>(path_input)\n<span class=\"hljs-title function_\">mkdir</span>(path_target)\nk = <span class=\"hljs-number\">1</span>\n<span class=\"hljs-keyword\">for</span> kind <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">classes</span>:\n  path = <span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">'./EuroSat'</span>, <span class=\"hljs-title function_\">str</span>(kind))\n  <span class=\"hljs-keyword\">for</span> i, f <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">enumerate</span>(<span class=\"hljs-title function_\">listdir</span>(path)):\n    shutil.<span class=\"hljs-title function_\">copyfile</span>(<span class=\"hljs-title function_\">join</span>(path, f),\n                  <span class=\"hljs-title function_\">join</span>(path_target, f))\n    <span class=\"hljs-title function_\">rename</span>(<span class=\"hljs-title function_\">join</span>(path_target, f), <span class=\"hljs-title function_\">join</span>(path_target, f<span class=\"hljs-string\">'{k}.jpg'</span>))\n    k += <span class=\"hljs-number\">1</span>\n</code></pre>\n<p>ì¤‘ìš”í•œ ë‘ ë²ˆì§¸ ë‹¨ê³„ëŠ” ë…¸ì´ì¦ˆ ìƒì„±ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì˜ˆë¥¼ ë“¤ì–´ ì¼ë¶€ í”½ì…€ì„ ë¬´ì‘ìœ„ë¡œ ë§ˆìŠ¤í‚¹í•˜ê±°ë‚˜ ê°€ìš°ì‹œì•ˆ ë…¸ì´ì¦ˆë¥¼ ì¶”ê°€í•˜ëŠ” ë“±ì˜ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê¸€ì—ì„œëŠ” ì €ëŠ” ìƒˆë¡œìš´ ë°©ì‹ì¸ Perlin ë…¸ì´ì¦ˆë¥¼ ì‹œë„í•´ ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤. Perlin ë…¸ì´ì¦ˆëŠ” 80ë…„ëŒ€ì— Ken Perlinì´ ì˜í™” ì—°ê¸° íš¨ê³¼ë¥¼ ê°œë°œí•  ë•Œ ë°œëª…í–ˆìŠµë‹ˆë‹¤. ì´ ì¢…ë¥˜ì˜ ë…¸ì´ì¦ˆëŠ” ì¼ë°˜ì ì¸ ëœë¤ ë…¸ì´ì¦ˆì— ë¹„í•´ ë” ìœ ê¸°ì ì¸ ì™¸ê´€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì €ì—ê²Œ ì´ë¥¼ ì¦ëª…í•˜ëŠ” ê¸°íšŒë¥¼ ì£¼ì„¸ìš”.</p>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">generate_perlin_noise</span>(width, height, scale, octaves, persistence, lacunarity):\n    noise = np.<span class=\"hljs-title function_\">zeros</span>((height, width))\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(height):\n        <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(width):\n            noise[i][j] = <span class=\"hljs-title function_\">pnoise2</span>(i / scale,\n                                  j / scale,\n                                  octaves=octaves,\n                                  persistence=persistence,\n                                  lacunarity=lacunarity,\n                                  repeatx=width,\n                                  repeaty=height,\n                                  base=<span class=\"hljs-number\">0</span>)\n    <span class=\"hljs-keyword\">return</span> noise\n\ndef <span class=\"hljs-title function_\">normalize_noise</span>(noise):\n    min_val = noise.<span class=\"hljs-title function_\">min</span>()\n    max_val = noise.<span class=\"hljs-title function_\">max</span>()\n    <span class=\"hljs-keyword\">return</span> (noise - min_val) / (max_val - min_val)\n\ndef <span class=\"hljs-title function_\">generate_clouds</span>(width, height, base_scale, octaves, persistence, lacunarity):\n    clouds = np.<span class=\"hljs-title function_\">zeros</span>((height, width))\n    <span class=\"hljs-keyword\">for</span> octave <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-number\">1</span>, octaves + <span class=\"hljs-number\">1</span>):\n        scale = base_scale / octave\n        layer = <span class=\"hljs-title function_\">generate_perlin_noise</span>(width, height, scale, <span class=\"hljs-number\">1</span>, persistence, lacunarity)\n        clouds += layer * (persistence ** octave)\n\n    clouds = <span class=\"hljs-title function_\">normalize_noise</span>(clouds)\n    <span class=\"hljs-keyword\">return</span> clouds\n\ndef <span class=\"hljs-title function_\">overlay_clouds</span>(image, clouds, alpha=<span class=\"hljs-number\">0.5</span>):\n\n    clouds_rgb = np.<span class=\"hljs-title function_\">stack</span>([clouds] * <span class=\"hljs-number\">3</span>, axis=-<span class=\"hljs-number\">1</span>)\n\n    image = image.<span class=\"hljs-title function_\">astype</span>(float) / <span class=\"hljs-number\">255.0</span>\n    clouds_rgb = clouds_rgb.<span class=\"hljs-title function_\">astype</span>(float)\n\n    blended = image * (<span class=\"hljs-number\">1</span> - alpha) + clouds_rgb * alpha\n\n    blended = (blended * <span class=\"hljs-number\">255</span>).<span class=\"hljs-title function_\">astype</span>(np.<span class=\"hljs-property\">uint8</span>)\n    <span class=\"hljs-keyword\">return</span> blended\n</code></pre>\n<pre><code class=\"hljs language-js\">ê°€ë¡œ, ì„¸ë¡œ = <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>\nì˜¥íƒ€ë¸Œ = <span class=\"hljs-number\">12</span>  # í•©ì³ì§€ëŠ” ì¡ìŒ ë ˆì´ì–´ì˜ ìˆ˜\nì§€ì†ì„± = <span class=\"hljs-number\">0.5</span>  # ë‚®ì€ ì§€ì†ì„±ì€ ë†’ì€ ì£¼íŒŒìˆ˜ ì˜¥íƒ€ë¸Œì˜ ì§„í­ì„ ì¤„ì…ë‹ˆë‹¤.\në¼ì¿ ë‚˜ë¦¬í‹° = <span class=\"hljs-number\">2</span>  # ë†’ì€ ë¼ì¿ ë‚˜ë¦¬í‹°ëŠ” ë†’ì€ ì£¼íŒŒìˆ˜ ì˜¥íƒ€ë¸Œì˜ ì£¼íŒŒìˆ˜ë¥¼ ëŠ˜ë¦½ë‹ˆë‹¤.\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(<span class=\"hljs-title function_\">listdir</span>(path_target))):\n  ê¸°ë³¸_ìŠ¤ì¼€ì¼ = random.<span class=\"hljs-title function_\">uniform</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">120</span>)  # ì¡ìŒ ì£¼íŒŒìˆ˜\n  ì•ŒíŒŒ = random.<span class=\"hljs-title function_\">uniform</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>)  # íˆ¬ëª…ë„\n\n  êµ¬ë¦„ = <span class=\"hljs-title function_\">generate_clouds</span>(ê°€ë¡œ, ì„¸ë¡œ, ê¸°ë³¸_ìŠ¤ì¼€ì¼, ì˜¥íƒ€ë¸Œ, ì§€ì†ì„±, ë¼ì¿ ë‚˜ë¦¬í‹°)\n\n  ì´ë¯¸ì§€ = np.<span class=\"hljs-title function_\">asarray</span>(<span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-title function_\">join</span>(path_target, f<span class=\"hljs-string\">'{i+1}.jpg'</span>)))\n  ì´ë¯¸ì§€ = <span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">fromarray</span>(<span class=\"hljs-title function_\">overlay_clouds</span>(ì´ë¯¸ì§€, êµ¬ë¦„, ì•ŒíŒŒ))\n  ì´ë¯¸ì§€.<span class=\"hljs-title function_\">save</span>(<span class=\"hljs-title function_\">join</span>(path_input, f<span class=\"hljs-string\">'{i+1}.jpg'</span>))\n  <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'{i+1}/{len(listdir(path_target))}ë²ˆì§¸ ì²˜ë¦¬ ì™„ë£Œ'</span>)\n</code></pre>\n<pre><code class=\"hljs language-js\">ì¸ë±ìŠ¤ = np.<span class=\"hljs-property\">random</span>.<span class=\"hljs-title function_\">randint</span>(<span class=\"hljs-number\">27000</span>)\nfig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>)\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">asarray</span>(<span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-title function_\">join</span>(path_target, f<span class=\"hljs-string\">'{ì¸ë±ìŠ¤}.jpg'</span>)))\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">asarray</span>(<span class=\"hljs-title class_\">Image</span>.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-title function_\">join</span>(path_input, f<span class=\"hljs-string\">'{ì¸ë±ìŠ¤}.jpg'</span>)))\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"ì›ë³¸\"</span>)\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"ì…ë ¥\"</span>)\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ì´ë¯¸ì§€ì˜ êµ¬ë¦„ì€ ë§¤ìš° í˜„ì‹¤ì ì´ë©° ë‹¤ì–‘í•œ \"ë°€ë„\"ì™€ ì§ˆê°ì„ ê°€ì§€ë©° ì‹¤ì œ êµ¬ë¦„ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤.</p>\n<p>ë§Œì•½ ì €ì²˜ëŸ¼ Perlin ì†ŒìŒì— í¥ë¯¸ë¥¼ ëŠë‚€ë‹¤ë©´, ê²Œì„ ê°œë°œ ì‚°ì—…ì—ì„œ ì´ ì†ŒìŒì´ ì–´ë–»ê²Œ ì ìš©ë  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë§ ë©‹ì§„ ë¹„ë””ì˜¤ê°€ ìˆì–´ìš”!</p>\n<p>ì´ì œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ëœ ë°ì´í„°ì…‹ì´ ìˆìœ¼ë‹ˆ, GANsì— ëŒ€í•´ ì´ì•¼ê¸°í•´ ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<h1>ìƒì„±ì  ì ëŒ€ ì‹ ê²½ë§</h1>\n<p>ì´ ì•„ì´ë””ì–´ë¥¼ ë” ì˜ ì„¤ëª…í•˜ê¸° ìœ„í•´, ë™ë‚¨ì•„ì‹œì•„ë¥¼ ì—¬í–‰í•˜ë‹¤ê°€ ë°–ì´ ë„ˆë¬´ ì¶¥ë‹¤ê³  ëŠë‚„ ë•Œ í›„ë””ê°€ ì ˆì‹¤í•˜ê²Œ í•„ìš”í•˜ë‹¤ê³  ìƒìƒí•´ ë³´ì„¸ìš”. ê°€ì¥ ê°€ê¹Œìš´ ê±°ë¦¬ ì‹œì¥ì— ê°€ë³´ë‹ˆ, ëª‡ ê°€ì§€ ë¸Œëœë“œ ì˜ë¥˜ê°€ ìˆëŠ” ì‘ì€ ê°€ê²Œë¥¼ ë°œê²¬í–ˆì–´ìš”. íŒë§¤ìê°€ ìœ ëª…í•œ ë¸Œëœë“œ ExpensiveButNotWorthItì˜ í›„ë””ë¥¼ ì‹œë„í•´ë³´ë¼ë©° ê´œì°®ì€ í›„ë””ë¥¼ ê°€ì ¸ë‹¤ì¤ë‹ˆë‹¤. ë” ìì„¸íˆ ì‚´í´ë³´ê³  ë¶„ëª…íˆ ê°€ì§œë¼ê³  ê²°ë¡  ë‚´ë¦¬ê²Œ ë©ë‹ˆë‹¤. íŒë§¤ìê°€ ë§í•©ë‹ˆë‹¤: 'ì ì‹œë§Œìš”, ì§„ì§œ ê²ƒì´ ìˆì–´ìš”.' ê·¸ê°€ ë‹¤ë¥¸ í›„ë””ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë°, ë¸Œëœë“œ ì œí’ˆê³¼ ë” ë‹®ì•˜ì§€ë§Œ ì—¬ì „íˆ ê°€ì§œì…ë‹ˆë‹¤. ì´ì™€ ê°™ì€ ë°˜ë³µ ì‘ì—…ì„ ëª‡ ë²ˆ ê±°ì¹œ í›„, íŒë§¤ìê°€ ì „ì„¤ì ì¸ ExpensiveButNotWorthItì˜ êµ¬ë³„ì´ ì–´ë ¤ìš´ ì‚¬ë³¸ì„ ê°€ì ¸ì™€ ì—¬ëŸ¬ë¶„ì€ ê¸°êº¼ì´ êµ¬ë§¤í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ GANsê°€ ì‘ë™í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤!</p>\n<p>GANì˜ ê²½ìš°, ë‹¹ì‹ ì€ íŒë³„ì(D)ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. íŒë³„ìì˜ ëª©í‘œëŠ” ì§„ì§œ ë¬¼ì²´ì™€ ê°€ì§œ ë¬¼ì²´ë¥¼ êµ¬ë³„í•˜ê±°ë‚˜ ì´ì§„ ë¶„ë¥˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ì— ë°˜í•´, ìƒì„±ì(G)ëŠ” ë†’ì€ í’ˆì§ˆì˜ ê°€ì§œë¥¼ ìƒì„±í•˜ë ¤ê³  í•˜ëŠ” íŒë§¤ìë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. íŒë³„ìì™€ ìƒì„±ìëŠ” ì„œë¡œ ëŠ¥ê°€í•˜ê¸° ìœ„í•´ ë…ë¦½ì ìœ¼ë¡œ í›ˆë ¨ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ìµœì¢…ì ìœ¼ë¡œ ìš°ë¦¬ëŠ” ë†’ì€ í’ˆì§ˆì˜ ê°€ì§œë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>\n<p><img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_3.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>í›ˆë ¨ ê³¼ì •ì€ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ë©ë‹ˆë‹¤:</p>\n<ul>\n<li>ì…ë ¥ ë…¸ì´ì¦ˆë¥¼ ìƒ˜í”Œë§í•©ë‹ˆë‹¤ (ìš°ë¦¬ì˜ ê²½ìš° êµ¬ë¦„ì´ ìˆëŠ” ì´ë¯¸ì§€).</li>\n<li>ë…¸ì´ì¦ˆë¥¼ ìƒì„±ì(G)ì— ê³µê¸‰í•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</li>\n<li>D ì†ì‹¤ì„ ê³„ì‚°í•©ë‹ˆë‹¤. Gì˜ ì¶œë ¥ì— ëŒ€í•œ í•˜ë‚˜ì™€ ì‹¤ì œ ë°ì´í„°ì— ëŒ€í•œ ë‹¤ë¥¸ ì˜ˆì¸¡ì„ ì–»ì–´ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</li>\n<li>Dì˜ ê°€ì¤‘ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</li>\n<li>ë‹¤ì‹œ ì…ë ¥ ë…¸ì´ì¦ˆë¥¼ ìƒ˜í”Œë§í•©ë‹ˆë‹¤.</li>\n<li>ë…¸ì´ì¦ˆë¥¼ ìƒì„±ì(G)ì— ê³µê¸‰í•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</li>\n<li>G ì†ì‹¤ì„ ê³„ì‚°í•©ë‹ˆë‹¤. Gì˜ ì˜ˆì¸¡ì„ Dì— ê³µê¸‰í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</li>\n<li>Gì˜ ê°€ì¤‘ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</li>\n</ul>\n<p><img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_4.png\" alt=\"Erasing Clouds from Satellite Imagery Using GANs\"></p>\n<p>In other words, we can define a value function V(G,D):</p>\n<p><img src=\"/assets/img/2024-06-19-ErasingCloudsfromSatelliteImageryUsingGANsGenerativeAdversarialNetworks_5.png\" alt=\"Value function V(G,D)\"></p>\n<p>where we want to minimize the term log(1-D(G(z))) to train G and maximize log D(x) to train D (in this notation x â€” real data sample and z â€” noise).</p>\n<p>ì´ì œ íŒŒì´í† ì¹˜ì—ì„œ êµ¬í˜„í•´ ë´…ì‹œë‹¤!</p>\n<p>ì›ë³¸ ë…¼ë¬¸ì—ì„œ ì €ìë“¤ì€ Multilayer Perceptron (MLP)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ ì–¸ê¸‰í•©ë‹ˆë‹¤; ì´ê²ƒì€ ANNìœ¼ë¡œ ê°„ë‹¨íˆë„ ë¶ˆë¦½ë‹ˆë‹¤ë§Œ, ì €ëŠ” ë¯¸ì„¸í•œ ì ‘ê·¼ì„ ì‹œë„í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤ â€” Generatorë¡œ UNet [5] ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•˜ê³ , Discriminatorë¡œëŠ” ResNet [6]ì„ ì‚¬ìš©í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ì´ë“¤ì€ ë‘˜ ë‹¤ ì˜ ì•Œë ¤ì§„ CNN ì•„í‚¤í…ì²˜ì´ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„œ ì„¤ëª…í•˜ì§€ëŠ” ì•Šê² ìŠµë‹ˆë‹¤ (ëŒ“ê¸€ì—ì„œ ë³„ë„ì˜ ê¸€ì„ ì“¸ì§€ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”).</p>\n<p>ì´ì œ êµ¬ì¶•í•´ ë´…ì‹œë‹¤. Discriminator:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> torch\n<span class=\"hljs-keyword\">import</span> torch.nn <span class=\"hljs-keyword\">as</span> nn\n<span class=\"hljs-keyword\">import</span> torch.optim <span class=\"hljs-keyword\">as</span> optim\n<span class=\"hljs-keyword\">import</span> torch.nn.functional <span class=\"hljs-keyword\">as</span> F\n<span class=\"hljs-keyword\">from</span> torch.utils.data <span class=\"hljs-keyword\">import</span> Dataset, DataLoader\n<span class=\"hljs-keyword\">from</span> torchvision <span class=\"hljs-keyword\">import</span> transforms\n<span class=\"hljs-keyword\">from</span> torch.utils.data <span class=\"hljs-keyword\">import</span> Subset\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ResidualBlock</span>(nn.<span class=\"hljs-property\">Module</span>):\n    def <span class=\"hljs-title function_\">__init__</span>(self, in_channels, out_channels, stride = <span class=\"hljs-number\">1</span>, downsample = <span class=\"hljs-title class_\">None</span>):\n        <span class=\"hljs-variable language_\">super</span>(<span class=\"hljs-title class_\">ResidualBlock</span>, self).<span class=\"hljs-title function_\">__init__</span>()\n        self.<span class=\"hljs-property\">conv1</span> = nn.<span class=\"hljs-title class_\">Sequential</span>(\n                        nn.<span class=\"hljs-title class_\">Conv2</span>d(in_channels, out_channels, kernel_size = <span class=\"hljs-number\">3</span>, stride = stride, padding = <span class=\"hljs-number\">1</span>),\n                        nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(out_channels),\n                        nn.<span class=\"hljs-title class_\">ReLU</span>())\n        self.<span class=\"hljs-property\">conv2</span> = nn.<span class=\"hljs-title class_\">Sequential</span>(\n                        nn.<span class=\"hljs-title class_\">Conv2</span>d(out_channels, out_channels, kernel_size = <span class=\"hljs-number\">3</span>, stride = <span class=\"hljs-number\">1</span>, padding = <span class=\"hljs-number\">1</span>),\n                        nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(out_channels))\n        self.<span class=\"hljs-property\">downsample</span> = downsample\n        self.<span class=\"hljs-property\">relu</span> = nn.<span class=\"hljs-title class_\">ReLU</span>()\n        self.<span class=\"hljs-property\">out_channels</span> = out_channels\n\n    def <span class=\"hljs-title function_\">forward</span>(self, x):\n        residual = x\n        out = self.<span class=\"hljs-title function_\">conv1</span>(x)\n        out = self.<span class=\"hljs-title function_\">conv2</span>(out)\n        <span class=\"hljs-keyword\">if</span> self.<span class=\"hljs-property\">downsample</span>:\n            residual = self.<span class=\"hljs-title function_\">downsample</span>(x)\n        out += residual\n        out = self.<span class=\"hljs-title function_\">relu</span>(out)\n        <span class=\"hljs-keyword\">return</span> out\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ResNet</span>(nn.<span class=\"hljs-property\">Module</span>):\n    def <span class=\"hljs-title function_\">__init__</span>(self, block=<span class=\"hljs-title class_\">ResidualBlock</span>, all_connections=[<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">3</span>]):\n        <span class=\"hljs-variable language_\">super</span>(<span class=\"hljs-title class_\">ResNet</span>, self).<span class=\"hljs-title function_\">__init__</span>()\n        self.<span class=\"hljs-property\">inputs</span> = <span class=\"hljs-number\">16</span>\n        self.<span class=\"hljs-property\">conv1</span> = nn.<span class=\"hljs-title class_\">Sequential</span>(\n                        nn.<span class=\"hljs-title class_\">Conv2</span>d(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">16</span>, kernel_size = <span class=\"hljs-number\">3</span>, stride = <span class=\"hljs-number\">1</span>, padding = <span class=\"hljs-number\">1</span>),\n                        nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(<span class=\"hljs-number\">16</span>),\n                        nn.<span class=\"hljs-title class_\">ReLU</span>()) #16x64x64\n        self.<span class=\"hljs-property\">maxpool</span> = nn.<span class=\"hljs-title class_\">MaxPool2</span>d(kernel_size = <span class=\"hljs-number\">2</span>, stride = <span class=\"hljs-number\">2</span>) #16x32x32\n\n\n        self.<span class=\"hljs-property\">layer0</span> = self.<span class=\"hljs-title function_\">makeLayer</span>(block, <span class=\"hljs-number\">16</span>, all_connections[<span class=\"hljs-number\">0</span>], stride = <span class=\"hljs-number\">1</span>) #connections = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">shape</span>: 16x32x32\n        self.<span class=\"hljs-property\">layer1</span> = self.<span class=\"hljs-title function_\">makeLayer</span>(block, <span class=\"hljs-number\">32</span>, all_connections[<span class=\"hljs-number\">1</span>], stride = <span class=\"hljs-number\">2</span>)#connections = <span class=\"hljs-number\">4</span>, <span class=\"hljs-attr\">shape</span>: 32x16x16\n        self.<span class=\"hljs-property\">layer2</span> = self.<span class=\"hljs-title function_\">makeLayer</span>(block, <span class=\"hljs-number\">128</span>, all_connections[<span class=\"hljs-number\">2</span>], stride = <span class=\"hljs-number\">2</span>)#connections = <span class=\"hljs-number\">6</span>, <span class=\"hljs-attr\">shape</span>: 1281x8x8\n        self.<span class=\"hljs-property\">layer3</span> = self.<span class=\"hljs-title function_\">makeLayer</span>(block, <span class=\"hljs-number\">256</span>, all_connections[<span class=\"hljs-number\">3</span>], stride = <span class=\"hljs-number\">2</span>)#connections = <span class=\"hljs-number\">3</span>, <span class=\"hljs-attr\">shape</span>: 256x4x4\n        self.<span class=\"hljs-property\">avgpool</span> = nn.<span class=\"hljs-title class_\">AvgPool2</span>d(<span class=\"hljs-number\">4</span>, stride=<span class=\"hljs-number\">1</span>)\n        self.<span class=\"hljs-property\">fc</span> = nn.<span class=\"hljs-title class_\">Linear</span>(<span class=\"hljs-number\">256</span>, <span class=\"hljs-number\">1</span>)\n\n    def <span class=\"hljs-title function_\">makeLayer</span>(self, block, outputs, connections, stride=<span class=\"hljs-number\">1</span>):\n        downsample = <span class=\"hljs-title class_\">None</span>\n        <span class=\"hljs-keyword\">if</span> stride != <span class=\"hljs-number\">1</span> or self.<span class=\"hljs-property\">inputs</span> != <span class=\"hljs-attr\">outputs</span>:\n            downsample = nn.<span class=\"hljs-title class_\">Sequential</span>(\n                nn.<span class=\"hljs-title class_\">Conv2</span>d(self.<span class=\"hljs-property\">inputs</span>, outputs, kernel_size=<span class=\"hljs-number\">1</span>, stride=stride),\n                nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(outputs),\n            )\n        layers = []\n        layers.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-title function_\">block</span>(self.<span class=\"hljs-property\">inputs</span>, outputs, stride, downsample))\n        self.<span class=\"hljs-property\">inputs</span> = outputs\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-number\">1</span>, connections):\n            layers.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-title function_\">block</span>(self.<span class=\"hljs-property\">inputs</span>, outputs))\n\n        <span class=\"hljs-keyword\">return</span> nn.<span class=\"hljs-title class_\">Sequential</span>(*layers)\n\n\n    def <span class=\"hljs-title function_\">forward</span>(self, x):\n        x = self.<span class=\"hljs-title function_\">conv1</span>(x)\n        x = self.<span class=\"hljs-title function_\">maxpool</span>(x)\n        x = self.<span class=\"hljs-title function_\">layer0</span>(x)\n        x = self.<span class=\"hljs-title function_\">layer1</span>(x)\n        x = self.<span class=\"hljs-title function_\">layer2</span>(x)\n        x = self.<span class=\"hljs-title function_\">layer3</span>(x)\n        x = self.<span class=\"hljs-title function_\">avgpool</span>(x)\n        x = x.<span class=\"hljs-title function_\">view</span>(-<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">256</span>)\n        x = self.<span class=\"hljs-title function_\">fc</span>(x).<span class=\"hljs-title function_\">flatten</span>()\n        <span class=\"hljs-keyword\">return</span> F.<span class=\"hljs-title function_\">sigmoid</span>(x)\n</code></pre>\n<p>Generator:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DoubleConv</span>(nn.<span class=\"hljs-property\">Module</span>):\n    def <span class=\"hljs-title function_\">__init__</span>(self, in_channels, out_channels):\n        <span class=\"hljs-variable language_\">super</span>(<span class=\"hljs-title class_\">DoubleConv</span>, self).<span class=\"hljs-title function_\">__init__</span>()\n        self.<span class=\"hljs-property\">double_conv</span> = nn.<span class=\"hljs-title class_\">Sequential</span>(\n            nn.<span class=\"hljs-title class_\">Conv2</span>d(in_channels, out_channels, kernel_size=<span class=\"hljs-number\">3</span>, padding=<span class=\"hljs-number\">1</span>),\n            nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(out_channels),\n            nn.<span class=\"hljs-title class_\">ReLU</span>(inplace=<span class=\"hljs-title class_\">True</span>),\n            nn.<span class=\"hljs-title class_\">Conv2</span>d(out_channels, out_channels, kernel_size=<span class=\"hljs-number\">3</span>, padding=<span class=\"hljs-number\">1</span>),\n            nn.<span class=\"hljs-title class_\">BatchNorm2</span>d(out_channels),\n            nn.<span class=\"hljs-title class_\">ReLU</span>(inplace=<span class=\"hljs-title class_\">True</span>)\n        )\n\n    def <span class=\"hljs-title function_\">forward</span>(self, x):\n        <span class=\"hljs-keyword\">return</span> self.<span class=\"hljs-title function_\">double_conv</span>(x)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UNet</span>(nn.<span class=\"hljs-property\">Module</span>):\n    def <span class=\"hljs-title function_\">__init__</span>(self):\n      <span class=\"hljs-variable language_\">super</span>().<span class=\"hljs-title function_\">__init__</span>()\n      self.<span class=\"hljs-property\">conv_1</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">32</span>) # 32x64x64\n      self.<span class=\"hljs-property\">pool_1</span> = nn.<span class=\"hljs-title class_\">MaxPool2</span>d(kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) # 32x32x32\n\n      self.<span class=\"hljs-property\">conv_2</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">64</span>)  #64x32x32\n      self.<span class=\"hljs-property\">pool_2</span> = nn.<span class=\"hljs-title class_\">MaxPool2</span>d(kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #64x16x16\n\n      self.<span class=\"hljs-property\">conv_3</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">128</span>)  #128x16x16\n      self.<span class=\"hljs-property\">pool_3</span> = nn.<span class=\"hljs-title class_\">MaxPool2</span>d(kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #128x8x8\n\n      self.<span class=\"hljs-property\">conv_4</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">256</span>)  #256x8x8\n      self.<span class=\"hljs-property\">pool_4</span> = nn.<span class=\"hljs-title class_\">MaxPool2</span>d(kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #256x4x4\n\n      self.<span class=\"hljs-property\">conv_5</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">256</span>, <span class=\"hljs-number\">512</span>)  #512x2x2\n\n      #<span class=\"hljs-variable constant_\">DECODER</span>\n      self.<span class=\"hljs-property\">upconv_1</span> = nn.<span class=\"hljs-title class_\">ConvTranspose2</span>d(<span class=\"hljs-number\">512</span>, <span class=\"hljs-number\">256</span>, kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #256x4x4\n      self.<span class=\"hljs-property\">conv_6</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">512</span>, <span class=\"hljs-number\">256</span>) #256x4x4\n\n\n      self.<span class=\"hljs-property\">upconv_2</span> = nn.<span class=\"hljs-title class_\">ConvTranspose2</span>d(<span class=\"hljs-number\">256</span>, <span class=\"hljs-number\">128</span>, kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #128x8x8\n      self.<span class=\"hljs-property\">conv_7</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">256</span>, <span class=\"hljs-number\">128</span>)  #128x8x8\n\n      self.<span class=\"hljs-property\">upconv_3</span> = nn.<span class=\"hljs-title class_\">ConvTranspose2</span>d(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">64</span>, kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #64x16x16\n      self.<span class=\"hljs-property\">conv_8</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">64</span>)  #64x16x16\n\n      self.<span class=\"hljs-property\">upconv_4</span> = nn.<span class=\"hljs-title class_\">ConvTranspose2</span>d(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">32</span>, kernel_size=<span class=\"hljs-number\">2</span>, stride=<span class=\"hljs-number\">2</span>) #32x32x32\n      self.<span class=\"hljs-property\">conv_9</span> = <span class=\"hljs-title class_\">DoubleConv</span>(<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">32</span>)  #32x32x32\n\n      self.<span class=\"hljs-property\">output</span> = nn.<span class=\"hljs-title class_\">Conv2</span>d(<span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">3</span>, kernel_size = <span class=\"hljs-number\">3</span>, stride = <span class=\"hljs-number\">1</span>, padding = <span class=\"hljs-number\">1</span>) #3x64x64\n\n    def <span class=\"hljs-title function_\">forward</span>(self, batch):\n\n      conv_1_out = self.<span class=\"hljs-title function_\">conv_1</span>(batch)\n      conv_2_out = self.<span class=\"hljs-title function_\">conv_2</span>(self.<span class=\"hljs-title function_\">pool_1</span>(conv_1_out))\n      conv_3_out = self.<span class=\"hljs-title function_\">conv_3</span>(self.<span class=\"hljs-title function_\">pool_2</span>(conv_2_out))\n      conv_4_out = self.<span class=\"hljs-title function_\">conv_4</span>(self.<span class=\"hljs-title function_\">pool_3</span>(conv_3_out))\n      conv_5_out = self.<span class=\"hljs-title function_\">conv_5</span>(self.<span class=\"hljs-title function_\">pool_4</span>(conv_4_out))\n\n      conv_6_out = self.<span class=\"hljs-title function_\">conv_6</span>(torch.<span class=\"hljs-title function_\">cat</span>([self.<span class=\"hljs-title function_\">upconv_1</span>(conv_5_out), conv_4_out], dim=<span class=\"hljs-number\">1</span>))\n      conv_7_out = self.<span class=\"hljs-title function_\">conv_7</span>(torch.<span class=\"hljs-title function_\">cat</span>([self.<span class=\"hljs-title function_\">upconv_2</span>(conv_6_out), conv_3_out], dim=<span class=\"hljs-number\">1</span>))\n      conv_8_out = self.<span class=\"hljs-title function_\">conv_8</span>(torch.<span class=\"hljs-title function_\">cat</span>([self.<span class=\"hljs-title function_\">upconv_3</span>(conv_7_out), conv_2_out], dim=<span class=\"hljs-number\">1</span>))\n      conv_9_out = self.<span class=\"hljs-title function_\">conv_9</span>(torch.<span class=\"hljs-title function_\">cat</span>([self.<span class=\"hljs-title function_\">upconv_4</span>(conv_8_out), conv_1_out], dim=<span class=\"hljs-number\">1</span>))\n\n      output = self.<span class=\"hljs-title function_\">output</span>(conv_9_out)\n\n\n      <span class=\"hljs-keyword\">return</span> F.<span class=\"hljs-title function_\">sigmoid</span>(output)\n</code></pre>\n<p>ì´ì œ ë°ì´í„°ë¥¼ í›ˆë ¨/í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë¶„í• í•˜ê³  torch ë°ì´í„° ì„¸íŠ¸ë¡œ ë˜í•‘í•´ì•¼í•©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">dataset</span>(<span class=\"hljs-title class_ inherited__\">Dataset</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, batch_size, images_paths, targets, img_size=<span class=\"hljs-number\">64</span></span>):\n        self.batch_size = batch_size\n        self.img_size = img_size\n        self.images_paths = images_paths\n        self.targets = targets\n        self.<span class=\"hljs-built_in\">len</span> = <span class=\"hljs-built_in\">len</span>(self.images_paths) // batch_size\n\n        self.transform = transforms.Compose([\n            transforms.ToTensor(),\n        ])\n\n        self.batch_im = [self.images_paths[idx * self.batch_size:(idx + <span class=\"hljs-number\">1</span>) * self.batch_size] <span class=\"hljs-keyword\">for</span> idx <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.<span class=\"hljs-built_in\">len</span>)]\n        self.batch_t = [self.targets[idx * self.batch_size:(idx + <span class=\"hljs-number\">1</span>) * self.batch_size] <span class=\"hljs-keyword\">for</span> idx <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.<span class=\"hljs-built_in\">len</span>)]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__getitem__</span>(<span class=\"hljs-params\">self, idx</span>):\n        pred = torch.stack([\n            self.transform(Image.<span class=\"hljs-built_in\">open</span>(join(path_input, file_name)))\n            <span class=\"hljs-keyword\">for</span> file_name <span class=\"hljs-keyword\">in</span> self.batch_im[idx]\n        ])\n        target = torch.stack([\n            self.transform(Image.<span class=\"hljs-built_in\">open</span>(join(path_target, file_name)))\n            <span class=\"hljs-keyword\">for</span> file_name <span class=\"hljs-keyword\">in</span> self.batch_im[idx]\n        ])\n        <span class=\"hljs-keyword\">return</span> pred, target\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__len__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> self.<span class=\"hljs-built_in\">len</span>\n</code></pre>\n<p>ë©‹ì ¸ìš”. ì´ì œ í›ˆë ¨ ë£¨í”„ë¥¼ ì‘ì„±í•  ì‹œê°„ì…ë‹ˆë‹¤. ê·¸ ì „ì— ì†ì‹¤ í•¨ìˆ˜ì™€ ì˜µí‹°ë§ˆì´ì €ë¥¼ ì •ì˜í•´ ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-python\">device = torch.device(<span class=\"hljs-string\">\"cuda\"</span> <span class=\"hljs-keyword\">if</span> torch.cuda.is_available() <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"cpu\"</span>)\n\nbatch_size = <span class=\"hljs-number\">64</span>\nnum_epochs = <span class=\"hljs-number\">15</span>\nlearning_rate_D = <span class=\"hljs-number\">1e-5</span>\nlearning_rate_G = <span class=\"hljs-number\">1e-4</span>\n\ndiscriminator = ResNet()\ngenerator = UNet()\n\nbce = nn.BCEWithLogitsLoss()\nl1loss = nn.L1Loss()\n\noptimizer_D = optim.Adam(discriminator.parameters(), lr=learning_rate_D)\noptimizer_G = optim.Adam(generator.parameters(), lr=learning_rate_G)\n\nscheduler_D = optim.lr_scheduler.StepLR(optimizer_D, step_size=<span class=\"hljs-number\">10</span>, gamma=<span class=\"hljs-number\">0.1</span>)\nscheduler_G = optim.lr_scheduler.StepLR(optimizer_G, step_size=<span class=\"hljs-number\">10</span>, gamma=<span class=\"hljs-number\">0.1</span>)\n</code></pre>\n<p>ì´ì „ GAN ì•Œê³ ë¦¬ì¦˜ ê·¸ë¦¼ì˜ ì†ì‹¤ í•¨ìˆ˜ì™€ëŠ” ë‹¤ë¥¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ L1 ì†ì‹¤ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ ì•„ì´ë””ì–´ëŠ” ìš°ë¦¬ê°€ ë¬´ì‘ìœ„ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì…ë ¥ì—ì„œ ëŒ€ë¶€ë¶„ì˜ ì •ë³´ë¥¼ ìœ ì§€í•˜ê³  ë…¸ì´ì¦ˆë§Œ ì œê±°í•˜ë ¤ê³  í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ G ì†ì‹¤ì€ ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì…ë‹ˆë‹¤:</p>\n<p>G_loss = log(1 âˆ’ D(G(z))) + ğ€ |G(z)-y|</p>\n<p>instead of just</p>\n<p>G_loss = log(1 âˆ’ D(G(z)))</p>\n<p>ğ€ is an arbitrary coefficient, which balances two components of the losses.</p>\n<p>ì´ì œ ë°ì´í„°ë¥¼ ë¶„í• í•˜ì—¬ í›ˆë ¨ ê³¼ì •ì„ ì‹œì‘í•´ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-js\">test_ratio, train_ratio = <span class=\"hljs-number\">0.3</span>, <span class=\"hljs-number\">0.7</span>\nnum_test = <span class=\"hljs-title function_\">int</span>(<span class=\"hljs-title function_\">len</span>(<span class=\"hljs-title function_\">listdir</span>(path_target)) * test_ratio)\nnum_train = <span class=\"hljs-title function_\">int</span>((<span class=\"hljs-title function_\">int</span>(<span class=\"hljs-title function_\">len</span>(<span class=\"hljs-title function_\">listdir</span>(path_target))) - num_test))\n\nimg_size = (<span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">64</span>)\n\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"í›ˆë ¨ ìƒ˜í”Œ ìˆ˜:\"</span>, num_train)\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-string\">\"í…ŒìŠ¤íŠ¸ ìƒ˜í”Œ ìˆ˜:\"</span>, num_test)\n\nrandom.<span class=\"hljs-title function_\">seed</span>(<span class=\"hljs-number\">231</span>)\ntrain_idxs = np.<span class=\"hljs-title function_\">array</span>(random.<span class=\"hljs-title function_\">sample</span>(<span class=\"hljs-title function_\">range</span>(num_test + num_train), num_train))\nmask = np.<span class=\"hljs-title function_\">ones</span>(num_train + num_test, dtype=bool)\nmask[train_idxs] = <span class=\"hljs-title class_\">False</span>\n\nimages = {}\nfeatures = random.<span class=\"hljs-title function_\">sample</span>(<span class=\"hljs-title function_\">listdir</span>(path_input), num_test + num_train)\ntargets = random.<span class=\"hljs-title function_\">sample</span>(<span class=\"hljs-title function_\">listdir</span>(path_target), num_test + num_train)\n\nrandom.<span class=\"hljs-title class_\">Random</span>(<span class=\"hljs-number\">231</span>).<span class=\"hljs-title function_\">shuffle</span>(features)\nrandom.<span class=\"hljs-title class_\">Random</span>(<span class=\"hljs-number\">231</span>).<span class=\"hljs-title function_\">shuffle</span>(targets)\n\ntrain_input_img_paths = np.<span class=\"hljs-title function_\">array</span>(features)[train_idxs]\ntrain_target_img_path = np.<span class=\"hljs-title function_\">array</span>(targets)[train_idxs]\ntest_input_img_paths = np.<span class=\"hljs-title function_\">array</span>(features)[mask]\ntest_target_img_path = np.<span class=\"hljs-title function_\">array</span>(targets)[mask]\n\ntrain_loader = <span class=\"hljs-title function_\">dataset</span>(batch_size=batch_size, img_size=img_size, images_paths=train_input_img_paths, targets=train_target_img_path)\ntest_loader = <span class=\"hljs-title function_\">dataset</span>(batch_size=batch_size, img_size=img_size, images_paths=test_input_img_paths, targets=test_target_img_path)\n</code></pre>\n<p>ì´ì œ í›ˆë ¨ ë£¨í”„ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-js\">train_loss_G, train_loss_D, val_loss_G, val_loss_D = [], [], [], []\nall_loss_G, all_loss_D = [], []\nbest_generator_epoch_val_loss, best_discriminator_epoch_val_loss = -np.<span class=\"hljs-property\">inf</span>, -np.<span class=\"hljs-property\">inf</span>\n<span class=\"hljs-keyword\">for</span> epoch <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(num_epochs):\n\n    discriminator.<span class=\"hljs-title function_\">train</span>()\n    generator.<span class=\"hljs-title function_\">train</span>()\n\n    discriminator_epoch_loss, generator_epoch_loss = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>\n\n    <span class=\"hljs-keyword\">for</span> inputs, targets <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">train_loader</span>:\n        inputs, <span class=\"hljs-literal\">true</span> = inputs, targets\n\n        <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'1. íŒë³„ì (ResNet) í›ˆë ¨í•˜ê¸°'</span><span class=\"hljs-string\">''</span>\n        optimizer_D.<span class=\"hljs-title function_\">zero_grad</span>()\n\n        fake = <span class=\"hljs-title function_\">generator</span>(inputs).<span class=\"hljs-title function_\">detach</span>()\n\n        pred_fake = <span class=\"hljs-title function_\">discriminator</span>(fake).<span class=\"hljs-title function_\">to</span>(device)\n        loss_fake = <span class=\"hljs-title function_\">bce</span>(pred_fake, torch.<span class=\"hljs-title function_\">zeros</span>(batch_size, device=device))\n\n        pred_real = <span class=\"hljs-title function_\">discriminator</span>(<span class=\"hljs-literal\">true</span>).<span class=\"hljs-title function_\">to</span>(device)\n        loss_real = <span class=\"hljs-title function_\">bce</span>(pred_real, torch.<span class=\"hljs-title function_\">ones</span>(batch_size, device=device))\n\n        loss_D = (loss_fake + loss_real) / <span class=\"hljs-number\">2</span>\n\n        loss_D.<span class=\"hljs-title function_\">backward</span>()\n        optimizer_D.<span class=\"hljs-title function_\">step</span>()\n\n        discriminator_epoch_loss += loss_D.<span class=\"hljs-title function_\">item</span>()\n        all_loss_D.<span class=\"hljs-title function_\">append</span>(loss_D.<span class=\"hljs-title function_\">item</span>())\n\n        <span class=\"hljs-string\">''</span><span class=\"hljs-string\">'2. ìƒì„±ì (UNet) í›ˆë ¨í•˜ê¸°'</span><span class=\"hljs-string\">''</span>\n        optimizer_G.<span class=\"hljs-title function_\">zero_grad</span>()\n\n        fake = <span class=\"hljs-title function_\">generator</span>(inputs)\n        pred_fake = <span class=\"hljs-title function_\">discriminator</span>(fake).<span class=\"hljs-title function_\">to</span>(device)\n\n        loss_G_bce = <span class=\"hljs-title function_\">bce</span>(pred_fake, torch.<span class=\"hljs-title function_\">ones_like</span>(pred_fake, device=device))\n        loss_G_l1 = <span class=\"hljs-title function_\">l1loss</span>(fake, targets) * <span class=\"hljs-number\">100</span>\n        loss_G = loss_G_bce + loss_G_l1\n        loss_G.<span class=\"hljs-title function_\">backward</span>()\n        optimizer_G.<span class=\"hljs-title function_\">step</span>()\n\n        generator_epoch_loss += loss_G.<span class=\"hljs-title function_\">item</span>()\n        all_loss_G.<span class=\"hljs-title function_\">append</span>(loss_G.<span class=\"hljs-title function_\">item</span>())\n\n    discriminator_epoch_loss /= <span class=\"hljs-title function_\">len</span>(train_loader)\n    generator_epoch_loss /= <span class=\"hljs-title function_\">len</span>(train_loader)\n    train_loss_D.<span class=\"hljs-title function_\">append</span>(discriminator_epoch_loss)\n    train_loss_G.<span class=\"hljs-title function_\">append</span>(generator_epoch_loss)\n\n    discriminator.<span class=\"hljs-built_in\">eval</span>()\n    generator.<span class=\"hljs-built_in\">eval</span>()\n\n    discriminator_epoch_val_loss, generator_epoch_val_loss = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>\n\n    <span class=\"hljs-keyword\">with</span> torch.<span class=\"hljs-title function_\">no_grad</span>():\n        <span class=\"hljs-keyword\">for</span> inputs, targets <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">test_loader</span>:\n            inputs, targets = inputs, targets\n\n            fake = <span class=\"hljs-title function_\">generator</span>(inputs)\n            pred = <span class=\"hljs-title function_\">discriminator</span>(fake).<span class=\"hljs-title function_\">to</span>(device)\n\n            loss_G_bce = <span class=\"hljs-title function_\">bce</span>(fake, torch.<span class=\"hljs-title function_\">ones_like</span>(fake, device=device))\n            loss_G_l1 = <span class=\"hljs-title function_\">l1loss</span>(fake, targets) * <span class=\"hljs-number\">100</span>\n            loss_G = loss_G_bce + loss_G_l1\n            loss_D = <span class=\"hljs-title function_\">bce</span>(pred.<span class=\"hljs-title function_\">to</span>(device), torch.<span class=\"hljs-title function_\">zeros</span>(batch_size, device=device))\n\n            discriminator_epoch_val_loss += loss_D.<span class=\"hljs-title function_\">item</span>()\n            generator_epoch_val_loss += loss_G.<span class=\"hljs-title function_\">item</span>()\n\n    discriminator_epoch_val_loss /= <span class=\"hljs-title function_\">len</span>(test_loader)\n    generator_epoch_val_loss /= <span class=\"hljs-title function_\">len</span>(test_loader)\n\n    val_loss_D.<span class=\"hljs-title function_\">append</span>(discriminator_epoch_val_loss)\n    val_loss_G.<span class=\"hljs-title function_\">append</span>(generator_epoch_val_loss)\n\n    <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">\"------ì—í¬í¬ [{epoch+1}/{num_epochs}]------\\ní›ˆë ¨ ì†ì‹¤ D: {discriminator_epoch_loss:.4f}, ê²€ì¦ ì†ì‹¤ D: {discriminator_epoch_val_loss:.4f}\"</span>)\n    <span class=\"hljs-title function_\">print</span>(f<span class=\"hljs-string\">'í›ˆë ¨ ì†ì‹¤ G: {generator_epoch_loss:.4f}, ê²€ì¦ ì†ì‹¤ G: {generator_epoch_val_loss:.4f}'</span>)\n\n    <span class=\"hljs-keyword\">if</span> discriminator_epoch_val_loss > <span class=\"hljs-attr\">best_discriminator_epoch_val_loss</span>:\n        discriminator_epoch_val_loss = best_discriminator_epoch_val_loss\n        torch.<span class=\"hljs-title function_\">save</span>(discriminator.<span class=\"hljs-title function_\">state_dict</span>(), <span class=\"hljs-string\">\"discriminator.pth\"</span>)\n    <span class=\"hljs-keyword\">if</span> generator_epoch_val_loss > <span class=\"hljs-attr\">best_generator_epoch_val_loss</span>:\n        generator_epoch_val_loss = best_generator_epoch_val_loss\n        torch.<span class=\"hljs-title function_\">save</span>(generator.<span class=\"hljs-title function_\">state_dict</span>(), <span class=\"hljs-string\">\"generator.pth\"</span>)\n\n    fig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">3</span>)\n    ax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(inputs.<span class=\"hljs-title function_\">numpy</span>()[<span class=\"hljs-number\">7</span>], (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">0</span>)))\n    ax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(targets.<span class=\"hljs-title function_\">numpy</span>()[<span class=\"hljs-number\">7</span>], (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">0</span>)))\n    ax[<span class=\"hljs-number\">2</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(fake.<span class=\"hljs-title function_\">detach</span>().<span class=\"hljs-title function_\">numpy</span>()[<span class=\"hljs-number\">7</span>], (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">0</span>)))\n    plt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<p>ì½”ë“œê°€ ëë‚˜ë©´ ì†ì‹¤ì„ ê·¸ë˜í”„ë¡œ ê·¸ë ¤ë³¼ ìˆ˜ ìˆì–´ìš”. ì´ ì½”ë“œëŠ” ì´ ë©‹ì§„ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì¼ë¶€ ì±„íƒë˜ì—ˆì–´ìš”:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">from</span> matplotlib.<span class=\"hljs-property\">font_manager</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">FontProperties</span>\n\nbackground_color = <span class=\"hljs-string\">'#001219'</span>\nfont = <span class=\"hljs-title class_\">FontProperties</span>(fname=<span class=\"hljs-string\">'LexendDeca-VariableFont_wght.ttf'</span>)\nfig, ax = plt.<span class=\"hljs-title function_\">subplots</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, figsize=(<span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">9</span>))\nfig.<span class=\"hljs-title function_\">set_facecolor</span>(background_color)\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">set_facecolor</span>(background_color)\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">set_facecolor</span>(background_color)\n\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">plot</span>(<span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(all_loss_G)), all_loss_G, color=<span class=\"hljs-string\">'#bc6c25'</span>, lw=<span class=\"hljs-number\">0.5</span>) \nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">plot</span>(<span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(all_loss_D)), all_loss_D, color=<span class=\"hljs-string\">'#00b4d8'</span>, lw=<span class=\"hljs-number\">0.5</span>)\n\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">scatter</span>(\n      [np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">argmax</span>(), np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">argmin</span>()],\n      [np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">max</span>(), np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">min</span>()],\n      s=<span class=\"hljs-number\">30</span>, color=<span class=\"hljs-string\">'#bc6c25'</span>,\n   )\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">scatter</span>(\n      [np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">argmax</span>(), np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">argmin</span>()],\n      [np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">max</span>(), np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">min</span>()],\n      s=<span class=\"hljs-number\">30</span>, color=<span class=\"hljs-string\">'#00b4d8'</span>,\n   )\n\nax.<span class=\"hljs-title function_\">text</span>(\n      np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">argmax</span>()+<span class=\"hljs-number\">60</span>, np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">max</span>()+<span class=\"hljs-number\">0.1</span>,\n      f<span class=\"hljs-string\">'{round(np.array(all_loss_G).max(),1)}'</span>,\n      fontsize=<span class=\"hljs-number\">13</span>, color=<span class=\"hljs-string\">'#bc6c25'</span>,\n      font=font,\n      ax=ax[<span class=\"hljs-number\">0</span>]\n   )\nax.<span class=\"hljs-title function_\">text</span>(\n      np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">argmin</span>()+<span class=\"hljs-number\">60</span>, np.<span class=\"hljs-title function_\">array</span>(all_loss_G).<span class=\"hljs-title function_\">min</span>()-<span class=\"hljs-number\">0.1</span>,\n      f<span class=\"hljs-string\">'{round(np.array(all_loss_G).min(),1)}'</span>,\n      fontsize=<span class=\"hljs-number\">13</span>, color=<span class=\"hljs-string\">'#bc6c25'</span>,\n      font=font,\n      ax=ax[<span class=\"hljs-number\">0</span>]\n   )\n\nax.<span class=\"hljs-title function_\">text</span>(\n      np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">argmax</span>()+<span class=\"hljs-number\">60</span>, np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">max</span>()+<span class=\"hljs-number\">0.01</span>,\n      f<span class=\"hljs-string\">'{round(np.array(all_loss_D).max(),1)}'</span>,\n      fontsize=<span class=\"hljs-number\">13</span>, color=<span class=\"hljs-string\">'#00b4d8'</span>,\n      font=font,\n      ax=ax[<span class=\"hljs-number\">1</span>]\n   )\nax.<span class=\"hljs-title function_\">text</span>(\n      np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">argmin</span>()+<span class=\"hljs-number\">60</span>, np.<span class=\"hljs-title function_\">array</span>(all_loss_D).<span class=\"hljs-title function_\">min</span>()-<span class=\"hljs-number\">0.005</span>,\n      f<span class=\"hljs-string\">'{round(np.array(all_loss_D).min(),1)}'</span>,\n      fontsize=<span class=\"hljs-number\">13</span>, color=<span class=\"hljs-string\">'#00b4d8'</span>,\n      font=font,\n      ax=ax[<span class=\"hljs-number\">1</span>]\n   )\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-number\">2</span>):\n    ax[i].<span class=\"hljs-title function_\">tick_params</span>(axis=<span class=\"hljs-string\">'x'</span>, colors=<span class=\"hljs-string\">'white'</span>)\n    ax[i].<span class=\"hljs-title function_\">tick_params</span>(axis=<span class=\"hljs-string\">'y'</span>, colors=<span class=\"hljs-string\">'white'</span>)\n    ax[i].<span class=\"hljs-property\">spines</span>[<span class=\"hljs-string\">'left'</span>].<span class=\"hljs-title function_\">set_color</span>(<span class=\"hljs-string\">'white'</span>) \n    ax[i].<span class=\"hljs-property\">spines</span>[<span class=\"hljs-string\">'bottom'</span>].<span class=\"hljs-title function_\">set_color</span>(<span class=\"hljs-string\">'white'</span>) \n    ax[i].<span class=\"hljs-title function_\">set_xlabel</span>(<span class=\"hljs-string\">'Epoch'</span>, color=<span class=\"hljs-string\">'white'</span>, fontproperties=font, fontsize=<span class=\"hljs-number\">13</span>)\n    ax[i].<span class=\"hljs-title function_\">set_ylabel</span>(<span class=\"hljs-string\">'Loss'</span>, color=<span class=\"hljs-string\">'white'</span>, fontproperties=font, fontsize=<span class=\"hljs-number\">13</span>)\n\nax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">'Generator'</span>, color=<span class=\"hljs-string\">'white'</span>, fontproperties=font, fontsize=<span class=\"hljs-number\">18</span>)\nax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">'Discriminator'</span>, color=<span class=\"hljs-string\">'white'</span>, fontproperties=font, fontsize=<span class=\"hljs-number\">18</span>)\nplt.<span class=\"hljs-title function_\">savefig</span>(<span class=\"hljs-string\">'Loss.jpg'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n# ax[<span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">set_axis_off</span>()\n# ax[<span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">set_axis_off</span>()\n</code></pre>\n<p>ë˜í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ì—ì„œ ì„ì˜ì˜ ìƒ˜í”Œì„ ì‹œê°í™”í• ê²Œìš”:</p>\n<pre><code class=\"hljs language-js\">random.<span class=\"hljs-title class_\">Random</span>(<span class=\"hljs-number\">2</span>).<span class=\"hljs-title function_\">shuffle</span>(test_target_img_path)\nrandom.<span class=\"hljs-title class_\">Random</span>(<span class=\"hljs-number\">2</span>).<span class=\"hljs-title function_\">shuffle</span>(test_input_img_paths)\nsubset_loader = <span class=\"hljs-title function_\">dataset</span>(batch_size=<span class=\"hljs-number\">5</span>, img_size=img_size, images_paths=test_input_img_paths,\n                        targets=test_target_img_path)\ngenerator = <span class=\"hljs-title class_\">UNet</span>()\ngenerator.<span class=\"hljs-title function_\">load_state_dict</span>(torch.<span class=\"hljs-title function_\">load</span>(<span class=\"hljs-string\">'generator.pth'</span>))\n\ngenerator.<span class=\"hljs-built_in\">eval</span>()\n<span class=\"hljs-keyword\">for</span> X, y <span class=\"hljs-keyword\">in</span> <span class=\"hljs-attr\">subset_loader</span>:\n    fig, axes = plt.<span class=\"hljs-title function_\">subplots</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">3</span>, figsize=(<span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">9</span>))\n\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-number\">5</span>):\n        axes[i, <span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(X.<span class=\"hljs-title function_\">numpy</span>()[i], (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>)))\n        axes[i, <span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"Input\"</span>)\n        axes[i, <span class=\"hljs-number\">0</span>].<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\n        \n        axes[i, <span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(y.<span class=\"hljs-title function_\">numpy</span>()[i], (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>)))\n        axes[i, <span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"Target\"</span>)\n        axes[i, <span class=\"hljs-number\">1</span>].<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\n        \n        generated_image = <span class=\"hljs-title function_\">generator</span>(X[i].<span class=\"hljs-title function_\">unsqueeze</span>(<span class=\"hljs-number\">0</span>)).<span class=\"hljs-title function_\">detach</span>().<span class=\"hljs-title function_\">numpy</span>()[<span class=\"hljs-number\">0</span>]\n        axes[i, <span class=\"hljs-number\">2</span>].<span class=\"hljs-title function_\">imshow</span>(np.<span class=\"hljs-title function_\">transpose</span>(generated_image, (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>)))\n        axes[i, <span class=\"hljs-number\">2</span>].<span class=\"hljs-title function_\">set_title</span>(<span class=\"hljs-string\">\"Generated\"</span>)\n        axes[i, <span class=\"hljs-number\">2</span>].<span class=\"hljs-title function_\">axis</span>(<span class=\"hljs-string\">'off'</span>)\n    \n    # ë ˆì´ì•„ì›ƒ ì¡°ì •\n    plt.<span class=\"hljs-title function_\">tight_layout</span>()\n    plt.<span class=\"hljs-title function_\">savefig</span>(<span class=\"hljs-string\">'Test.jpg'</span>)\n    plt.<span class=\"hljs-title function_\">show</span>()\n    <span class=\"hljs-keyword\">break</span> \n</code></pre>\n<p>ì—¬ê¸°ì„œ ë³´ì‹œë‹¤ì‹œí”¼, ê²°ê³¼ëŠ” ì™„ë²½í•˜ì§€ ì•Šê³  ë•…ì»¤ë²„ ìœ í˜•ì— ë§¤ìš° ì˜ì¡´í•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³ , êµ¬ì¶•ëœ ëª¨ë¸ì€ ì´ë¯¸ì§€ì—ì„œ êµ¬ë¦„ì„ ì œê±°í•˜ë©°, G ë° D ê¹Šì´ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒìœ¼ë¡œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìœ ë§í•œ ì „ëµì€ ì„œë¡œ ë‹¤ë¥¸ ë•…ì»¤ë²„ ìœ í˜•ì„ ìœ„í•´ ë³„ë„ì˜ ëª¨ë¸ì„ í›ˆë ¨ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‘ë¬¼ë°­ê³¼ ë¬¼ íˆ¬êµ¬ëŠ” ë¶„ëª…íˆ ë‹¤ë¥¸ ê³µê°„ì  íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜í™” ëª¨ë¸ì˜ ëŠ¥ë ¥ì— ì˜í–¥ì„ ì£¼ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ ê¸°ì‚¬ê°€ ì§€ë¦¬ì •ë³´ ë„ë©”ì¸ì—ì„œ ì‹¬ì¸µ í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•˜ëŠ” ë° ìƒˆë¡œìš´ ì‹œê°ì„ ì œê³µí•´ ë“œë ¸ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ë‚´ ìƒê°ì—ëŠ”, GANsëŠ” ë°ì´í„° ê³¼í•™ìê°€ í™œìš©í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ê°•ë ¥í•œ ë„êµ¬ ì¤‘ í•˜ë‚˜ì´ë©°, ì—¬ëŸ¬ë¶„ì˜ ë„êµ¬ ìƒìì˜ í•„ìˆ˜ì ì¸ ë¶€ë¶„ì´ ë˜ê¸¸ í¬ë§í•©ë‹ˆë‹¤!</p>\n<p>===========================================</p>\n<p>ì°¸ê³ ë¬¸í—Œ:</p>\n<ol>\n<li>\n<p>Goodfellow, Ian, Jean Pouget-Abadie, Mehdi Mirza, Bing Xu, David Warde-Farley, Sherjil Ozair, Aaron Courville ë° Yoshua Bengio. â€œGenerative adversarial nets.â€ Advances in neural information processing systems 27 (2014). <a href=\"https://proceedings.neurips.cc/paper_files/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf\" rel=\"nofollow\" target=\"_blank\">ë…¼ë¬¸ ë§í¬</a></p>\n</li>\n<li>\n<p>Helber, Patrick, Benjamin Bischke, Andreas Dengel ë° Damian Borth. â€œEurosat: A novel dataset and deep learning benchmark for land use and land cover classification.â€ IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing 12, no. 7 (2019): 2217â€“2226. <a href=\"https://arxiv.org/pdf/1709.00029\" rel=\"nofollow\" target=\"_blank\">ë…¼ë¬¸ ë§í¬</a></p>\n</li>\n<li>\n<p>Wen, Xue, Zongxu Pan, Yuxin Hu ë° Jiayin Liu. â€œGenerative adversarial learning in YUV color space for thin cloud removal on satellite imagery.â€ Remote Sensing 13, no. 6 (2021): 1079. <a href=\"https://www.mdpi.com/2072-4292/13/6/1079\" rel=\"nofollow\" target=\"_blank\">ë…¼ë¬¸ ë§í¬</a></p>\n</li>\n</ol>\n<ol start=\"5\">\n<li>\n<p>Ronneberger, Olaf, Philipp Fischer, and Thomas Brox. â€œU-net: Convolutional networks for biomedical image segmentation.â€ In Medical image computing and computer-assisted interventionâ€“MICCAI 2015: 18th international conference, Munich, Germany, October 5â€“9, 2015, proceedings, part III 18, pp. 234â€“241. Springer International Publishing, 2015. <a href=\"https://arxiv.org/pdf/1505.04597\" rel=\"nofollow\" target=\"_blank\">Link</a></p>\n</li>\n<li>\n<p>He, Kaiming, et al. â€œDeep residual learning for image recognition.â€ Proceedings of the IEEE conference on computer vision and pattern recognition. 2016. <a href=\"https://openaccess.thecvf.com/content_cvpr_2016/papers/He_Deep_Residual_Learning_CVPR_2016_paper.pdf\" rel=\"nofollow\" target=\"_blank\">Link</a></p>\n</li>\n</ol>\n<p>===========================================</p>\n<p>ì œ Mediumì˜ ëª¨ë“  ê²Œì‹œë¬¼ì€ ë¬´ë£Œì´ë©° ê³µê°œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì—¬ê¸°ì„œ ì €ë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì‹œë©´ ì •ë§ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!</p>\n<p>P.s. ì €ëŠ” (ì§€ë¦¬)ë°ì´í„° ê³¼í•™, ë¨¸ì‹  ëŸ¬ë‹/ì¸ê³µì§€ëŠ¥, ê¸°í›„ ë³€í™”ì— ëŒ€í•´ ì—´ì •ì ìœ¼ë¡œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì–´ë–¤ í”„ë¡œì íŠ¸ì—ì„œ í•¨ê»˜ ì‘ì—…í•˜ê³  ì‹¶ë‹¤ë©´ LinkedInì—ì„œ ì—°ë½ ì£¼ì„¸ìš”.</p>\n<p>ğŸ›°ï¸ë” ë§ì€ ì†Œì‹ì„ ë°›ì•„ë³´ë ¤ë©´ íŒ”ë¡œìš°í•˜ì„¸ìš”!ğŸ›°ï¸</p>\n</body>\n</html>\n"},"__N_SSG":true}