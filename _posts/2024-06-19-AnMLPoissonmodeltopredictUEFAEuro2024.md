---
title: "UEFA Euro 2024를 예측하기 위한 ML  포아송 모델"
description: ""
coverImage: "/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_0.png"
date: 2024-06-19 09:20
ogImage: 
  url: /assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_0.png
tag: Tech
originalTitle: "An ML — Poisson model to predict UEFA Euro 2024"
link: "https://medium.com/ai-mind-labs/a-machine-learning-poisson-model-to-predict-uefa-euro-2024-d7b22bacc06e"
---


<img src="/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_0.png" />

2022 월드컵 이브에 제가 "기계 학습으로 2022 FIFA 월드컵 예측"이라는 기사를 여기에 게시했습니다. 이 기사는 제 첫 번째이자 지금까지 제가 Medium에서 가장 많이 읽힌 기사였습니다. 이 기사는 제게 매우 중요해서, 2022년 말부터 이어온 데이터 과학자로서 스포츠 분석에 중점을 둔 역할로 직업을 바꿨습니다. 하지만 긍정적인 반향이 있음에도 불구하고, 그 모델의 많은 부분을 개선할 수 있다고 믿었습니다.

스포츠 분석 업무를 하면서 그 분야의 최신 동향을 많이 연구하게 되었고, 결과 예측에 대한 연구가 많았습니다. 대부분의 연구는 정확한 결과 또는 경기 승자를 예측하기 위해 포아송 분포를 사용합니다. 포아송 분포를 개선하려는 많은 연구가 있는데, 그 중에서도 최적 λ 매개변수(포아송의 기대값)를 선택하려는 연구가 많았습니다. 대부분의 연구는 간단한 골 평균/이동 평균을 사용하지 않도록 공격력과 수비력과 같은 지표를 개발했습니다. 이러한 접근법은 한계가 있다고 생각했고, 나는 직접 기계 학습 회귀 모델을 사용하여 λ 매개변수를 찾아내는 모델을 만들어, 홈팀과 원정팀 각각의 승리 확률을 계산하기로 결정했습니다.

최적의 λ 매개변수를 찾기 위해, 나의 회귀 모델은 홈팀과 원정팀이 경기에서 할 골의 예상 수를 예측했습니다. 각 팀의 예측된 값은 포아송 분포에서 λ로 사용되었습니다.

<div class="content-ad"></div>

```markdown
![그림](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_1.png)

유로 대회에 대해 왜 그렇게 하나요? 먼저, 저는 4년마다 열리는 국제 대회를 좋아합니다. 또한, 국제 대회는 "공격 강도"라는 간단하고 일반적인 계산에 결합될 수 있는 매개변수가 있습니다. 이는 국가대표팀의 FIFA 순위입니다.

# 데이터 출처

2022년 월드컵 예측에 사용한 동일한 데이터셋을 사용했습니다: 지난 경기와 FIFA 순위. 둘 다 Kaggle에서 찾을 수 있으며, 결과는 2024년 6월 11일까지의 경기 결과가 포함되어 있습니다. 이 모델에서는 2019년 8월 1일 이후의 결과를 사용했습니다.
```

<div class="content-ad"></div>

ML 모델의 성능을 많이 향상시킬 수 있어요. 예상 골 같은 고급 축구 데이터와 슛, 코너, 그리고 프리킥과 같은 통계를 사용해 보면 좋을 거에요. 문제는 국제 경기용 이런 종류의 데이터를 구하는 것이 꽤 어렵다는 거죠.

# 피쳐 엔지니어링

피쳐 개발은 2022 월드컵 프로젝트에서 했던 것과 동일했어요. 거의 동일한 코드를 사용했지만 팀의 골과 랭킹 차이에 가중치를 부여하지 않고 새로운 피처 세트를 만들었어요:

- home_weight_goals & away_weight_goals: 팀이 넣은 평균 골에 랭킹 차이를 곱한 값
- home_weight_points & away_weight_points: 팀이 획득한 평균 포인트에 랭킹 차이를 곱한 값

<div class="content-ad"></div>

또한 랭크 차이에 의한 가중치 버전의 골을 5경기 이동 평균으로 만들었습니다.

이전 프로젝트인 2022 월드컵은 국제 경기에서 FIFA 랭킹이 좋은 예측 요인임을 보여줬습니다. 또한 팀 랭킹 간의 차이가 더 나은 예측자임을 알 수 있었습니다. 현재 골 수를 예측하는 문제에서는 팀 골과 상대편 골을 조합한 평균이 좋은 예측자일 가능성이 높습니다. 그래서 두 가지를 결합하기로 결정했습니다.

# 데이터 분석

다음 단계는 데이터를 분석하여 모델에 예측력이 있는 특성을 선택하는 것입니다. 현재 모델의 목적은 홈팀과 어웨이팀의 골 수를 예측하는 것이므로 WC 2022 예측 기사에서 만든 분석은 사용할 수 없지만, Rank 차이가 좋은 예측자임을 알 수 있었습니다.

<div class="content-ad"></div>

첫 번째 분석은 가능한 특징과 목표(홈/원정에서 기록한 득점) 사이의 선형 회귀 그래프를 만들 것입니다. 이를 통해 우리는 가능한 선형 관계를 찾을 수 있을 것입니다.

경기에서의 득점은 매우 제한된 범위 내에서 연속 변수이므로(팀이 경기에서 기록할 수 있는 최소 득점은 0이고, 한 팀이 경기에서 6개 이상의 득점을 기록하는 것은 매우 드물다), 저는 또한 목표 수가 높은 예측력을 가질 가능성이 있는 변수의 분포에 득점 수가 어떤 영향을 미치는지 분석할 것입니다. 예를 들어 팀 득점 평균치 등.

![이미지1](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_2.png)

![이미지2](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_3.png)

<div class="content-ad"></div>

아래 그림은 홈 팀에 대한 첫 번째 분석을 보여줍니다. 예상대로, 어떤 특성도 명확한 선형 관계가 없었지만, 랭크 차이와 랭크 차이로 가중된 특성이 시각적으로 가장 영향을 받은 것으로 나타났습니다. 그래서 저는 이들 특성이 경기에서의 득점 수에 어떻게 영향을 받는지 확인해 보려고 합니다.

위의 그림은 랭크 차이로 가중된 홈 팀의 평균 득점을 보여줍니다. 0, 1, 2, 3골 사이를 구분할 때 주로 득점 수에 영향을 받는 분포가 명확히 보입니다. 이는 또한 랭크 차이로 가중된 원정팀이 입은 평균 골과 홈팀과 원정팀이 획득한 점수 평균에도 동일하게 나타납니다. 이러한 특성들의 5경기 이동 평균 버전은 득점 수에 크게 영향을 받지 않습니다.

<div class="content-ad"></div>

이것은 우리에게 어떤 일이 발생할 것인지에 대한 단서를 제공합니다. 그럼, 가중 특징으로만 가득 찬 평균만 사용하여 테스트하겠습니다.

![이미지](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_6.png)

결과는 상당히 유사하지만, 예상대로 반대 방향입니다. 홈 팀보다 랭킹이 낮은 원정 팀이 더 강한 팀이라고 가정할 때, 원정 모델에서 양의 피처를 가지고 있으면 원정팀이 이기고, 홈 팀 모델에는 그 반대의 기대가 있습니다.

# 기계 학습 모델

<div class="content-ad"></div>

이제 기능을 갖춘 상태이므로, 홈 골과 어웨이 골을 예측하는 두 가지 모델을 개발해야 합니다. 선형 회귀, 랜덤 포레스트 회귀 및 그래디언트 부스팅 회귀 세 가지 모델을 테스트할 것입니다. 특성과 목표 간에 선형 관계가 명확하지 않기 때문에 모델 성능은 R2 스코어 대신 평균 제곱 오차(MSE)로 평가할 것입니다. 하지만 선택한 모델을 선정하는 주요 분석은 예측값의 분포와 잔차를 확인하는 것입니다.

홈 골과 어웨이 골 둘 다 랜덤 포레스트 모델을 선택했습니다.

홈 팀의 경우, 선형 회귀와 랜덤 포레스트(선택한 모델)의 분석을 보여드리겠습니다. 왜 랜덤 포레스트를 선택했는지를 설명하겠습니다. 먼저 두 모델에 대한 실제 대 예측 값의 차이를 살펴보겠습니다.

<div class="content-ad"></div>

![image](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_8.png)

두 플롯을 비교해 보면 오차의 유사한 패턴을 확인할 수 있습니다. 그러나 선형 회귀가 이 문제에서 실패하는 지점도 볼 수 있습니다. 말했듯이, 골의 수가 연속 변수임에도 불구하고 그 값의 범위가 매우 제한적입니다. 선형 회귀가 가끔 예측하는 것처럼 경기에서 0 골 미만은 가질 수 없습니다. 왜냐하면 선형 회귀 모델은 학습할 때 본 경계를 넘어서 예측을 할 수 있지만, 트리 기반 모델은 그렇지 못하기 때문입니다.

이는 종종 트리 기반 모델의 문제로 여겨지지만, 여기서는 선형 회귀 모델과 비교했을 때 큰 장점으로 여겨집니다.

물론, 선형 회귀가 예측한 값이 0 미만인 경우를 수동으로 0으로 설정할 수 있지만, 그렇게하는 것은 랜덤 포레스트보다 모델이 훨씬 좋은 성능을 발휘할 경우에만 의미가 있습니다. 그러기 위해 잔차를 분석해 보겠습니다.

<div class="content-ad"></div>

회귀 모델의 잔차는 예측값과 실제 값의 차이입니다. 우리는 위에서 볼 수 있듯 랜덤 포레스트는 홈 팀의 골을 조금 더 과소 평가합니다. 하지만 이는 음수 예측값을 해결하기 위해 선형 회귀를 사용하는데 충분한 큰 차이가 아닙니다. 그래서 저는 랜덤 포레스트를 선택했습니다.

원정팀 골 모델에서도 비슷한 분석을 진행하고 다시 랜덤 포레스트를 선택했습니다. RF와 그래디언트 부스팅 중에서는 결과가 매우 유사합니다. 저는 더 복잡한 모델로는 과적합이 발생할 수 있는 작은 데이터베이스를 사용하고 있기 때문에 계속해서 RF를 선택했습니다.

# 포아송 모델

이제 홈팀과 원정팀 분포를 예측하는 모델을 가지고 있으므로 홈 승리, 무승부 및 원정 승리의 확률을 계산할 수 있습니다.

<div class="content-ad"></div>

그것을 하기 위해, 우선 독일과 스코틀랜드의 UEFA 유로 첫 번째 경기 예시로 0~10 골에 대한 포아송 확률을 계산합니다.

이제 각 팀이 0~10 골을 넣는 확률을 가지고 있으므로, 각 정확한 결과의 확률을 계산할 수 있습니다. 아래 표에 표시되어 있습니다:

```markdown
| 골 수 | 스코틀랜드 승 확률 | 독일 승 확률 | 무승부 확률 |
|-------|-------------------|-------------|-------------|
|   0   |      0.100        |    0.200    |   0.150     |
|   1   |      0.150        |    0.180    |   0.100     |
|   2   |      0.120        |    0.150    |   0.080     |
|  ...  |       ...         |     ...     |    ...      |
```

빨간색으로 표시된 것은 스코틀랜드가 이기는 시나리오의 확률입니다. 초록색으로 표시된 것은 독일이 이기는 시나리오이고, 노란색은 무승부입니다. 독일이 이기는 확률, 무승부 확률, 스코틀랜드가 이기는 확률을 알기 위해 매트릭스의 각 부분을 합산합니다.

<div class="content-ad"></div>

```markdown
![image](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_10.png)

# 시뮬레이션

이제 모든 모델이 준비되었으니, 재미있는 부분에 들어갈 시간이에요. 게임을 시뮬레이션하기 위해, 그룹 단계의 각 경기에 대한 골의 기대값을 예측합니다. 그러나 문제가 하나 있어요. 모델은 분명히 많은 비김을 과소 평가합니다. 그래서, 이것을 조정하기 위해 비김에 보정을 주기로 했어요. 각 팀의 확률에서 5%를 제거하고 이를 비김 확률에 추가했어요.

시뮬레이션된 경기의 결과는 아래에 표시되어 있어요:
```

<div class="content-ad"></div>

그룹 스테이지 시뮬레이션을 완료한 후, 그룹 경기 결과를 계산했습니다. 아래는 모든 그룹을 포함한 전체 테이블입니다:

프랑스가 네덜란드와 이탈리아에 패배하며, 타이틀 수비자인 이탈리아가 크로아티아 뒤에 머물게 된 것이 가장 큰 놀란 점 같아요. 위에서 보시다시피, 최고의 3위 팀들을 이미 계산한 상태입니다.

이제는 챔피언십 스테이지를 시뮬레이션해야 합니다. UEFA Euro는 여러분이 여기서 찾아볼 수 있는 매우 독특한 매치 조합을 가지고 있습니다. 이것은 제 분석을 위한 코드 기반이 되었고, 아래에는 WC 2022 시뮬레이션을 위해 만든 동일한 차트에 결과가 표시되어 있습니다:

<div class="content-ad"></div>

```markdown
![모델_스코어](/assets/img/2024-06-19-AnMLPoissonmodeltopredictUEFAEuro2024_12.png)

프랑스가 예측된 우승팀이라는 것을 볼 수 있습니다. 이것은 매우 현실적이라고 생각합니다. 벨기에가 준우승했고, 특히 반 결승에서 잉글랜드를 꺾고 매우 치열한 경기를 치렀다는 점에서 놀라운 일이라고 생각합니다.

# 결론

프로젝트의 취지는 내가 가장 좋아하는 축구를 예측하기 위해 데이터 과학과 ML 지식을 활용하는 것이었습니다. 그러나 이번에는 제 첫 번째 모델이 갖고 있던 일부 결함도 수정하고자 했습니다. 예를 들어, 2022 월드컵 모델은 무승부를 예측하지 않았습니다!
```

<div class="content-ad"></div>

저는 이 목표가 달성되었다고 생각해요. 이 모델은 더 많은 과학적 근거를 바탕으로 하며 축구 예측의 최신 기술을 많이 반영하고 있어요. 또한, 이 모델은 다양한 용도로 활용할 수 있어요. 예를 들어, 한 경기에서 3골 이상이 나올 확률을 얻는 것이 가능해요.

자세한 코드를 보고 싶다면 GitHub 저장소를 확인해주세요. 제 LinkedIn으로 연락하고 싶다면, 그게 저의 LinkedIn이에요. 감사합니다!

## AI Mind로부터의 메시지

<img src="https://miro.medium.com/v2/resize:fit:500/0*5Wm7sOfTpe5DEbhg.gif" />

<div class="content-ad"></div>

우리 커뮤니티에 참여해 주셔서 감사합니다! 떠나시기 전에:

- 👏 이야기에 박수를 보내고 저자를 팔로우하세요 👉
- 📰 AI Mind 판에서 더 많은 콘텐츠를 확인하세요
- 🧠 무료로 AI 프롬프트를 손쉽게 향상하세요
- 🧰 직관적인 AI 도구를 발견하세요