---
title: "애플의 고페치 쉽게 해결되지 않는 취약성"
description: ""
coverImage: "/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_0.png"
date: 2024-05-27 15:37
ogImage:
  url: /assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_0.png
tag: Tech
originalTitle: "Apple GoFetch: The Vulnerability Which is Not Easy To Fix"
link: "https://medium.com/asecuritysite-when-bob-met-alice/apple-gofetch-the-vulnerability-which-is-not-easy-to-fix-2c4e6229a2cb"
---


![Secure Enclave](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_0.png)

고객님의 가장 민감한 비밀, 즉 식별하고 컴퓨터를 식별하는 개인 키와 같은 것들은 안전한 사물함에 저장됩니다. 일반적으로 이는 공개 키 쌍에서의 개인 키로, 내보낸 공개 키가 해당 개인 키와 일치할 것입니다. 이후 안전한 사물함에서 비밀 키를 포함하는 처리를 할 수 있습니다:

![Secure Enclave](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_1.png)

이를 통해 Bob은 안전한 사물함에 개인 키를 저장하고 데이터의 해시에 서명하기 위해 사용할 수 있습니다. 그런 다음 Alice에게 이를 전송할 수 있고, 그녀는 이를 사용하여 그의 신원과 데이터의 무결성을 확인할 수 있습니다.


<div class="content-ad"></div>


![image](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_2.png)

Eve가 Bob의 개인 키를 잡을 수 있었다면, 그녀는 그것을 통해 Alice에게 그가 되는 척할 수 있습니다. 결국 이제 최근 Apple Macbooks에 사용된 Apple의 M-시리즈 프로세서가 사이드 채널 공격에 취약하며 비밀 키를 노출시킬 수 있다는 것이 밝혀졌습니다. 이것을 GoFetch라고 이름 지었습니다.

공격의 주요 포커스는 민감한 데이터가 주소로 사용되고 데이터를 주소로 변환할 수 있는지에 대한 것입니다. 이것은 데이터 메모리 의존적 프리패처(DMPs)에 관련되어 있으며 데이터를 메모리 주소로 변환하는 프로그램입니다. 이를 사용하여 연구 팀은 디피-헬만 키 교환과 RSA 키 그리고 포스트-양자 암호학 키(CRYSTALS-Kyber와 CRYSTALS-Dilithium)를 포함하여 캡처하는 데 성공했습니다.



![image](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_3.png)


<div class="content-ad"></div>

이것은 심각한 결함이며, 침입자가 컴퓨터로부터 가장 민감한 기밀 정보를 발견하고 컴퓨터와 컴퓨터 소유자를 모방할 수 있게 합니다. 불행히도, 프로세서의 마이크로아키텍처 설계와 관련이 있기 때문에 이를 수정하는 것이 쉽지 않습니다. 대안으로는 서드파티 암호화 라이브러리를 사용하고 소프트웨어에서 실행하는 것이 있습니다. 이는 상당한 성능 저하를 야기할 것입니다.

많은 다른 공격이 프리페처(prefetchers)를 사용했는데, 이 기능은 프로세서가 예측된 작업을 미리 확인하고 프로그램이 다음에 요청할 데이터를 메모리에 미리 로드할 수 있게 합니다. 이러한 작업은 암호화 작업의 운영을 공개할 수 있습니다. 일반적으로 암호화는 일정한 시간 응답을 가지도록 설계되어 있으며, 암호화 작업 처리 시 사용된 작업에 대한 정보를 발견할 수 없습니다. 새로운 연구 결과에 따르면 프로세서가 메모리 콘텐츠를 암호화 키로 인식하고 메모리 포인터 값으로 혼동시킬 수 있다는 것을 안내해줍니다. 포인터의 역참조가 그러면 암호화 키를 드러낼 수 있습니다.

# 암호 누출

보안 커뮤니티에서는 놀라운 암호화 알고리즘을 만들었지만, 결국 모든 비트는 실리콘과 금속에 모두 저장되고, 침입자들이 키를 해독하기 위해 모니터를 설치할 가능성이 점점 높아지고 있습니다.

<div class="content-ad"></div>

암호화 키의 해독은 종종 무차별 대입 방법이나 구현상의 결함을 대상으로 하게 됩니다. 그러나 물리적인 사이드 채널 공격에 증가하는 관심이 있습니다. 여기에는 전자기 방사선, 전력소비, 전기 전압 변동, 심지어 소리 및 열 변화와 같은 암호화 정보의 무의도한 정보 누출이 포함됩니다. 현재는 몇 회사만 사이드 채널 공격으로부터 장치를 보호하고 있습니다. 특히 이는 비용이 많이 들며 복잡한 장비로의 광범위한 테스트가 필요하기 때문입니다.

장치 또한 점점 빨라지고 있는데, 그러면서 더 많은 라디오와 전자기(EM) 방사를 방출하는 경향이 있습니다. 예를 들어 2GHz 프로세서는 우리의 Wi-Fi 신호(2.4 GHz)와 동일한 주파수에서 작동하며, 종종 칩은 라디오파를 방출하지 않도록 보호되지 않습니다. 이는 장치의 빠른 작동의 자연적인 부산물입니다. 이러한 높은 주파수에서는 EM 방사를 막기 어렵기 때문에 주위의 배선 및 다른 회로로의 결합을 막는 것이 종종 어려울 수 있습니다.

<div class="content-ad"></div>

보안 연구원들이 최근 GnuPG 암호 라이브러리에서 취약점을 발견했습니다. 이 취약점으로 1,024비트 공개 키를 해독하고 해당 개인 키를 찾아 비밀 데이터를 해독할 수 있었습니다. GnuPG는 암호학을 위한 표준 오픈 소스 라이브러리이며 Windows, Mac 및 Linux 시스템에서 사용됩니다.

취약점은 CVE-2017-7526 ID를 부여받았으며 로컬 FLUSH+RELOAD 사이드 채널 공격으로 공격됩니다. 이 때 "왼쪽에서 오른쪽으로 이동하는 슬라이딩 윈도우" 방법으로 지수 비트에 대한 정보가 누설되어 전체 키가 복원됩니다. 캐시 메모리에 개인 RSA 키가 저장되어 있는 Level 3 캐시 사이드 채널 공격이 관련되어 있습니다.

공격자는 캐시의 메모리 사용량을 관찰하거나 (또는 복호화 과정 중 방출되는 전자기 방사를 통해) 정보를 얻습니다. 물리적 머신에서는 어려울 수 있지만, 연구원들은 한 가상 머신에서 다른 가상 머신으로 키를 추출할 수 있다고 설명합니다. 또한 2,048비트 RSA가 동일한 방법으로 해독될 수 있지만, 더 많은 컴퓨팅 자원이 필요할 것으로 예상됩니다.

<div class="content-ad"></div>

# 1,024비트 키가 현재의 전류에 떨어진다

현재 RSA 해킹의 한계는 768비트 키에 대한 것이며 모듈러스(N)의 인수분해를 사용하여 공격하는 방식이지만, 2010년에는 다른 방법으로 사이드 채널 공격을 사용하여 프로세서의 전류 흐름을 관찰하여 1,024비트 키를 해킹한 사례가 있습니다 (100시간 내에). [여기]

![이미지](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_6.png)

# 무선 공격

<div class="content-ad"></div>

RSA 알고리즘을 음향 방법으로 해킹하는 작업이 진행되었고, 전자기와 전압 변화도 같이 연구되고 있습니다. 이제 연구자들은 [여기]라는 논문에서 중요한 발전을 이루었습니다.

이 논문에서 저자들은 인기 있는 키 교환 방법인 ECDH (타원 곡선 디피-헬만)의 해킹을 개요하였습니다. ECDH는 Microsoft Live, Google, Facebook 등의 사이트에 연결할 때 자주 사용되는 방법 중 하나입니다.

연구에서는 ECDH 공개 키 암호화 알고리즘을 공격하고 전자기적 변화를 측정합니다. 그들은 신중히 선택된 암호문과 시간-주파수 신호 분석 기술을 사용하여 키를 해킹합니다. 이를 통해 몇 초 안에 복호화 키를 해독할 수 있으며, 다른 방에 있는 안테나로부터도 가능합니다.

![이미지](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_7.png)

<div class="content-ad"></div>

ECDH은 이제 인기있는 방법이며, 타원 곡선 방법을 사용한 Diffie-Hellman 키 교환 방법의 기본 개념이다.

## 전력 분석

칩의 전력 레일을 변조하는 작업은 암호화 키를 발견하기 위해 잘 문서화된 상태이며, 여기서 키의 보안과 보호가 감소됩니다. 또한 메모리 칩이 얼려지고 비트 상태를 유지하는 "차가운 부팅(cold boot)"에 관한 작업도 있습니다.

## SIM 카드에 대한 차등 전력 분석

<div class="content-ad"></div>

지금까지 우리는 SIM 카드가 대부분의 공격으로부터 안전하다고 생각했습니다. 그러나 상해자오퉁대학 교수 유위유는 이제 128비트 AES를 사용하는 3G/4G SIM 카드가 해킹될 수 있다는 것을 보여 주었습니다. 그래서 SIM 카드 클론의 악몽이 실현될 수도 있습니다.

SIM 암호화 키에 대한 액세스는 법 집행기관의 주요 관심사이며, 네덜란드 SIM 카드 제조업체 젬알토로부터 수십 억 개의 암호화 키가 범죄 수사관들에 의해 도난당한 의혹이 제기된 때에 이 사안이 강조되었습니다. 이러한 키는 휴대폰의 데이터와 음성 메시지에 액세스할 수 있게 합니다.

Prof 유위유 교수는 이번 블랙햇 미국 2015 발표에서 SIM 카드로부터 암호화 키를 회복하고 복제하는 미세 전력 분석 방법을 소개했습니다. 전체적으로 키를 복구하는 데 10-40분이 걸리며, 그 방법은 가장 인기 있는 SIM 카드 제조업체 중 8개에서 성공했습니다.

그는 전력 변화를 캡처하는 오실로스코프와 MP300-SC2 프로토콜 분석기, 그리고 PC를 사용하여 암호 해독을 분석합니다. 이 작업은 차등 전력 분석 (DPA)를 활용합니다. 단순한 전력 분석 (SPA)을 이용하면 프로세서가 소비하는 전력을 모니터링하여 레지스터와 데이터 버스의 내용에 대한 힌트를 얻을 수 있습니다.

<div class="content-ad"></div>


![Image 1](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_8.png)

With DPA, chips undergo certain encryption tests. The power levels of the chips are then observed and analyzed for correlation of bit patterns used (refer to Figure 2). Differences in the encryption process help to deduce the key. For instance, test data is applied with a variety of keys to the device, and power levels are monitored. Each power consumption level changes based on the chip's activity.

![Image 2](/assets/img/2024-05-27-AppleGoFetchTheVulnerabilityWhichisNotEasyToFix_9.png)

## DPA and CPA on AES cracking


<div class="content-ad"></div>

여기서 우리가 한 작업은 Arduino 장치에서 AES-128 S-box에 대한 전력 분석 공격을 사용하여 30분 미만으로 128비트 AES를 깰 수 있었습니다. 이는 차별적 전력 분석(DPA) 및 상관 전력 분석(CPA)을 활용한 것입니다. 자세한 내용은 [여기](https://youtu.be/7D-Hr4Nw0T4?t=21m30s)를 확인해주세요.

# 결론

GoFetch는 심각한 취약점이며 상당한 성능 저하 없이는 쉽게 해결되지 않습니다. 이는 애플에게 큰 비용이 들 것으로 예상됩니다.
