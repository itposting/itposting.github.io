---
title: "휴대폰, 보안 및 현대 DNS"
description: ""
coverImage: "/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_0.png"
date: 2024-06-19 04:25
ogImage: 
  url: /assets/img/2024-06-19-OnphonessecurityandthemodernDNS_0.png
tag: Tech
originalTitle: "On phones, security, and the modern DNS"
link: "https://medium.com/@raduzaharia/on-phones-security-and-the-modern-dns-5fd0887d4e86"
---


![이미지](/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_0.png)  

저는 항상 나만의 DNS 서버를 가지고 싶었어요. 가능한 모든 인터넷 쿼리를 위해가 아니라, 제가 원하는 것만을 위해서죠. 가정 기기를 주소 지정할 때 IP를 사용하는 것을 피하고, 전체 홈 네트워크에 구성한 서비스에 이름을 부여하는 것을 좋아해요. 물론, 이를 위한 여러 가지 방법이 있어요. 모든 데스크톱 플랫폼에는 이름과 주소를 연결할 수 있는 호스트 파일이 있어요. 예를 들어 뮤직.my.com을 192.168.1.15로 연결하는 것처럼 말이죠. 이 방법은 훌륭하지만, 모든 데스크톱에서 파일을 구성해야 한다는 점이 단점이에요.

우리는 이전에 언급했던 mDNS를 사용할 수도 있어요. 이는 네트워크의 모든 장치를 가져와 pc-radu.local과 같이 로컬로 끝나는 도메인에 응답할 수 있는 멀티캐스트 네트워크를 생성해요. 하지만 이 방법이 바로 우리가 원하는 것은 아니에요. 확실히 장치들이 응답하고, 우리는 불투명한 IP 대신 멋진 이름을 얻을 수 있겠지만, 항상 장치를 대상으로 하려는 것은 아니에요. 서비스는 다른 설정이 필요하며 music.local이나 music.pc-radu.local로 응답하지 않을 거예요.

또한 가지고 있는 도메인을 사서 DNS를 구성하고, A 레코드를 사용하여 music.my.com이 192.168.1.15와 일치하도록 할 수 있어요. 네, 로컬 IP 주소에 도메인을 지정하기 위해 전체 공개 인터넷 DNS 설정을 사용하는 것은 어리석은 일이라고 볼 수 있고, 가정의 장치와 서비스를 더 나은 이름으로 지정하기 위해 전체 도메인을 구매하는 것은 더욱 어리석은 일이지만, 어리석기는 해도요, 오늘 우리가 가진 최고의 네이밍 옵션이에요. 이전에 다른 옵션이 있었지만, 그 마지막 날이 다가오고 있다고 우려되요. 그것에 대해 이야기해봐요.

<div class="content-ad"></div>

## 개인 DNS 서버

![이미지](/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_1.png)

DNS는 인터넷 거물들만의 전유물이 아닙니다. 앞서 살펴본 것처럼, 도메인을 IP 주소로 해석하는 것은 호스트 파일을 편집하는 것만큼 쉽습니다. 그리고 이를 수행하는 홈 서버를 갖는 것은 큰 문제가 아닙니다. 쉬운 옵션을 원한다면, 시중에 나와 있는 NAS(Network-Attached Storage) 장치들은 모두 몇 분 안에 설치하고 구성할 수 있는 DNS 서버 응용프로그램을 제공합니다.

예를 들어, Synology는 설정이 매우 쉬운 DNS 서버를 제공하는데, 여기서는 기본 영역을 생성하고 리소스 레코드를 편집하면 됩니다. 잘못된 작업을 할 수 없게 하고 모든 작업들이 잘 설명되어 있습니다. 터미널에 접근할 필요가 없고 구성 파일을 수동으로 편집할 필요도 없는 절대 초보자 친화적인 도구입니다. 또한, ASUS 등 다른 기업들도 유사하거나 더 나은 DNS 서버를 가지고 있을 것입니다.

<div class="content-ad"></div>

DNS 서버를 구성하면 DHCP를 통해 광고하여, 가정 네트워크에 참여하는 모든 기기가 기본 존 도메인을 위해 먼저 이를 쿼리할 수 있게 됩니다. 즉, 라우터를 설정하여 기본 DNS를 NAS IP로, 보조 DNS를 클라우드플레어 또는 원하는 곳으로 지정합니다. DNS 서버 도메인에 대한 모든 요청은 해당 서버를 통해 해결되고, 그 외 모든 요청은 클라우드플레어를 통해 처리됩니다.

이것은 완벽한 시나리오입니다. 도메인을 구입할 필요도 없고, 가정에 사용할 도메인을 자유롭게 선택할 수 있습니다. 심지어 다른 사람이 구매한 도메인에 대해서도 선택이 가능하며, 가정 네트워크에 있는 모든 기기는 가정 도메인을 요청할 때 우리 서비스를 가리키게 됩니다.

## 그러나...

![이미지](/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_2.png)

<div class="content-ad"></div>

그건 사소한 문제가 아니고 앞으로 홈 DNS 서버를 설정하는 것에 대해 이야기할 수도 있지만, 별로 복잡하지 않아요. DNS 서버와 DHCP 서버를 설정해야 하는 두 가지가 있는데, NAS와 좋은 라우터를 사용하면 몇 번의 클릭으로 끝낼 수 있거든요. 하지만 이에 대해 이야기해야 할 중요한 점이 하나 있어요.

모든 것을 구성한 후에는 네트워크의 모든 데스크톱이 새로운 프로세스를 충실히 따르게 됩니다: music.my.com에 액세스하려면 이 이름의 IP 주소를 요청하고 192.168.1.15를 받아오게 될 거예요. 이후로 간단합니다: 경로가 캐시되어 더 이상의 요청은 그곳으로 직행하게 될 거예요. 좋은 SSL 인증서도 가져오면 인터넷 전체에서 볼 수 있는 완전히 안전한 웹 경험을 얻을 수 있을 거예요. 하지만 핸드폰 브라우저에서 동일한 것을 시도해 보면 몇 번의 탭만에 모든 것이 무너지는 것을 보게 될 거예요.

핸드폰이 홈 네트워크에서 동일한 DHCP 서버를 사용하고 동일한 주 DNS와 보조 DNS를 얻더라도, 네트워크 정보 애플리케이션으로 올바르게 구성되어 있는지 확인할 수 있더라도 브라우저는 간단히 music.my.com에 대해 아무것도 모른다고 대답할 거예요. 더 나쁜 것은, 이해하고 디버그하기 어렵습니다. 데스크톱은 홈 DNS를 따르지만 핸드폰은 그렇지 않아요. 그렇지만 핸드폰 자체에서는 올바르게 보고 있다고 밝히고 있지만 말이에요.

이걸 이해하는 데 시간이 좀 걸렸어요. 한 번 핸드폰 브라우저에서 성공적으로 music.my.com을 로드했다면, 핸드폰에 경로가 캐시될 수 있고 잘 작동할지도 모릅니다. 웹 페이지는 브라우저에 캐시될 수 있고 사이트가 잘 로드되는 것을 볼 수도 있겠죠. 브라우저에서 시크릿 모드를 사용해야 하고, 핸드폰의 DNS 캐시를 비우기 위해 재부팅하거나 비행기 모드로 전환한 다음 다시 켜야 합니다. 적어도 그렇게 처리하면 된다고 들었어요.

<div class="content-ad"></div>

## 그리고, 쇼스토퍼

<img src="/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_3.png" />

모든 것이 명백하다면, 웹과 DNS 캐시 모두가 명확하다면, 데스크톱이 music.my.com에 응답한다면, 데스크톱과 동일한 DNS를 사용하는 폰을 여러 앱으로 확인해봤는데, 폰 브라우저에 주소를 입력해도 페이지가 로드되지 않을 것입니다. 기본적으로 앱 스토어에서 설치된 어떤 브라우저도 페이지를로드하지 않습니다. iOS든 Android든 말입니다. 리눅스 폰은 제외입니다. 리눅스 폰은 동작할 것입니다. 하지만 저희는 지금 리눅스 폰이 없습니다, 맞죠?

그래서 무슨 일이 벌어졌을까요? 이것은 사실입니다. 본문은 폰, NAS, 라우터, 홈 서버, 그리고 내 홈 네트워크에 있는 여러 데스크톱을 걸쳐 수주간 동안의 지속적인 조사와 탐구로부터 온 풍부한 지식의 결과입니다. 그리고 모든 것이 당연히 DNS로 시작되고 끝납니다. music.my.com을 모든 데스크탑이 로드할 수 있다는 것을 알기 때문에 DNS가 작동한다는 것을 알고 있습니다. 하지만 안드로이드든 iOS든 홈 네트워크에 있는 모바일은 작동하지 않는다는 것을 알고 있습니다.

<div class="content-ad"></div>

인터넷이 예전과는 다르다는 걸 느끼시죠. DNS 역시 예전과 달라졌습니다. 인터넷과 보안의 기초에는 엄청난 갈등이 있고, DNS는 영향을 받는 한 가지 주체에 불과합니다. 최근에 DNS over TLS와 DNS over HTTPS에 대해 계속 듣고 있습니다. 둘 다 개인 정보 보호와 보안을 강화하는 DNS 옵션입니다. 개인 정보 보호는 누군가가 방문한 URL을 가로챌 수 없기 때문에, 보안은 DNS를 변경하여 유효한 경로를 악성 경로로 바꿀 수 없기 때문에 중요합니다.

이 모든 것이 좋긴 한데, Synology의 DNS 서버는 그리 똑똑하지 않습니다. TLS 또는 HTTPS 요청을 처리하는 방법을 모릅니다. 이 문제를 겪는 유일한 제품은 아닙니다. 사실, 다양한 ISP의 많은 DNS 서버가 바람직한 인터넷의 개인 정보 보호와 보안 요구 사항을 따라가지 못했습니다. DNS는 결국 인터넷의 핵심입니다.

하지만 핸드폰은 다릅니다. iOS와 Android 모두 최신 프로토콜과 보안 기능에 대한 높은 수용력을 가지고 있습니다. 왜냐하면 둘 다 자체 생태계에 완전히 잠겨 있기 때문입니다. Android 스택을 위한 개발자는 Google 뿐입니다. 커널부터 핵심 기능, 사용자 API, 지원 API, 하드웨어 레이어, 네트워크 스택 그리고 DNS를 통한 이름 확인까지 Google이 모두 만듭니다. iOS도 Apple과 마찬가지입니다. 오늘날 Android 핸드폰의 설정 영역을 살펴보면 DNS를 검색하면 '개인 DNS'라는 재미있는 섹션을 찾을 수 있습니다. 그 옵션을 읽어보면 Android는 기본적으로 DHCP 서버가 제공한 DNS 설정을 효과적으로 무시한다는 것을 알 수 있습니다.

## 추악한 진실

<div class="content-ad"></div>

![OnphonessecurityandthemodernDNS_4](/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_4.png)

여기가 토끼굴이죠, 발견과 기대, 해결책을 찾기 위한 노력, 마침내는 절망이 가득합니다. 개인 DNS 설정을 끄고, 집의 DHCP 서버가 제공하는 DNS를 사용할 수 있어요. 물론 그대로 둘 것을 권장하는 기본 설정으로 두는 것이 더 안전할 거예요. 하지만 우리는 이를 끄고 다시 music.my.com을 로드해보죠, 새로운 희망을 품고 말이에요. 그래도 여전히 작동하지 않을 거에요.

지금은 모든 이름과 장소의 개발자들이 DNS를 더 이상 신뢰하지 않는다고요. 그렇게 안전하고 신뢰할 수 있는 DNS를 원하는데, 심지어 구글이 안전 및 개인 정보 보호 설정을 무시하는 옵션을 제공하더라도 사용자의 요청을 존중하지 않아요. 모든 핸드폰 브라우저는 자체 DNS 서버 주소를 사용하며, DHCP는 신경 쓰지 않아요. Edge는 이를 다른 사람들에게 알리지 않고 수행해요. 제가 무슨 일이 일어나고 있는지 깨닫기 위해 마이크로소프트의 다양한 기사를 찾아야 했어요. 현재 버전에 더 이상 적용되지 않는 애매한 해결책이 있고, 작동하지 않는 것도 있어요.

아마 Firefox는 최소한 더 개방적이고 사용자 정의 가능할 것이라고 생각하실 수 있어요. 하지만, 전혀 그렇지 않아요. Edge처럼 모든 웹 쿼리에 대해 완전히 다른 DNS를 사용한다는 사실을 아무도 알려주지 않아요. Brave는 기본적으로 자체 DNS 리졸버를 가지고 있지만, 적은 대신 변경할 수 있게끔 해줘요. 하지만, 알고리고 잘못한 일을 했고 그 결과를 받아야 한다고 명시적으로 알려주는 경우도 있어요.

<div class="content-ad"></div>

iOS의 Safari는 어떻게 될까요? 동일합니다: 아무것도 알려주지 않고, 프라이빗 DNS를 사용하며 변경할 수 없습니다. Chrome은 어떻게 될까요? 마찬가지입니다. Brave는 어떨까요? 마찬가지로, Android와 마찬가지로 DHCP DNS를 적용하도록 허용하기 위해 여러 동의서에 서명해야 한다는 점을 덧붙이겠습니다. 그리고 다음 Windows의 보안 개선 사항으로 DNS 잠금이 포함될 것이라고 들었을 수도 있습니다. Microsoft는 그 의미에 대해 정확히 설명하지 않았지만, Google과 Apple이 Android와 iOS를 위해 수행한 것과 유사한 일을 하게 될 것으로 생각됩니다: DHCP DNS 주소를 무시하고 자체, 프라이빗하며 안전한 TLS, HTTPS 또는 미래를 위해 개발할 새로운 프로토콜을 사용하는 것입니다.

## 이제 문제가 생겼습니다

<img src="/assets/img/2024-06-19-OnphonessecurityandthemodernDNS_5.png" />

<div class="content-ad"></div>

여러분은 다 브레이브를 사용할 겁니다. 다들 리눅스를 사용할 겁니다. 그건 대단한 일이죠. 그런데 문제는 더 나중에 발생합니다. 이 변경사항들은 우리가 모두 중요시하는 문제인 개인정보 보호와 보안 문제를 해결하기 위해 이뤄졌다는 점을 알 수 있습니다. 불행히도, 이 해결책은 열린 구성 가능성을 가진 것이 아니라, 공급업체들이 엄격하게 잠금을 거는 것으로 선택되었습니다. Windows, iOS, 안드로이드의 경우 운영 체제 공급업체, 그리고 Edge, Chrome, Brave, Firefox의 경우 애플리케이션 공급업체가 바로 이에 해당합니다.

이런 것들은 단지 브라우저에 해당하는 것들뿐입니다. 안드로이드에서 DNS 문제를 디버깅하는 동안, 여러 개의 무작위 네트워크 체커를 사용해보았는데, 그들 또한 자체 DNS 리졸버를 사용했습니다. 일부는 리졸버를 구성할 수 있게 했고, 다른 일부는 집 DNS 서버가 존재할 수 없다고 소리치기까지 했습니다. 여기서 최종 문제가 발생합니다: 집 DNS 서버를 부인함으로써. 일반적인 공급업체들이 어떤 종류의 집 서버도 부인한다고 이야기할 수도 있습니다. 이러한 이유로, 나는 내 네트워크에서 모든 기기가 인식할 수 있는 가공된 도메인을 갖지 못할 수 있습니다.

운영 체제 설정 뒤에 DNS 해결을 감추는 것은 한 가지일지라도, 응용 프로그램 수준에서 개인 및 알려지지 않은 DNS 리졸버를 사용하는 것은 다른 문제입니다. 그러나 어느 쪽도 열린 인터넷에서 일어나서는 안 됩니다. 그것이 DHCP가 존재하는 이유이며, 그것이 DNS 해결 주소를 제공하는 이유이며, 네트워크의 모든 기기가 그것을 사용하는 이유입니다: 우리가 무엇을 해결하고 싶은지를 사용자 정의할 수 있는 기회를 제공하기 위해서 입니다.

이러한 방식으로 DNS 해결을 잠그는 것은 홈 네트워크 전반에 걸쳐 사용되는 신뢰할만한 광고 차단 솔루션인 PI-Hole을 비활성화합니다. my.com에서 보여준 것과 같이 홈 메이드 도메인을 비활성화시킵니다. 사용자가 선호하는 DNS 해결 서비스를 선택하는 것을 방해합니다. 완전한 제어 하에 단일 DNS 해결을 갖도록 공급업체에게 권한을 주는 것입니다. 비록 그것이 더 개인 정보 보호 및 안전성을 강조하도록 되어 있더라도요.

<div class="content-ad"></div>

그래서 우리는 이 모든 것으로 무엇을 배웠을까요? 일단, 집 네트워크에서 기기에 이름을 지정하는 유일한 방법은 실제 도메인을 구입하고 거기에 기기 및 서비스 매핑을 위한 DNS 항목을 추가하는 것입니다. 둘째, 집 DNS 시대는 매우 가까워졌습니다. 요즘에는 전화기가 더 많이 사용되는데, 곧 데스크톱도 전화기와 같은 행동을 할 것이며, DNS가 완전히 제조사의 통제 아래 밀봉되게 될 것입니다. 셋째, 우리는 모두를 개인 정보 보호와 보안을 위해 이렇게 하는 것이죠.

알았어요, DNS over TLS나 HTTPS를 원합니다. 인터넷 쿼리에서 ISP를 멀리하고 싶어요. 브라우저 설정에 대해 알게 된 첫 순간, 그것들을 모두 활성화하고 그런 기능이 없는 브라우저를 사용하기를 거부했어요. 하지만 집에서도 DNS over TLS를 사용할 수 있어야 합니다. 제게 그것을 거부하지 마세요. DHCP로부터 받은 DNS 서버를 현재 사용 중인 것으로 표시하지 말아주세요. 저가 실제 사용 중인 DNS를 보여주세요. 적어도 그것이 무엇인지 알게 하고 확인하고 질문할 수 있도록 해주세요. 모두를 보안을 위해 가려놓지 말아주세요. 그리고 제 DNS가 아닌 것처럼 말하지 말아주세요.