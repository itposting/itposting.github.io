---
title: "세계에서 가장 강력한 SQL LLM을 구축하는 Snowflake의 방법"
description: ""
coverImage: "/assets/img/2024-05-27-HowSnowflakebuildingthemostpowerfulSQLLLMintheworld_0.png"
date: 2024-05-27 13:03
ogImage:
  url: /assets/img/2024-05-27-HowSnowflakebuildingthemostpowerfulSQLLLMintheworld_0.png
tag: Tech
originalTitle: "How Snowflake building the most powerful SQL LLM in the world"
link: "https://medium.com/wrenai/what-we-learned-from-snowflake-copilot-building-the-most-powerful-sql-llm-in-the-world-52f82d661bc1"
---

AI가 데이터 민주화를 위한 새로운 기회를 만들어냈습니다. SQL을 필요로 하지 않고 언어 모델 이해력의 힘을 이용하여 통찰력을 얻는 것으로 많은 사용자가 현재 대량의 데이터에 감춰진 가치 있는 통찰을 발견할 수 있게 되었습니다.

지난 달, Snowflake의 공학 부사장인 Vivek Raghunathan이 Fully Connected 컨퍼런스에서 혁신적인 Snowflake Copilot에 대해 이야기했습니다. 이 비디오는 지난 주 YouTube에서 공개되었습니다. WrenAI 팀은 몇 달 동안 텍스트를 SQL로 변환하는 작업을 진행해왔고, 우리는 Vivek이 최근에 공유한 SQL LLM 주제에 대한 생각과 기술을 많이 배웠습니다. 오늘, 이 비디오에서 얻은 생각과 교훈을 정리하고자 합니다. 이것이 다른 개발자들이 텍스트를 SQL로 더 빨리 혁신할 수 있도록 도움이 되기를 바랍니다!

만약 전체 비디오에 관심이 있다면, 아래 링크를 확인해보세요!

자, 시작해봅시다!

<div class="content-ad"></div>

# 데이터 분석에서 인공지능의 현재와 미래

Vivek은 데이터 분석에서 인공지능의 현재와 미래에 대해 이야기했습니다.

## 현재: 당신을 돕는 인공지능

- 분석가를 위한 대화형 도우미
- 자연어를 SQL로 전환: 분석가가 SQL을 실행
- 인터페이스를 통해 반복적인 데이터 및 스키마 발견

<div class="content-ad"></div>

하지만 미래에는 비즈니스 사용자들을 위한 완전한 대화형 기사로 발전할 것입니다. SQL을 모르는 사람들도 자연어로 질문하고 답변을 받을 수 있어서 더 많은 개인들이 능력을 얻을 것입니다.

## 미래: 의존할 수 있는 AI

- 비즈니스 사용자들을 위한 대화형 기사
- 답변을 위한 자연어: SQL 전문 지식 불필요
- 상호작용 가능한 데이터 및 시각화를 허용하는 인터페이스

## 우리의 생각:

<div class="content-ad"></div>

WrenAI를 개발하면서도 이를 경험했습니다. 현재 기술 혁신의 한계로 모든 비즈니스 사용자를 대상으로 한 완전한 AI 팔로우업 서비스를 제공하는 것은 여전히 제한적인 면이 있습니다. 이는 자율 주행 자동차에서 경험하는 것과 비슷합니다. 수년 동안 자동차 제조사들은 운전자와 동행하는 자율 주행 시스템을 출시해왔습니다. 자율 주행 기능을 통해 고객과 운전자 경험이 전환되는 것을 확인할 때까지는 여전히 데이터 분석가들의 도움이 필요할 것입니다.

# 현실 세계에서 Text-to-SQL은 그리 간단한가요?

Vivek는 Text-to-SQL이 마치 빙산 문제와 같다고 언급했습니다. 문제는 표면상 간단해 보이지만 실제로는 매우 복잡하다고합니다.

대화 중 인용문:

<div class="content-ad"></div>

그의 강연에서 언급된 몇 가지 분명한 도전 과제들은 빠르게 직면하게 될 것입니다:

- 현실 세계는 지저분한 스키마와 데이터를 가지고 있으며, 종종 수만 개의 테이블과 수십만 개의 열이 포함된 데이터베이스가 있습니다.
- 현실 세계의 의미론은 더 복잡합니다: rev1, rev2 및 rev3로 레이블이 지정된 열을 가진 테이블이 있을 수 있지만, 수익 열은 무엇인가요? 미국 달러인가요, 아니면 현지 통화입니까? 몇 주 전에 전송된 이메일에서 폐기되었나요? 이 중 어느 것이 현재 진실의 근원인가요?
- 테이블 간에는 올바르게 결합할 수 있는 여러 가지 방법이 있어 더욱 복잡해집니다.

## 저희의 생각

정말 간단한 문제가 아니네요!

<div class="content-ad"></div>

WrenAI는 데이터와 의미 사이의 도전을 해결하는 데 주안점을 둡니다; 텍스트에서 SQL로 신뢰할 수 있는 변환을 만들기 위한 핵심은 기존 데이터 구조의 위에 의미 아키텍처에 대응하는 신뢰할 수 있는 의미 엔진을 구축하는 방법입니다. 실제로, 의미 관계, 계산, 집계를 정의하는 것과 같이, LLMs는 서로 다른 시나리오에서 서로 다른 문맥을 다루는 방법을 배워야 합니다. 이는 견고한 의미적 계층에 많이 의존합니다.

# Snowflake 실험 v0부터 v4까지

Snowflake는 v0부터 v4까지 여러 번의 실험을 거쳤습니다. 다행히도 Vivek은 개선된 텍스트에서 SQL로의 혁신을 위해 다음 버전에서 시도하고 배운 내용을 너그럽게 공유했습니다.

자세히 알아봅시다!

<div class="content-ad"></div>

# V0: Optimized for Spider

대화에서 Vivek은 말했습니다:

## 처음으로 직면한 빙산 (도전):

V0 버전에서는, 최상의 모델을 사용하여 스파이더 데이터셋을 사용하여 82%의 결과를 달성하였지만, 최적화되지 않은 Zero-shot GPT-4는 74%의 결과를 가져왔습니다. 그러나 실제 세계 데이터에서는, 최상의 모델을 사용하여 정확도가 9%로 떨어지고, prompt-optimized된 GPT-4를 사용하면 14%의 결과를 얻었습니다.

<div class="content-ad"></div>

그들이 중요성을 깨닫기 시작한 때입니다. "의미론적 카탈로그"는 의미론이 데이터 검색에 엄청 중요하다는 것을, 사전 훈련된 LLMs가 귀하의 비즈니스 콘텍스트에 대해 아무것도 모르기 때문에 유일한 방법은 RAG를 통해 의미론을 제공하는 것입니다.

## 우리의 생각:

의미론은 텍스트에서 SQL로의 전환 도전을 해결하는 데 핵심적이며, WrenAI를 구현하기 시작할 때 중심적인 핵심 설계입니다.

# V1: 실세계에서 검색이 중요합니다

<div class="content-ad"></div>

V1 버전에서는 Snowflake 팀이 고민하며 시작했습니다. 웹 품질의 검색을 기업 메타데이터 검색에 적용하고 그 결과를 LLM(언어 모델)에 공급한다면 성능이 혁신적으로 향상될 수 있다는 아이디어가 나왔죠.

다시 말해, 이 LLM에 어떤 내용을 포함해야 할지라는 더 단순한 문제를 해결하기 위해 보다 어려운 문제를 먼저 해결하려고 합니다.

아래는 결과인데, Snowflake의 최고 모델은 9%에서 24%로 개선되었고, GPT-4 버전도 14%에서 28%로 성장했습니다. 따라서 의미론적 카탈로그 검색이 중요하다는 직관이 옳다는 것이 입증되었습니다.

![Snowflake](/assets/img/2024-05-27-HowSnowflakebuildingthemostpowerfulSQLLLMintheworld_0.png)

<div class="content-ad"></div>

Vivek 씨가 말했던 것처럼, Snowflake에서 대화 카탈로그 검색 결과를 어떻게 검색하는지 설명했어요.

## 그들이 직면한 두 번째 어려움(도전):

Snowflake 팀이 직면한 다른 어려움은 레이터입니다. 모든 것을 수작업으로 다시 주석을 다는 작업을 했고, 성능을 평가하기 위해 더 복잡한 예제를 추가했으며, 단일 테이블 대 복수 테이블 및 간단한 조인 대 복잡한 조인과 같은 데이터 의미론에 기반하여 슬라이스를 나눴다.

아래에는 Vivek가 그의 발표에서 공유한 내용이 있습니다:

<div class="content-ad"></div>

## 우리의 생각:

이 통찰은 우리에게 흥미로워 보입니다. WrenAI를 구현할 때 검색 최적화를 많이 하지 않았습니다. 현재는 벡터 저장소에서 Top-N 선택만 사용합니다. 검색 기술의 더 자세한 세부 사항을 살펴보고, 이 영역을 개선하기 위한 작업을 진행 중입니다.

우리 팀은 또한 내부 검증 데이터 세트를 구축하고 있습니다. 이 데이터 세트는 단일 및 다중 테이블, 그리고 단순 및 복잡한 조인 데이터 세트를 포함하여 보다 복잡한 시나리오를 갖도록 설계되어 있습니다. 이로써 솔루션이 실제 세계에서 정확하게 유지되도록 합니다.

이 주제에 대한 토론을 위한 새로운 이슈를 오픈해 주시면 환영입니다! 우리 팀은 더 많은 개선사항을 살펴보기를 원합니다!

<div class="content-ad"></div>

# V2: Text2SQL 모델링 통찰

다음으로, Vivek은 이러한 발전에도 불구하고 모델이 대화 능력에서 여전히 어려움을 겪고 있다고 공유했습니다. SQL 작업을 최적화했지만 대화를 처리하고 지시를 따르는 것에 어려움이 있었다고 합니다.

아래는 그들이 공유한 몇 가지 통찰입니다:

- 더 나은 기본 LLMs: 코드 LLMs가 SQL 작업에서 아주 잘 수행된다는 것이 밝혀졌습니다.
- 더 나은 신호: 몇 가지는 LLM 생성에서 나오며, 예를 들어 주석 등이 있습니다. 일부는 스노우플레이크 문서 등의 고전적인 기술에서 얻어집니다. 그 중 하나는 쿼리 이력인데, 실제 사람들이 실제로 하는 작업에 관한 보물창고입니다.
- 사고의 연결: 처음에는 테이블을 선택하고, 그 다음에 조인하고, 그 다음에 열을 선택하고, 그리고 마지막으로 디코드 시에 정확성을 확인합니다. LLM이 JSON을 생성할 때는 출력이 스키마와 일치하는지 확인하는 의존성 파서가 있습니다.

<div class="content-ad"></div>

이 새로운 깔끔한 평가를 통해 상당한 개선을 확인했습니다. 기본 모델 27%가 39%가 되었고, GPT-4를 사용한 경우 40%가 46%로 상승했습니다.

## 그들이 마주한 세 번째 빙하(도전):

다음 도전 과제는 제로 샷 텍스트 - SQL 솔루션 대신 대화형 공동 조종사를 구축하는 것입니다. 대화를 처리하고 분석가들이 쿼리를 점진적으로 개선할 수 있도록 해야 합니다.

시스템의 한 부분을 최적화하면 전체 시스템이 의도치 않게 최적화되지 않을 수 있습니다. 두 가지 큰 문제가 발생했습니다:

<div class="content-ad"></div>

- 모델은 지시에 따라 더 이상 우수하지 않았습니다. 왜냐하면 텍스트-SQL 작업만을 보았기 때문입니다.
- 이는 대화에서 메모리가 떨어졌습니다. 여러 턴의 경우가 아닌, 제로샷 사례만을 경험했기 때문입니다.

## 저희의 생각

이 강의에서 언급한 텍스트-SQL 도전 과제는 제로샷 방식이 아닌 상호작용적인 접근이 필요합니다. WrenAI에서도 이러한 접근을 추구하고 있으며, 지속적으로 개선하고 있는 몇 가지 경험을 진행 중에 있습니다.

우리의 구현을 통해 "증강 및 생성" RAG 파이프라인에서 검증, 수정 및 명확화 다이얼로그와 같은 정교한 프로세스를 구현했습니다. 이를 통해 LLMs가 사용자의 의도를 완전히 이해할 수 있도록 지원하고 있습니다. 물론, 계속해서 개선할 부분이 많이 남아 있습니다.

<div class="content-ad"></div>


![Snowflake](/assets/img/2024-05-27-HowSnowflakebuildingthemostpowerfulSQLLLMintheworld_1.png)

## V3: 지시 따르기, 도구 사용

Vivek은 텍스트를 SQL로 바꾸는 작업과 더 일반적인 지시 따르기 작업을 섞어 LLM을 지시 따르도록 다시 교육했다. 그리고 이를 Multi-LLM 설정에 오케스트레이터 LLM으로 계층화했다.

오케스트레이터 모델의 책임은 고객과 대화하는 것입니다. 이는 주체적인 방식과 유사합니다. SQL을 작성해야 할 때마다 다른 크기의 텍스트를 SQL 모델을 사용하도록 허용했습니다. 지능적으로 작업을 위임하는 이 방법은 많은 문제를 해결해 주었습니다.


<div class="content-ad"></div>

그리고 숫자들은 더욱 향상되었어요. 최고 모델은 이제 추가된 지시 따르기 능력으로 38%에서 41%로 상승했고, GPT-4 플러스 최적화를 통해 46%의 평가도달을 이루었어요.

### 그들이 직면한 네 번째 얼음산 (도전):

46.4%에서 99%로 나아가면, 텍스트-투-SQL의 목표는 SQL을 모르는 비즈니스 사용자를 위한 대화형 조종사를 구축하는 것이에요. 이것이 기회이며, 그들은 99%의 정확도가 필요해요.

### 우리의 생각

<div class="content-ad"></div>

WrenAI에서는 텍스트-SQL의 미래에 대해 낙관적입니다. 우리는 LLM 혁신이 숨막히게 빠르게 진행되고 있어 곧 LLM이 의미적 맥락을 통해 인간 수준의 이해력에 가깝게 발전하여 이상적인 데이터 민주화 세계를 이룰 것이라 믿습니다.

# V4: 정확도 99%로 향상

이제 스노우플레이크에서 진행 중입니다! 고객이 제공한 의미적 맥락을 활용하여 메트릭 및 조인 경로 등을 이해합니다.

## 우리의 생각

<div class="content-ad"></div>

눈송이에서 더 많은 정보 공유를 기대하고 있어요! 정말 흥미로워요!

# 모든 수업의 최종 결론

마지막으로, Vivek이 모든 도전을 경험하고 얻은 주요 교훈과 배운 점을 아래에 정리했어요.

- 👏 제품은 전체 e2e 시스템입니다: LLM 모델링뿐만 아니라요
- 👏 의미 체계 카탈로그 검색은 중요합니다: 실제 LLM 검색 엔진으로 강화하기
- 👏 SQL 주석 품질이 중요합니다: 주석 처리 담당자는 전문가여야 해요
- 👏 대화형 SQL은 LLM의 불사조 문제입니다: 복잡한 명령어 튜닝, 사고 과정 연결, 도구 사용
- 👏 99%까지 가려면 돌파구가 필요합니다

<div class="content-ad"></div>

그게 다에요! Vivek 씨와 Snowflake 팀이 이번 토롤에서 많은 귀중한 교훈을 나눠 주셨어요. 당신으로부터 많은 것을 배웠습니다!

앞으로도 기대됩니다!

WrenAI를 확인해보지 않았다면, 방문해보세요!

👉 GitHub: https://github.com/Canner/WrenAI

<div class="content-ad"></div>

👉 X: [https://twitter.com/getwrenai](https://twitter.com/getwrenai)

👉 Medium: [https://blog.getwren.ai/](https://blog.getwren.ai/)

이 글을 즐겨 보셨다면 깃헙에서 ⭐ WrenAI에 스타를 주시는 걸 잊지 마세요 ⭐ 언제나 독자 여러분 감사합니다.
