---
title: "undefined"
description: ""
coverImage: "/assets/img/undefined_0.png"
date: 2024-06-19 05:11
ogImage: 
  url: /assets/img/undefined_0.png
tag: Tech
originalTitle: "undefined"
link: "https://medium.com/@suryateja.icai/the-journey-of-migrating-from-interactive-clusters-to-job-clusters-for-cost-savings-and-its-9993deb854d0"
---


<img src="/assets/img/undefined_0.png" />

우리의 데이터 처리 세계에서는 Azure Data Factory (ADF) 파이프라인에서 Databricks 노트북을 실행하는 환경에서 비용을 관리하는 것이 중요합니다. 성능을 유지하면서 비용을 줄이기 위해 대화식 클러스터에서 작업 클러스터로 마이그레이션하기로 결정했습니다. 이 과정에서 우리가 관찰하고 배운 내용을 공유하려고 합니다.

세팅

우리의 데이터 처리에는 두 가지 유형의 실행 프로세스가 포함되어 있었습니다:
1. 병렬 실행: ADF에서 동시에 트리거된 여러 노트북.
2. 순차 실행: 종속성으로 인해 특정한 순서로 트리거된 노트북들이 서로 뒤이어 실행됩니다.

<div class="content-ad"></div>

최초 계획

병렬 실행:
- 이전 방법: 대화식 클러스터 사용.
- 새 방법: 작업 클러스터로 전환.
- 이유: 각 작업 클러스터의 실행 시간이 모든 노트북이 동시에 트리거되기 때문에 동일했습니다.

순차 실행:
- 이전 방법: 대화식 클러스터 사용.
- 새 방법: 작업 클러스터 사용 시도 중.
- 도전: 각 작업 클러스터의 실행 시간이 누적되며, 노트북 세트마다 약 세 분이 추가됩니다. 십 개 세트가 있으면 이 과정에 추가로 30분이 소요되므로 순차 실행에 대해서는 계속 대화식 클러스터를 사용했습니다.

스핀 업 시간을 줄이기 위해 컴퓨팅 풀 사용을 고려했지만, 이는 비용 절감이라는 주요 목표와 부합하지 않았습니다.

<div class="content-ad"></div>

이주 작업

우선, 동일한 구성을 가진 인터랙티브 클러스터 5개가 있었습니다. 비용 효율성을 위해:
- 병렬 실행을 작업 클러스터로 옮겼습니다.
- 순차적 실행을 위해 인터랙티브 클러스터 3개를 해체하여 2개만 남겼습니다.

우리 클러스터 구성:
- 노드 유형: Standard_DS32_v3
- 워커 노드: 2에서 20으로 자동 확장

작업 클러스터에도 동일한 구성을 사용했습니다.

<div class="content-ad"></div>

예상치 못한 결과

첫 달에는 비용이 감소할 것으로 예상했지만, 뜻밖에도 비용이 40% 증가했습니다.

비용 분석:
- 이전 이주 후: 대화식 클러스터 월 비용 $26,000
- 이주 후:
  - 대화식 클러스터: 월 $16,000
  - 작업 클러스터: 월 $18,000
  - 총합: 월 $34,000

해결책

<div class="content-ad"></div>

비용 증가를 인식하여, 저희는 작업 클러스터를 재구성했습니다:
1. Standard_DS16_v3:
   - 결과: 작업 완료에 소요되는 시간은 동일했습니다.
   - 비용: 월 $12,000으로 감소했습니다.

2. Standard_DS8_v3:
   - 결과: 작업이 추가 10분 소요되었습니다.
   - 비용: 더욱 감소하였으며, 효율적인 작업 완료 시간을 유지했습니다.

이 조정으로 성능을 희생하지 않고 비용을 크게 줄일 수 있었습니다.

맺음말

<div class="content-ad"></div>

우리의 대화형 클러스터에서 작업 클러스터로의 여정은 예상치 못한 변화로 가득찼어요. 처음에는 비용이 증가했지만, 작업 클러스터를 재구성함으로써 상당한 절약을 이뤄 냈어요. 우리의 경험은 성능과 비용을 최적화하기 위해 지속적으로 모니터링하고 구성을 조정하는 중요성을 강조합니다.

다음 기사에서는 클러스터 구성을 변경해도 작업을 완료하는 데 걸리는 시간이 거의 변하지 않은 이유에 대해 자세히 다뤄볼 거에요.

참고: 여기서 언급된 비용은 대략적인 수치이며 설명 용도로 사용되었습니다.

더 많은 통찰력을 기대해주세요!